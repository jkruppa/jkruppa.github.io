```{r echo = FALSE}
pacman::p_load(tidyverse, readxl, knitr, kableExtra, Hmisc)
```

# Pre-Tests oder Vortest

![](images/caution.png){fig-align="center" width="50%"}

@sec-lin-reg-quality

## Genutzte R Pakete für das Kapitel

Wir wollen folgende R Pakete in diesem Kapitel nutzen.

```{r echo = TRUE}
#| message: false
pacman::p_load(tidyverse, magrittr, conflicted,
               broom, car, performance, see)
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("mutate", "dplyr")
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", 
                "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

## Pre-Test auf Varianzhomogenität

```{r}

data_tbl <- tibble(A = rnorm(10, 5, 2),
                   B = rnorm(10, 5, 2)) %>% 
  gather(trt, rsp) %>% 
  mutate(trt = as_factor(trt))

leveneTest(rsp ~ trt, data = data_tbl) %>% tidy

bartlett.test(rsp ~ trt, data = data_tbl) %>% tidy


```

## Varianzen sind homogen, Fallzahl niedrig

```{r}
small_homo_tbl <- tibble(A = rnorm(10, 10, 5),
                         B = rnorm(10, 10, 5)) %>% 
  gather(trt, rsp) %>% 
  mutate(trt = as_factor(trt))
```

```{r}
ggplot(small_homo_tbl, aes(trt, rsp, fill = trt)) +
  theme_bw() +
  geom_boxplot() +
  scale_fill_okabeito() +
  theme(legend.position = "none")
```

```{r}
leveneTest(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)

bartlett.test(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)
```

## Varianzen sind heterogen, Fallzahl niedrig

```{r}
small_homo_tbl <- tibble(A = rnorm(10, 10, 10),
                         B = rnorm(10, 10, 5)) %>% 
  gather(trt, rsp) %>% 
  mutate(trt = as_factor(trt))
```

```{r}
ggplot(small_homo_tbl, aes(trt, rsp, fill = trt)) +
  theme_bw() +
  geom_boxplot() +
  scale_fill_okabeito() +
  theme(legend.position = "none")
```

```{r}
leveneTest(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)

bartlett.test(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)
```

## Varianzen sind homogen, Fallzahl hoch

```{r}
small_homo_tbl <- tibble(A = rnorm(100, 10, 5),
                         B = rnorm(100, 10, 5)) %>% 
  gather(trt, rsp) %>% 
  mutate(trt = as_factor(trt))
```

```{r}
ggplot(small_homo_tbl, aes(trt, rsp, fill = trt)) +
  theme_bw() +
  geom_boxplot() +
  scale_fill_okabeito() +
  theme(legend.position = "none")
```

```{r}
leveneTest(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)

bartlett.test(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)
```

## Varianzen sind heterogen, Fallzahl hoch

```{r}
small_homo_tbl <- tibble(A = rnorm(100, 10, 10),
                         B = rnorm(100, 10, 5)) %>% 
  gather(trt, rsp) %>% 
  mutate(trt = as_factor(trt))
```

```{r}
ggplot(small_homo_tbl, aes(trt, rsp, fill = trt)) +
  theme_bw() +
  geom_boxplot() +
  scale_fill_okabeito() +
  theme(legend.position = "none")
```

```{r}
leveneTest(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)

bartlett.test(rsp ~ trt, data = small_homo_tbl) %>% tidy %>% select(p.value)
```

### Package `performance`

```{r}
lm(rsp ~ trt, data = data_tbl) %>% check_model(check = "homogeneity")

```

```{r}
lm(rsp ~ trt, data = data_tbl) %>% check_homogeneity()

```

## Pre-Test auf Normalverteilung

### Package `performance`

```{r}



lm(rsp ~ trt, data = data_tbl) %>% check_model(check = "normality")


lm(rsp ~ trt, data = data_tbl) %>% check_normality()


```

### Visuelle Überprüfung

```{r}
#| echo: true
#| message: false
#| label: fig-pretest-qual-qq-1
#| fig-align: center
#| fig-height: 4
#| fig-width: 4
#| fig-cap: "QQ-Plot der Sprungweite in \\[cm\\]. Die Gerade geht einmal durch die Mitte der Punkte und die Punkte liegen nicht exakt auf der Geraden. Eine leichte Abweichung von der Normalverteilung könnte vorliegen."

ggplot(data_tbl, aes(sample = rsp)) + 
  stat_qq() + 
  stat_qq_line(color = "red") +
  theme_bw()
```

```{r}
#| echo: true
#| message: false
#| label: fig-pretest-qual-qq-2
#| fig-align: center
#| fig-height: 4
#| fig-width: 4
#| fig-cap: "QQ-Plot der Sprungweite in \\[cm\\]. Die Gerade geht einmal durch die Mitte der Punkte und die Punkte liegen nicht exakt auf der Geraden. Eine leichte Abweichung von der Normalverteilung könnte vorliegen."

ggplot(data_tbl, aes(sample = rsp, color = trt)) + 
  stat_qq() + 
  stat_qq_line() +
  theme_bw()
```
