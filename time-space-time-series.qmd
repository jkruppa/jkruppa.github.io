```{r echo = FALSE}
pacman::p_load(tidyverse, readxl, knitr, kableExtra, openxlsx)
```

# Zeitreihen (eng. *time series*) {#sec-time-series}

*Letzte Änderung am `r format(fs::file_info("example-preface.qmd")$modification_time, '%d. %B %Y um %H:%M:%S')`*

> *"Die Vergangenheit ist geschrieben, aber die Zukunft ist noch nicht in Stein gemeißelt" --- Jean-Luc Picard, Star Trek: The Next Generation*

![](images/caution.png){fig-align="center" width="50%"}

In diesem Kapitel wollen wir uns mit Zeitreihen (eng. *time series*) beschäftigen. Was ja auch irgendwie zu erwarten war. Wir haben ganz einfach auf der x-Achse einer potenziellen Visualisierung die Zeit dargestellt. Wir wollen dann analysieren, ob es über den zeitlichen Verlauf einen Trend gibt oder wir ein gutes Modell für den Verlauf der Beobachtungen anpassen können. Dabei haben wir dann aber meistens nicht einen super simplen Verlauf, sondern Spitzen oder Täler in den Daten, so dass wir hier die Daten entsprechend glätten (eng. *to smooth*) müssen.

Wenn du noch mehr lesen willst, dann kann ich dir folgende Literatur empfehlen. @robert2006time liefert eine gute Übersicht über die Anwendung in R, ist aber schon etwas älter. Das Gleiche gilt dann auch für das Buch von @chan2008time und @cowpertwait2009introductory. Dennoch bilden alle drei Bücher die Grundlagen der Analysen von zeitreihen super ab. Für eine Abschlussarbeit sollten die Quellen also allemal reichen.

## Genutzte R Pakete

Wir wollen folgende R Pakete in diesem Kapitel nutzen.

```{r echo = TRUE}
#| message: false
pacman::p_load(tidyverse, magrittr, janitor, conflicted)
```

Am Ende des Kapitels findest du nochmal den gesamten R Code in einem Rutsch zum selber durchführen oder aber kopieren.

## Daten

In diesem Kapitel nutzen wir

```{r}
#| message: false
#| warning: false

csh_tbl <- read_excel("data/csh_data.xlsx") %>% 
  clean_names() %>% 
  mutate_if(is.numeric, round, 2)
```

`r nrow(csh_tbl)`

@tbl-time-csh

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-time-csh
#| tbl-cap: "Auszug"

rbind(head(csh_tbl, n = 4),
      rep("...", times = ncol(csh_tbl)),
      tail(csh_tbl, n = 4)) %>% 
  kable(align = "c", "pipe")
```

Nächster Datensatz

```{r}
#| message: false
#| warning: false

temp_tbl <- read_excel("data/temperatur_salad.xlsx") %>% 
  clean_names() %>% 
  mutate_if(is.numeric, round, 2)
```

`r nrow(temp_tbl)`

@tbl-time-temp

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-time-temp
#| tbl-cap: "Auszug"
#| column: page

raw_temp_tbl <- temp_tbl %>% 
  mutate_all(as.character)

rbind(head(raw_temp_tbl , n = 4),
      rep("...", times = ncol(raw_temp_tbl)),
      tail(raw_temp_tbl, n = 4)) %>% 
  kable(align = "c", "pipe")
```

```{r}
#| eval: false
time_long_tbl <- time_tbl %>% 
  mutate(uhrzeit = format(uhrzeit, format = "%H:%M:%S"),
         datum = format(datum, format = "%Y-%m-%d"),
         datum = ymd(datum) + hms(uhrzeit)) %>% 
  pivot_longer(x2_messw:last_col(),
               names_sep = "_",
               names_to = c("wdh", "type"),
               values_to = "temp") %>% 
  mutate(wdh = str_replace(wdh, "^x", ""))
```

Nächster Datensatz

```{r}
#| message: false
#| warning: false

station_tbl <- read_excel("data/Wetterstation_Hagebüchen.xlsx") %>% 
  clean_names() %>% 
  mutate_if(is.numeric, round, 2)
```

`r nrow(station_tbl)`

@tbl-time-station

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-time-station
#| tbl-cap: "Auszug"
#| column: page

raw_station_tbl <- station_tbl %>% 
  mutate_all(as.character)

rbind(head(raw_station_tbl , n = 4),
      rep("...", times = ncol(raw_station_tbl)),
      tail(raw_station_tbl, n = 4)) %>% 
  kable(align = "c", "pipe")
```

## Links

[Welcome to a Little Book of R for Time Series!](https://a-little-book-of-r-for-time-series.readthedocs.io/en/latest/)

[14 Time Series Analysis](https://rc2e.com/timeseriesanalysis)

https://r-statistics.co/Time-Series-Analysis-With-R.html

https://www.r-bloggers.com/2021/04/timeseries-analysis-in-r/

[timetk for R](https://business-science.github.io/timetk/)

[Analysing Time Series Data -- Modelling, Forecasting And Data Formatting In R](https://ourcodingclub.github.io/tutorials/time/)

## Referenzen {.unnumbered}
