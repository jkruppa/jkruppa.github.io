<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Ein Kochbuch mit Rezepten aus der Bio Data Science, Biostatistik, Biometrie und Statistik zum selber nachkochen!">

<title>26&nbsp; Fortgeschrittene Designs – Bio Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./experimental-design-samplesize.html" rel="next">
<link href="./experimental-design-basic.html" rel="prev">
<link href="./cover2024_favi.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-05fe91a66cf75bbbb8c9664867fe5124.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-05a8b96638736df272eeeeef67138371.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script>
<meta name="mermaid-theme" content="neutral">
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="26&nbsp; Fortgeschrittene Designs – Bio Data Science">
<meta property="og:description" content="Ein Kochbuch mit Rezepten der Bio Data Science, Biostatistik, Biometrie und Statistik">
<meta property="og:image" content="https://github.com/jkruppa/jkruppa.github.io/raw/master/cover2024.png">
<meta property="og:site_name" content="Bio Data Science">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./experimental-design-preface.html">Experimentelle Designs</a></li><li class="breadcrumb-item"><a href="./experimental-design-advanced.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fortgeschrittene Designs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bio Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jkruppa/jkruppa.github.io/" title="Quellcode" class="quarto-navigation-tool px-1" aria-label="Quellcode"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Willkommen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./organisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Organisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./literature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bibliothek</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forschungsprozess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Forschungsprozess</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./abschlussarbeit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Abschlussarbeit</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./example-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datenbeispiele</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-fleas-dogs-cats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Von Flöhen auf Tieren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-gummi-bears.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Von Gummibärchen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-complex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Von komplexeren Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Von Datenbanken</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./programing-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programmieren in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-letters-numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Daten in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Operatoren, Funktionen und Pakete</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Daten einlesen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Daten bearbeiten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Reguläre Ausdrücke</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-purrr-furrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ein <code>purrr</code> Cookbook</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-quarto-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Quarto und Shiny App</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./eda-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explorative Datenanalyse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Deskriptive Statistik</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Visualisierung von Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Verteilung von Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Transformieren von Daten</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-tests-preface-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testen von Hypothesen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Die Testentscheidung</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-theorie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Die Testtheorie</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Der Effektschätzer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-pretest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Der Pre-Test oder Vortest</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./experimental-design-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experimentelle Designs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Versuchsplanung in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Einfache Designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-advanced.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fortgeschrittene Designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-samplesize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Fallzahlplanung</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-tests-preface-app.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistische Gruppenvergleiche</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Testen in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-ttest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Der t-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Die ANOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Die ANCOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-utest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Der Wilcoxon-Mann-Whitney-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-kruskal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Der Kruskal-Wallis-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-friedman.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Der Friedman Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-chi-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Der <span class="math inline">\(\mathcal{X}^2\)</span>-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-anteil-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Der Anteilstest</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-diagnostic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Der diagnostische Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-trendtest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Der Trendtest</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-permutationstest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Der Permutationstest</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-posthoc2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Der Post-hoc Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-linear-reg-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grundlagen des Modellierens</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-linear-reg-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Simple lineare Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Multiple lineare Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-linear-reg-quality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Modelgüte</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-linear-reg-corr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Korrelation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-outlier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Ausreißer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-variable-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Variablenselektion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-missing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Fehlende Werte</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-sensitivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Sensitivitätsanalyse</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-modeling-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistisches Modellieren</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Modellieren in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-gaussian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Gaussian Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-beta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Beta Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-multinom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">Multinomiale / Ordinale Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">Logistische Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-prob-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">Linear Probability Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-mixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">Lineare gemischte Modelle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-gee.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">Generalized Estimating Equations (GEE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-non-linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Nicht lineare Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-robust-quantile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">Robuste und Quantilesregression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">60</span>&nbsp; <span class="chapter-title">Überlebenszeitanalysen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-noninferiority.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">61</span>&nbsp; <span class="chapter-title">Äquivalenz oder Nichtunterlegenheit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-meta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">62</span>&nbsp; <span class="chapter-title">Metaanalysen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">63</span>&nbsp; <span class="chapter-title">Clusteranalysen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">64</span>&nbsp; <span class="chapter-title">Multivariate Verfahren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">65</span>&nbsp; <span class="chapter-title">Fragebogenanalyse</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./time-space-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Zeitliche und räumliche Analysen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-space-pseudo-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">66</span>&nbsp; <span class="chapter-title">Pseudo Zeitreihen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-space-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">67</span>&nbsp; <span class="chapter-title">Zeitreihen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-space-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">68</span>&nbsp; <span class="chapter-title">Räumliche Daten</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./classification-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Klassifikation oder maschinelles Lernen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">69</span>&nbsp; <span class="chapter-title">Grundlagen der Klassifikation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">70</span>&nbsp; <span class="chapter-title">Data splitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-pre-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">71</span>&nbsp; <span class="chapter-title">Data preprocessing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-model-compare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">72</span>&nbsp; <span class="chapter-title">Vergleich von Algorithmen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">73</span>&nbsp; <span class="chapter-title"><span class="math inline">\(k\)</span> nearest neighbor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-randomforest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">74</span>&nbsp; <span class="chapter-title">Decision trees</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">75</span>&nbsp; <span class="chapter-title">Support vector machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-neural-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">76</span>&nbsp; <span class="chapter-title">Neural networks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./abspann.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abspann</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-spielecke.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">77</span>&nbsp; <span class="chapter-title">Spielecke</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-anova2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">78</span>&nbsp; <span class="chapter-title">Die ANOVA</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
  <li><a href="#genutzte-r-pakete" id="toc-genutzte-r-pakete" class="nav-link active" data-scroll-target="#genutzte-r-pakete"><span class="header-section-number">26.1</span> Genutzte R Pakete</a></li>
  <li><a href="#sec-rcbd-3fac" id="toc-sec-rcbd-3fac" class="nav-link" data-scroll-target="#sec-rcbd-3fac"><span class="header-section-number">26.2</span> Randomized complete block design (RCBD, 3-faktoriell)</a>
  <ul class="collapse">
  <li><a href="#mit-expand_grid" id="toc-mit-expand_grid" class="nav-link" data-scroll-target="#mit-expand_grid"><span class="header-section-number">26.2.1</span> … mit <code>expand_grid()</code></a></li>
  <li><a href="#mit-fieldhub" id="toc-mit-fieldhub" class="nav-link" data-scroll-target="#mit-fieldhub"><span class="header-section-number">26.2.2</span> … mit <code>{FielDHub}</code></a></li>
  <li><a href="#mit-agricolae" id="toc-mit-agricolae" class="nav-link" data-scroll-target="#mit-agricolae"><span class="header-section-number">26.2.3</span> … mit <code>{agricolae}</code></a></li>
  </ul></li>
  <li><a href="#sec-split" id="toc-sec-split" class="nav-link" data-scroll-target="#sec-split"><span class="header-section-number">26.3</span> Split plot design (3-faktoriell)</a>
  <ul class="collapse">
  <li><a href="#mit-expand_grid-1" id="toc-mit-expand_grid-1" class="nav-link" data-scroll-target="#mit-expand_grid-1"><span class="header-section-number">26.3.1</span> … mit <code>expand_grid()</code></a></li>
  <li><a href="#mit-fieldhub-1" id="toc-mit-fieldhub-1" class="nav-link" data-scroll-target="#mit-fieldhub-1"><span class="header-section-number">26.3.2</span> … mit <code>{FielDHub}</code></a></li>
  <li><a href="#mit-agricolae-1" id="toc-mit-agricolae-1" class="nav-link" data-scroll-target="#mit-agricolae-1"><span class="header-section-number">26.3.3</span> … mit <code>{agricolae}</code></a></li>
  <li><a href="#mit-dae" id="toc-mit-dae" class="nav-link" data-scroll-target="#mit-dae"><span class="header-section-number">26.3.4</span> … mit <code>{dae}</code></a></li>
  </ul></li>
  <li><a href="#sec-subsampling" id="toc-sec-subsampling" class="nav-link" data-scroll-target="#sec-subsampling"><span class="header-section-number">26.4</span> Subsampling</a></li>
  <li><a href="#sec-incomplete" id="toc-sec-incomplete" class="nav-link" data-scroll-target="#sec-incomplete"><span class="header-section-number">26.5</span> Incomplete block design</a>
  <ul class="collapse">
  <li><a href="#mit-expand_grid-3-faktoriell" id="toc-mit-expand_grid-3-faktoriell" class="nav-link" data-scroll-target="#mit-expand_grid-3-faktoriell"><span class="header-section-number">26.5.1</span> … mit <code>expand_grid()</code> (3-faktoriell)</a></li>
  <li><a href="#mit-fieldhub-2" id="toc-mit-fieldhub-2" class="nav-link" data-scroll-target="#mit-fieldhub-2"><span class="header-section-number">26.5.2</span> … mit <code>{FielDHub}</code></a></li>
  <li><a href="#mit-agricolae-2-faktoriell" id="toc-mit-agricolae-2-faktoriell" class="nav-link" data-scroll-target="#mit-agricolae-2-faktoriell"><span class="header-section-number">26.5.3</span> … mit <code>{agricolae}</code> (2-faktoriell)</a></li>
  </ul></li>
  <li><a href="#sec-strip-plot" id="toc-sec-strip-plot" class="nav-link" data-scroll-target="#sec-strip-plot"><span class="header-section-number">26.6</span> Strip plot design (3-faktoriell)</a>
  <ul class="collapse">
  <li><a href="#mit-agricolae-2" id="toc-mit-agricolae-2" class="nav-link" data-scroll-target="#mit-agricolae-2"><span class="header-section-number">26.6.1</span> … mit <code>{agricolae}</code></a></li>
  <li><a href="#mit-fieldhub-3" id="toc-mit-fieldhub-3" class="nav-link" data-scroll-target="#mit-fieldhub-3"><span class="header-section-number">26.6.2</span> … mit <code>{FielDHub}</code></a></li>
  </ul></li>
  <li><a href="#referenzen" id="toc-referenzen" class="nav-link" data-scroll-target="#referenzen">Referenzen</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jkruppa/jkruppa.github.io/edit/master/experimental-design-advanced.qmd" class="toc-action"><i class="bi bi-github"></i>Seite editieren</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Problem melden</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/blob/master/experimental-design-advanced.qmd" class="toc-action"><i class="bi empty"></i>Quellcode anzeigen</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./experimental-design-preface.html">Experimentelle Designs</a></li><li class="breadcrumb-item"><a href="./experimental-design-advanced.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fortgeschrittene Designs</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-experimental-design-advanced" class="quarto-section-identifier"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fortgeschrittene Designs</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Gesamten Code zeigen</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Gesamten Code verbergen</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Quellcode anzeigen</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Letzte Änderung am 21. May 2024 um 18:05:08</em></p>
<blockquote class="blockquote">
<p><em>“The best time to plan an experiment is after you’ve done it.” — Roland Fisher</em></p>
</blockquote>
<p>In diesem Kapitel wollen wir uns mit der Erstellung von komplexeren experimentellen Designs beschäftigen. Wie immer nicht mit der Auswertung, aber ich habe dir Modellierungsvorschläge immer wieder angegeben.</p>
<ul>
<li><a href="#sec-rcbd-3fac">Randomized complete block design (RCBD, 3-faktoriell)</a></li>
<li><a href="#sec-split">Split plot design (3-faktoriell) oder Spaltanlage</a></li>
<li><a href="#sec-subsampling">Subsampling</a></li>
<li><a href="#sec-incomplete">Incomplete block design (3-faktoriell und 2-faktoriell)</a></li>
<li><a href="#sec-strip-plot">Strip plot design (3-faktoriell) oder Streifenanlage</a></li>
</ul>
<p>Dabei ist zu Bedenken, dass diese Designs sehr viel Aufwand in der Anlegen der Anlage sowie der praktischen Auswertung auf dem Feld bedürfen. Hier musst du dich dann nochmal beraten lassen, bevor du mit einem Experiment startest. Wir schauen uns jetzt aber erstmal einen Überblick über die gängigsten komplexeren experimentellen Designs an. Beachte auch die kurze Veröffentlichung über <a href="https://www.dlg.org/de/landwirtschaft/themen/pflanzenbau/pflanzenernaehrung/dlg-kompakt-3-2021">Versuchsergebnisse interpretieren</a> der DLG e.V. - Deutsche Landwirtschafts-Gesellschaft. Dort findest du nochmal mehr Kontext über komplexere experimentelle Designs und Grundsätze für die Interpretation von Versuchsergebnissen, die du natürlich auch auf deine Planungen übertragen kannst. Bevor du die Ergebnisse interpretieren kannst musst du ja eine solide Versuchsplanung durchgeführt haben.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Auf ein Wort zum Umfang des Kapitels
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ich werde mich in diesem Kapitel für das Erste auf die wichtigen experimentellen Design beschränken. Wenn sich aus der Lehre oder Beratungstätigkeit noch Bedarf an weiteren experimentellen Designs ergibt, werde ich die Designs entsprechend ergänzen. Insbesondere hier gilt, dass <a href="https://schmidtpaul.github.io/DSFAIR/DesigningExperiments.html">DSFAIR - Data Science for Agriculture in R</a> einen sehr umfangreichen Überblick über experimentelle Designs und deren Auswertung liefert.</p>
<p><strong>Wenn dir ein experimentelles Design fehlt, dann schreibe mir gerne eine Mail und ich schaue, dass ich das experimentelle Design ergänze.</strong></p>
<p>Mehr Informationen findest du auch durch das Inhaltsverzeichnis von dem R Paket <code>agricolae</code> mit <a href="https://myaseen208.com/agricolae/articles/ExperimentalDesign.html">Experimental Designs with {agricolae}</a>. Auch ist es sehr hilfreich sich Datenbeispiele auf <a href="https://kwstat.github.io/agridat/reference/index.html">{agridat} - Datensätze mit Abbildungen in <code>{desplot}</code></a> anzuschauen. Am meisten hilft vermutlich auch die Referenzliste des <a href="https://didiermurillof.github.io/FielDHub/reference/index.html">R Paketes <code>{FielDHub}</code></a>. Leider sind die generischen Abbildungen in <code>{FielDHub}</code> nicht so toll, wie die Abbildungen, die du dir selber in <code>{desplot}</code> baust.</p>
</div>
</div>
<p>Das charmante an dem neuen R Paket <code>{FielDHub}</code> ist die Verbindung einer Shiny App zusammen mit dem normalen Code, den du hier siehst. Ich habe dir immer die Referenz zu <code>{FielDHub}</code> hinzugefügt, in der ist auch die Anleitung zu finden für die Shiny App. Um <code>{FielDHub}</code> im Browser zu starten, musst du nur folgenden Code in R ausführen, nachdem du das R Paket installiert hast.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FielDHub)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">run_app</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#fig-exp-adv-1" class="quarto-xref">Abbildung&nbsp;<span>26.1</span></a> sehen wir einmal die Übersicht über die drei häufigsten komplexeren experimentellen Designs mit dem RCBD (3-faktoriell), dem Split plot Design (3-faktoriell) sowie dem Subsampling eines RCBD (2-faktoriell). Die drei experimentellen Designs werden immer mal wieder etwas durcheinander gewirbelt. Du kannst dir im Prinzip die Sachlage wie folgt vorstellen. Im RCBD (3-faktoriell) werden die beiden Behandlungsfaktoren über die Blöcke randomsiert. Die beiden Behandlungen sind vollkommen durcheinander in der <a href="#fig-exp-adv-1-1" class="quarto-xref">Abbildung&nbsp;<span>26.1 (a)</span></a>. Im Fall eines Split plot Design (3-faktoriell) wird eine Behandlung innerhalb der anderen Behandlung über die Blöcke randomisiert. Wir haben also eine Spaltanlage vorliegen, da wir immer eine Behandlung in einer Spalte randomisieren. Das ist schon in der <a href="#fig-exp-adv-1-2" class="quarto-xref">Abbildung&nbsp;<span>26.1 (b)</span></a> zu sehen. Die Farben bilden die zweite Behandlung ab. Innerhalb einer Spalte ist dann die erste Behandlung randomisiert. Das Subsampling nimmt jetzt eine Behandlung raus. Wir haben dann nur noch eine Behandlung als Faktor, die wir in den Blöcken randomisieren. Die Idee des Subsamplings ist nun, dass wir wiederholt Pflanzen innerhalb der Behandlung messen. Wir mitteln jetzt aber nicht über die Pflanzen in einem Block sondern nehmen alle Pflanzen mit in die statistische Auswertung. Das ist eigentlich die zentrale Idee des Subsamplings, wie wir das machen, ist dann die andere Frage. In der <a href="#fig-exp-adv-1-3" class="quarto-xref">Abbildung&nbsp;<span>26.1 (c)</span></a> sehen wir schön wie sich die Pflanzen-ID’s über das Feld verteilen. Die Farben stellen die vier Behandlungslevel dar.</p>
<div class="cell" data-layout-nrow="1" data-layout-align="center">
<div id="fig-exp-adv-1" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-exp-adv-1" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-exp-adv-1-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-exp-adv-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-1-1.png" class="lightbox" data-gallery="fig-exp-adv-1" title="Abbildung&nbsp;26.1&nbsp;(a)— Sechs Eisendüngerbehandlung (Text: fe_1 bis fe_6) sowie vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) in vier Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-exp-adv-1" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-exp-adv-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Sechs Eisendüngerbehandlung (Text: fe_1 bis fe_6) sowie vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) in vier Blöcken.
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-exp-adv-1" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-exp-adv-1-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-exp-adv-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-1-2.png" class="lightbox" data-gallery="fig-exp-adv-1" title="Abbildung&nbsp;26.1&nbsp;(b)— Sechs Eisendüngerbehandlung (Text: fe_1 bis fe_6) sowie vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) in vier Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-1-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-exp-adv-1" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-exp-adv-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Sechs Eisendüngerbehandlung (Text: fe_1 bis fe_6) sowie vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) in vier Blöcken.
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-exp-adv-1" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-exp-adv-1-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-exp-adv-1-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-1-3.png" class="lightbox" data-gallery="fig-exp-adv-1" title="Abbildung&nbsp;26.1&nbsp;(c)— Vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) mit den individuellen Beobachtungen in vier Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-1-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-exp-adv-1" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-exp-adv-1-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) mit den individuellen Beobachtungen in vier Blöcken.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.1— Vergleich der drei häufigsten komplexeren experimentellen Designs mit dem RCBD (3-faktoriell), dem Split plot Design (3-faktoriell) sowie dem Subsampling eines RCBD (2-faktoriell). Die Zahlen bei dem Subsampling stellt die ID’s der individuellen Beobachtungen dar.
</figcaption>
</figure>
</div>
</div>
<section id="genutzte-r-pakete" class="level2" data-number="26.1">
<h2 data-number="26.1" class="anchored" data-anchor-id="genutzte-r-pakete"><span class="header-section-number">26.1</span> Genutzte R Pakete</h2>
<p>Wir wollen folgende R Pakete in diesem Kapitel nutzen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, magrittr, agricolae, dae, desplot,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>               janitor, FielDHub,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>               conflicted)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(magrittr<span class="sc">::</span>set_names)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>cbbPalette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>An der Seite des Kapitels findest du den Link <em>Quellcode anzeigen</em>, über den du Zugang zum gesamten R-Code dieses Kapitels erhältst.</p>
</section>
<section id="sec-rcbd-3fac" class="level2" data-number="26.2">
<h2 data-number="26.2" class="anchored" data-anchor-id="sec-rcbd-3fac"><span class="header-section-number">26.2</span> Randomized complete block design (RCBD, 3-faktoriell)</h2>
<p>Das Maximum des machbaren ist eigentlich ein dreifaktorielles Modell im <em>randomized complete block design</em>. Natürlich geht auch noch mehr, aber der Grundsatz ist eigentlich, dass wir uns maximal zwei Behandlungsfaktoren und dann ein bis zwei Cluster anschauen. Die Cluster sind dann meist einmal der klassische Block plus ein Faktor für verschiedene Lokalisationen. Wir nehmen hier jetzt einmal zwei Behandlungsfaktoren und dann noch einen klassischen Block dazu. Beide Behandlungsfaktoren sind ineinander und dann natürlich im Block genestet. Hier aber erstmal das Modell mit den drei Faktoren für den besseren Überblick. Wir haben einmal die Düngung <code>fert</code>, dann den Faktor Boden <code>soil</code> sowie die verschiedenen Blöcke durch <code>block</code>.</p>
<p><span class="math display">\[
y \sim \overbrace{soil}^{f_1} + \underbrace{fert}_{f_2} + \overbrace{block}^{f_3}
\]</span></p>
<p>mit</p>
<ul>
<li>dem Faktor Dünger <code>fert</code> und den sechs Düngestufen als Level <code>fe_1</code> bis <code>fe_6</code>.</li>
<li>dem Faktor Boden <code>soil</code> und den vier Bodenarten als Level <code>soil_1</code> bis <code>soil_4</code>.</li>
<li>dem Faktor Block <code>block</code> und den zwei Leveln <code>block_1</code> und <code>block_2</code>.</li>
</ul>
<p>Die Struktur der Daten ist wie folgt gegeben. Jedes Level der Düngerstufe <code>fert</code> ist in dem Faktor des Bodens <code>soil</code> enthalten. Die beiden Behandlungen sind dann wiederum jeweils vollständig in den Blöcken <code>block</code> vorhanden. In der <a href="#fig-mermaid-adv-rcbd" class="quarto-xref">Abbildung&nbsp;<span>26.2</span></a> sehen wir einmal den Zusammenhang zwischen den drei Faktoren</p>
<div class="cell" data-fig-width="6" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-mermaid-adv-rcbd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-adv-rcbd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-adv-rcbd">flowchart LR
    A(fert):::factor --- B(((nestet))) --&gt; E(block):::factor
    C(soil):::factor --- D(((nestet))) --&gt; E
    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-adv-rcbd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.2— text
</figcaption>
</figure>
</div>
</div>
</div>
<p>Wir wollen uns jetzt die Daten einmal selber erstellen und das R Paket <code>agricolae</code> nutzen um uns ein passendes Design zu bauen. Abschließend schauen wir uns den Versuchsplan einmal mit <code>desplot</code> an.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Modell zur Auswertung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wir rechnen ein multiples lineares Modell für die statistische Analyse.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> soil <span class="sc">+</span> fert <span class="sc">+</span> soil<span class="sc">:</span>fert <span class="sc">+</span> block, <span class="at">data =</span> rcbd_3f_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<section id="mit-expand_grid" class="level3" data-number="26.2.1">
<h3 data-number="26.2.1" class="anchored" data-anchor-id="mit-expand_grid"><span class="header-section-number">26.2.1</span> … mit <code>expand_grid()</code></h3>
<p>Bei dem <em>randomized complete block design</em> haben wir ja Glück, wir müssen nur darauf achten, das die einzelnen Beobachtungen innerhalb der Blöcke vollständig randomisiert sind. Daher Randomisieren wir ganz am Ende einmal die Saplte <code>fert</code> und die Spalte <code>soil</code> durch. Wir hätten uns das <code>mutate()</code> auch sparen können und stattdessen einfach die Funktion <code>slice_sample(prop = 1)</code> nutzen. Die Funktion permutiert dann alles innerhalb der gruppierten Blöcke durch. Mach wie es dir besser gefällt und du es besser nachvollziehen kannst.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>three_fct_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">soil =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">fert =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">factor</span>(soil, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">fert =</span> <span class="fu">factor</span>(fert, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">sample</span>(fert), <span class="co"># Randomisierung fert</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">sample</span>(soil)) <span class="co"># Randomisierung soil</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>three_fct_long_tbl</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 3
# Groups:   block [2]
   block   soil   fert 
   &lt;fct&gt;   &lt;fct&gt;  &lt;fct&gt;
 1 Block 1 soil_1 fe_6 
 2 Block 1 soil_2 fe_3 
 3 Block 1 soil_3 fe_1 
 4 Block 1 soil_2 fe_3 
 5 Block 1 soil_2 fe_6 
 6 Block 1 soil_1 fe_2 
 7 Block 1 soil_3 fe_6 
 8 Block 1 soil_3 fe_4 
 9 Block 1 soil_3 fe_5 
10 Block 1 soil_4 fe_5 
# ℹ 38 more rows</code></pre>
</div>
</div>
<p>Jetzt mache ich es etwas anders bei der Erstellung des Grids der Spalten und Zeilen. Ich will später beim <code>desplot()</code> für die Blöcke durch <code>| block</code> separieren. Daher setzte ich die Spaltennummerierung <code>cols</code> jeweils auf 1 bis 4 und bilde die Blöcke durch ein davor geschaltetes <code>rep</code> ab. Wenn du die Variable <code>rep</code> nicht möchtest, kannst du auch die <code>cols</code> auf 1 bis 8 setzten, darfst dann aber nicht für die Blöcke durch <code>rep</code> separieren.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>three_fct_plot_tbl <span class="ot">&lt;-</span> three_fct_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#fig-exp-adv-6" class="quarto-xref">Abbildung&nbsp;<span>26.3</span></a> sehen wir dann einmal das <em>randomized complete block design</em> mit drei Faktoren einmal dargestellt. Wir sehen gut, wie die zwei Behandlungen vollständig randomisiert wurden. Beachte, dass die Farben den Faktor <code>soil</code> darstellen und die Labels dann den Faktor <code>fert</code>. Du kannst mit der Option <code>show.key = FALSE</code> auch die Legende ausschalten. Bei sehr komplexen Designs mit vielen Faktorstufen ist es dann doch mal ratsam, sich die Legende mit ausgeben zu lassen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> soil, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> three_fct_plot_tbl ,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Randomized complete block design (3-faktoriell)"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-adv-6" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Abbildung&nbsp;26.3— Randomized complete block design (3-faktoriell) für die Faktoren Dünger fert sowie soil vollständig randomisiert in den beiden Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.3— Randomized complete block design (3-faktoriell) für die Faktoren Dünger <code>fert</code> sowie <code>soil</code> vollständig randomisiert in den beiden Blöcken.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Auch hier können wir dann den Versuchsplan relativ einfach raus schreiben. Ich entferne noch die Spalte <code>rep</code>, da ich die Spalte nicht weiter brauchen werde. Dann wären wir auch schon mit dem Design fertig.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>three_fct_plot_tbl <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>rep) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="st">"template_sheet.xlsx"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mit-fieldhub" class="level3" data-number="26.2.2">
<h3 data-number="26.2.2" class="anchored" data-anchor-id="mit-fieldhub"><span class="header-section-number">26.2.2</span> … mit <code>{FielDHub}</code></h3>
<p>Für die Erstellung des <em>randomized complete block design</em> in der Shiny App schaue dir die Anleitung unter <a href="https://didiermurillof.github.io/FielDHub/reference/full_factorial.html">Generates a Full Factorial Design mit <code>{FielDHub}</code></a> einmal an. Hier einmal der Code für die Erstellung in R. Wir haben jetzt vier Behandlungen für den Faktor <code>soil</code> sowie sechs Behandlungen für den Faktor <code>fe</code> vorliegen und wollen jeweils drei Blöcke anlegen. Jetzt einmal die generische Funktion <code>full_factorial()</code> in der wir aber keine Namen der Level übergeben können. Ohne die Namen wird die Abbildung maximal wirr. Ich erkenne dann gar nichts mehr, wenn ich nur noch Zahlen stehen habe.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="ot">&lt;-</span> <span class="fu">full_factorial</span>(<span class="at">setfactors =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>), </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reps =</span> <span class="dv">3</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Deshalb gibt es die Möglichkeit sich ein Grid zu erstellen und anhand der Namen des Grid dann die Parzellen zu benennen. Leider ist das Vorgehen etwas suboptimal was das Einfärben gleich angeht.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_factorial <span class="ot">&lt;-</span> <span class="fu">lst</span>(<span class="at">fct =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"soil"</span>, <span class="st">"fe"</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>))),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lvl =</span> <span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>data_factorial</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    fct    lvl
1  soil soil_1
2  soil soil_2
3  soil soil_3
4  soil soil_4
5    fe   fe_1
6    fe   fe_2
7    fe   fe_3
8    fe   fe_4
9    fe   fe_5
10   fe   fe_6</code></pre>
</div>
</div>
<p>Wir bauen uns jetzt die Daten mit der Funktion <code>full_factorial()</code> setzen aber die Option <code>setfactors = NULL</code> damit die Funktion die Faktoren und deren Level aus unserem Datensatz <code>data_factorial</code> nimmt. Das ist jetzt auch nur so semi praktisch, aber immerhin könnten wir hier beliebig viele Faktoren prinzipiell nehmen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="ot">&lt;-</span> <span class="fu">full_factorial</span>(<span class="at">setfactors =</span> <span class="cn">NULL</span>, <span class="at">reps =</span> <span class="dv">3</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">2</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> data_factorial) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst. Nicht immer brauchst du alle Informationen. Zum Beispiel ist der Ort <code>location</code>, wo das Experiment durchgeführt wird eher zweitrangig. Du könntest dir auch zusätzliche Daten generieren lassen, aber das kannst du dir dann auch selber mit Werten ausdenken.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 7
      ID LOCATION  PLOT   REP FACTOR_soil FACTOR_fe TRT_COMB   
   &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;      
 1     1        1   101     1 soil_4      fe_5      soil_4*fe_5
 2     2        1   102     1 soil_1      fe_6      soil_1*fe_6
 3     3        1   103     1 soil_3      fe_2      soil_3*fe_2
 4     4        1   104     1 soil_2      fe_1      soil_2*fe_1
 5     5        1   105     1 soil_3      fe_4      soil_3*fe_4
 6     6        1   106     1 soil_2      fe_6      soil_2*fe_6
 7     7        1   107     1 soil_1      fe_4      soil_1*fe_4
 8     8        1   108     1 soil_3      fe_1      soil_3*fe_1
 9     9        1   109     1 soil_2      fe_3      soil_2*fe_3
10    10        1   110     1 soil_4      fe_2      soil_4*fe_2
# ℹ 62 more rows</code></pre>
</div>
</div>
<p>Dann erstellen wir auch schon die <a href="#fig-exp-basic-fac3-fieldhub" class="quarto-xref">Abbildung&nbsp;<span>26.4</span></a> mit dem <em>randomized complete block design</em>. Leider ist die Abbildung nur noch an der Grenze zu okay. Wir haben wilde Farben, die jeweils die Faktorkombination wiedergeben. Leider helfen die Farben wenig und auch ist alles sehr unübersichtlich. Das Paket <code>{desplot}</code> kann definitiv mehr. Hier würde ich dann wirklich auf den Plot hier aus <code>{FielDHub}</code> verzichten und stattdessen mir den Plot wie oben in der <a href="#fig-exp-adv-6" class="quarto-xref">Abbildung&nbsp;<span>26.3</span></a> aus den den Feldbuch selber bauen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-basic-fac3-fieldhub" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-basic-fac3-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-basic-fac3-fieldhub-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Abbildung&nbsp;26.4— Schema der Pflanzungen nach den Behandlungen für das randomized complete block design. Die Farbwhal und die Beschriftung ist mehr als gewöhnungsbedürftig. Die Abbildung ist nicht sehr übersichtlich und nur begrenzt als Darstellung geeignet."><img src="experimental-design-advanced_files/figure-html/fig-exp-basic-fac3-fieldhub-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-basic-fac3-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.4— Schema der Pflanzungen nach den Behandlungen für das <em>randomized complete block design</em>. Die Farbwhal und die Beschriftung ist mehr als gewöhnungsbedürftig. Die Abbildung ist nicht sehr übersichtlich und nur begrenzt als Darstellung geeignet.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mit-agricolae" class="level3" data-number="26.2.3">
<h3 data-number="26.2.3" class="anchored" data-anchor-id="mit-agricolae"><span class="header-section-number">26.2.3</span> … mit <code>{agricolae}</code></h3>
<p>Jetzt bauen wir unser Design nochmal in <code>{agricolae}</code> nach. Hier brauchen wir dann aber alles als Vektor, sonst wird es zu unübersichtlich in den Funktionen. Darüber hinaus ist es dann auch mal was anders und du siehst nochmal eine andere Art den Code zu schreiben. Prinzipiell hätten wir auch im vorherigen Teil alles erstmal in Vektoren lagern können. Aber gut, hier erstmal alle Level der Faktoren vorbereiten und die Anzahl der Blöcke auf vier gesetzt. Dann brauchen wir noch die Länge der Level, also die Anzahl an Düngerstufen und Bodenarten. Dafür nutzen wir die Funktion <code>distinct_n()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)    </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>n_trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac1_soil) </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>n_trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac2_fert) </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>n_block <span class="ot">&lt;-</span> <span class="dv">4</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir schon das <em>randomized complete block design</em> mit drei Faktoren über die Funktion <code>design.ab()</code> erstellen. Wie immer heißt die Wiederholung auch hier <code>r</code>, das ist zwar sehr einheitlich aber manchmal auch verwirrend. Auch musst die beiden Vektoren aneinanderkleben damit die Funktion funktioniert.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="ot">&lt;-</span> <span class="fu">design.ab</span>(<span class="at">trt =</span> <span class="fu">c</span>(n_trt_fac2_fert, n_trt_fac1_soil), </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">design =</span> <span class="st">"rcbd"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">r =</span> n_block, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">seed =</span> <span class="dv">42</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir auch schon unser Ergebnis der Funktion einmal aufarbeiten. Wie immer fehlt das Positionsgrid, so dass wir hier nochmal tätig werden müssen. Dann wollen wir noch die Faktoren wieder umbenennen, so dass auch die Level passen. Am Ende wähle ich noch die Spalten aus, die wir dann später brauchen werden. Meistens müssen wir auch bei den komplexeren Designs und der Nutzung von <code>agricolae</code> im Nachgang sehr viel selber machen. Teilweise lohnt es sich da für mich nicht, für zwei Zeilen Code eine Funktion zu nutzen, der ich dann auch noch sehr viel Nachprogrammieren muss. Man merkt hier eben auch das Alter von dem R Paket <code>agricolae</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_book_tbl <span class="ot">&lt;-</span> rcbd_fac3_obj<span class="sc">$</span>book <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand.grid</span>(<span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span>n_trt_fac2_fert,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span>(n_trt_fac1_soil<span class="sc">*</span>n_block))) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt_fac2_fert =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, A),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">trt_fac1_soil =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, B),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">paste0</span>(<span class="st">"Block "</span>, block)) <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(block, <span class="at">fert =</span> trt_fac2_fert, <span class="at">soil =</span> trt_fac1_soil, rows, cols)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Natürlich hat die Funktion auch keinen <code>sketch</code>, wenn man ihn braucht. Das haben wir ja jetzt schon selber mit dem Positionsgrid programmiert. In der <a href="#fig-exp-adv-2" class="quarto-xref">Abbildung&nbsp;<span>26.5</span></a> siehst du dann das Ergebnis des Versuchsplans. Wir haben hier nochmal zwei Blöcke zusätzlich zu dem obigen Beispiel genommen, dann siehst du nochmal schöner, wie sich die beiden Behandlungen in den Blöcken randomisieren.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> rcbd_fac3_book_tbl,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Randomized complete block design (3-faktoriell)"</span>, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>, <span class="at">key.cex =</span> <span class="dv">1</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-adv-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Abbildung&nbsp;26.5— Randomized complete block design (3-faktoriell) für die Faktoren Dünger fert sowie soil vollständig randomisiert in den vier Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.5— Randomized complete block design (3-faktoriell) für die Faktoren Dünger <code>fert</code> sowie <code>soil</code> vollständig randomisiert in den vier Blöcken.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-split" class="level2" data-number="26.3">
<h2 data-number="26.3" class="anchored" data-anchor-id="sec-split"><span class="header-section-number">26.3</span> Split plot design (3-faktoriell)</h2>
<p>Die Spaltanlage (eng. <em>split plot design</em>) ist eine häufig genutzte Variante, wenn wir eine Behandlungsfaktor nur in einem anderen Level eines zweiten Behandlungsfaktor randomisieren können. Wir können also eine Feldspur nur auf eine Art mechanisch bearbeiten und geben dann aber pro Feldspur verschiedene Dünger auf. Oder wir können in einen Stahl nur auf eine Art Futter zuführen, aber verschiedene Arten von Futter. Das gleiche kannst du dir auch mit einer Klimakammer vorstellen in der wir verschiedene Pflanzenlinien stellen können.</p>
<p>Beide Behandlungsfaktoren sind ineinander und dann natürlich im Block genestet. Hier aber erstmal das Modell mit den drei Faktoren für den besseren Überblick. Wir haben einmal die Düngung <code>fert</code>, dann den Faktor Boden <code>soil</code> sowie die verschiedenen Blöcke mit <code>block</code>.</p>
<p><span class="math display">\[
y \sim \overbrace{soil}^{f_1} + \underbrace{fert}_{f_2} + \overbrace{block}^{f_3}
\]</span></p>
<p>mit</p>
<ul>
<li>dem Faktor Dünger <code>fert</code> und den sechs Düngestufen als Level <code>fe_1</code> bis <code>fe_6</code>.</li>
<li>dem Faktor Boden <code>soil</code> und den vier Bodenarten als Level <code>soil_1</code> bis <code>soil_4</code>.</li>
<li>dem Faktor Block <code>block</code> und den zwei Leveln <code>block_1</code> und <code>block_2</code>.</li>
</ul>
<p>In der <a href="#fig-mermaid-splitplot" class="quarto-xref">Abbildung&nbsp;<span>26.6</span></a> sehen wir die Abhängigkeitsstruktur des <em>split plot designs</em>. Wir haben den Faktor <code>fert</code> den wir in den Faktor <code>soil</code> nesten. Den Faktor <code>soil</code> nesten wir dann wiederrum in die Spalten <code>cols</code> des Blocks. Deshalb nennen wir das ja auch eine Spaltanlage. Ein Faktor ist immer in den Spalten angeordnet und der andere Faktor in der Spalte randomisiert. Wie immer wird es vielleicht klarer, wenn du dir dazu die <a href="#fig-exp-adv-split" class="quarto-xref">Abbildung&nbsp;<span>26.7</span></a> als Ergebnis des Versuchsdesigns anschaust.</p>
<div class="cell" data-fig-width="6" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-mermaid-splitplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-splitplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-splitplot">flowchart LR
    A(fert):::factor --- B(((nestet))) --&gt; C(soil):::factor --- D(((nestet))) --&gt; E(cols) --- F(block):::factor
    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-splitplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.6— Abhängigkeitsstruktur des <em>split plot design</em>. Der Faktor <code>soil</code> ist in den Spalten <code>cols</code> der Blöcke randomisiert und der zweite Faktor <code>fert</code> innerhalb des anderen Faktors und somit auch in den Spalten.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Modell zur Auswertung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wir rechnen ein komplexeres gemischtes Modell mit allen möglichen zufälligen Effekten.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(yield <span class="sc">~</span> soil <span class="sc">+</span> fert <span class="sc">+</span> soil<span class="sc">:</span>fert <span class="sc">+</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span><span class="sc">|</span>block) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block<span class="sc">:</span>fert) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block<span class="sc">:</span>soil), </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> split_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Oder können überlegen ein gemischtes Modell mit weniger zufälligen Effekten zu rechnen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(yield <span class="sc">~</span> soil <span class="sc">+</span> fert <span class="sc">+</span> soil<span class="sc">:</span>fert <span class="sc">+</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span><span class="sc">|</span>block), </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> split_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Die Entscheidung kannst du dann mit der <a href="https://jkruppa.github.io/stat-modeling-basic.html#sec-model-basic-compare">Modellselektion</a> durchführen.</p>
</div>
</div>
<p>Jetzt haben wir die volle Auswahl an Möglichkeiten. Ich zeige einmal wie man händisch das <em>split plot designs</em> erstellt. Dann schauen wir uns die Erstellung in <code>agricolae</code> einmal an und dann zeige ich noch die Variante in <code>dae</code>, die mich echt einiges an Zeit und Nerven gekostet hat. In sich ist das Paket <code>dae</code> ja logisch, aber die Dokumentation lässt für mich etwas zu wünschen übrig. Dennoch hier einmal die volle Dreifaltigkeit der Versuchsdesignerstellung, wenn ich mir schon die Mühe gemacht habe.</p>
<section id="mit-expand_grid-1" class="level3" data-number="26.3.1">
<h3 data-number="26.3.1" class="anchored" data-anchor-id="mit-expand_grid-1"><span class="header-section-number">26.3.1</span> … mit <code>expand_grid()</code></h3>
<p>Ja, selber machen ist hier etwas mühsamer, aber wenn du die Schritte nachvollziehst, dann wird dir vermutlich das <em>split plot design</em> sehr viel klarer. Als erstes erschaffen wir die zwei Blöcke und die vier Bodenarten. Dabei sind in jedem Block die vier Bodenarten genestet. Dann gruppieren wir nach Block und randomiseren einmal die Bodenarten je Block. Im nächsten Schritt erweitern wir dann jede Block/Boden-Kombination um die sechs Düngerstufen. Dann gruppieren wir wieder, aber diesmal für jede Block/Boden-Kombination, um hier dann einmal die Düngestufen zu randomisieren. Dann lösen wir alle Gruppen auf und setzen fürunsere Faktoren dann noch die richtigen Labels.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>splitplot_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">soil =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span>             <span class="co"># Gruppieren nach block</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">soil =</span> <span class="fu">sample</span>(soil)) <span class="sc">|&gt;</span> <span class="co"># Randomisieren von soil in block</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">fert =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block, soil) <span class="sc">|&gt;</span>       <span class="co"># Gruppieren nach block und soil</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">sample</span>(fert)) <span class="sc">|&gt;</span> <span class="co"># Randomisieren von fert in block und soil</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">factor</span>(fert, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">factor</span>(soil, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))) </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>splitplot_long_tbl</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 3
   block   soil   fert 
   &lt;fct&gt;   &lt;fct&gt;  &lt;fct&gt;
 1 Block 1 soil_4 fe_1 
 2 Block 1 soil_4 fe_3 
 3 Block 1 soil_4 fe_4 
 4 Block 1 soil_4 fe_6 
 5 Block 1 soil_4 fe_2 
 6 Block 1 soil_4 fe_5 
 7 Block 1 soil_2 fe_4 
 8 Block 1 soil_2 fe_5 
 9 Block 1 soil_2 fe_2 
10 Block 1 soil_2 fe_6 
# ℹ 38 more rows</code></pre>
</div>
</div>
<p>Da ich auch gleich wieder für die Blöcke separieren möchte, baue ich mir für jeden Block <code>rep</code> nochmal vier Spalten, je eine Spalte für eine Bodenbehandlung, und dann nochmal sechs Zeilen, eine für jede Düngestufe. Dann verbinden wir den randomisirten Datensatz mit den Pflanzgrid und schon können wir uns das <em>split plot design</em> einmal anschauen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>splitplot_plot_tbl <span class="ot">&lt;-</span> splitplot_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#fig-exp-adv-split" class="quarto-xref">Abbildung&nbsp;<span>26.7</span></a> siehst du einmal das <em>split plot design</em> dargestellt. Hier wird auch nochmal schön das Randomisierungsmuster klar. Du siehst auch warum das <em>split plot design</em> im Deutschen auch Spaltanlage heißt. Der Dünger ist in Spalten des Bodenfaktores randomisiert. Jeder Block hat also seine eigene Randomiserung der Böden.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> splitplot_plot_tbl ,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Split plot design (3-faktoriell)"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-adv-split" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-split-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Abbildung&nbsp;26.7— Split plot design (3-faktoriell) für die Faktoren Dünger fert sowie soil randomisiert in den zwei Blöcken. Der Faktor fert ist in dem Faktor soil genestet und randomisiert."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-split-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.7— Split plot design (3-faktoriell) für die Faktoren Dünger <code>fert</code> sowie <code>soil</code> randomisiert in den zwei Blöcken. Der Faktor <code>fert</code> ist in dem Faktor <code>soil</code> genestet und randomisiert.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mit-fieldhub-1" class="level3" data-number="26.3.2">
<h3 data-number="26.3.2" class="anchored" data-anchor-id="mit-fieldhub-1"><span class="header-section-number">26.3.2</span> … mit <code>{FielDHub}</code></h3>
<p>Für die Erstellung des <em>split plot design</em> in der Shiny App schaue dir die Anleitung unter <a href="https://didiermurillof.github.io/FielDHub/reference/split_plot.html">Generates a Split Plot Design mit <code>{FielDHub}</code></a> einmal an. Hier einmal der Code für die Erstellung in R. Wir haben jetzt vier Behandlungen für den Faktor <code>soil</code> sowie sechs Behandlungen für den Faktor <code>fe</code> vorliegen und wollen jeweils drei Blöcke anlegen. Jetzt einmal die Funktion <code>split_plot()</code> in der wir hier aber die Namen der Level übergeben können. Das ist dann wiederum eine Erleichterung zum dreifaktoriellen Design eben.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>split_plot_obj <span class="ot">&lt;-</span> <span class="fu">split_plot</span>(<span class="at">wp =</span> <span class="fu">paste0</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sp =</span> <span class="fu">paste0</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">reps =</span> <span class="dv">3</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">2023</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst. Wie immer brauchst du nicht alle Informationen. Auch hier würde ich das Feldbuch dann nutzen um mir selber in <code>{desplot}</code> die Abbildung zu erstellen. Die automatisierte Abbildungserstellung in <code>{FielDHub}</code> ist der manuellen weit unterlegen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>split_plot_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 7
      ID LOCATION  PLOT   REP WHOLE_PLOT SUB_PLOT TRT_COMB   
   &lt;int&gt;    &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      
 1     1        1   101     1 soil_3     fe_3     soil_3|fe_3
 2     2        1   101     1 soil_3     fe_2     soil_3|fe_2
 3     3        1   101     1 soil_3     fe_1     soil_3|fe_1
 4     4        1   101     1 soil_3     fe_6     soil_3|fe_6
 5     5        1   101     1 soil_3     fe_4     soil_3|fe_4
 6     6        1   101     1 soil_3     fe_5     soil_3|fe_5
 7     7        1   102     1 soil_1     fe_4     soil_1|fe_4
 8     8        1   102     1 soil_1     fe_1     soil_1|fe_1
 9     9        1   102     1 soil_1     fe_6     soil_1|fe_6
10    10        1   102     1 soil_1     fe_3     soil_1|fe_3
# ℹ 62 more rows</code></pre>
</div>
</div>
<p>Dann erstellen wir auch schon die <a href="#fig-exp-basic-split-fieldhub" class="quarto-xref">Abbildung&nbsp;<span>26.8</span></a> mit dem <em>split plot design</em>. Leider ist die Abbildung nur noch okay. Die Einteilung mit dem <code>|</code> ist besser als beim faktoriellen Design, aber so richtig überzeugen tut mich die Darstellung nicht. Wir haben ja die wilden Farben, da wir jeweils die Faktorkombination wiedergeben. Leider helfen die Farben wenig und auch ist alles sehr unübersichtlich. Das Paket <code>{desplot}</code> kann definitiv mehr. Hier würde ich dann wirklich auf den Plot hier aus <code>{FielDHub}</code> verzichten und stattdessen mir den Plot wie oben in der <a href="#fig-exp-adv-split" class="quarto-xref">Abbildung&nbsp;<span>26.7</span></a> aus den den Feldbuch selber bauen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>split_plot_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-basic-split-fieldhub" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-basic-split-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-basic-split-fieldhub-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Abbildung&nbsp;26.8— Split plot design (3-faktoriell) für die Faktoren Dünger fert sowie soil randomisiert in den zwei Blöcken. Der Faktor fert ist in dem Faktor soil genestet und randomisiert."><img src="experimental-design-advanced_files/figure-html/fig-exp-basic-split-fieldhub-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-basic-split-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.8— Split plot design (3-faktoriell) für die Faktoren Dünger <code>fert</code> sowie <code>soil</code> randomisiert in den zwei Blöcken. Der Faktor <code>fert</code> ist in dem Faktor <code>soil</code> genestet und randomisiert.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mit-agricolae-1" class="level3" data-number="26.3.3">
<h3 data-number="26.3.3" class="anchored" data-anchor-id="mit-agricolae-1"><span class="header-section-number">26.3.3</span> … mit <code>{agricolae}</code></h3>
<p>Jetzt machen wir das Ganze nochmal mit dem R Paket <code>{agricolae}</code>. Hier müssen wir wieder die Vektoren mit den Faktoren und Leveln vorab erschaffen. Auch brauchen wir die Anzahl an Leveln für jeden Faktor. Am Ende randomisieren wir hier mal in vier Blöcke, einfach um es etwas anders zu machen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)    </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>n_trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac1_soil) </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>n_trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac2_fert) </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>n_block <span class="ot">&lt;-</span> <span class="dv">4</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Für die Erstellung des <em>split plot design</em> nutzen wir die Funktion <code>design.split()</code>. Hier ist es wichtig, unbedingt die <code>serie = 0</code> als Option zu setzen. Wir brauchen die so entstehende Information in der Spalte <code>plots</code> sonst klappt es im Folgenden nicht die <code>plots</code> gleich den Spalten <code>cols</code> zu setzen. Ja, ich weiß, ist alles super suboptimal, aber so ist es eben in <code>{agricolae}</code>. Du musst noch einges machen, damit die Funktion auch einen visualisierbare Ausgabe wiedergibt.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>splitplot_obj <span class="ot">&lt;-</span> <span class="fu">design.split</span>(<span class="at">trt1 =</span> trt_fac1_soil,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trt2 =</span> trt_fac2_fert,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">r =</span> n_block,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seed =</span> <span class="dv">42</span>, <span class="at">serie =</span> <span class="dv">0</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Leider gibt es kein <code>sketch</code>-Objekt gerade hier wo man eins gebrauchen könnte. Deshalb also nochmal alles umbauen und die Zeilen <code>rows</code> und Spalten <code>cols</code> entsprechend ergänzen. Ich nenne jetzt nochmal ein wenig die Variablen um, einfach damit hier nicht immer das Gleiche passiert. Wichtig ist, dass wir hier immer für die Blöcke separieren. Wir müssen also in <code>desplot</code> definitiv die Option <code>| block</code> setzen, sonst klappt es mit der Darstellung nicht.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>splitsplot_book_tbl <span class="ot">&lt;-</span> splitplot_obj<span class="sc">$</span>book <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, block),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cols =</span> plots, </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">rows =</span> <span class="fu">as.numeric</span>(splots)) <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(block, <span class="at">fert =</span> trt_fac2_fert, <span class="at">soil =</span> trt_fac1_soil, rows, cols)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#fig-exp-adv-3" class="quarto-xref">Abbildung&nbsp;<span>26.9</span></a> siehst du das Ergebnis der Versuchsplanerstellung mit <code>{agricolae}</code>. Wir kriegen faktisch das Gleiche raus, gut die Faktoren sind anders permutiert, aber das wundert uns jetzt nicht. Am Ende musst du entscheiden, was dir besser gefällt. Je komplexer die Randomisierung ist, desto einfacher ist die Nutzung der <code>{agricolae}</code> Funktionen. Beim <em>split plot design</em> ist es so eine Sache, es lohnt sich bei sehr großen Anlagen dann schon.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> splitsplot_book_tbl ,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Split plot design (3-faktoriell)"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-adv-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Abbildung&nbsp;26.9— Split plot design (3-faktoriell) für die Faktoren Dünger fert sowie soil randomisiert in den vier Blöcken. Der Faktor fert ist in dem Faktor soil genestet und randomisiert."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.9— Split plot design (3-faktoriell) für die Faktoren Dünger <code>fert</code> sowie <code>soil</code> randomisiert in den vier Blöcken. Der Faktor <code>fert</code> ist in dem Faktor <code>soil</code> genestet und randomisiert.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mit-dae" class="level3" data-number="26.3.4">
<h3 data-number="26.3.4" class="anchored" data-anchor-id="mit-dae"><span class="header-section-number">26.3.4</span> … mit <code>{dae}</code></h3>
<p>Auch das R Paket <code>{dae}</code> liefert die Möglichkeit ein <em>split plot design</em> zu erstellen. Die Idee von <code>dae</code> ist ja ein mehr generalisiertes Framework für die Erstellung von Versuchsplänen anzubieten. Deshalb gibt es ja nur die Funktion <code>designRandomize()</code>, die ein gegebenes Design nach feststehenden Regeln randomisiert. Die Idee ist gut, aber dafür musst du dich relativ tief in das Paket <code>dae</code> einarbeiten. Für mich war dieser kurze Code für das <em>split plot design</em> schon recht langwierig aus den Beispielen aus den <a href="https://cran.r-project.org/web/packages/dae/vignettes/DesignNotes.pdf">Notes on the use of dae for design</a> herzuleiten. Prinzipiell ist es ja nicht schwer, aber es ist schon etwas mehr Auswand.</p>
<p>Wie funktioniert nun die Erstellung eines <em>split plot design</em>? Wir bauen uns erstmal unser Design der Positionen mit den Blöcken, Mainplots <code>MPlots</code> sowie den Subplot <code>SubPlots</code>. Dabei ist es wichtig zu wissen, dass die Subplots in den Mainplots genestet sind. Die Mainplots sind dann wiederum in den Blöcken genestet. Ja, hier hast du dann ein Paket spezifisches Naming der Optionen. Im zweiten Schritt packen wir dann den Faktor Boden <code>soil</code> und den Faktor <code>fert</code> zu den Positionen hinzu. Wichtig ist das <code>times = 4</code> am Ende, was nochmal die Faktorkombinationen von <code>soil</code> und <code>fert</code> jeweils in der Anzahl der Blöcke wiederholt. Wir haben ja hier vier Blöcke vorliegen, dass vergisst man ja mal schnell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>split_sys <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">fac.gen</span>(<span class="fu">list</span>(<span class="at">Blocks =</span> <span class="dv">4</span>, <span class="at">MPlots =</span> <span class="dv">4</span>, <span class="at">SubPlots =</span> <span class="dv">6</span>)),</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fac.gen</span>(<span class="fu">list</span>(<span class="at">soil =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fert =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)), <span class="at">times =</span> <span class="dv">4</span>)) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>split_sys <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 96 × 5
   Blocks MPlots SubPlots soil   fert 
   &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;    &lt;fct&gt;  &lt;fct&gt;
 1 1      1      1        soil_1 fe_1 
 2 1      1      2        soil_1 fe_2 
 3 1      1      3        soil_1 fe_3 
 4 1      1      4        soil_1 fe_4 
 5 1      1      5        soil_1 fe_5 
 6 1      1      6        soil_1 fe_6 
 7 1      2      1        soil_2 fe_1 
 8 1      2      2        soil_2 fe_2 
 9 1      2      3        soil_2 fe_3 
10 1      2      4        soil_2 fe_4 
# ℹ 86 more rows</code></pre>
</div>
</div>
<p>An der Ausgabe siehst du ganz schön, wie die Spalte Mainplots zu dem Faktor <code>soil</code> passt sowie die Spalte Subplots zu dem Faktor <code>fert</code>. Die Herausforderung ist nun, dass das R Paket <code>dae</code> davon ausgeht, dass du weißt, was ein <em>split plot design</em> ist und wie es aufgebaut ist. Es gibt also wenig Hilfestellung innerhalb der Funktionen. Dafür sind die Funktionen super flexibel und du kannst dir deine eigenen kreativen Designs bauen - wovon ich abrate.</p>
<p>Im nächsten Schritt nutzen wir die Funktion <code>designRandomize()</code> um die Faktoren <code>soil</code> und <code>fert</code> den Positionen in der Spalte <code>Block</code>, <code>MPlots</code> und <code>SubPlots</code> randomisiert zuzuweisen. Deshalb sind ja auch die Faktoren <code>soil</code> und <code>fert</code> der Option <code>allocated</code> (deu. <em>zugeteilt</em>) zugewiesen, da die beiden Faktoren ja den Spalten <code>Block</code>, <code>MPlots</code> und <code>SubPlots</code> als Empfänger (eng. <code>recipient</code>) zugeteilt werden. Soweit so gut, dass sagt aber noch nichts über das <em>Wie</em> der Zuteilung aus. Das machen wir dann mit der Option <code>nestet.recipients</code>. Der Option sagen wir jetzt wer in was genestet ist. Und durch diese Zuordnung erschaffen wir ein <em>split plot design</em>. Die Mainplots sind in den Blöcken genestet und dann die Subplots in den Mainplots und den Blöcken. Ja, da muss man erstmal drauf kommen. Hat bei mir gedauert, bis ich das hingekriegt habe.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>split_lay <span class="ot">&lt;-</span> <span class="fu">designRandomize</span>(<span class="at">allocated =</span> split_sys[<span class="fu">c</span>(<span class="st">"soil"</span>, <span class="st">"fert"</span>)],</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">recipient =</span> split_sys[<span class="fu">c</span>(<span class="st">"Blocks"</span>, <span class="st">"MPlots"</span>, <span class="st">"SubPlots"</span>)],</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nestet.recipients =</span> <span class="fu">list</span>(<span class="at">MPlots =</span> <span class="st">"Blocks"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">SubPlots =</span> <span class="fu">c</span>(<span class="st">"MPlots"</span>, <span class="st">"Blocks"</span>)),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">235805</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>split_lay <span class="sc">|&gt;</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 96 × 5
   Blocks MPlots SubPlots soil   fert 
   &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;    &lt;fct&gt;  &lt;fct&gt;
 1 1      1      1        soil_4 fe_4 
 2 1      1      2        soil_4 fe_2 
 3 1      1      3        soil_4 fe_5 
 4 1      1      4        soil_4 fe_3 
 5 1      1      5        soil_4 fe_1 
 6 1      1      6        soil_4 fe_6 
 7 1      2      1        soil_2 fe_4 
 8 1      2      2        soil_2 fe_2 
 9 1      2      3        soil_2 fe_5 
10 1      2      4        soil_2 fe_3 
# ℹ 86 more rows</code></pre>
</div>
</div>
<p>Und wir haben eine Randomisierung. Leider wissen wir nicht, ob die so geklappt hat, es ist ja wirklich schwer zusehen. Deshalb wollen wir uns die Ausgabe mal visualisieren. Das Gleiche Problem wie schon eben haben wir mit der Visualisierung mit <code>designGGPlot()</code>. Die Hilfeseite ist etwas unterkomplex für die Möglichkeiten der Funktion. So musste ich auch hier recht lange Rumspielen, bis ich die folgende <a href="#fig-exp-adv-4" class="quarto-xref">Abbildung&nbsp;<span>26.10</span></a> erstellen konnte. Der Witz ist eigentlich hier, dass wir eine interne Funktion nutzen und auch das Objekt aus <code>designRandomize()</code> übergeben. Dennoch müssen wir uns selber mit den <code>row.factors()</code> und den <code>column.factors()</code> alles zusammenkleben. Ich habe es dann geschafft, aber es war mehr Zufall als Können. Das die Spalten die Mainplots sind, war mir klar, aber das die Zeilen durch die beiden Vektoren <code>Blocks</code> und <code>Subplots</code> so in der Reihenfolge gebildet werden war nur durch probieren zu lösen. Das eine aussagekräftige Legende fehlt, ist dann schon fast nicht mehr von Belang.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-exp-adv-4" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Abbildung&nbsp;26.10— Split plot design (3-faktoriell) für die Faktoren Dünger fert sowie soil randomisiert in den vier Blöcken. Der Faktor fert ist in dem Faktor soil genestet und randomisiert."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.10— Split plot design (3-faktoriell) für die Faktoren Dünger <code>fert</code> sowie <code>soil</code> randomisiert in den vier Blöcken. Der Faktor <code>fert</code> ist in dem Faktor <code>soil</code> genestet und randomisiert.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Am Ende ermöglicht das Paket <code>{dae}</code> super flexibel experimentelle Design zu erstellen. Ich werde das Paket auch für Designs im Rahmen der Analyse von linearen gemischten Modellen nutzen. Dafür ist das Paket super. Du musst aber wissen, dass das Paket einiges an Einarbeitung benötigt und du auch die Philosophie hinter den Funktionen verstehen musst. Mal eben schnell, geht leider nicht. Dafür kann das Paket <code>{dae}</code> mehr als als andere Pakete im Bereich der Erstellung von experimentellen Designs.</p>
</section>
</section>
<section id="sec-subsampling" class="level2" data-number="26.4">
<h2 data-number="26.4" class="anchored" data-anchor-id="sec-subsampling"><span class="header-section-number">26.4</span> Subsampling</h2>
<p>Die zentrale Idee des Subsamplings ist, dass wir nicht über die Pflanzen in unseren Blöcken mitteln. Wir nehmen also alle Pflanzen in unserem Block mit in die Analyse. Oder aber wir mitteln nicht das Gewicht der Ferkel für jede Bucht, sondern wollen die Gewichte individuell mit betrachten. Wir messen die Beobachtungen innerhalb der Behandlung und nehmen diese individuellen Beobachtungen auch mit ins Modell. Damit haben wir eigentlich das gleiche Modell wie auch bei dem <em>randomized complete block design</em> mit zwei Faktoren. Nur das wir eben in den Blöcken und Behandlungen nicht einen Mittelwert über alles haben, sondern eben sechs individuelle Werte für die sechs Beobachtungen in einer Behandlung/Block-Kombination in unserem Beispiel.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beispieldaten aus <code>{agridat}</code> zu Subsampling
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wenn dich nochmal Daten zum Subsampling interessiert dann schaue dir doch die Beispieldaten aus dem R Paket <code>{agridat}</code> an. Zum einen wäre der Datensatz <a href="https://kwstat.github.io/agridat/reference/grover.rcb.subsample.html">Rice RCB with subsamples</a> sowie die Daten <a href="https://kwstat.github.io/agridat/reference/gomez.splitplot.subsample.html">Split-plot experiment of rice, with subsamples</a> von Interesse. Du findest hinter dem Link dann auch die Hilfe wie du die Daten in R mit <code>data()</code> lädst.</p>
</div>
</div>
<p>Das generelle Modell unterscheidet sich nicht von einem RCBD. Wir haben zwei Faktoren, einmal die Behandlung und einmal einen Block vorliegen. Damit sind wir noch sehr ähnlich. Den Unterschied macht gleich die Randomisierung und die Betrachtung der einzelnen individuellen Beobachtungen.</p>
<p><span class="math display">\[
y \sim \overbrace{trt}^{f_1} + \underbrace{block}_{f_2}
\]</span></p>
<p>mit</p>
<ul>
<li>dem Faktor Behandlung <code>trt</code> und den vier Behandlungsstufen als Level <code>ctrl</code>, <code>A</code>, <code>B</code> und <code>C</code>.</li>
<li>dem Faktor Block <code>block</code> und den vier Leveln <code>block_1</code> bis <code>block_4</code>.</li>
</ul>
<p>Es gibt jetzt zwei Arten, wie wir die Daten randomisieren und betrachten können. Zum einen randomisieren wir die Individuen vollständig auf die Behandlungen und die Behandlungen nesten wir dann in die Blöcke. Dann haben wir die Abhängigkeitssruktur in der <a href="#fig-mermaid-sub-1" class="quarto-xref">Abbildung&nbsp;<span>26.11</span></a> vorliegen. Im Anschluss mitteln wir dann nicht über alle Beobachtungen. Prinzipiell ist es also ein sehr großes <em>randomized complete block design</em>.</p>
<div class="cell" data-fig-width="6" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-mermaid-sub-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-sub-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-sub-1">flowchart LR
    A(trt):::factor --- B(((nestet))) --&gt; C(block):::factor 
    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-sub-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.11— Subsampling vollständig innerhalb der Blöcke randomisiert. Die individuellen Beobachtungen sind über alle Behandlungen innerhalb der Blöcke randomisiert
</figcaption>
</figure>
</div>
</div>
</div>
<p>Anders sieht es in der Variante zwei aus, hier haben wir die individuellen Beobachtungen in Clustern für eine einzelne Behandlung vorliegen. Die Beobachtungen sind innerhalb der Behandlungen genestet. In unserem Beispiel stehen die individuellen Pflanzen immer in einem Pflanztray. Du kannst dir aber auch Ferkel von verschiedenen Müttern in einer Bucht in einem Stall vorstellen. Es ergibt sich dann die <a href="#fig-mermaid-sub-2" class="quarto-xref">Abbildung&nbsp;<span>26.12</span></a>, wo unsere einzelnen Beobachtungen in den Behandlungen und dann in den Blöcken genestet sind.</p>
<div class="cell" data-fig-width="6" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-mermaid-sub-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-sub-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-sub-2">flowchart LR
    A(tray) --- B(((nestet))) --&gt; C(trt):::factor --- D(((nestet))) --&gt; E(cols) --- F(block):::factor
    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-sub-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.12— Subsampling vollständig innerhalb der Behandlung randomisiert. Die individuellen Pflanzen stehen in Trays und können nicht innerhalb der Behandlung <code>trt</code> randomisiert werden.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Für die abschließende statistische Analyse kommt es darauf an, wie die individuellen Pflanzen in den Behandlungen stehen. Eventuell ist alles durcheinander gemischt, das heißt, die Pflanzen sind in den Behandlungen und Blöcken randomisiert. Dann ist es recht einfach mit einem linearen Modell zu machen.</p>
<p>Wenn du aber die Pflanzen in einem Pflanztray oder irgendwie anders fixierst hast, dann macht es schon einen Unterschied. In dem Fall sind die Pflanzen ja individuell nicht unabhängig voneinander. Die Pflanzen sind ja in einem Tray zusammen. Dann nutzen wir ein lineares gemischtes Modell.</p>
<p>Im Folgenden generieren wir einmal beide Fälle, wobei der zweite Fall - Pflanzen stehen zusammen - als Subsampling angesehen wird. Häufig kann dies auch bei Tierversuchen passieren, wenn zum Beispiel Ferkel in einer Bucht in einem Stahl stehen. Da aber ab und zu beides vorkommt, hier dann einmal beides. Wir können das Subsampling nur selber mit <code>expand_grid()</code> durchführen, da weder das R Paket <code>{agricolae}</code> noch das R Paket <code>{dae}</code> eine entsprechende Implementierung der Funktionalität zur Generierung eines Datensatzes mit Subsampling aufweist.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Modell zur Auswertung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Vollständig im Block randomisiert, wir rechnen ein lineares Modell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> trt <span class="sc">+</span> block <span class="sc">+</span> trt<span class="sc">:</span>block, <span class="at">data =</span> subsampling_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Behandlung im Block randomisiert, dass heißt, dass die Pflanzen zusammen in einem Tray stehen, wir rechnen ein gemischtes Modell. Der Tray-Effekt wird dann im zufälligen Effekt <code>(1 | trt:block)</code> modelliert.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(drymatter <span class="sc">~</span> trt <span class="sc">+</span> block <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">:</span>block), <span class="at">data =</span> subsampling_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>Das Subsampling geht nur im Selbermachen, also machen wir das dann einmal mit der Funktion <code>expand_grid()</code>. Als erstes erstellen wir einmal ein Design mit vier Blöcken und vier Behandlungen. Dann ergänzen wir noch pro Behandlung sechs individuelle Beobachtungen. Am Ende randomisieren wir einmal über die Behandlungen in den Blöcken. Wichtig ist hier, dass wir die Daten nach den Blöcken gruppieren müssen und schon vorher alle individuellen Pflanzen generieren.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>subsampling_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">trt =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">factor</span>(trt, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"ctrl"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">pid =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">pid_text =</span> <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">96</span>, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">sample</span>(trt)) <span class="do">## Randomisierung in den Blöcken</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann bauen wir noch unser Grid auf. Wir wollen insgesamt sechzehn Spalten, dass sind die Blöcke/Behandlungs-Kombinationen. Dann brauchen wir noch jeweils sechs Zeilen für die individuellen Pflanzen. Dann können wir die Daten schon nehmen und in der <a href="#fig-exp-adv-10-1" class="quarto-xref">Abbildung&nbsp;<span>26.13 (a)</span></a> visualisieren. Bevor wir die Abbildung besprechen, generieren wir uns nochmal die anderen Daten, wo die Behandlungen in den Blöcken randomisiert werden.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>subsampling_plot_tbl <span class="ot">&lt;-</span> subsampling_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Eine andere Möglichkeit ist, dass unsere Pflanzen in einem Pflanztray stehen. Damit haben wir keine Randomisierung mehr in den Blöcken, sondern wir können nur unsere Behandlungen in den Blöcken randomisieren. Die Positionen in den Trays sind ja fix. Daher Randomisieren wir erst den Faktor der Behandlungen in den gruppierten Blöcken. Dann ergänzen wir noch die sechs individuellen Pflanzen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>subsampling_tray_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">trt =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">factor</span>(trt, <span class="at">labels =</span> trt_fac1_soil),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">sample</span>(trt)) <span class="sc">|&gt;</span> <span class="co"># Randomisierung der Behandlungen in den Blöcken</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Jetzt bauen wir uns noch das Grid für die Positionen zusammen, da bleibt alles beim alten. Wir brauchen auch wieder sechzehn Spalten, dass sind die Blöcke/Behandlungs-Kombinationen. Dann noch die sechs Zeilen für das Pflanzentray. In der <a href="#fig-exp-adv-10-2" class="quarto-xref">Abbildung&nbsp;<span>26.13 (b)</span></a> sehen wir einmal das Ergebnis der Randomisierung. Alle Pflanzen sind jetzt in einer Spalte randomisiert, die eben das Tray der Pflanzung entspricht.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>subsampling_tray_plot_tbl <span class="ot">&lt;-</span> subsampling_tray_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#fig-exp-adv-10" class="quarto-xref">Abbildung&nbsp;<span>26.13</span></a> sehen wir nochmal die beiden Arten des Subsamplings miteinander vergleichen. In der <a href="#fig-exp-adv-10-1" class="quarto-xref">Abbildung&nbsp;<span>26.13 (a)</span></a> sind alle Behandlungen mit ihren sechs Wiederholungen zufällig im Block verteilt. Im anderen Fall sehen wir in der <a href="#fig-exp-adv-10-2" class="quarto-xref">Abbildung&nbsp;<span>26.13 (b)</span></a>, wenn die Pfanzen zusammen in einem Tray stehen und alle die gleiche Behandlung kriegen. Es können aber auch Schweine in einer Bucht sein und die Blöcke sind dann die einzelnen Ställe.</p>
<div class="cell" data-layout-nrow="1" data-layout-align="center">
<div id="fig-exp-adv-10" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-exp-adv-10" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-exp-adv-10-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-exp-adv-10-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-10-1.png" class="lightbox" data-gallery="fig-exp-adv-10" title="Abbildung&nbsp;26.13&nbsp;(a)— … vollständig innerhalb Block randomisiert (subsampling_plot_tbl)."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-exp-adv-10" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-exp-adv-10-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) … vollständig innerhalb Block randomisiert (<code>subsampling_plot_tbl</code>).
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-exp-adv-10" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-exp-adv-10-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-exp-adv-10-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-10-2.png" class="lightbox" data-gallery="fig-exp-adv-10" title="Abbildung&nbsp;26.13&nbsp;(b)— … Behandlungen innerhalb Block randomisiert (subsampling_tray_plot_tbl)."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-10-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-exp-adv-10" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-exp-adv-10-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) … Behandlungen innerhalb Block randomisiert (<code>subsampling_tray_plot_tbl</code>).
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.13— Verschiedene Arten des Subsamplings. Einmal vollständig innerhalb der Blöcke randomsiert und einmal die Behandlung randomisiert.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="sec-incomplete" class="level2" data-number="26.5">
<h2 data-number="26.5" class="anchored" data-anchor-id="sec-incomplete"><span class="header-section-number">26.5</span> Incomplete block design</h2>
<p>Bei dem <em>incomplete block design</em> haben wir eigentlich ein normales Design, wie das 3-faktorielle <em>randomized complete block design</em> vorliegen, aber die Randomiserung ist nicht vollständig über alle Blöcke. Wir nehmen einmal die beiden Spezialfälle <a href="experimental-design-basic.html#sec-alpha">Alpha design</a> und <a href="experimental-design-basic.html#sec-augment">Augmented design</a> aus der Betrachtung raus. Wir schauen uns hier nochmal zu Vervollständigung das <em>randomized complete block design</em> mit nicht kompletten Blöcken an. Ich persönlich stehe dem Design etwas zwiegesaplten gegenüber. Ich würde lieber die Anzahl der Gruppen der Behandlungen reduzieren als die Blöcke. Wenn du ein Pilotversuch machst um zu schauen welche Linien wachsen oder aber ob es überhaupt einen Effekt einer Behandlung gibt, dann mag das <em>incomplete block design</em> einen Sinn machen. Dann sparst du wirklich Ressourcen und Zeit.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Verliere keine Behandlung im <em>incomplete block design</em>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Achte immer darauf, dass du genug Blöcke hast um auch alle Behandlungslevel aufzunehmen. Schaue lieber doppelt, ob du auch wirklich alle Behandlungen in deinem Versuchsplan drin hast. Es kann schnell passieren, dass du auf einmal nur ein Level der Behandlung oder gar keins mehr in deinem Design vorliegen hast. Das R Paket <code>agricolae</code> versucht das <em>incomplete block design</em> so zu bauen, dass du keine Behandlungen verlierst.</p>
</div>
</div>
<p>Wir immer erstmal unser Modell mit den zwei Behandlungsfaktoren <code>soil</code> und <code>fert</code>. Dann kommt noch der nicht komplette Block <code>inc_block</code> hinzu.</p>
<p><span class="math display">\[
y \sim \overbrace{soil}^{f_1} + \underbrace{fert}_{f_2} + \overbrace{inc\_block}^{f_3}
\]</span></p>
<p>mit</p>
<ul>
<li>dem Faktor Dünger <code>fert</code> und den sechs Düngestufen als Level <code>fe_1</code> bis <code>fe_6</code>.</li>
<li>dem Faktor Boden <code>soil</code> und den vier Bodenarten als Level <code>soil_1</code> bis <code>soil_4</code>.</li>
<li>dem Faktor Block <code>block</code> und den zwei Leveln <code>block_1</code> und <code>block_2</code>.</li>
</ul>
<p>In der <a href="#fig-mermaid-incomplete-1" class="quarto-xref">Abbildung&nbsp;<span>26.14</span></a> sehen wir nochmal die Abhängigkeitsstruktur des <em>incomplete block design</em>. Die beiden Faktoren <code>soil</code> und <code>fert</code> sind in den Blöcken genestet. Wir stellen hier die Linien als gestrichelt dar um auszudrücken, dass wir nur eine nicht komplette Zuordnung der Behandlungsfaktoren zu den Blöcken haben.</p>
<div class="cell" data-fig-width="6" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-mermaid-incomplete-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-incomplete-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-incomplete-1">flowchart LR
    A(fert):::factor -.- B(((nestet))) -.-&gt; E(inc_block):::inc_block
    C(soil):::factor -.- D(((nestet))) -.-&gt; E
    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px
    classDef inc_block fill:#CC79A7,stroke:#333,stroke-width:0.75px
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-incomplete-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.14— Schema der Abhängigkeitsstruktur des <em>incomplete block design</em> für das 3-faktorielle <em>randomized complete block design</em>. Die gestrichelte Linie stellt die nicht vollständige Zuordnung der Behandlungsfaktoren zu den Blöcken dar. Daher sind die Blöcke <code>inc_block</code> nicht komplett.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Dann das Ganze nochmal in dem R Paket <code>{agricolae}</code> mit einem 2-faktoriellen <em>randomized complete block design</em> mit dem Fall der nicht kompletten Blöcke. Wir können in der Standardfunktion von <code>agricolae</code> nur ein 2-faktorielles <em>incomplete block design</em> abbilden. Deshalb dieses etwas kleinere Modell mit einem Behandlungsfaktor <code>trt</code> und einem Block <code>block</code>. Wir werden dann die Behandlungsgruppen nicht komplett auf alle Blöcke randomisieren.</p>
<p><span class="math display">\[
y \sim \overbrace{trt}^{f_1} + \underbrace{inc\_block}_{f_2}
\]</span> mit</p>
<ul>
<li>dem Faktor Behandlung <code>trt</code> und den vier Behandlungsstufen als Level <code>ctrl</code>, <code>A</code>, <code>B</code> und <code>C</code>.</li>
<li>dem Faktor Block <code>soil</code> und den drei Blöcken mit den Leveln <code>1</code>, <code>2</code>, <code>3</code>.</li>
</ul>
<p>Dann schauen wir uns nochmal die die Abhängigkeitsstruktur des <em>incomplete block design</em> in der <a href="#fig-mermaid-incomplete-2" class="quarto-xref">Abbildung&nbsp;<span>26.15</span></a> an. Wir sehen, dass Design ist relativ einfach. Die Behandlungen sind in den Blöcken genestet, aber wir haben nicht alle Behandlungen in allen Blöcken vorliegen.</p>
<div class="cell" data-fig-width="6" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-mermaid-incomplete-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-incomplete-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-incomplete-2">flowchart LR
    C(trt):::factor -.- D(((nestet))) -.-&gt; E(inc_block):::inc_block
    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px
    classDef inc_block fill:#CC79A7,stroke:#333,stroke-width:0.75px
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-incomplete-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.15— Schema der Abhängigkeitsstruktur des <em>incomplete block design</em> für das 2-faktorielle <em>randomized complete block design</em>. Die gestrichelte Linie stellt die nicht vollständige Zuordnung der Behandlungsfaktoren zu den Blöcken dar. Daher sind die Blöcke <code>inc_block</code> nicht komplett.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Wir oben schon geschrieben, die Verwendung von dem R Paket <code>agricolae</code> schützt dich davor, keine der Behandlungslevel zu verlieren. Bei dem Selbermachen musst du dann immer schauen, ob dir der Versuchsplan so passt und alle Behandlungen einigermaßen vertreten und randomisiert sind.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Modell zur Auswertung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wir rechnen ein multiples lineares Modell für die statistische Analyse. Vermutlich reicht die Fallzahl nicht für alle Interaktionen zwischen allen Faktoren.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> fert <span class="sc">+</span> soil <span class="sc">+</span> fert<span class="sc">:</span>soil <span class="sc">+</span> inc_block, <span class="at">data =</span> inc_block_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Wir rechnen ein multiples lineares Modell für die statistische Analyse.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> trt <span class="sc">+</span> inc_block <span class="sc">+</span> trt<span class="sc">:</span>inc_block, <span class="at">data =</span> inc_block_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<section id="mit-expand_grid-3-faktoriell" class="level3" data-number="26.5.1">
<h3 data-number="26.5.1" class="anchored" data-anchor-id="mit-expand_grid-3-faktoriell"><span class="header-section-number">26.5.1</span> … mit <code>expand_grid()</code> (3-faktoriell)</h3>
<p>Bei dem Selbermachen ist es jetzt eigentlich wie bei dem 3-faktoriellen <em>randomized complete block design</em>. Deshalb schaue einfach nochmal oben nach, wenn dir Teile der Generierung unklar sind. Hier und dort ändert sich ja bei mir immer nur leicht der Code, damit du auch mal was anderes siehst. Es gibt ja viele Wege nach Rom.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>incomplete_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">soil =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">fert =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">factor</span>(soil, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">fert =</span> <span class="fu">factor</span>(fert, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">sample</span>(fert),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">sample</span>(soil)) </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>incomplete_long_tbl</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 3
# Groups:   block [2]
   block   soil   fert 
   &lt;fct&gt;   &lt;fct&gt;  &lt;fct&gt;
 1 Block 1 soil_3 fe_3 
 2 Block 1 soil_3 fe_3 
 3 Block 1 soil_1 fe_4 
 4 Block 1 soil_1 fe_6 
 5 Block 1 soil_3 fe_2 
 6 Block 1 soil_3 fe_6 
 7 Block 1 soil_2 fe_2 
 8 Block 1 soil_4 fe_3 
 9 Block 1 soil_1 fe_4 
10 Block 1 soil_2 fe_2 
# ℹ 38 more rows</code></pre>
</div>
</div>
<p>Noch haben wir kein <em>incomplete block design</em> vorliegen, dass bauen wir uns jetzt. Wir rasieren nämlich einfach die letzten beiden Zeilen unseres <em>randomized complete block design</em> ab. Damit haben wir dann nur noch ein <span class="math inline">\(4\times4\)</span>-Block übrig. Sonst wäre es ja ein Block mit sechs Zeilen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>incomplete_plot_tbl <span class="ot">&lt;-</span> incomplete_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rows <span class="sc">&lt;=</span> <span class="dv">4</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Jetzt müssen wir uns die Sachlage einmal anschauen. In der <a href="#fig-exp-adv-7" class="quarto-xref">Abbildung&nbsp;<span>26.16</span></a> sehen wir einmal den Versuchsplan für das <em>incomplete block design</em>. Du musst immer schauen, ob wir wirklich alle Level jedes Behandlungsfaktors auch vorliegen haben und ob sich die Level auch einigermaßen gut verteilen. Das <em>incomplete block design</em> ist da etwas frickelig, ob es dann auch wirklich gut ist. Aber du kannst auch nciht alle Kombinationen vorliegen haben, denn sonst wäre es ja auch kein <em>incomplete block design</em>.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> incomplete_plot_tbl,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Incomplete block design (3-faktoriell)"</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-adv-7" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Abbildung&nbsp;26.16— Incomplete block design (3-faktoriell) für die Faktoren Dünger fert sowie soil randomisiert in den zwei Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.16— Incomplete block design (3-faktoriell) für die Faktoren Dünger <code>fert</code> sowie <code>soil</code> randomisiert in den zwei Blöcken.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mit-fieldhub-2" class="level3" data-number="26.5.2">
<h3 data-number="26.5.2" class="anchored" data-anchor-id="mit-fieldhub-2"><span class="header-section-number">26.5.2</span> … mit <code>{FielDHub}</code></h3>
<p>Für die Erstellung des <em>incomplete block design</em> in der Shiny App schaue dir die Anleitung unter <a href="https://didiermurillof.github.io/FielDHub/reference/incomplete_blocks.html">Generates a Resolvable Incomplete Block Design mit <code>{FielDHub}</code></a> einmal an. Hier einmal der Code für die Erstellung in R. Leider ist das ganz viel rumprobieren, bis es dann mit den Parametern klappt. Dehalb empfhele ich dir hier auf jeden Fall die Shiny App, da kannst du viel einfach rumprobieren und mit den Anzahlen an Behandlungen und Blöcken spielen. Hier generierst du sehr viele Fehlermeldungen und versuchst dann ein Design zu finden was passt, dann musst du es ja noch visualisieren. Die Schritte sind dann in der Shiny App besser miteinander verwoben.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>incomplete_block_obj <span class="ot">&lt;-</span> <span class="fu">incomplete_blocks</span>(<span class="at">t =</span> <span class="dv">6</span>,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">k =</span> <span class="dv">3</span>,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">1984</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>incomplete_block_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 8
      ID LOCATION  PLOT   REP IBLOCK  UNIT ENTRY TREATMENT
   &lt;int&gt;    &lt;int&gt; &lt;dbl&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    
 1     1        1   101     1      1     1     3 G-3      
 2     2        1   102     1      1     2     4 G-4      
 3     3        1   103     1      1     3     6 G-6      
 4     4        1   104     1      2     1     5 G-5      
 5     5        1   105     1      2     2     2 G-2      
 6     6        1   106     1      2     3     1 G-1      
 7     7        1   201     2      1     1     4 G-4      
 8     8        1   202     2      1     2     5 G-5      
 9     9        1   203     2      1     3     6 G-6      
10    10        1   204     2      2     1     3 G-3      
11    11        1   205     2      2     2     1 G-1      
12    12        1   206     2      2     3     2 G-2      
13    13        1   301     3      1     1     2 G-2      
14    14        1   302     3      1     2     5 G-5      
15    15        1   303     3      1     3     6 G-6      
16    16        1   304     3      2     1     1 G-1      
17    17        1   305     3      2     2     4 G-4      
18    18        1   306     3      2     3     3 G-3      </code></pre>
</div>
</div>
<p>Dann erstellen wir auch schon die <a href="#fig-exp-basic-incomplete-fieldhub" class="quarto-xref">Abbildung&nbsp;<span>26.17</span></a> mit dem <em>split plot design</em>. Da wir hier wieder eine relativ einfache Abbildung haben, geht es dann auch mit der Darstellung in <code>{FielDHub}</code>. Leider sind auch hier die Zahlen teilweise sehr schwer auf den Farben zu erkennen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>incomplete_block_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-basic-incomplete-fieldhub" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-basic-incomplete-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-basic-incomplete-fieldhub-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Abbildung&nbsp;26.17— Incomplete block design (2-faktoriell) für den Faktor trt randomisiert in den sechs Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-basic-incomplete-fieldhub-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-basic-incomplete-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.17— Incomplete block design (2-faktoriell) für den Faktor <code>trt</code> randomisiert in den sechs Blöcken.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mit-agricolae-2-faktoriell" class="level3" data-number="26.5.3">
<h3 data-number="26.5.3" class="anchored" data-anchor-id="mit-agricolae-2-faktoriell"><span class="header-section-number">26.5.3</span> … mit <code>{agricolae}</code> (2-faktoriell)</h3>
<p>Der Vorteil von <code>{agricolae}</code> und der Funktion <code>design.bib()</code> ist ganz klar die Effizienz und die optimale Verteilung der Behandlungsfaktoren auf die Blöcke. Wir können hier sicher sein das optimale Ergebnis der Randomisierung zu erhalten und müssen auch keine Sorge haben, das Level der Behandlungen abhanden gekommen sind. Deshalb kann ich hier die Funktion <code>design.bib()</code> in <code>{agricolae}</code> sehr empfehlen.</p>
<p>Die Namen der Optionen sind nicht die Stärke von <code>{agricolae}</code>, also haben wir hier wieder die alten Probleme. Wir müssen darauf achten, dass wir die Anzahl an Blöcken mit <code>k</code> angeben. Wenn du zu wenig Blöcke bei zu vielen Behandlungslevel wählst, dann gibt dir die Funktion einen Fehler wieder und kein Ergebnis. An der Ausgabe der Funktion kannst du dann gleich deine Effizienz gegenüber einer vollständigen Randomisierung abschätzen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>bib_obj <span class="ot">&lt;-</span> <span class="fu">design.bib</span>(<span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"ctrl"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>),</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">k =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">543</span>, <span class="at">serie =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Parameters BIB
==============
Lambda     : 2
treatmeans : 4
Block size : 3
Blocks     : 4
Replication: 3 

Efficiency factor 0.8888889 

&lt;&lt;&lt; Book &gt;&gt;&gt;</code></pre>
</div>
</div>
<p>Wichtig ist hier, dass wir auf den <code>Efficiency factor</code> schauen. Wir sind mit unserer Randomisierung des <em>incomplete block design</em> ungefähr zu 89% so gut wie das gleichwertige <em>randomized complete block design</em>. Das ist schonmal gut. Wir sparen Platz auf dem Feld oder dem Stall und sind trotzdem nicht so viel schlechter als ein vollständig randomisiertes Design. Aber Achtung, die Aussagekraft ist hier geringer, für Pilotstudien ist das immer okay, für echte Feldstudien zur Zulassung oder für wissenschaftliche Publikationen eher weniger bis gar nicht.</p>
<p>Wir müssen in diesem Fall nicht so viel an den Daten bereinigen um uns gleich die Visualisierung anzuschauen. Das geht hier relativ einfach. Wir benennen nur die Spalten um und sind schon soweit fertig.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bib_book_tbl <span class="ot">&lt;-</span> bib_obj <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">"book"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"plots"</span>, <span class="st">"block"</span>, <span class="st">"trt"</span>))</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>bib_book_tbl</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   plots block trt  
   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;
 1   101 1     C    
 2   102 1     B    
 3   103 1     A    
 4   201 2     ctrl 
 5   202 2     C    
 6   203 2     B    
 7   301 3     A    
 8   302 3     ctrl 
 9   303 3     C    
10   401 4     ctrl 
11   402 4     A    
12   403 4     B    </code></pre>
</div>
</div>
<p>Dann ergänzen wir noch die Informationen zu den Spalten und den Zeilen, so dass wir dann auch gleich <code>desplot()</code> nutzen können. Wir müssen hier nochmal nach den Spalten gruppieren, damit wir die Zeilen sauber zugeordnet kriegen. Wir haben ja nicht für jede Behandlung eine Zeile sondern eben weniger. Ja, man hätte auch mit der Information von <code>k = 3</code> hier arbeiten können. So finde ich es aber schöner.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>bib_plot_tbl <span class="ot">&lt;-</span> bib_book_tbl <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cols =</span> <span class="fu">as.numeric</span>(block)) <span class="sc">|&gt;</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cols) <span class="sc">|&gt;</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Einmal der Vergleich zum <code>sketch</code> aus der Ausgabe von <code>design.bib()</code>. Siehst gut aus und entspricht unseren Erwartungen. Du siehst hier gut, dass im ersten Block die Kontrolle gar nicht enthalten ist.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bib_obj <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">"sketch"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]   [,3]   [,4]  
[1,] "C"  "ctrl" "A"    "ctrl"
[2,] "B"  "C"    "ctrl" "A"   
[3,] "A"  "B"    "C"    "B"   </code></pre>
</div>
</div>
<p>In der <a href="#fig-exp-adv-8" class="quarto-xref">Abbildung&nbsp;<span>26.18</span></a> sehen wir die Visualisierung unseres <em>incomplete block design</em> für den Faktor <code>trt</code> randomisiert in den vier Blöcken. Ich finde die farbliche Hinterlegung sehr schön, da sieht man viel schneller die eigentliche Zuordnung der Behandlungslevel zu den Blöcken. Auch siehst du schön, dass in dem vierten Block die Behandlung <code>C</code> gar nicht vorkommt. Was du dann nicht misst, kann auch nicht in der statistischen Auswertung berücksichtigt werden.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(trt <span class="sc">~</span> cols <span class="sc">+</span> rows, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> trt, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> block,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> bib_plot_tbl,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Incomplete block design (2-faktoriell)"</span>, </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">FALSE</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-adv-8" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="Abbildung&nbsp;26.18— Incomplete block design (2-faktoriell) für den Faktor trt randomisiert in den vier Blöcken."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.18— Incomplete block design (2-faktoriell) für den Faktor <code>trt</code> randomisiert in den vier Blöcken.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-strip-plot" class="level2" data-number="26.6">
<h2 data-number="26.6" class="anchored" data-anchor-id="sec-strip-plot"><span class="header-section-number">26.6</span> Strip plot design (3-faktoriell)</h2>
<p>Das Streifenparzellenversuch (eng. <em>strip plot design</em>) ist eigentlich ein doppeltes <em>split plot design</em> oder eben eine Erweiterung. Wo das <em>split plot design</em> in Spalten orientiert ist ergänzen wir jetzt durch das <em>strip plot design</em> noch die horizontale Dimension. Das heißt wir haben eine Randomisierung und Abhängigkeitsstruktur in den Spalten sowie in den Zeilen. Dabei orientieren wir uns an dem <a href="https://kwstat.github.io/agridat/reference/gomez.stripplot.html">Strip-plot experiment of rice</a> aus <span class="citation" data-cites="gomez1984statistical">Gomez und Gomez (<a href="#ref-gomez1984statistical" role="doc-biblioref">1984</a>)</span>. Du findest dann das Datenbeispiel auch in <code>{agridat}</code> als <code>data(gomez.stripplot)</code>. Ich habe versucht jetzt die Daten in der Form nachzubauen und somit kannst du dann auch ähnliche Experimente planen.</p>
<p>Unser <em>strip plot design</em> hat drei Wiederholungen mit <code>block</code>, eine Sorte <code>trt_gen</code> als horizontaler Streifen und Stickstoffdünger <code>trt_nitro</code> als vertikaler Streifen. Das ganze klingt immer super abstrakt, deshalb gehe gerne gleich zur Auflösung in die <a href="#fig-exp-adv-9" class="quarto-xref">Abbildung&nbsp;<span>26.20</span></a>. Manchmal ist es besser sich gleich die Visualisierung anzuschauen und dann das folgende Modell.</p>
<p><span class="math display">\[
y \sim \overbrace{trt_{gen}}^{f_1} + \underbrace{trt_{nitro}}_{f_2} + \overbrace{block}^{f_3}
\]</span></p>
<p>mit</p>
<ul>
<li>dem Faktor Behandlung <code>trt_gen</code> und den sechs Linien als Level <code>G_1</code> bis <code>G_6</code>.</li>
<li>dem Faktor Dünger <code>trt_nitro</code> und den drei Düngestufen als Level <code>0</code>, <code>60</code> und <code>120</code>.</li>
<li>dem Faktor Block <code>block</code> und den drei Leveln <code>1</code> bis <code>3</code>.</li>
</ul>
<p>In der <a href="#fig-mermaid-stripplot" class="quarto-xref">Abbildung&nbsp;<span>26.19</span></a> dann einmal die Abhängigkeitsstruktur des <em>split plot design</em>. Wichtig ist hierbei, dass die genetischen Linien <code>trt_gen</code> in den Zeilen <code>rows</code> der Blöcke genestet und randomisiert sind. Wir sehen aber die Zeilen später nicht in der Auswertung. Die Zeilen werden durch den Faktor Block repräsentiert. Genauso ist es mit der Stickstoffbehandlung <code>trt_nitro</code>, die dann in den Spalten <code>cols</code> des Blocks genested und randomisiert wird. Auch hier sehen wir dann in der späteren Auswertung nur den Block.</p>
<div class="cell" data-fig-width="6" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-mermaid-stripplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-stripplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-stripplot">flowchart LR
    A(trt_gen):::factor --- B(((nestet))) ---&gt; C(rows) --- E(block):::factor
    F(trt_nitro):::factor --- G(((nestet))) ---&gt; H(cols) --- E
    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-stripplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.19— Schema der Abhängigkeitsstruktur des <em>split plot design</em>. Die genetischen Linien <code>trt_gen</code> sind in den Zeilen <code>rows</code> der Blöcke genestet und randomisiert. Die Stickstoffbehandlung <code>trt_nitro</code> ist dann in den Spalten <code>cols</code> des Blocks genested und randomisiert.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Modell zur Auswertung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wir rechnen hier ein lineares gemischtes Modell für die Auswertung der Daten.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(yield <span class="sc">~</span> trt_gen <span class="sc">+</span> nitro <span class="sc">+</span> trt_gen<span class="sc">:</span>nitro <span class="sc">+</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">|</span> block) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> block<span class="sc">:</span>nitro) <span class="sc">+</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">|</span> block<span class="sc">:</span>trt_gen), </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> stripplot_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<section id="mit-agricolae-2" class="level3" data-number="26.6.1">
<h3 data-number="26.6.1" class="anchored" data-anchor-id="mit-agricolae-2"><span class="header-section-number">26.6.1</span> … mit <code>{agricolae}</code></h3>
<p>Das <em>strip plot design</em> kann ich selber machen, aber hier fängt es dann an wirklich so kompliziert zu werden, dass es sich nicht mehr lohnt. Dafür haben wir dann in <code>{agricolae}</code> die passende Funktion. Die würde ich dann auch immer empfehlen zu nutzen, dass macht das Leben wirklich einfacher. Wir müssen zwar wieder erstmal unsere Faktoren als Vektoren bauen und dann alles in den passenden Objekten ablegen, aber das ist nur wenig Aufwand im Vergleich zum Selbermachen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>trt_gen <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"G"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>n_trt_gen <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_gen)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>trt_nitro <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">120</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>n_trt_nitro <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_nitro)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>n_block <span class="ot">&lt;-</span> <span class="dv">3</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Jetzt kommt der einzige wichtige Teil, damit du später die Zeilen- und Spaltenpositionen einfach zuweisen kannst. Du musst in die Option <code>trt1 =</code> den <em>kürzen</em> Vektor packen. Hier hat der Dünger nur drei Level, also ist der Dünger in der Option <code>trt1 =</code> vertreten. Dann nehmen wir den längeren Vektor für die genetischen Linien in die zweite Option <code>trt2 =</code> mit rein. Nimm also erst den kurzen Vektor dann den langen Vektor, dann klappt es auch mit der späteren Zuweisung der Positionen leichter.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>strip_obj <span class="ot">&lt;-</span> <span class="fu">design.strip</span>(<span class="at">trt1 =</span> trt_nitro, <span class="co"># kürzerer Vektor (hier der Länge 3) </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trt2 =</span> trt_gen,   <span class="co"># längerer Vektor (hier der Länge 6)</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">r =</span> n_block, <span class="at">serie =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">543</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Für die Zuweisung der richtigen Zeilen <code>rows</code> und Spalten <code>cols</code> im Positionsgrid müssen wir dann nicht so viel machen, wenn wir oben darauf geachtet haben, die Behandlungsfaktoren in der richtigen Reihenfolge den Optionen zuzuweisen. Die Zuweisung der <code>cols</code> funktioniert also nur, wenn du in der Funktion <code>design.strip()</code> wirklich den kürzeren vor dem längeren Vektor zuweist.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>strip_plot_tbl <span class="ot">&lt;-</span> strip_obj<span class="sc">$</span>book <span class="sc">|&gt;</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span>(n_trt_nitro<span class="sc">*</span>n_block), </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span>n_trt_gen))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann sind wir schon soweit uns einmal in der <a href="#fig-exp-adv-9" class="quarto-xref">Abbildung&nbsp;<span>26.20</span></a> das <em>strip plot design</em> anzuschauen. Du kannst sehr schon sehen, wie die genetischen Linien in den Zeilen randomisiert sind und die verschiedenen Stickstoffgaben dann in den Zeilen. Die drei Blöcke werden dann durch die dicken Linien dargestellt. Da wir es bei dem <em>strip plot design</em> häufig mit Großversuchen zu tun haben sind die Blöcke meistens durch Feldwege oder andere bauliche Bedingungen voneinander getrennt.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(trt_gen <span class="sc">~</span> cols<span class="sc">*</span>rows,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> block, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> trt_nitro, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.regions =</span> cbbPalette, </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> trt_nitro, <span class="at">cex =</span> <span class="dv">1</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> strip_plot_tbl, <span class="at">shorten =</span> <span class="st">"no"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Strip plot design (3-faktoriell)"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-adv-9" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-adv-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-adv-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Abbildung&nbsp;26.20— Strip plot design (3-faktoriell) für den Faktor trt_gen, in den Zeilen randomisiert sowie dem Faktor trt_nitro in den Saplten randomisiert und in drei Blöcken genestet."><img src="experimental-design-advanced_files/figure-html/fig-exp-adv-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-adv-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.20— Strip plot design (3-faktoriell) für den Faktor <code>trt_gen</code>, in den Zeilen randomisiert sowie dem Faktor <code>trt_nitro</code> in den Saplten randomisiert und in drei Blöcken genestet.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mit-fieldhub-3" class="level3" data-number="26.6.2">
<h3 data-number="26.6.2" class="anchored" data-anchor-id="mit-fieldhub-3"><span class="header-section-number">26.6.2</span> … mit <code>{FielDHub}</code></h3>
<p>Für die Erstellung des <em>strip plot design</em> in der Shiny App schaue dir die Anleitung unter <a href="https://didiermurillof.github.io/FielDHub/reference/strip_plot.html">Strip Plot Design mit <code>{FielDHub}</code></a> einmal an. Hier einmal der Code für die Erstellung in R. Der Code ist fast so einfach wie auch eben in <code>{agricolae}</code>. Wir definieren wieder unseren horizontalen Parzellen <code>Hplots</code> und dann noch die vertikalen Parzellen <code>Vplots</code>. So wichtig ist die Zuordnung nicht. Du kannst ja auch einfach das Blatt drehen und dann sind die Parzellen anders angeordnet.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>strip_plot_obj <span class="ot">&lt;-</span> <span class="fu">strip_plot</span>(<span class="at">Hplots =</span> trt_nitro, <span class="co"># kürzerer Vektor (hier der Länge 3) </span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Vplots =</span> trt_gen,   <span class="co"># längerer Vektor (hier der Länge 6)</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">b =</span> n_block)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>strip_plot_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 7
      ID LOCATION  PLOT   REP HSTRIP VSTRIP TRT_COMB
   &lt;int&gt; &lt;fct&gt;    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
 1     1 1         1001     1    120 G6     120|G6  
 2     2 1         1002     1    120 G2     120|G2  
 3     3 1         1003     1    120 G3     120|G3  
 4     4 1         1004     1    120 G1     120|G1  
 5     5 1         1005     1    120 G5     120|G5  
 6     6 1         1006     1    120 G4     120|G4  
 7     7 1         1012     1     60 G6     60|G6   
 8     8 1         1011     1     60 G2     60|G2   
 9     9 1         1010     1     60 G3     60|G3   
10    10 1         1009     1     60 G1     60|G1   
# ℹ 44 more rows</code></pre>
</div>
</div>
<p>Dann erstellen wir auch schon die <a href="#fig-exp-basic-stripplot-fieldhub" class="quarto-xref">Abbildung&nbsp;<span>26.21</span></a> mit dem <em>strip plot design</em>. Da wir hier wieder eine relativ einfache Abbildung haben, geht es dann auch mit der Darstellung in <code>{FielDHub}</code>. Leider sind auch hier die Zahlen teilweise sehr schwer auf den Farben zu erkennen und ich mag die Darstellung mit dem <code>|</code> nicht. Das geht dann wirklich schöner wie du in der <a href="#fig-exp-adv-9" class="quarto-xref">Abbildung&nbsp;<span>26.20</span></a> sehen kannst. Da lohnt sich dann auch die Arbeit mit <code>{desplot}</code> nochmal aus dem Feldbuch was schöneres zu machen. Die Informationen sind ja da.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>strip_plot_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-exp-basic-stripplot-fieldhub" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exp-basic-stripplot-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="experimental-design-advanced_files/figure-html/fig-exp-basic-stripplot-fieldhub-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Abbildung&nbsp;26.21— Strip plot design (3-faktoriell) für den Faktor trt_gen, in den Zeilen randomisiert sowie dem Faktor trt_nitro in den Saplten randomisiert und in drei Blöcken genestet."><img src="experimental-design-advanced_files/figure-html/fig-exp-basic-stripplot-fieldhub-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exp-basic-stripplot-fieldhub-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;26.21— Strip plot design (3-faktoriell) für den Faktor <code>trt_gen</code>, in den Zeilen randomisiert sowie dem Faktor <code>trt_nitro</code> in den Saplten randomisiert und in drei Blöcken genestet.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="referenzen" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="referenzen">Referenzen</h2>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-gomez1984statistical" class="csl-entry" role="listitem">
Gomez KA, Gomez AA. 1984. Statistical procedures for agricultural research. John wiley &amp; sons.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./experimental-design-basic.html" class="pagination-link" aria-label="Einfache Designs">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Einfache Designs</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./experimental-design-samplesize.html" class="pagination-link" aria-label="Fallzahlplanung">
        <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Fallzahlplanung</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Quellcode</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb71" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE}</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(tidyverse, readxl, knitr, kableExtra, Hmisc,</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="in">               grid, agricolae, patchwork, desplot, modelr, see)</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fortgeschrittene Designs {#sec-experimental-design-advanced}</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>*Letzte Änderung am `r format(fs::file_info("experimental-design-advanced.qmd")$modification_time, '%d. %B %Y um %H:%M:%S')`*</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *"The best time to plan an experiment is after you've done it." --- Roland Fisher*</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>In diesem Kapitel wollen wir uns mit der Erstellung von komplexeren experimentellen Designs beschäftigen. Wie immer nicht mit der Auswertung, aber ich habe dir Modellierungsvorschläge immer wieder angegeben.</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Randomized complete block design (RCBD, 3-faktoriell)</span><span class="co">](#sec-rcbd-3fac)</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Split plot design (3-faktoriell) oder Spaltanlage</span><span class="co">](#sec-split)</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Subsampling</span><span class="co">](#sec-subsampling)</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Incomplete block design (3-faktoriell und 2-faktoriell)</span><span class="co">](#sec-incomplete)</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Strip plot design (3-faktoriell) oder Streifenanlage</span><span class="co">](#sec-strip-plot)</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>Dabei ist zu Bedenken, dass diese Designs sehr viel Aufwand in der Anlegen der Anlage sowie der praktischen Auswertung auf dem Feld bedürfen. Hier musst du dich dann nochmal beraten lassen, bevor du mit einem Experiment startest. Wir schauen uns jetzt aber erstmal einen Überblick über die gängigsten komplexeren experimentellen Designs an. Beachte auch die kurze Veröffentlichung über <span class="co">[</span><span class="ot">Versuchsergebnisse interpretieren</span><span class="co">](https://www.dlg.org/de/landwirtschaft/themen/pflanzenbau/pflanzenernaehrung/dlg-kompakt-3-2021)</span> der DLG e.V. - Deutsche Landwirtschafts-Gesellschaft. Dort findest du nochmal mehr Kontext über komplexere experimentelle Designs und Grundsätze für die Interpretation von Versuchsergebnissen, die du natürlich auch auf deine Planungen übertragen kannst. Bevor du die Ergebnisse interpretieren kannst musst du ja eine solide Versuchsplanung durchgeführt haben.</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Auf ein Wort zum Umfang des Kapitels</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>Ich werde mich in diesem Kapitel für das Erste auf die wichtigen experimentellen Design beschränken. Wenn sich aus der Lehre oder Beratungstätigkeit noch Bedarf an weiteren experimentellen Designs ergibt, werde ich die Designs entsprechend ergänzen. Insbesondere hier gilt, dass <span class="co">[</span><span class="ot">DSFAIR - Data Science for Agriculture in R</span><span class="co">](https://schmidtpaul.github.io/DSFAIR/DesigningExperiments.html)</span> einen sehr umfangreichen Überblick über experimentelle Designs und deren Auswertung liefert.</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>**Wenn dir ein experimentelles Design fehlt, dann schreibe mir gerne eine Mail und ich schaue, dass ich das experimentelle Design ergänze.**</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>Mehr Informationen findest du auch durch das Inhaltsverzeichnis von dem R Paket <span class="in">`agricolae`</span> mit <span class="co">[</span><span class="ot">Experimental Designs with {agricolae}</span><span class="co">](https://myaseen208.com/agricolae/articles/ExperimentalDesign.html)</span>. Auch ist es sehr hilfreich sich Datenbeispiele auf <span class="co">[</span><span class="ot">{agridat} - Datensätze mit Abbildungen in `{desplot}`</span><span class="co">](https://kwstat.github.io/agridat/reference/index.html)</span> anzuschauen. Am meisten hilft vermutlich auch die Referenzliste des <span class="co">[</span><span class="ot">R Paketes `{FielDHub}`</span><span class="co">](https://didiermurillof.github.io/FielDHub/reference/index.html)</span>. Leider sind die generischen Abbildungen in <span class="in">`{FielDHub}`</span> nicht so toll, wie die Abbildungen, die du dir selber in <span class="in">`{desplot}`</span> baust.</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>Das charmante an dem neuen R Paket <span class="in">`{FielDHub}`</span> ist die Verbindung einer Shiny App zusammen mit dem normalen Code, den du hier siehst. Ich habe dir immer die Referenz zu <span class="in">`{FielDHub}`</span> hinzugefügt, in der ist auch die Anleitung zu finden für die Shiny App. Um <span class="in">`{FielDHub}`</span> im Browser zu starten, musst du nur folgenden Code in R ausführen, nachdem du das R Paket installiert hast.</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FielDHub)</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a><span class="fu">run_app</span>()</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a>In der @fig-exp-adv-1 sehen wir einmal die Übersicht über die drei häufigsten komplexeren experimentellen Designs mit dem RCBD (3-faktoriell), dem Split plot Design (3-faktoriell) sowie dem Subsampling eines RCBD (2-faktoriell). Die drei experimentellen Designs werden immer mal wieder etwas durcheinander gewirbelt. Du kannst dir im Prinzip die Sachlage wie folgt vorstellen. Im RCBD (3-faktoriell) werden die beiden Behandlungsfaktoren über die Blöcke randomsiert. Die beiden Behandlungen sind vollkommen durcheinander in der @fig-exp-adv-1-1. Im Fall eines Split plot Design (3-faktoriell) wird eine Behandlung innerhalb der anderen Behandlung über die Blöcke randomisiert. Wir haben also eine Spaltanlage vorliegen, da wir immer eine Behandlung in einer Spalte randomisieren. Das ist schon in der @fig-exp-adv-1-2 zu sehen. Die Farben bilden die zweite Behandlung ab. Innerhalb einer Spalte ist dann die erste Behandlung randomisiert. Das Subsampling nimmt jetzt eine Behandlung raus. Wir haben dann nur noch eine Behandlung als Faktor, die wir in den Blöcken randomisieren. Die Idee des Subsamplings ist nun, dass wir wiederholt Pflanzen innerhalb der Behandlung messen. Wir mitteln jetzt aber nicht über die Pflanzen in einem Block sondern nehmen alle Pflanzen mit in die statistische Auswertung. Das ist eigentlich die zentrale Idee des Subsamplings, wie wir das machen, ist dann die andere Frage. In der @fig-exp-adv-1-3 sehen wir schön wie sich die Pflanzen-ID's über das Feld verteilen. Die Farben stellen die vier Behandlungslevel dar.</span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-1</span></span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Vergleich der drei häufigsten komplexeren experimentellen Designs mit dem RCBD (3-faktoriell), dem Split plot Design (3-faktoriell) sowie dem Subsampling eines RCBD (2-faktoriell). Die Zahlen bei dem Subsampling stellt die ID's der individuellen Beobachtungen dar."</span></span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Sechs Eisendüngerbehandlung (Text: fe_1 bis fe_6) sowie vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) in vier Blöcken."</span></span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Sechs Eisendüngerbehandlung (Text: fe_1 bis fe_6) sowie vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) in vier Blöcken."</span></span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Vier Bodenbehandlung (Farbe: schwarz, rot, orange, grün) mit den individuellen Beobachtungen in vier Blöcken."</span></span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 1</span></span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-60"><a href="#cb71-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-61"><a href="#cb71-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-62"><a href="#cb71-62" aria-hidden="true" tabindex="-1"></a>trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)    </span>
<span id="cb71-63"><a href="#cb71-63" aria-hidden="true" tabindex="-1"></a>n_trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac1_soil) </span>
<span id="cb71-64"><a href="#cb71-64" aria-hidden="true" tabindex="-1"></a>trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)  </span>
<span id="cb71-65"><a href="#cb71-65" aria-hidden="true" tabindex="-1"></a>n_trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac2_fert) </span>
<span id="cb71-66"><a href="#cb71-66" aria-hidden="true" tabindex="-1"></a>n_block <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb71-67"><a href="#cb71-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-68"><a href="#cb71-68" aria-hidden="true" tabindex="-1"></a><span class="do">## rcbd</span></span>
<span id="cb71-69"><a href="#cb71-69" aria-hidden="true" tabindex="-1"></a>fac2rcbd_out <span class="ot">&lt;-</span> <span class="fu">design.ab</span>(<span class="at">trt =</span> <span class="fu">c</span>(n_trt_fac2_fert, n_trt_fac1_soil), </span>
<span id="cb71-70"><a href="#cb71-70" aria-hidden="true" tabindex="-1"></a>                          <span class="at">design =</span> <span class="st">"rcbd"</span>,</span>
<span id="cb71-71"><a href="#cb71-71" aria-hidden="true" tabindex="-1"></a>                          <span class="at">r =</span> n_block, </span>
<span id="cb71-72"><a href="#cb71-72" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb71-73"><a href="#cb71-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-74"><a href="#cb71-74" aria-hidden="true" tabindex="-1"></a>fac2rcbd_out<span class="sc">$</span>bookRowCol <span class="ot">&lt;-</span> fac2rcbd_out<span class="sc">$</span>book <span class="sc">|&gt;</span></span>
<span id="cb71-75"><a href="#cb71-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand.grid</span>(<span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span>n_trt_fac2_fert,</span>
<span id="cb71-76"><a href="#cb71-76" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span>(n_trt_fac1_soil<span class="sc">*</span>n_block))) <span class="sc">|&gt;</span> </span>
<span id="cb71-77"><a href="#cb71-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt_fac2_fert =</span> <span class="fu">paste0</span>(<span class="st">"fe_"</span>, A),</span>
<span id="cb71-78"><a href="#cb71-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">trt_fac1_soil =</span> <span class="fu">paste0</span>(<span class="st">"soil_"</span>, B),</span>
<span id="cb71-79"><a href="#cb71-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">paste0</span>(<span class="st">"Block "</span>, block))</span>
<span id="cb71-80"><a href="#cb71-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-81"><a href="#cb71-81" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-82"><a href="#cb71-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-83"><a href="#cb71-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-84"><a href="#cb71-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> trt_fac2_fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col=</span>trt_fac1_soil,</span>
<span id="cb71-85"><a href="#cb71-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> fac2rcbd_out<span class="sc">$</span>bookRowCol,</span>
<span id="cb71-86"><a href="#cb71-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Randomized complete block design (3-faktoriell)"</span>, </span>
<span id="cb71-87"><a href="#cb71-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">FALSE</span>, <span class="at">key.cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb71-88"><a href="#cb71-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-89"><a href="#cb71-89" aria-hidden="true" tabindex="-1"></a><span class="do">## split plot</span></span>
<span id="cb71-90"><a href="#cb71-90" aria-hidden="true" tabindex="-1"></a>splitplot_out <span class="ot">&lt;-</span> <span class="fu">design.split</span>(<span class="at">trt1 =</span> trt_fac1_soil,</span>
<span id="cb71-91"><a href="#cb71-91" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trt2 =</span> trt_fac2_fert,</span>
<span id="cb71-92"><a href="#cb71-92" aria-hidden="true" tabindex="-1"></a>                              <span class="at">r =</span> n_block,</span>
<span id="cb71-93"><a href="#cb71-93" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb71-94"><a href="#cb71-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-95"><a href="#cb71-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-96"><a href="#cb71-96" aria-hidden="true" tabindex="-1"></a>splitplot_out<span class="sc">$</span>bookRowCol <span class="ot">&lt;-</span> splitplot_out<span class="sc">$</span>book <span class="sc">|&gt;</span> </span>
<span id="cb71-97"><a href="#cb71-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">paste0</span>(<span class="st">"Block "</span>, block),</span>
<span id="cb71-98"><a href="#cb71-98" aria-hidden="true" tabindex="-1"></a>         <span class="at">cols =</span> plots <span class="sc">|&gt;</span> <span class="fu">str_sub</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb71-99"><a href="#cb71-99" aria-hidden="true" tabindex="-1"></a>         <span class="at">rows =</span> splots <span class="sc">|&gt;</span> <span class="fu">as.integer</span>())</span>
<span id="cb71-100"><a href="#cb71-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-101"><a href="#cb71-101" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-102"><a href="#cb71-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-103"><a href="#cb71-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-104"><a href="#cb71-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> trt_fac2_fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col=</span>trt_fac1_soil,</span>
<span id="cb71-105"><a href="#cb71-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> splitplot_out<span class="sc">$</span>bookRowCol ,</span>
<span id="cb71-106"><a href="#cb71-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Split plot design (3-faktoriell)"</span>,</span>
<span id="cb71-107"><a href="#cb71-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">FALSE</span>, <span class="at">key.cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb71-108"><a href="#cb71-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-109"><a href="#cb71-109" aria-hidden="true" tabindex="-1"></a><span class="do">## subsampling</span></span>
<span id="cb71-110"><a href="#cb71-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-111"><a href="#cb71-111" aria-hidden="true" tabindex="-1"></a>rcbd_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb71-112"><a href="#cb71-112" aria-hidden="true" tabindex="-1"></a>                             <span class="at">trt =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb71-113"><a href="#cb71-113" aria-hidden="true" tabindex="-1"></a>                             <span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-114"><a href="#cb71-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">factor</span>(trt, <span class="at">labels =</span> trt_fac1_soil),</span>
<span id="cb71-115"><a href="#cb71-115" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb71-116"><a href="#cb71-116" aria-hidden="true" tabindex="-1"></a>         <span class="at">pid =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb71-117"><a href="#cb71-117" aria-hidden="true" tabindex="-1"></a>         <span class="at">pid_text =</span> <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">96</span>, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb71-118"><a href="#cb71-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb71-119"><a href="#cb71-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">sample</span>(trt)) </span>
<span id="cb71-120"><a href="#cb71-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-121"><a href="#cb71-121" aria-hidden="true" tabindex="-1"></a>rcbd_plot_tbl <span class="ot">&lt;-</span> rcbd_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb71-122"><a href="#cb71-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb71-123"><a href="#cb71-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-124"><a href="#cb71-124" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(<span class="at">data =</span> rcbd_plot_tbl, <span class="at">flip =</span> <span class="cn">TRUE</span>, </span>
<span id="cb71-125"><a href="#cb71-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">form =</span> block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block,</span>
<span id="cb71-126"><a href="#cb71-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> trt, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-127"><a href="#cb71-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> pid, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-128"><a href="#cb71-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Subsampling (2-faktoriell)"</span>, </span>
<span id="cb71-129"><a href="#cb71-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> pid_text, </span>
<span id="cb71-130"><a href="#cb71-130" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">show.key =</span> <span class="cn">FALSE</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> trt) </span>
<span id="cb71-131"><a href="#cb71-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-132"><a href="#cb71-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-133"><a href="#cb71-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-134"><a href="#cb71-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-135"><a href="#cb71-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-136"><a href="#cb71-136" aria-hidden="true" tabindex="-1"></a><span class="fu">## Genutzte R Pakete</span></span>
<span id="cb71-137"><a href="#cb71-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-138"><a href="#cb71-138" aria-hidden="true" tabindex="-1"></a>Wir wollen folgende R Pakete in diesem Kapitel nutzen.</span>
<span id="cb71-139"><a href="#cb71-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-140"><a href="#cb71-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = TRUE}</span></span>
<span id="cb71-141"><a href="#cb71-141" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb71-142"><a href="#cb71-142" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(tidyverse, magrittr, agricolae, dae, desplot,</span></span>
<span id="cb71-143"><a href="#cb71-143" aria-hidden="true" tabindex="-1"></a><span class="in">               janitor, FielDHub,</span></span>
<span id="cb71-144"><a href="#cb71-144" aria-hidden="true" tabindex="-1"></a><span class="in">               conflicted)</span></span>
<span id="cb71-145"><a href="#cb71-145" aria-hidden="true" tabindex="-1"></a><span class="in">conflicts_prefer(dplyr::filter)</span></span>
<span id="cb71-146"><a href="#cb71-146" aria-hidden="true" tabindex="-1"></a><span class="in">conflicts_prefer(magrittr::set_names)</span></span>
<span id="cb71-147"><a href="#cb71-147" aria-hidden="true" tabindex="-1"></a><span class="in">cbbPalette &lt;- c("#000000", "#E69F00", "#56B4E9", "#009E73", </span></span>
<span id="cb71-148"><a href="#cb71-148" aria-hidden="true" tabindex="-1"></a><span class="in">                "#F0E442", "#0072B2", "#D55E00", "#CC79A7")</span></span>
<span id="cb71-149"><a href="#cb71-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-150"><a href="#cb71-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-151"><a href="#cb71-151" aria-hidden="true" tabindex="-1"></a>An der Seite des Kapitels findest du den Link *Quellcode anzeigen*, über den du Zugang zum gesamten R-Code dieses Kapitels erhältst.</span>
<span id="cb71-152"><a href="#cb71-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-153"><a href="#cb71-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## Randomized complete block design (RCBD, 3-faktoriell) {#sec-rcbd-3fac}</span></span>
<span id="cb71-154"><a href="#cb71-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-155"><a href="#cb71-155" aria-hidden="true" tabindex="-1"></a>Das Maximum des machbaren ist eigentlich ein dreifaktorielles Modell im *randomized complete block design*. Natürlich geht auch noch mehr, aber der Grundsatz ist eigentlich, dass wir uns maximal zwei Behandlungsfaktoren und dann ein bis zwei Cluster anschauen. Die Cluster sind dann meist einmal der klassische Block plus ein Faktor für verschiedene Lokalisationen. Wir nehmen hier jetzt einmal zwei Behandlungsfaktoren und dann noch einen klassischen Block dazu. Beide Behandlungsfaktoren sind ineinander und dann natürlich im Block genestet. Hier aber erstmal das Modell mit den drei Faktoren für den besseren Überblick. Wir haben einmal die Düngung <span class="in">`fert`</span>, dann den Faktor Boden <span class="in">`soil`</span> sowie die verschiedenen Blöcke durch <span class="in">`block`</span>.</span>
<span id="cb71-156"><a href="#cb71-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-157"><a href="#cb71-157" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-158"><a href="#cb71-158" aria-hidden="true" tabindex="-1"></a>y \sim \overbrace{soil}^{f_1} + \underbrace{fert}_{f_2} + \overbrace{block}^{f_3}</span>
<span id="cb71-159"><a href="#cb71-159" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-160"><a href="#cb71-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-161"><a href="#cb71-161" aria-hidden="true" tabindex="-1"></a>mit</span>
<span id="cb71-162"><a href="#cb71-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-163"><a href="#cb71-163" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Dünger <span class="in">`fert`</span> und den sechs Düngestufen als Level <span class="in">`fe_1`</span> bis <span class="in">`fe_6`</span>.</span>
<span id="cb71-164"><a href="#cb71-164" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Boden <span class="in">`soil`</span> und den vier Bodenarten als Level <span class="in">`soil_1`</span> bis <span class="in">`soil_4`</span>.</span>
<span id="cb71-165"><a href="#cb71-165" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Block <span class="in">`block`</span> und den zwei Leveln <span class="in">`block_1`</span> und <span class="in">`block_2`</span>.</span>
<span id="cb71-166"><a href="#cb71-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-167"><a href="#cb71-167" aria-hidden="true" tabindex="-1"></a>Die Struktur der Daten ist wie folgt gegeben. Jedes Level der Düngerstufe <span class="in">`fert`</span> ist in dem Faktor des Bodens <span class="in">`soil`</span> enthalten. Die beiden Behandlungen sind dann wiederum jeweils vollständig in den Blöcken <span class="in">`block`</span> vorhanden. In der @fig-mermaid-adv-rcbd sehen wir einmal den Zusammenhang zwischen den drei Faktoren</span>
<span id="cb71-168"><a href="#cb71-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-171"><a href="#cb71-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb71-172"><a href="#cb71-172" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-mermaid-adv-rcbd</span></span>
<span id="cb71-173"><a href="#cb71-173" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-width: 6</span></span>
<span id="cb71-174"><a href="#cb71-174" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: "text"</span></span>
<span id="cb71-175"><a href="#cb71-175" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb71-176"><a href="#cb71-176" aria-hidden="true" tabindex="-1"></a><span class="in">    A(fert):::factor --- B(((nestet))) --&gt; E(block):::factor</span></span>
<span id="cb71-177"><a href="#cb71-177" aria-hidden="true" tabindex="-1"></a><span class="in">    C(soil):::factor --- D(((nestet))) --&gt; E</span></span>
<span id="cb71-178"><a href="#cb71-178" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-179"><a href="#cb71-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-180"><a href="#cb71-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-181"><a href="#cb71-181" aria-hidden="true" tabindex="-1"></a>Wir wollen uns jetzt die Daten einmal selber erstellen und das R Paket <span class="in">`agricolae`</span> nutzen um uns ein passendes Design zu bauen. Abschließend schauen wir uns den Versuchsplan einmal mit <span class="in">`desplot`</span> an.</span>
<span id="cb71-182"><a href="#cb71-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-183"><a href="#cb71-183" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb71-184"><a href="#cb71-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modell zur Auswertung</span></span>
<span id="cb71-185"><a href="#cb71-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-186"><a href="#cb71-186" aria-hidden="true" tabindex="-1"></a>Wir rechnen ein multiples lineares Modell für die statistische Analyse.</span>
<span id="cb71-187"><a href="#cb71-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-190"><a href="#cb71-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-191"><a href="#cb71-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-192"><a href="#cb71-192" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> soil <span class="sc">+</span> fert <span class="sc">+</span> soil<span class="sc">:</span>fert <span class="sc">+</span> block, <span class="at">data =</span> rcbd_3f_tbl)</span>
<span id="cb71-193"><a href="#cb71-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-194"><a href="#cb71-194" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-195"><a href="#cb71-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-196"><a href="#cb71-196" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `expand_grid()`</span></span>
<span id="cb71-197"><a href="#cb71-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-198"><a href="#cb71-198" aria-hidden="true" tabindex="-1"></a>Bei dem *randomized complete block design* haben wir ja Glück, wir müssen nur darauf achten, das die einzelnen Beobachtungen innerhalb der Blöcke vollständig randomisiert sind. Daher Randomisieren wir ganz am Ende einmal die Saplte <span class="in">`fert`</span> und die Spalte <span class="in">`soil`</span> durch. Wir hätten uns das <span class="in">`mutate()`</span> auch sparen können und stattdessen einfach die Funktion <span class="in">`slice_sample(prop = 1)`</span> nutzen. Die Funktion permutiert dann alles innerhalb der gruppierten Blöcke durch. Mach wie es dir besser gefällt und du es besser nachvollziehen kannst.</span>
<span id="cb71-199"><a href="#cb71-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-202"><a href="#cb71-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-203"><a href="#cb71-203" aria-hidden="true" tabindex="-1"></a>three_fct_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">soil =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">fert =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-204"><a href="#cb71-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb71-205"><a href="#cb71-205" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">factor</span>(soil, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb71-206"><a href="#cb71-206" aria-hidden="true" tabindex="-1"></a>         <span class="at">fert =</span> <span class="fu">factor</span>(fert, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb71-207"><a href="#cb71-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb71-208"><a href="#cb71-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">sample</span>(fert), <span class="co"># Randomisierung fert</span></span>
<span id="cb71-209"><a href="#cb71-209" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">sample</span>(soil)) <span class="co"># Randomisierung soil</span></span>
<span id="cb71-210"><a href="#cb71-210" aria-hidden="true" tabindex="-1"></a>three_fct_long_tbl</span>
<span id="cb71-211"><a href="#cb71-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-212"><a href="#cb71-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-213"><a href="#cb71-213" aria-hidden="true" tabindex="-1"></a>Jetzt mache ich es etwas anders bei der Erstellung des Grids der Spalten und Zeilen. Ich will später beim <span class="in">`desplot()`</span> für die Blöcke durch <span class="in">`| block`</span> separieren. Daher setzte ich die Spaltennummerierung <span class="in">`cols`</span> jeweils auf 1 bis 4 und bilde die Blöcke durch ein davor geschaltetes <span class="in">`rep`</span> ab. Wenn du die Variable <span class="in">`rep`</span> nicht möchtest, kannst du auch die <span class="in">`cols`</span> auf 1 bis 8 setzten, darfst dann aber nicht für die Blöcke durch <span class="in">`rep`</span> separieren.</span>
<span id="cb71-214"><a href="#cb71-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-217"><a href="#cb71-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-218"><a href="#cb71-218" aria-hidden="true" tabindex="-1"></a>three_fct_plot_tbl <span class="ot">&lt;-</span> three_fct_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb71-219"><a href="#cb71-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb71-220"><a href="#cb71-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-221"><a href="#cb71-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-222"><a href="#cb71-222" aria-hidden="true" tabindex="-1"></a>In der @fig-exp-adv-6 sehen wir dann einmal das *randomized complete block design* mit drei Faktoren einmal dargestellt. Wir sehen gut, wie die zwei Behandlungen vollständig randomisiert wurden. Beachte, dass die Farben den Faktor <span class="in">`soil`</span> darstellen und die Labels dann den Faktor <span class="in">`fert`</span>. Du kannst mit der Option <span class="in">`show.key = FALSE`</span> auch die Legende ausschalten. Bei sehr komplexen Designs mit vielen Faktorstufen ist es dann doch mal ratsam, sich die Legende mit ausgeben zu lassen.</span>
<span id="cb71-223"><a href="#cb71-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-226"><a href="#cb71-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-227"><a href="#cb71-227" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-228"><a href="#cb71-228" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-229"><a href="#cb71-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-6</span></span>
<span id="cb71-230"><a href="#cb71-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-231"><a href="#cb71-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb71-232"><a href="#cb71-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-233"><a href="#cb71-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Randomized complete block design (3-faktoriell) für die Faktoren Dünger `fert` sowie `soil` vollständig randomisiert in den beiden Blöcken."</span></span>
<span id="cb71-234"><a href="#cb71-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-235"><a href="#cb71-235" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-236"><a href="#cb71-236" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-237"><a href="#cb71-237" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-238"><a href="#cb71-238" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, </span>
<span id="cb71-239"><a href="#cb71-239" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> soil, </span>
<span id="cb71-240"><a href="#cb71-240" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> three_fct_plot_tbl ,</span>
<span id="cb71-241"><a href="#cb71-241" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Randomized complete block design (3-faktoriell)"</span>,</span>
<span id="cb71-242"><a href="#cb71-242" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-243"><a href="#cb71-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-244"><a href="#cb71-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-245"><a href="#cb71-245" aria-hidden="true" tabindex="-1"></a>Auch hier können wir dann den Versuchsplan relativ einfach raus schreiben. Ich entferne noch die Spalte <span class="in">`rep`</span>, da ich die Spalte nicht weiter brauchen werde. Dann wären wir auch schon mit dem Design fertig.</span>
<span id="cb71-246"><a href="#cb71-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-249"><a href="#cb71-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-250"><a href="#cb71-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb71-251"><a href="#cb71-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-252"><a href="#cb71-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-253"><a href="#cb71-253" aria-hidden="true" tabindex="-1"></a>three_fct_plot_tbl <span class="sc">|&gt;</span> </span>
<span id="cb71-254"><a href="#cb71-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>rep) <span class="sc">|&gt;</span> </span>
<span id="cb71-255"><a href="#cb71-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="st">"template_sheet.xlsx"</span>)</span>
<span id="cb71-256"><a href="#cb71-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-257"><a href="#cb71-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-258"><a href="#cb71-258" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{FielDHub}`</span></span>
<span id="cb71-259"><a href="#cb71-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-260"><a href="#cb71-260" aria-hidden="true" tabindex="-1"></a>Für die Erstellung des *randomized complete block design* in der Shiny App schaue dir die Anleitung unter <span class="co">[</span><span class="ot">Generates a Full Factorial Design mit `{FielDHub}`</span><span class="co">](https://didiermurillof.github.io/FielDHub/reference/full_factorial.html)</span> einmal an. Hier einmal der Code für die Erstellung in R. Wir haben jetzt vier Behandlungen für den Faktor <span class="in">`soil`</span> sowie sechs Behandlungen für den Faktor <span class="in">`fe`</span> vorliegen und wollen jeweils drei Blöcke anlegen. Jetzt einmal die generische Funktion <span class="in">`full_factorial()`</span> in der wir aber keine Namen der Level übergeben können. Ohne die Namen wird die Abbildung maximal wirr. Ich erkenne dann gar nichts mehr, wenn ich nur noch Zahlen stehen habe.</span>
<span id="cb71-261"><a href="#cb71-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-264"><a href="#cb71-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-265"><a href="#cb71-265" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="ot">&lt;-</span> <span class="fu">full_factorial</span>(<span class="at">setfactors =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>), </span>
<span id="cb71-266"><a href="#cb71-266" aria-hidden="true" tabindex="-1"></a>                                <span class="at">reps =</span> <span class="dv">3</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">2</span>)</span>
<span id="cb71-267"><a href="#cb71-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-268"><a href="#cb71-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-269"><a href="#cb71-269" aria-hidden="true" tabindex="-1"></a>Deshalb gibt es die Möglichkeit sich ein Grid zu erstellen und anhand der Namen des Grid dann die Parzellen zu benennen. Leider ist das Vorgehen etwas suboptimal was das Einfärben gleich angeht.</span>
<span id="cb71-270"><a href="#cb71-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-273"><a href="#cb71-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-274"><a href="#cb71-274" aria-hidden="true" tabindex="-1"></a>data_factorial <span class="ot">&lt;-</span> <span class="fu">lst</span>(<span class="at">fct =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"soil"</span>, <span class="st">"fe"</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>))),</span>
<span id="cb71-275"><a href="#cb71-275" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lvl =</span> <span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb71-276"><a href="#cb71-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb71-277"><a href="#cb71-277" aria-hidden="true" tabindex="-1"></a>data_factorial</span>
<span id="cb71-278"><a href="#cb71-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-279"><a href="#cb71-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-280"><a href="#cb71-280" aria-hidden="true" tabindex="-1"></a>Wir bauen uns jetzt die Daten mit der Funktion <span class="in">`full_factorial()`</span> setzen aber die Option <span class="in">`setfactors = NULL`</span> damit die Funktion die Faktoren und deren Level aus unserem Datensatz <span class="in">`data_factorial`</span> nimmt. Das ist jetzt auch nur so semi praktisch, aber immerhin könnten wir hier beliebig viele Faktoren prinzipiell nehmen.</span>
<span id="cb71-281"><a href="#cb71-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-284"><a href="#cb71-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-285"><a href="#cb71-285" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="ot">&lt;-</span> <span class="fu">full_factorial</span>(<span class="at">setfactors =</span> <span class="cn">NULL</span>, <span class="at">reps =</span> <span class="dv">3</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">2</span>,</span>
<span id="cb71-286"><a href="#cb71-286" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> data_factorial) </span>
<span id="cb71-287"><a href="#cb71-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-288"><a href="#cb71-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-289"><a href="#cb71-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-290"><a href="#cb71-290" aria-hidden="true" tabindex="-1"></a>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst. Nicht immer brauchst du alle Informationen. Zum Beispiel ist der Ort <span class="in">`location`</span>, wo das Experiment durchgeführt wird eher zweitrangig. Du könntest dir auch zusätzliche Daten generieren lassen, aber das kannst du dir dann auch selber mit Werten ausdenken.</span>
<span id="cb71-291"><a href="#cb71-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-294"><a href="#cb71-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-295"><a href="#cb71-295" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb71-296"><a href="#cb71-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb71-297"><a href="#cb71-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-298"><a href="#cb71-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-299"><a href="#cb71-299" aria-hidden="true" tabindex="-1"></a>Dann erstellen wir auch schon die @fig-exp-basic-fac3-fieldhub mit dem *randomized complete block design*. Leider ist die Abbildung nur noch an der Grenze zu okay. Wir haben wilde Farben, die jeweils die Faktorkombination wiedergeben. Leider helfen die Farben wenig und auch ist alles sehr unübersichtlich. Das Paket <span class="in">`{desplot}`</span> kann definitiv mehr. Hier würde ich dann wirklich auf den Plot hier aus <span class="in">`{FielDHub}`</span> verzichten und stattdessen mir den Plot wie oben in der @fig-exp-adv-6 aus den den Feldbuch selber bauen.</span>
<span id="cb71-300"><a href="#cb71-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-303"><a href="#cb71-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-304"><a href="#cb71-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-305"><a href="#cb71-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-306"><a href="#cb71-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-basic-fac3-fieldhub</span></span>
<span id="cb71-307"><a href="#cb71-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-308"><a href="#cb71-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb71-309"><a href="#cb71-309" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb71-310"><a href="#cb71-310" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Schema der Pflanzungen nach den Behandlungen für das *randomized complete block design*. Die Farbwhal und die Beschriftung ist mehr als gewöhnungsbedürftig. Die Abbildung ist nicht sehr übersichtlich und nur begrenzt als Darstellung geeignet."</span></span>
<span id="cb71-311"><a href="#cb71-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-312"><a href="#cb71-312" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb71-313"><a href="#cb71-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-314"><a href="#cb71-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-315"><a href="#cb71-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{agricolae}`</span></span>
<span id="cb71-316"><a href="#cb71-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-317"><a href="#cb71-317" aria-hidden="true" tabindex="-1"></a>Jetzt bauen wir unser Design nochmal in <span class="in">`{agricolae}`</span> nach. Hier brauchen wir dann aber alles als Vektor, sonst wird es zu unübersichtlich in den Funktionen. Darüber hinaus ist es dann auch mal was anders und du siehst nochmal eine andere Art den Code zu schreiben. Prinzipiell hätten wir auch im vorherigen Teil alles erstmal in Vektoren lagern können. Aber gut, hier erstmal alle Level der Faktoren vorbereiten und die Anzahl der Blöcke auf vier gesetzt. Dann brauchen wir noch die Länge der Level, also die Anzahl an Düngerstufen und Bodenarten. Dafür nutzen wir die Funktion <span class="in">`distinct_n()`</span>.</span>
<span id="cb71-318"><a href="#cb71-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-321"><a href="#cb71-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-322"><a href="#cb71-322" aria-hidden="true" tabindex="-1"></a>trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)    </span>
<span id="cb71-323"><a href="#cb71-323" aria-hidden="true" tabindex="-1"></a>n_trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac1_soil) </span>
<span id="cb71-324"><a href="#cb71-324" aria-hidden="true" tabindex="-1"></a>trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)  </span>
<span id="cb71-325"><a href="#cb71-325" aria-hidden="true" tabindex="-1"></a>n_trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac2_fert) </span>
<span id="cb71-326"><a href="#cb71-326" aria-hidden="true" tabindex="-1"></a>n_block <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb71-327"><a href="#cb71-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-328"><a href="#cb71-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-329"><a href="#cb71-329" aria-hidden="true" tabindex="-1"></a>Dann können wir schon das *randomized complete block design* mit drei Faktoren über die Funktion <span class="in">`design.ab()`</span> erstellen. Wie immer heißt die Wiederholung auch hier <span class="in">`r`</span>, das ist zwar sehr einheitlich aber manchmal auch verwirrend. Auch musst die beiden Vektoren aneinanderkleben damit die Funktion funktioniert.</span>
<span id="cb71-330"><a href="#cb71-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-333"><a href="#cb71-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-334"><a href="#cb71-334" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_obj <span class="ot">&lt;-</span> <span class="fu">design.ab</span>(<span class="at">trt =</span> <span class="fu">c</span>(n_trt_fac2_fert, n_trt_fac1_soil), </span>
<span id="cb71-335"><a href="#cb71-335" aria-hidden="true" tabindex="-1"></a>                           <span class="at">design =</span> <span class="st">"rcbd"</span>,</span>
<span id="cb71-336"><a href="#cb71-336" aria-hidden="true" tabindex="-1"></a>                           <span class="at">r =</span> n_block, </span>
<span id="cb71-337"><a href="#cb71-337" aria-hidden="true" tabindex="-1"></a>                           <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb71-338"><a href="#cb71-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-339"><a href="#cb71-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-340"><a href="#cb71-340" aria-hidden="true" tabindex="-1"></a>Dann können wir auch schon unser Ergebnis der Funktion einmal aufarbeiten. Wie immer fehlt das Positionsgrid, so dass wir hier nochmal tätig werden müssen. Dann wollen wir noch die Faktoren wieder umbenennen, so dass auch die Level passen. Am Ende wähle ich noch die Spalten aus, die wir dann später brauchen werden. Meistens müssen wir auch bei den komplexeren Designs und der Nutzung von <span class="in">`agricolae`</span> im Nachgang sehr viel selber machen. Teilweise lohnt es sich da für mich nicht, für zwei Zeilen Code eine Funktion zu nutzen, der ich dann auch noch sehr viel Nachprogrammieren muss. Man merkt hier eben auch das Alter von dem R Paket <span class="in">`agricolae`</span>.</span>
<span id="cb71-341"><a href="#cb71-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-344"><a href="#cb71-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-345"><a href="#cb71-345" aria-hidden="true" tabindex="-1"></a>rcbd_fac3_book_tbl <span class="ot">&lt;-</span> rcbd_fac3_obj<span class="sc">$</span>book <span class="sc">|&gt;</span></span>
<span id="cb71-346"><a href="#cb71-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand.grid</span>(<span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span>n_trt_fac2_fert,</span>
<span id="cb71-347"><a href="#cb71-347" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span>(n_trt_fac1_soil<span class="sc">*</span>n_block))) <span class="sc">|&gt;</span> </span>
<span id="cb71-348"><a href="#cb71-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt_fac2_fert =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, A),</span>
<span id="cb71-349"><a href="#cb71-349" aria-hidden="true" tabindex="-1"></a>         <span class="at">trt_fac1_soil =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, B),</span>
<span id="cb71-350"><a href="#cb71-350" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">paste0</span>(<span class="st">"Block "</span>, block)) <span class="sc">|&gt;</span> </span>
<span id="cb71-351"><a href="#cb71-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(block, <span class="at">fert =</span> trt_fac2_fert, <span class="at">soil =</span> trt_fac1_soil, rows, cols)</span>
<span id="cb71-352"><a href="#cb71-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-353"><a href="#cb71-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-354"><a href="#cb71-354" aria-hidden="true" tabindex="-1"></a>Natürlich hat die Funktion auch keinen <span class="in">`sketch`</span>, wenn man ihn braucht. Das haben wir ja jetzt schon selber mit dem Positionsgrid programmiert. In der @fig-exp-adv-2 siehst du dann das Ergebnis des Versuchsplans. Wir haben hier nochmal zwei Blöcke zusätzlich zu dem obigen Beispiel genommen, dann siehst du nochmal schöner, wie sich die beiden Behandlungen in den Blöcken randomisieren.</span>
<span id="cb71-355"><a href="#cb71-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-358"><a href="#cb71-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-359"><a href="#cb71-359" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-360"><a href="#cb71-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-361"><a href="#cb71-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-2</span></span>
<span id="cb71-362"><a href="#cb71-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-363"><a href="#cb71-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb71-364"><a href="#cb71-364" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-365"><a href="#cb71-365" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Randomized complete block design (3-faktoriell) für die Faktoren Dünger `fert` sowie `soil` vollständig randomisiert in den vier Blöcken."</span></span>
<span id="cb71-366"><a href="#cb71-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-367"><a href="#cb71-367" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-368"><a href="#cb71-368" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-369"><a href="#cb71-369" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-370"><a href="#cb71-370" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb71-371"><a href="#cb71-371" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> rcbd_fac3_book_tbl,</span>
<span id="cb71-372"><a href="#cb71-372" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Randomized complete block design (3-faktoriell)"</span>, </span>
<span id="cb71-373"><a href="#cb71-373" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>, <span class="at">key.cex =</span> <span class="dv">1</span>)</span>
<span id="cb71-374"><a href="#cb71-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-375"><a href="#cb71-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-376"><a href="#cb71-376" aria-hidden="true" tabindex="-1"></a><span class="fu">## Split plot design (3-faktoriell) {#sec-split}</span></span>
<span id="cb71-377"><a href="#cb71-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-378"><a href="#cb71-378" aria-hidden="true" tabindex="-1"></a>Die Spaltanlage (eng. *split plot design*) ist eine häufig genutzte Variante, wenn wir eine Behandlungsfaktor nur in einem anderen Level eines zweiten Behandlungsfaktor randomisieren können. Wir können also eine Feldspur nur auf eine Art mechanisch bearbeiten und geben dann aber pro Feldspur verschiedene Dünger auf. Oder wir können in einen Stahl nur auf eine Art Futter zuführen, aber verschiedene Arten von Futter. Das gleiche kannst du dir auch mit einer Klimakammer vorstellen in der wir verschiedene Pflanzenlinien stellen können.</span>
<span id="cb71-379"><a href="#cb71-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-380"><a href="#cb71-380" aria-hidden="true" tabindex="-1"></a>Beide Behandlungsfaktoren sind ineinander und dann natürlich im Block genestet. Hier aber erstmal das Modell mit den drei Faktoren für den besseren Überblick. Wir haben einmal die Düngung <span class="in">`fert`</span>, dann den Faktor Boden <span class="in">`soil`</span> sowie die verschiedenen Blöcke mit <span class="in">`block`</span>.</span>
<span id="cb71-381"><a href="#cb71-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-382"><a href="#cb71-382" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-383"><a href="#cb71-383" aria-hidden="true" tabindex="-1"></a>y \sim \overbrace{soil}^{f_1} + \underbrace{fert}_{f_2} + \overbrace{block}^{f_3}</span>
<span id="cb71-384"><a href="#cb71-384" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-385"><a href="#cb71-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-386"><a href="#cb71-386" aria-hidden="true" tabindex="-1"></a>mit</span>
<span id="cb71-387"><a href="#cb71-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-388"><a href="#cb71-388" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Dünger <span class="in">`fert`</span> und den sechs Düngestufen als Level <span class="in">`fe_1`</span> bis <span class="in">`fe_6`</span>.</span>
<span id="cb71-389"><a href="#cb71-389" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Boden <span class="in">`soil`</span> und den vier Bodenarten als Level <span class="in">`soil_1`</span> bis <span class="in">`soil_4`</span>.</span>
<span id="cb71-390"><a href="#cb71-390" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Block <span class="in">`block`</span> und den zwei Leveln <span class="in">`block_1`</span> und <span class="in">`block_2`</span>.</span>
<span id="cb71-391"><a href="#cb71-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-392"><a href="#cb71-392" aria-hidden="true" tabindex="-1"></a>In der @fig-mermaid-splitplot sehen wir die Abhängigkeitsstruktur des *split plot designs*. Wir haben den Faktor <span class="in">`fert`</span> den wir in den Faktor <span class="in">`soil`</span> nesten. Den Faktor <span class="in">`soil`</span> nesten wir dann wiederrum in die Spalten <span class="in">`cols`</span> des Blocks. Deshalb nennen wir das ja auch eine Spaltanlage. Ein Faktor ist immer in den Spalten angeordnet und der andere Faktor in der Spalte randomisiert. Wie immer wird es vielleicht klarer, wenn du dir dazu die @fig-exp-adv-split als Ergebnis des Versuchsdesigns anschaust.</span>
<span id="cb71-393"><a href="#cb71-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-396"><a href="#cb71-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb71-397"><a href="#cb71-397" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-mermaid-splitplot</span></span>
<span id="cb71-398"><a href="#cb71-398" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-width: 6</span></span>
<span id="cb71-399"><a href="#cb71-399" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: "Abhängigkeitsstruktur des *split plot design*. Der Faktor `soil` ist in den Spalten `cols` der Blöcke randomisiert und der zweite Faktor `fert` innerhalb des anderen Faktors und somit auch in den Spalten."</span></span>
<span id="cb71-400"><a href="#cb71-400" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb71-401"><a href="#cb71-401" aria-hidden="true" tabindex="-1"></a><span class="in">    A(fert):::factor --- B(((nestet))) --&gt; C(soil):::factor --- D(((nestet))) --&gt; E(cols) --- F(block):::factor</span></span>
<span id="cb71-402"><a href="#cb71-402" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-403"><a href="#cb71-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-404"><a href="#cb71-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-405"><a href="#cb71-405" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb71-406"><a href="#cb71-406" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modell zur Auswertung</span></span>
<span id="cb71-407"><a href="#cb71-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-408"><a href="#cb71-408" aria-hidden="true" tabindex="-1"></a>Wir rechnen ein komplexeres gemischtes Modell mit allen möglichen zufälligen Effekten.</span>
<span id="cb71-409"><a href="#cb71-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-412"><a href="#cb71-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-413"><a href="#cb71-413" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-414"><a href="#cb71-414" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(yield <span class="sc">~</span> soil <span class="sc">+</span> fert <span class="sc">+</span> soil<span class="sc">:</span>fert <span class="sc">+</span> </span>
<span id="cb71-415"><a href="#cb71-415" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span><span class="sc">|</span>block) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block<span class="sc">:</span>fert) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block<span class="sc">:</span>soil), </span>
<span id="cb71-416"><a href="#cb71-416" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> split_tbl)</span>
<span id="cb71-417"><a href="#cb71-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-418"><a href="#cb71-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-419"><a href="#cb71-419" aria-hidden="true" tabindex="-1"></a>Oder können überlegen ein gemischtes Modell mit weniger zufälligen Effekten zu rechnen.</span>
<span id="cb71-420"><a href="#cb71-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-423"><a href="#cb71-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-424"><a href="#cb71-424" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-425"><a href="#cb71-425" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(yield <span class="sc">~</span> soil <span class="sc">+</span> fert <span class="sc">+</span> soil<span class="sc">:</span>fert <span class="sc">+</span> </span>
<span id="cb71-426"><a href="#cb71-426" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span><span class="sc">|</span>block), </span>
<span id="cb71-427"><a href="#cb71-427" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> split_tbl)</span>
<span id="cb71-428"><a href="#cb71-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-429"><a href="#cb71-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-430"><a href="#cb71-430" aria-hidden="true" tabindex="-1"></a>Die Entscheidung kannst du dann mit der <span class="co">[</span><span class="ot">Modellselektion</span><span class="co">](https://jkruppa.github.io/stat-modeling-basic.html#sec-model-basic-compare)</span> durchführen.</span>
<span id="cb71-431"><a href="#cb71-431" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-432"><a href="#cb71-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-433"><a href="#cb71-433" aria-hidden="true" tabindex="-1"></a>Jetzt haben wir die volle Auswahl an Möglichkeiten. Ich zeige einmal wie man händisch das *split plot designs* erstellt. Dann schauen wir uns die Erstellung in <span class="in">`agricolae`</span> einmal an und dann zeige ich noch die Variante in <span class="in">`dae`</span>, die mich echt einiges an Zeit und Nerven gekostet hat. In sich ist das Paket <span class="in">`dae`</span> ja logisch, aber die Dokumentation lässt für mich etwas zu wünschen übrig. Dennoch hier einmal die volle Dreifaltigkeit der Versuchsdesignerstellung, wenn ich mir schon die Mühe gemacht habe.</span>
<span id="cb71-434"><a href="#cb71-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-435"><a href="#cb71-435" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `expand_grid()`</span></span>
<span id="cb71-436"><a href="#cb71-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-437"><a href="#cb71-437" aria-hidden="true" tabindex="-1"></a>Ja, selber machen ist hier etwas mühsamer, aber wenn du die Schritte nachvollziehst, dann wird dir vermutlich das *split plot design* sehr viel klarer. Als erstes erschaffen wir die zwei Blöcke und die vier Bodenarten. Dabei sind in jedem Block die vier Bodenarten genestet. Dann gruppieren wir nach Block und randomiseren einmal die Bodenarten je Block. Im nächsten Schritt erweitern wir dann jede Block/Boden-Kombination um die sechs Düngerstufen. Dann gruppieren wir wieder, aber diesmal für jede Block/Boden-Kombination, um hier dann einmal die Düngestufen zu randomisieren. Dann lösen wir alle Gruppen auf und setzen fürunsere Faktoren dann noch die richtigen Labels.</span>
<span id="cb71-438"><a href="#cb71-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-441"><a href="#cb71-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-442"><a href="#cb71-442" aria-hidden="true" tabindex="-1"></a>splitplot_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb71-443"><a href="#cb71-443" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">soil =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-444"><a href="#cb71-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span>             <span class="co"># Gruppieren nach block</span></span>
<span id="cb71-445"><a href="#cb71-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">soil =</span> <span class="fu">sample</span>(soil)) <span class="sc">|&gt;</span> <span class="co"># Randomisieren von soil in block</span></span>
<span id="cb71-446"><a href="#cb71-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">fert =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb71-447"><a href="#cb71-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block, soil) <span class="sc">|&gt;</span>       <span class="co"># Gruppieren nach block und soil</span></span>
<span id="cb71-448"><a href="#cb71-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">sample</span>(fert)) <span class="sc">|&gt;</span> <span class="co"># Randomisieren von fert in block und soil</span></span>
<span id="cb71-449"><a href="#cb71-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb71-450"><a href="#cb71-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">factor</span>(fert, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)),</span>
<span id="cb71-451"><a href="#cb71-451" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb71-452"><a href="#cb71-452" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">factor</span>(soil, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))) </span>
<span id="cb71-453"><a href="#cb71-453" aria-hidden="true" tabindex="-1"></a>splitplot_long_tbl</span>
<span id="cb71-454"><a href="#cb71-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-455"><a href="#cb71-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-456"><a href="#cb71-456" aria-hidden="true" tabindex="-1"></a>Da ich auch gleich wieder für die Blöcke separieren möchte, baue ich mir für jeden Block <span class="in">`rep`</span> nochmal vier Spalten, je eine Spalte für eine Bodenbehandlung, und dann nochmal sechs Zeilen, eine für jede Düngestufe. Dann verbinden wir den randomisirten Datensatz mit den Pflanzgrid und schon können wir uns das *split plot design* einmal anschauen.</span>
<span id="cb71-457"><a href="#cb71-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-460"><a href="#cb71-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-461"><a href="#cb71-461" aria-hidden="true" tabindex="-1"></a>splitplot_plot_tbl <span class="ot">&lt;-</span> splitplot_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb71-462"><a href="#cb71-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb71-463"><a href="#cb71-463" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb71-464"><a href="#cb71-464" aria-hidden="true" tabindex="-1"></a>                        <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb71-465"><a href="#cb71-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-466"><a href="#cb71-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-467"><a href="#cb71-467" aria-hidden="true" tabindex="-1"></a>In der @fig-exp-adv-split siehst du einmal das *split plot design* dargestellt. Hier wird auch nochmal schön das Randomisierungsmuster klar. Du siehst auch warum das *split plot design* im Deutschen auch Spaltanlage heißt. Der Dünger ist in Spalten des Bodenfaktores randomisiert. Jeder Block hat also seine eigene Randomiserung der Böden.</span>
<span id="cb71-468"><a href="#cb71-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-471"><a href="#cb71-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-472"><a href="#cb71-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-473"><a href="#cb71-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-474"><a href="#cb71-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-split</span></span>
<span id="cb71-475"><a href="#cb71-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-476"><a href="#cb71-476" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb71-477"><a href="#cb71-477" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-478"><a href="#cb71-478" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Split plot design (3-faktoriell) für die Faktoren Dünger `fert` sowie `soil` randomisiert in den zwei Blöcken. Der Faktor `fert` ist in dem Faktor `soil` genestet und randomisiert."</span></span>
<span id="cb71-479"><a href="#cb71-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-480"><a href="#cb71-480" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-481"><a href="#cb71-481" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-482"><a href="#cb71-482" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-483"><a href="#cb71-483" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb71-484"><a href="#cb71-484" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> splitplot_plot_tbl ,</span>
<span id="cb71-485"><a href="#cb71-485" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Split plot design (3-faktoriell)"</span>,</span>
<span id="cb71-486"><a href="#cb71-486" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-487"><a href="#cb71-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-488"><a href="#cb71-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-489"><a href="#cb71-489" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{FielDHub}`</span></span>
<span id="cb71-490"><a href="#cb71-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-491"><a href="#cb71-491" aria-hidden="true" tabindex="-1"></a>Für die Erstellung des *split plot design* in der Shiny App schaue dir die Anleitung unter <span class="co">[</span><span class="ot">Generates a Split Plot Design mit `{FielDHub}`</span><span class="co">](https://didiermurillof.github.io/FielDHub/reference/split_plot.html)</span> einmal an. Hier einmal der Code für die Erstellung in R. Wir haben jetzt vier Behandlungen für den Faktor <span class="in">`soil`</span> sowie sechs Behandlungen für den Faktor <span class="in">`fe`</span> vorliegen und wollen jeweils drei Blöcke anlegen. Jetzt einmal die Funktion <span class="in">`split_plot()`</span> in der wir hier aber die Namen der Level übergeben können. Das ist dann wiederum eine Erleichterung zum dreifaktoriellen Design eben.</span>
<span id="cb71-492"><a href="#cb71-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-495"><a href="#cb71-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-496"><a href="#cb71-496" aria-hidden="true" tabindex="-1"></a>split_plot_obj <span class="ot">&lt;-</span> <span class="fu">split_plot</span>(<span class="at">wp =</span> <span class="fu">paste0</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb71-497"><a href="#cb71-497" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sp =</span> <span class="fu">paste0</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb71-498"><a href="#cb71-498" aria-hidden="true" tabindex="-1"></a>                             <span class="at">reps =</span> <span class="dv">3</span>,</span>
<span id="cb71-499"><a href="#cb71-499" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">2023</span>)</span>
<span id="cb71-500"><a href="#cb71-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-501"><a href="#cb71-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-502"><a href="#cb71-502" aria-hidden="true" tabindex="-1"></a>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst. Wie immer brauchst du nicht alle Informationen. Auch hier würde ich das Feldbuch dann nutzen um mir selber in <span class="in">`{desplot}`</span> die Abbildung zu erstellen. Die automatisierte Abbildungserstellung in <span class="in">`{FielDHub}`</span> ist der manuellen weit unterlegen.</span>
<span id="cb71-503"><a href="#cb71-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-506"><a href="#cb71-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-507"><a href="#cb71-507" aria-hidden="true" tabindex="-1"></a>split_plot_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb71-508"><a href="#cb71-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb71-509"><a href="#cb71-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-510"><a href="#cb71-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-511"><a href="#cb71-511" aria-hidden="true" tabindex="-1"></a>Dann erstellen wir auch schon die @fig-exp-basic-split-fieldhub mit dem *split plot design*. Leider ist die Abbildung nur noch okay. Die Einteilung mit dem <span class="in">`|`</span> ist besser als beim faktoriellen Design, aber so richtig überzeugen tut mich die Darstellung nicht. Wir haben ja die wilden Farben, da wir jeweils die Faktorkombination wiedergeben. Leider helfen die Farben wenig und auch ist alles sehr unübersichtlich. Das Paket <span class="in">`{desplot}`</span> kann definitiv mehr. Hier würde ich dann wirklich auf den Plot hier aus <span class="in">`{FielDHub}`</span> verzichten und stattdessen mir den Plot wie oben in der @fig-exp-adv-split aus den den Feldbuch selber bauen.</span>
<span id="cb71-512"><a href="#cb71-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-515"><a href="#cb71-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-516"><a href="#cb71-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-517"><a href="#cb71-517" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-518"><a href="#cb71-518" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-basic-split-fieldhub</span></span>
<span id="cb71-519"><a href="#cb71-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-520"><a href="#cb71-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb71-521"><a href="#cb71-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb71-522"><a href="#cb71-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Split plot design (3-faktoriell) für die Faktoren Dünger `fert` sowie `soil` randomisiert in den zwei Blöcken. Der Faktor `fert` ist in dem Faktor `soil` genestet und randomisiert."</span></span>
<span id="cb71-523"><a href="#cb71-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-524"><a href="#cb71-524" aria-hidden="true" tabindex="-1"></a>split_plot_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb71-525"><a href="#cb71-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-526"><a href="#cb71-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-527"><a href="#cb71-527" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{agricolae}`</span></span>
<span id="cb71-528"><a href="#cb71-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-529"><a href="#cb71-529" aria-hidden="true" tabindex="-1"></a>Jetzt machen wir das Ganze nochmal mit dem R Paket <span class="in">`{agricolae}`</span>. Hier müssen wir wieder die Vektoren mit den Faktoren und Leveln vorab erschaffen. Auch brauchen wir die Anzahl an Leveln für jeden Faktor. Am Ende randomisieren wir hier mal in vier Blöcke, einfach um es etwas anders zu machen.</span>
<span id="cb71-530"><a href="#cb71-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-533"><a href="#cb71-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-534"><a href="#cb71-534" aria-hidden="true" tabindex="-1"></a>trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)    </span>
<span id="cb71-535"><a href="#cb71-535" aria-hidden="true" tabindex="-1"></a>n_trt_fac1_soil <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac1_soil) </span>
<span id="cb71-536"><a href="#cb71-536" aria-hidden="true" tabindex="-1"></a>trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)  </span>
<span id="cb71-537"><a href="#cb71-537" aria-hidden="true" tabindex="-1"></a>n_trt_fac2_fert <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_fac2_fert) </span>
<span id="cb71-538"><a href="#cb71-538" aria-hidden="true" tabindex="-1"></a>n_block <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb71-539"><a href="#cb71-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-540"><a href="#cb71-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-541"><a href="#cb71-541" aria-hidden="true" tabindex="-1"></a>Für die Erstellung des *split plot design* nutzen wir die Funktion <span class="in">`design.split()`</span>. Hier ist es wichtig, unbedingt die <span class="in">`serie = 0`</span> als Option zu setzen. Wir brauchen die so entstehende Information in der Spalte <span class="in">`plots`</span> sonst klappt es im Folgenden nicht die <span class="in">`plots`</span> gleich den Spalten <span class="in">`cols`</span> zu setzen. Ja, ich weiß, ist alles super suboptimal, aber so ist es eben in <span class="in">`{agricolae}`</span>. Du musst noch einges machen, damit die Funktion auch einen visualisierbare Ausgabe wiedergibt.</span>
<span id="cb71-542"><a href="#cb71-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-545"><a href="#cb71-545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-546"><a href="#cb71-546" aria-hidden="true" tabindex="-1"></a>splitplot_obj <span class="ot">&lt;-</span> <span class="fu">design.split</span>(<span class="at">trt1 =</span> trt_fac1_soil,</span>
<span id="cb71-547"><a href="#cb71-547" aria-hidden="true" tabindex="-1"></a>                              <span class="at">trt2 =</span> trt_fac2_fert,</span>
<span id="cb71-548"><a href="#cb71-548" aria-hidden="true" tabindex="-1"></a>                              <span class="at">r =</span> n_block,</span>
<span id="cb71-549"><a href="#cb71-549" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seed =</span> <span class="dv">42</span>, <span class="at">serie =</span> <span class="dv">0</span>)</span>
<span id="cb71-550"><a href="#cb71-550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-551"><a href="#cb71-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-552"><a href="#cb71-552" aria-hidden="true" tabindex="-1"></a>Leider gibt es kein <span class="in">`sketch`</span>-Objekt gerade hier wo man eins gebrauchen könnte. Deshalb also nochmal alles umbauen und die Zeilen <span class="in">`rows`</span> und Spalten <span class="in">`cols`</span> entsprechend ergänzen. Ich nenne jetzt nochmal ein wenig die Variablen um, einfach damit hier nicht immer das Gleiche passiert. Wichtig ist, dass wir hier immer für die Blöcke separieren. Wir müssen also in <span class="in">`desplot`</span> definitiv die Option <span class="in">`| block`</span> setzen, sonst klappt es mit der Darstellung nicht.</span>
<span id="cb71-553"><a href="#cb71-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-556"><a href="#cb71-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-557"><a href="#cb71-557" aria-hidden="true" tabindex="-1"></a>splitsplot_book_tbl <span class="ot">&lt;-</span> splitplot_obj<span class="sc">$</span>book <span class="sc">|&gt;</span> </span>
<span id="cb71-558"><a href="#cb71-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, block),</span>
<span id="cb71-559"><a href="#cb71-559" aria-hidden="true" tabindex="-1"></a>         <span class="at">cols =</span> plots, </span>
<span id="cb71-560"><a href="#cb71-560" aria-hidden="true" tabindex="-1"></a>         <span class="at">rows =</span> <span class="fu">as.numeric</span>(splots)) <span class="sc">|&gt;</span> </span>
<span id="cb71-561"><a href="#cb71-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(block, <span class="at">fert =</span> trt_fac2_fert, <span class="at">soil =</span> trt_fac1_soil, rows, cols)</span>
<span id="cb71-562"><a href="#cb71-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-563"><a href="#cb71-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-564"><a href="#cb71-564" aria-hidden="true" tabindex="-1"></a>In der @fig-exp-adv-3 siehst du das Ergebnis der Versuchsplanerstellung mit <span class="in">`{agricolae}`</span>. Wir kriegen faktisch das Gleiche raus, gut die Faktoren sind anders permutiert, aber das wundert uns jetzt nicht. Am Ende musst du entscheiden, was dir besser gefällt. Je komplexer die Randomisierung ist, desto einfacher ist die Nutzung der <span class="in">`{agricolae}`</span> Funktionen. Beim *split plot design* ist es so eine Sache, es lohnt sich bei sehr großen Anlagen dann schon.</span>
<span id="cb71-565"><a href="#cb71-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-568"><a href="#cb71-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-569"><a href="#cb71-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-570"><a href="#cb71-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-571"><a href="#cb71-571" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-3</span></span>
<span id="cb71-572"><a href="#cb71-572" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-573"><a href="#cb71-573" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb71-574"><a href="#cb71-574" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-575"><a href="#cb71-575" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Split plot design (3-faktoriell) für die Faktoren Dünger `fert` sowie `soil` randomisiert in den vier Blöcken. Der Faktor `fert` ist in dem Faktor `soil` genestet und randomisiert."</span></span>
<span id="cb71-576"><a href="#cb71-576" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-577"><a href="#cb71-577" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-578"><a href="#cb71-578" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-579"><a href="#cb71-579" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb71-580"><a href="#cb71-580" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> splitsplot_book_tbl ,</span>
<span id="cb71-581"><a href="#cb71-581" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Split plot design (3-faktoriell)"</span>,</span>
<span id="cb71-582"><a href="#cb71-582" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-583"><a href="#cb71-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-584"><a href="#cb71-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-585"><a href="#cb71-585" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{dae}`</span></span>
<span id="cb71-586"><a href="#cb71-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-587"><a href="#cb71-587" aria-hidden="true" tabindex="-1"></a>Auch das R Paket <span class="in">`{dae}`</span> liefert die Möglichkeit ein *split plot design* zu erstellen. Die Idee von `dae` ist ja ein mehr generalisiertes Framework für die Erstellung von Versuchsplänen anzubieten. Deshalb gibt es ja nur die Funktion `designRandomize()`, die ein gegebenes Design nach feststehenden Regeln randomisiert. Die Idee ist gut, aber dafür musst du dich relativ tief in das Paket `dae` einarbeiten. Für mich war dieser kurze Code für das *split plot design* schon recht langwierig aus den Beispielen aus den <span class="co">[</span><span class="ot">Notes on the use of dae for design</span><span class="co">](https://cran.r-project.org/web/packages/dae/vignettes/DesignNotes.pdf)</span> herzuleiten. Prinzipiell ist es ja nicht schwer, aber es ist schon etwas mehr Auswand.</span>
<span id="cb71-588"><a href="#cb71-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-589"><a href="#cb71-589" aria-hidden="true" tabindex="-1"></a>Wie funktioniert nun die Erstellung eines *split plot design*? Wir bauen uns erstmal unser Design der Positionen mit den Blöcken, Mainplots <span class="in">`MPlots`</span> sowie den Subplot <span class="in">`SubPlots`</span>. Dabei ist es wichtig zu wissen, dass die Subplots in den Mainplots genestet sind. Die Mainplots sind dann wiederum in den Blöcken genestet. Ja, hier hast du dann ein Paket spezifisches Naming der Optionen. Im zweiten Schritt packen wir dann den Faktor Boden <span class="in">`soil`</span> und den Faktor <span class="in">`fert`</span> zu den Positionen hinzu. Wichtig ist das <span class="in">`times = 4`</span> am Ende, was nochmal die Faktorkombinationen von <span class="in">`soil`</span> und <span class="in">`fert`</span> jeweils in der Anzahl der Blöcke wiederholt. Wir haben ja hier vier Blöcke vorliegen, dass vergisst man ja mal schnell.</span>
<span id="cb71-590"><a href="#cb71-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-593"><a href="#cb71-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-594"><a href="#cb71-594" aria-hidden="true" tabindex="-1"></a>split_sys <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">fac.gen</span>(<span class="fu">list</span>(<span class="at">Blocks =</span> <span class="dv">4</span>, <span class="at">MPlots =</span> <span class="dv">4</span>, <span class="at">SubPlots =</span> <span class="dv">6</span>)),</span>
<span id="cb71-595"><a href="#cb71-595" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fac.gen</span>(<span class="fu">list</span>(<span class="at">soil =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb71-596"><a href="#cb71-596" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fert =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)), <span class="at">times =</span> <span class="dv">4</span>)) </span>
<span id="cb71-597"><a href="#cb71-597" aria-hidden="true" tabindex="-1"></a>split_sys <span class="sc">|&gt;</span> </span>
<span id="cb71-598"><a href="#cb71-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb71-599"><a href="#cb71-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-600"><a href="#cb71-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-601"><a href="#cb71-601" aria-hidden="true" tabindex="-1"></a>An der Ausgabe siehst du ganz schön, wie die Spalte Mainplots zu dem Faktor <span class="in">`soil`</span> passt sowie die Spalte Subplots zu dem Faktor <span class="in">`fert`</span>. Die Herausforderung ist nun, dass das R Paket <span class="in">`dae`</span> davon ausgeht, dass du weißt, was ein *split plot design* ist und wie es aufgebaut ist. Es gibt also wenig Hilfestellung innerhalb der Funktionen. Dafür sind die Funktionen super flexibel und du kannst dir deine eigenen kreativen Designs bauen - wovon ich abrate.</span>
<span id="cb71-602"><a href="#cb71-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-603"><a href="#cb71-603" aria-hidden="true" tabindex="-1"></a>Im nächsten Schritt nutzen wir die Funktion <span class="in">`designRandomize()`</span> um die Faktoren <span class="in">`soil`</span> und <span class="in">`fert`</span> den Positionen in der Spalte <span class="in">`Block`</span>, <span class="in">`MPlots`</span> und <span class="in">`SubPlots`</span> randomisiert zuzuweisen. Deshalb sind ja auch die Faktoren <span class="in">`soil`</span> und <span class="in">`fert`</span> der Option <span class="in">`allocated`</span> (deu. *zugeteilt*) zugewiesen, da die beiden Faktoren ja den Spalten `Block`, `MPlots` und `SubPlots` als Empfänger (eng. `recipient`) zugeteilt werden. Soweit so gut, dass sagt aber noch nichts über das *Wie* der Zuteilung aus. Das machen wir dann mit der Option `nestet.recipients`. Der Option sagen wir jetzt wer in was genestet ist. Und durch diese Zuordnung erschaffen wir ein *split plot design*. Die Mainplots sind in den Blöcken genestet und dann die Subplots in den Mainplots und den Blöcken. Ja, da muss man erstmal drauf kommen. Hat bei mir gedauert, bis ich das hingekriegt habe.</span>
<span id="cb71-604"><a href="#cb71-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-607"><a href="#cb71-607" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-608"><a href="#cb71-608" aria-hidden="true" tabindex="-1"></a>split_lay <span class="ot">&lt;-</span> <span class="fu">designRandomize</span>(<span class="at">allocated =</span> split_sys[<span class="fu">c</span>(<span class="st">"soil"</span>, <span class="st">"fert"</span>)],</span>
<span id="cb71-609"><a href="#cb71-609" aria-hidden="true" tabindex="-1"></a>                             <span class="at">recipient =</span> split_sys[<span class="fu">c</span>(<span class="st">"Blocks"</span>, <span class="st">"MPlots"</span>, <span class="st">"SubPlots"</span>)],</span>
<span id="cb71-610"><a href="#cb71-610" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nestet.recipients =</span> <span class="fu">list</span>(<span class="at">MPlots =</span> <span class="st">"Blocks"</span>,</span>
<span id="cb71-611"><a href="#cb71-611" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">SubPlots =</span> <span class="fu">c</span>(<span class="st">"MPlots"</span>, <span class="st">"Blocks"</span>)),</span>
<span id="cb71-612"><a href="#cb71-612" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">235805</span>)</span>
<span id="cb71-613"><a href="#cb71-613" aria-hidden="true" tabindex="-1"></a>split_lay <span class="sc">|&gt;</span> </span>
<span id="cb71-614"><a href="#cb71-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb71-615"><a href="#cb71-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-616"><a href="#cb71-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-617"><a href="#cb71-617" aria-hidden="true" tabindex="-1"></a>Und wir haben eine Randomisierung. Leider wissen wir nicht, ob die so geklappt hat, es ist ja wirklich schwer zusehen. Deshalb wollen wir uns die Ausgabe mal visualisieren. Das Gleiche Problem wie schon eben haben wir mit der Visualisierung mit <span class="in">`designGGPlot()`</span>. Die Hilfeseite ist etwas unterkomplex für die Möglichkeiten der Funktion. So musste ich auch hier recht lange Rumspielen, bis ich die folgende @fig-exp-adv-4 erstellen konnte. Der Witz ist eigentlich hier, dass wir eine interne Funktion nutzen und auch das Objekt aus <span class="in">`designRandomize()`</span> übergeben. Dennoch müssen wir uns selber mit den <span class="in">`row.factors()`</span> und den <span class="in">`column.factors()`</span> alles zusammenkleben. Ich habe es dann geschafft, aber es war mehr Zufall als Können. Das die Spalten die Mainplots sind, war mir klar, aber das die Zeilen durch die beiden Vektoren <span class="in">`Blocks`</span> und <span class="in">`Subplots`</span> so in der Reihenfolge gebildet werden war nur durch probieren zu lösen. Das eine aussagekräftige Legende fehlt, ist dann schon fast nicht mehr von Belang.</span>
<span id="cb71-618"><a href="#cb71-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-621"><a href="#cb71-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-622"><a href="#cb71-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb71-623"><a href="#cb71-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-624"><a href="#cb71-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-4</span></span>
<span id="cb71-625"><a href="#cb71-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-626"><a href="#cb71-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb71-627"><a href="#cb71-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb71-628"><a href="#cb71-628" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Split plot design (3-faktoriell) für die Faktoren Dünger `fert` sowie `soil` randomisiert in den vier Blöcken. Der Faktor `fert` ist in dem Faktor `soil` genestet und randomisiert."</span></span>
<span id="cb71-629"><a href="#cb71-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-630"><a href="#cb71-630" aria-hidden="true" tabindex="-1"></a><span class="fu">designGGPlot</span>(split_lay, <span class="at">labels =</span> <span class="st">"fert"</span>, <span class="at">cellalpha =</span> <span class="fl">0.75</span>, <span class="at">cellfillcolour.column =</span> <span class="st">"soil"</span>,</span>
<span id="cb71-631"><a href="#cb71-631" aria-hidden="true" tabindex="-1"></a>             <span class="at">row.factors =</span> <span class="fu">c</span>(<span class="st">"Blocks"</span>, <span class="st">"SubPlots"</span>), <span class="at">column.factors =</span> <span class="fu">c</span>(<span class="st">"MPlots"</span>),</span>
<span id="cb71-632"><a href="#cb71-632" aria-hidden="true" tabindex="-1"></a>             <span class="at">blockdefinition =</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">1</span>)),</span>
<span id="cb71-633"><a href="#cb71-633" aria-hidden="true" tabindex="-1"></a>             <span class="at">blocklinecolour =</span> <span class="st">"black"</span>, <span class="at">title =</span> <span class="cn">NULL</span>)</span>
<span id="cb71-634"><a href="#cb71-634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-635"><a href="#cb71-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-636"><a href="#cb71-636" aria-hidden="true" tabindex="-1"></a>Am Ende ermöglicht das Paket <span class="in">`{dae}`</span> super flexibel experimentelle Design zu erstellen. Ich werde das Paket auch für Designs im Rahmen der Analyse von linearen gemischten Modellen nutzen. Dafür ist das Paket super. Du musst aber wissen, dass das Paket einiges an Einarbeitung benötigt und du auch die Philosophie hinter den Funktionen verstehen musst. Mal eben schnell, geht leider nicht. Dafür kann das Paket <span class="in">`{dae}`</span> mehr als als andere Pakete im Bereich der Erstellung von experimentellen Designs.</span>
<span id="cb71-637"><a href="#cb71-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-638"><a href="#cb71-638" aria-hidden="true" tabindex="-1"></a><span class="fu">## Subsampling {#sec-subsampling}</span></span>
<span id="cb71-639"><a href="#cb71-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-640"><a href="#cb71-640" aria-hidden="true" tabindex="-1"></a>Die zentrale Idee des Subsamplings ist, dass wir nicht über die Pflanzen in unseren Blöcken mitteln. Wir nehmen also alle Pflanzen in unserem Block mit in die Analyse. Oder aber wir mitteln nicht das Gewicht der Ferkel für jede Bucht, sondern wollen die Gewichte individuell mit betrachten. Wir messen die Beobachtungen innerhalb der Behandlung und nehmen diese individuellen Beobachtungen auch mit ins Modell. Damit haben wir eigentlich das gleiche Modell wie auch bei dem *randomized complete block design* mit zwei Faktoren. Nur das wir eben in den Blöcken und Behandlungen nicht einen Mittelwert über alles haben, sondern eben sechs individuelle Werte für die sechs Beobachtungen in einer Behandlung/Block-Kombination in unserem Beispiel.</span>
<span id="cb71-641"><a href="#cb71-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-642"><a href="#cb71-642" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb71-643"><a href="#cb71-643" aria-hidden="true" tabindex="-1"></a><span class="fu">## Beispieldaten aus `{agridat}` zu Subsampling</span></span>
<span id="cb71-644"><a href="#cb71-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-645"><a href="#cb71-645" aria-hidden="true" tabindex="-1"></a>Wenn dich nochmal Daten zum Subsampling interessiert dann schaue dir doch die Beispieldaten aus dem R Paket <span class="in">`{agridat}`</span> an. Zum einen wäre der Datensatz <span class="co">[</span><span class="ot">Rice RCB with subsamples</span><span class="co">](https://kwstat.github.io/agridat/reference/grover.rcb.subsample.html)</span> sowie die Daten <span class="co">[</span><span class="ot">Split-plot experiment of rice, with subsamples</span><span class="co">](https://kwstat.github.io/agridat/reference/gomez.splitplot.subsample.html)</span> von Interesse. Du findest hinter dem Link dann auch die Hilfe wie du die Daten in R mit <span class="in">`data()`</span> lädst.</span>
<span id="cb71-646"><a href="#cb71-646" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-647"><a href="#cb71-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-648"><a href="#cb71-648" aria-hidden="true" tabindex="-1"></a>Das generelle Modell unterscheidet sich nicht von einem RCBD. Wir haben zwei Faktoren, einmal die Behandlung und einmal einen Block vorliegen. Damit sind wir noch sehr ähnlich. Den Unterschied macht gleich die Randomisierung und die Betrachtung der einzelnen individuellen Beobachtungen.</span>
<span id="cb71-649"><a href="#cb71-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-650"><a href="#cb71-650" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-651"><a href="#cb71-651" aria-hidden="true" tabindex="-1"></a>y \sim \overbrace{trt}^{f_1} + \underbrace{block}_{f_2} </span>
<span id="cb71-652"><a href="#cb71-652" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-653"><a href="#cb71-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-654"><a href="#cb71-654" aria-hidden="true" tabindex="-1"></a>mit</span>
<span id="cb71-655"><a href="#cb71-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-656"><a href="#cb71-656" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Behandlung <span class="in">`trt`</span> und den vier Behandlungsstufen als Level <span class="in">`ctrl`</span>, <span class="in">`A`</span>, <span class="in">`B`</span> und <span class="in">`C`</span>.</span>
<span id="cb71-657"><a href="#cb71-657" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Block <span class="in">`block`</span> und den vier Leveln <span class="in">`block_1`</span> bis <span class="in">`block_4`</span>.</span>
<span id="cb71-658"><a href="#cb71-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-659"><a href="#cb71-659" aria-hidden="true" tabindex="-1"></a>Es gibt jetzt zwei Arten, wie wir die Daten randomisieren und betrachten können. Zum einen randomisieren wir die Individuen vollständig auf die Behandlungen und die Behandlungen nesten wir dann in die Blöcke. Dann haben wir die Abhängigkeitssruktur in der @fig-mermaid-sub-1 vorliegen. Im Anschluss mitteln wir dann nicht über alle Beobachtungen. Prinzipiell ist es also ein sehr großes *randomized complete block design*.</span>
<span id="cb71-660"><a href="#cb71-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-663"><a href="#cb71-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb71-664"><a href="#cb71-664" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-mermaid-sub-1</span></span>
<span id="cb71-665"><a href="#cb71-665" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-width: 6</span></span>
<span id="cb71-666"><a href="#cb71-666" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: "Subsampling vollständig innerhalb der Blöcke randomisiert. Die individuellen Beobachtungen sind über alle Behandlungen innerhalb der Blöcke randomisiert"</span></span>
<span id="cb71-667"><a href="#cb71-667" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb71-668"><a href="#cb71-668" aria-hidden="true" tabindex="-1"></a><span class="in">    A(trt):::factor --- B(((nestet))) --&gt; C(block):::factor </span></span>
<span id="cb71-669"><a href="#cb71-669" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-670"><a href="#cb71-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-671"><a href="#cb71-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-672"><a href="#cb71-672" aria-hidden="true" tabindex="-1"></a>Anders sieht es in der Variante zwei aus, hier haben wir die individuellen Beobachtungen in Clustern für eine einzelne Behandlung vorliegen. Die Beobachtungen sind innerhalb der Behandlungen genestet. In unserem Beispiel stehen die individuellen Pflanzen immer in einem Pflanztray. Du kannst dir aber auch Ferkel von verschiedenen Müttern in einer Bucht in einem Stall vorstellen. Es ergibt sich dann die @fig-mermaid-sub-2, wo unsere einzelnen Beobachtungen in den Behandlungen und dann in den Blöcken genestet sind.</span>
<span id="cb71-673"><a href="#cb71-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-676"><a href="#cb71-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb71-677"><a href="#cb71-677" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-mermaid-sub-2</span></span>
<span id="cb71-678"><a href="#cb71-678" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-width: 6</span></span>
<span id="cb71-679"><a href="#cb71-679" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: "Subsampling vollständig innerhalb der Behandlung randomisiert. Die individuellen Pflanzen stehen in Trays und können nicht innerhalb der Behandlung `trt` randomisiert werden."</span></span>
<span id="cb71-680"><a href="#cb71-680" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb71-681"><a href="#cb71-681" aria-hidden="true" tabindex="-1"></a><span class="in">    A(tray) --- B(((nestet))) --&gt; C(trt):::factor --- D(((nestet))) --&gt; E(cols) --- F(block):::factor</span></span>
<span id="cb71-682"><a href="#cb71-682" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-683"><a href="#cb71-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-684"><a href="#cb71-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-685"><a href="#cb71-685" aria-hidden="true" tabindex="-1"></a>Für die abschließende statistische Analyse kommt es darauf an, wie die individuellen Pflanzen in den Behandlungen stehen. Eventuell ist alles durcheinander gemischt, das heißt, die Pflanzen sind in den Behandlungen und Blöcken randomisiert. Dann ist es recht einfach mit einem linearen Modell zu machen.</span>
<span id="cb71-686"><a href="#cb71-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-687"><a href="#cb71-687" aria-hidden="true" tabindex="-1"></a>Wenn du aber die Pflanzen in einem Pflanztray oder irgendwie anders fixierst hast, dann macht es schon einen Unterschied. In dem Fall sind die Pflanzen ja individuell nicht unabhängig voneinander. Die Pflanzen sind ja in einem Tray zusammen. Dann nutzen wir ein lineares gemischtes Modell.</span>
<span id="cb71-688"><a href="#cb71-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-689"><a href="#cb71-689" aria-hidden="true" tabindex="-1"></a>Im Folgenden generieren wir einmal beide Fälle, wobei der zweite Fall - Pflanzen stehen zusammen - als Subsampling angesehen wird. Häufig kann dies auch bei Tierversuchen passieren, wenn zum Beispiel Ferkel in einer Bucht in einem Stahl stehen. Da aber ab und zu beides vorkommt, hier dann einmal beides. Wir können das Subsampling nur selber mit <span class="in">`expand_grid()`</span> durchführen, da weder das R Paket <span class="in">`{agricolae}`</span> noch das R Paket <span class="in">`{dae}`</span> eine entsprechende Implementierung der Funktionalität zur Generierung eines Datensatzes mit Subsampling aufweist.</span>
<span id="cb71-690"><a href="#cb71-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-691"><a href="#cb71-691" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb71-692"><a href="#cb71-692" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modell zur Auswertung</span></span>
<span id="cb71-693"><a href="#cb71-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-694"><a href="#cb71-694" aria-hidden="true" tabindex="-1"></a>Vollständig im Block randomisiert, wir rechnen ein lineares Modell.</span>
<span id="cb71-695"><a href="#cb71-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-698"><a href="#cb71-698" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-699"><a href="#cb71-699" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-700"><a href="#cb71-700" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> trt <span class="sc">+</span> block <span class="sc">+</span> trt<span class="sc">:</span>block, <span class="at">data =</span> subsampling_tbl)</span>
<span id="cb71-701"><a href="#cb71-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-702"><a href="#cb71-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-703"><a href="#cb71-703" aria-hidden="true" tabindex="-1"></a>Behandlung im Block randomisiert, dass heißt, dass die Pflanzen zusammen in einem Tray stehen, wir rechnen ein gemischtes Modell. Der Tray-Effekt wird dann im zufälligen Effekt <span class="in">`(1 | trt:block)`</span> modelliert.</span>
<span id="cb71-704"><a href="#cb71-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-707"><a href="#cb71-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-708"><a href="#cb71-708" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-709"><a href="#cb71-709" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(drymatter <span class="sc">~</span> trt <span class="sc">+</span> block <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">:</span>block), <span class="at">data =</span> subsampling_tbl)</span>
<span id="cb71-710"><a href="#cb71-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-711"><a href="#cb71-711" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-712"><a href="#cb71-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-713"><a href="#cb71-713" aria-hidden="true" tabindex="-1"></a>Das Subsampling geht nur im Selbermachen, also machen wir das dann einmal mit der Funktion <span class="in">`expand_grid()`</span>. Als erstes erstellen wir einmal ein Design mit vier Blöcken und vier Behandlungen. Dann ergänzen wir noch pro Behandlung sechs individuelle Beobachtungen. Am Ende randomisieren wir einmal über die Behandlungen in den Blöcken. Wichtig ist hier, dass wir die Daten nach den Blöcken gruppieren müssen und schon vorher alle individuellen Pflanzen generieren.</span>
<span id="cb71-714"><a href="#cb71-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-717"><a href="#cb71-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-718"><a href="#cb71-718" aria-hidden="true" tabindex="-1"></a>subsampling_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb71-719"><a href="#cb71-719" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">trt =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb71-720"><a href="#cb71-720" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-721"><a href="#cb71-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">factor</span>(trt, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"ctrl"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)),</span>
<span id="cb71-722"><a href="#cb71-722" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb71-723"><a href="#cb71-723" aria-hidden="true" tabindex="-1"></a>         <span class="at">pid =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb71-724"><a href="#cb71-724" aria-hidden="true" tabindex="-1"></a>         <span class="at">pid_text =</span> <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">96</span>, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb71-725"><a href="#cb71-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb71-726"><a href="#cb71-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">sample</span>(trt)) <span class="do">## Randomisierung in den Blöcken</span></span>
<span id="cb71-727"><a href="#cb71-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-728"><a href="#cb71-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-729"><a href="#cb71-729" aria-hidden="true" tabindex="-1"></a>Dann bauen wir noch unser Grid auf. Wir wollen insgesamt sechzehn Spalten, dass sind die Blöcke/Behandlungs-Kombinationen. Dann brauchen wir noch jeweils sechs Zeilen für die individuellen Pflanzen. Dann können wir die Daten schon nehmen und in der @fig-exp-adv-10-1 visualisieren. Bevor wir die Abbildung besprechen, generieren wir uns nochmal die anderen Daten, wo die Behandlungen in den Blöcken randomisiert werden.</span>
<span id="cb71-730"><a href="#cb71-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-733"><a href="#cb71-733" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-734"><a href="#cb71-734" aria-hidden="true" tabindex="-1"></a>subsampling_plot_tbl <span class="ot">&lt;-</span> subsampling_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb71-735"><a href="#cb71-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb71-736"><a href="#cb71-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-737"><a href="#cb71-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-738"><a href="#cb71-738" aria-hidden="true" tabindex="-1"></a>Eine andere Möglichkeit ist, dass unsere Pflanzen in einem Pflanztray stehen. Damit haben wir keine Randomisierung mehr in den Blöcken, sondern wir können nur unsere Behandlungen in den Blöcken randomisieren. Die Positionen in den Trays sind ja fix. Daher Randomisieren wir erst den Faktor der Behandlungen in den gruppierten Blöcken. Dann ergänzen wir noch die sechs individuellen Pflanzen.</span>
<span id="cb71-739"><a href="#cb71-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-742"><a href="#cb71-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-743"><a href="#cb71-743" aria-hidden="true" tabindex="-1"></a>subsampling_tray_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb71-744"><a href="#cb71-744" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">trt =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-745"><a href="#cb71-745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">factor</span>(trt, <span class="at">labels =</span> trt_fac1_soil),</span>
<span id="cb71-746"><a href="#cb71-746" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb71-747"><a href="#cb71-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb71-748"><a href="#cb71-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trt =</span> <span class="fu">sample</span>(trt)) <span class="sc">|&gt;</span> <span class="co"># Randomisierung der Behandlungen in den Blöcken</span></span>
<span id="cb71-749"><a href="#cb71-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="st">"0"</span>))</span>
<span id="cb71-750"><a href="#cb71-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-751"><a href="#cb71-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-752"><a href="#cb71-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-753"><a href="#cb71-753" aria-hidden="true" tabindex="-1"></a>Jetzt bauen wir uns noch das Grid für die Positionen zusammen, da bleibt alles beim alten. Wir brauchen auch wieder sechzehn Spalten, dass sind die Blöcke/Behandlungs-Kombinationen. Dann noch die sechs Zeilen für das Pflanzentray. In der @fig-exp-adv-10-2 sehen wir einmal das Ergebnis der Randomisierung. Alle Pflanzen sind jetzt in einer Spalte randomisiert, die eben das Tray der Pflanzung entspricht.</span>
<span id="cb71-754"><a href="#cb71-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-757"><a href="#cb71-757" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-758"><a href="#cb71-758" aria-hidden="true" tabindex="-1"></a>subsampling_tray_plot_tbl <span class="ot">&lt;-</span> subsampling_tray_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb71-759"><a href="#cb71-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb71-760"><a href="#cb71-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-761"><a href="#cb71-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-762"><a href="#cb71-762" aria-hidden="true" tabindex="-1"></a>In der @fig-exp-adv-10 sehen wir nochmal die beiden Arten des Subsamplings miteinander vergleichen. In der @fig-exp-adv-10-1 sind alle Behandlungen mit ihren sechs Wiederholungen zufällig im Block verteilt. Im anderen Fall sehen wir in der @fig-exp-adv-10-2, wenn die Pfanzen zusammen in einem Tray stehen und alle die gleiche Behandlung kriegen. Es können aber auch Schweine in einer Bucht sein und die Blöcke sind dann die einzelnen Ställe.</span>
<span id="cb71-763"><a href="#cb71-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-766"><a href="#cb71-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-767"><a href="#cb71-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb71-768"><a href="#cb71-768" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-769"><a href="#cb71-769" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-10</span></span>
<span id="cb71-770"><a href="#cb71-770" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-771"><a href="#cb71-771" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb71-772"><a href="#cb71-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-773"><a href="#cb71-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Verschiedene Arten des Subsamplings. Einmal vollständig innerhalb der Blöcke randomsiert und einmal die Behandlung randomisiert."</span></span>
<span id="cb71-774"><a href="#cb71-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb71-775"><a href="#cb71-775" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "... vollständig innerhalb Block randomisiert (`subsampling_plot_tbl`)."</span></span>
<span id="cb71-776"><a href="#cb71-776" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "... Behandlungen innerhalb Block randomisiert (`subsampling_tray_plot_tbl`)."</span></span>
<span id="cb71-777"><a href="#cb71-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 1</span></span>
<span id="cb71-778"><a href="#cb71-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-779"><a href="#cb71-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-780"><a href="#cb71-780" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(<span class="at">data =</span> subsampling_plot_tbl, <span class="at">flip =</span> <span class="cn">TRUE</span>, </span>
<span id="cb71-781"><a href="#cb71-781" aria-hidden="true" tabindex="-1"></a>        <span class="at">form =</span> block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block,</span>
<span id="cb71-782"><a href="#cb71-782" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> trt, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-783"><a href="#cb71-783" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> pid, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-784"><a href="#cb71-784" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Subsampling (2-faktoriell, vollständig randomisiert)"</span>, </span>
<span id="cb71-785"><a href="#cb71-785" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> pid_text, </span>
<span id="cb71-786"><a href="#cb71-786" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">show.key =</span> <span class="cn">FALSE</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> trt) </span>
<span id="cb71-787"><a href="#cb71-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-788"><a href="#cb71-788" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(<span class="at">data =</span> subsampling_tray_plot_tbl, <span class="at">flip =</span> <span class="cn">TRUE</span>, </span>
<span id="cb71-789"><a href="#cb71-789" aria-hidden="true" tabindex="-1"></a>        <span class="at">form =</span> block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block,</span>
<span id="cb71-790"><a href="#cb71-790" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> trt, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-791"><a href="#cb71-791" aria-hidden="true" tabindex="-1"></a>        <span class="co">#out2 = pid, out2.gpar = list(col = "grey", lty = 1),</span></span>
<span id="cb71-792"><a href="#cb71-792" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Subsampling (2-faktoriell, Behandlung randomisiert)"</span>, </span>
<span id="cb71-793"><a href="#cb71-793" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> rep, </span>
<span id="cb71-794"><a href="#cb71-794" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">show.key =</span> <span class="cn">FALSE</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> trt) </span>
<span id="cb71-795"><a href="#cb71-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-796"><a href="#cb71-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-797"><a href="#cb71-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-798"><a href="#cb71-798" aria-hidden="true" tabindex="-1"></a><span class="fu">## Incomplete block design {#sec-incomplete}</span></span>
<span id="cb71-799"><a href="#cb71-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-800"><a href="#cb71-800" aria-hidden="true" tabindex="-1"></a>Bei dem *incomplete block design* haben wir eigentlich ein normales Design, wie das 3-faktorielle *randomized complete block design* vorliegen, aber die Randomiserung ist nicht vollständig über alle Blöcke. Wir nehmen einmal die beiden Spezialfälle [Alpha design](#sec-alpha) und [Augmented design](#sec-augment) aus der Betrachtung raus. Wir schauen uns hier nochmal zu Vervollständigung das *randomized complete block design* mit nicht kompletten Blöcken an. Ich persönlich stehe dem Design etwas zwiegesaplten gegenüber. Ich würde lieber die Anzahl der Gruppen der Behandlungen reduzieren als die Blöcke. Wenn du ein Pilotversuch machst um zu schauen welche Linien wachsen oder aber ob es überhaupt einen Effekt einer Behandlung gibt, dann mag das *incomplete block design* einen Sinn machen. Dann sparst du wirklich Ressourcen und Zeit.</span>
<span id="cb71-801"><a href="#cb71-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-802"><a href="#cb71-802" aria-hidden="true" tabindex="-1"></a>::: callout-caution</span>
<span id="cb71-803"><a href="#cb71-803" aria-hidden="true" tabindex="-1"></a><span class="fu">## Verliere keine Behandlung im *incomplete block design*</span></span>
<span id="cb71-804"><a href="#cb71-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-805"><a href="#cb71-805" aria-hidden="true" tabindex="-1"></a>Achte immer darauf, dass du genug Blöcke hast um auch alle Behandlungslevel aufzunehmen. Schaue lieber doppelt, ob du auch wirklich alle Behandlungen in deinem Versuchsplan drin hast. Es kann schnell passieren, dass du auf einmal nur ein Level der Behandlung oder gar keins mehr in deinem Design vorliegen hast. Das R Paket <span class="in">`agricolae`</span> versucht das *incomplete block design* so zu bauen, dass du keine Behandlungen verlierst.</span>
<span id="cb71-806"><a href="#cb71-806" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-807"><a href="#cb71-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-808"><a href="#cb71-808" aria-hidden="true" tabindex="-1"></a>Wir immer erstmal unser Modell mit den zwei Behandlungsfaktoren <span class="in">`soil`</span> und <span class="in">`fert`</span>. Dann kommt noch der nicht komplette Block <span class="in">`inc_block`</span> hinzu.</span>
<span id="cb71-809"><a href="#cb71-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-810"><a href="#cb71-810" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-811"><a href="#cb71-811" aria-hidden="true" tabindex="-1"></a>y \sim \overbrace{soil}^{f_1} + \underbrace{fert}_{f_2} + \overbrace{inc<span class="sc">\_</span>block}^{f_3}</span>
<span id="cb71-812"><a href="#cb71-812" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-813"><a href="#cb71-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-814"><a href="#cb71-814" aria-hidden="true" tabindex="-1"></a>mit</span>
<span id="cb71-815"><a href="#cb71-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-816"><a href="#cb71-816" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Dünger <span class="in">`fert`</span> und den sechs Düngestufen als Level <span class="in">`fe_1`</span> bis <span class="in">`fe_6`</span>.</span>
<span id="cb71-817"><a href="#cb71-817" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Boden <span class="in">`soil`</span> und den vier Bodenarten als Level <span class="in">`soil_1`</span> bis <span class="in">`soil_4`</span>.</span>
<span id="cb71-818"><a href="#cb71-818" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Block <span class="in">`block`</span> und den zwei Leveln <span class="in">`block_1`</span> und <span class="in">`block_2`</span>.</span>
<span id="cb71-819"><a href="#cb71-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-820"><a href="#cb71-820" aria-hidden="true" tabindex="-1"></a>In der @fig-mermaid-incomplete-1 sehen wir nochmal die Abhängigkeitsstruktur des *incomplete block design*. Die beiden Faktoren <span class="in">`soil`</span> und <span class="in">`fert`</span> sind in den Blöcken genestet. Wir stellen hier die Linien als gestrichelt dar um auszudrücken, dass wir nur eine nicht komplette Zuordnung der Behandlungsfaktoren zu den Blöcken haben.</span>
<span id="cb71-821"><a href="#cb71-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-824"><a href="#cb71-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb71-825"><a href="#cb71-825" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-mermaid-incomplete-1</span></span>
<span id="cb71-826"><a href="#cb71-826" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-width: 6</span></span>
<span id="cb71-827"><a href="#cb71-827" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: "Schema der Abhängigkeitsstruktur des *incomplete block design* für das 3-faktorielle *randomized complete block design*. Die gestrichelte Linie stellt die nicht vollständige Zuordnung der Behandlungsfaktoren zu den Blöcken dar. Daher sind die Blöcke `inc_block` nicht komplett."</span></span>
<span id="cb71-828"><a href="#cb71-828" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb71-829"><a href="#cb71-829" aria-hidden="true" tabindex="-1"></a><span class="in">    A(fert):::factor -.- B(((nestet))) -.-&gt; E(inc_block):::inc_block</span></span>
<span id="cb71-830"><a href="#cb71-830" aria-hidden="true" tabindex="-1"></a><span class="in">    C(soil):::factor -.- D(((nestet))) -.-&gt; E</span></span>
<span id="cb71-831"><a href="#cb71-831" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-832"><a href="#cb71-832" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef inc_block fill:#CC79A7,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-833"><a href="#cb71-833" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-834"><a href="#cb71-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-835"><a href="#cb71-835" aria-hidden="true" tabindex="-1"></a>Dann das Ganze nochmal in dem R Paket <span class="in">`{agricolae}`</span> mit einem 2-faktoriellen *randomized complete block design* mit dem Fall der nicht kompletten Blöcke. Wir können in der Standardfunktion von `agricolae` nur ein 2-faktorielles *incomplete block design* abbilden. Deshalb dieses etwas kleinere Modell mit einem Behandlungsfaktor <span class="in">`trt`</span> und einem Block <span class="in">`block`</span>. Wir werden dann die Behandlungsgruppen nicht komplett auf alle Blöcke randomisieren.</span>
<span id="cb71-836"><a href="#cb71-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-837"><a href="#cb71-837" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-838"><a href="#cb71-838" aria-hidden="true" tabindex="-1"></a>y \sim \overbrace{trt}^{f_1} + \underbrace{inc<span class="sc">\_</span>block}_{f_2} </span>
<span id="cb71-839"><a href="#cb71-839" aria-hidden="true" tabindex="-1"></a>$$ mit</span>
<span id="cb71-840"><a href="#cb71-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-841"><a href="#cb71-841" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Behandlung <span class="in">`trt`</span> und den vier Behandlungsstufen als Level <span class="in">`ctrl`</span>, <span class="in">`A`</span>, <span class="in">`B`</span> und <span class="in">`C`</span>.</span>
<span id="cb71-842"><a href="#cb71-842" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Block <span class="in">`soil`</span> und den drei Blöcken mit den Leveln <span class="in">`1`</span>, <span class="in">`2`</span>, <span class="in">`3`</span>.</span>
<span id="cb71-843"><a href="#cb71-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-844"><a href="#cb71-844" aria-hidden="true" tabindex="-1"></a>Dann schauen wir uns nochmal die die Abhängigkeitsstruktur des *incomplete block design* in der @fig-mermaid-incomplete-2 an. Wir sehen, dass Design ist relativ einfach. Die Behandlungen sind in den Blöcken genestet, aber wir haben nicht alle Behandlungen in allen Blöcken vorliegen.</span>
<span id="cb71-845"><a href="#cb71-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-848"><a href="#cb71-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb71-849"><a href="#cb71-849" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-mermaid-incomplete-2</span></span>
<span id="cb71-850"><a href="#cb71-850" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-width: 6</span></span>
<span id="cb71-851"><a href="#cb71-851" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: "Schema der Abhängigkeitsstruktur des *incomplete block design* für das 2-faktorielle *randomized complete block design*. Die gestrichelte Linie stellt die nicht vollständige Zuordnung der Behandlungsfaktoren zu den Blöcken dar. Daher sind die Blöcke `inc_block` nicht komplett."</span></span>
<span id="cb71-852"><a href="#cb71-852" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb71-853"><a href="#cb71-853" aria-hidden="true" tabindex="-1"></a><span class="in">    C(trt):::factor -.- D(((nestet))) -.-&gt; E(inc_block):::inc_block</span></span>
<span id="cb71-854"><a href="#cb71-854" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-855"><a href="#cb71-855" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef inc_block fill:#CC79A7,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-856"><a href="#cb71-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-857"><a href="#cb71-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-858"><a href="#cb71-858" aria-hidden="true" tabindex="-1"></a>Wir oben schon geschrieben, die Verwendung von dem R Paket <span class="in">`agricolae`</span> schützt dich davor, keine der Behandlungslevel zu verlieren. Bei dem Selbermachen musst du dann immer schauen, ob dir der Versuchsplan so passt und alle Behandlungen einigermaßen vertreten und randomisiert sind.</span>
<span id="cb71-859"><a href="#cb71-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-860"><a href="#cb71-860" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb71-861"><a href="#cb71-861" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modell zur Auswertung</span></span>
<span id="cb71-862"><a href="#cb71-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-863"><a href="#cb71-863" aria-hidden="true" tabindex="-1"></a>Wir rechnen ein multiples lineares Modell für die statistische Analyse. Vermutlich reicht die Fallzahl nicht für alle Interaktionen zwischen allen Faktoren.</span>
<span id="cb71-864"><a href="#cb71-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-867"><a href="#cb71-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-868"><a href="#cb71-868" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-869"><a href="#cb71-869" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> fert <span class="sc">+</span> soil <span class="sc">+</span> fert<span class="sc">:</span>soil <span class="sc">+</span> inc_block, <span class="at">data =</span> inc_block_tbl)</span>
<span id="cb71-870"><a href="#cb71-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-871"><a href="#cb71-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-872"><a href="#cb71-872" aria-hidden="true" tabindex="-1"></a>Wir rechnen ein multiples lineares Modell für die statistische Analyse.</span>
<span id="cb71-873"><a href="#cb71-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-876"><a href="#cb71-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-877"><a href="#cb71-877" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-878"><a href="#cb71-878" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(drymatter <span class="sc">~</span> trt <span class="sc">+</span> inc_block <span class="sc">+</span> trt<span class="sc">:</span>inc_block, <span class="at">data =</span> inc_block_tbl)</span>
<span id="cb71-879"><a href="#cb71-879" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-880"><a href="#cb71-880" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-881"><a href="#cb71-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-882"><a href="#cb71-882" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `expand_grid()` (3-faktoriell)</span></span>
<span id="cb71-883"><a href="#cb71-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-884"><a href="#cb71-884" aria-hidden="true" tabindex="-1"></a>Bei dem Selbermachen ist es jetzt eigentlich wie bei dem 3-faktoriellen *randomized complete block design*. Deshalb schaue einfach nochmal oben nach, wenn dir Teile der Generierung unklar sind. Hier und dort ändert sich ja bei mir immer nur leicht der Code, damit du auch mal was anderes siehst. Es gibt ja viele Wege nach Rom.</span>
<span id="cb71-885"><a href="#cb71-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-888"><a href="#cb71-888" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-889"><a href="#cb71-889" aria-hidden="true" tabindex="-1"></a>incomplete_long_tbl <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">block =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">soil =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">fert =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-890"><a href="#cb71-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">factor</span>(block, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"Block "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)),</span>
<span id="cb71-891"><a href="#cb71-891" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">factor</span>(soil, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">"soil_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb71-892"><a href="#cb71-892" aria-hidden="true" tabindex="-1"></a>         <span class="at">fert =</span> <span class="fu">factor</span>(fert, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">"fe_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb71-893"><a href="#cb71-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(block) <span class="sc">|&gt;</span> </span>
<span id="cb71-894"><a href="#cb71-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fert =</span> <span class="fu">sample</span>(fert),</span>
<span id="cb71-895"><a href="#cb71-895" aria-hidden="true" tabindex="-1"></a>         <span class="at">soil =</span> <span class="fu">sample</span>(soil)) </span>
<span id="cb71-896"><a href="#cb71-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-897"><a href="#cb71-897" aria-hidden="true" tabindex="-1"></a>incomplete_long_tbl</span>
<span id="cb71-898"><a href="#cb71-898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-899"><a href="#cb71-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-900"><a href="#cb71-900" aria-hidden="true" tabindex="-1"></a>Noch haben wir kein *incomplete block design* vorliegen, dass bauen wir uns jetzt. Wir rasieren nämlich einfach die letzten beiden Zeilen unseres *randomized complete block design* ab. Damit haben wir dann nur noch ein $4\times4$-Block übrig. Sonst wäre es ja ein Block mit sechs Zeilen.</span>
<span id="cb71-901"><a href="#cb71-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-904"><a href="#cb71-904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-905"><a href="#cb71-905" aria-hidden="true" tabindex="-1"></a>incomplete_plot_tbl <span class="ot">&lt;-</span> incomplete_long_tbl <span class="sc">|&gt;</span> </span>
<span id="cb71-906"><a href="#cb71-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb71-907"><a href="#cb71-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rows <span class="sc">&lt;=</span> <span class="dv">4</span>)</span>
<span id="cb71-908"><a href="#cb71-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-909"><a href="#cb71-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-910"><a href="#cb71-910" aria-hidden="true" tabindex="-1"></a>Jetzt müssen wir uns die Sachlage einmal anschauen. In der @fig-exp-adv-7 sehen wir einmal den Versuchsplan für das *incomplete block design*. Du musst immer schauen, ob wir wirklich alle Level jedes Behandlungsfaktors auch vorliegen haben und ob sich die Level auch einigermaßen gut verteilen. Das *incomplete block design* ist da etwas frickelig, ob es dann auch wirklich gut ist. Aber du kannst auch nciht alle Kombinationen vorliegen haben, denn sonst wäre es ja auch kein *incomplete block design*.</span>
<span id="cb71-911"><a href="#cb71-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-914"><a href="#cb71-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-915"><a href="#cb71-915" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-916"><a href="#cb71-916" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-917"><a href="#cb71-917" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-7</span></span>
<span id="cb71-918"><a href="#cb71-918" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-919"><a href="#cb71-919" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb71-920"><a href="#cb71-920" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-921"><a href="#cb71-921" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Incomplete block design (3-faktoriell) für die Faktoren Dünger `fert` sowie `soil` randomisiert in den zwei Blöcken."</span></span>
<span id="cb71-922"><a href="#cb71-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-923"><a href="#cb71-923" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(block <span class="sc">~</span> cols <span class="sc">+</span> rows <span class="sc">|</span> block, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-924"><a href="#cb71-924" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> rows, <span class="at">out1.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>),</span>
<span id="cb71-925"><a href="#cb71-925" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> cols, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-926"><a href="#cb71-926" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> fert, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>, <span class="at">col =</span> soil,</span>
<span id="cb71-927"><a href="#cb71-927" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> incomplete_plot_tbl,</span>
<span id="cb71-928"><a href="#cb71-928" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Incomplete block design (3-faktoriell)"</span>,</span>
<span id="cb71-929"><a href="#cb71-929" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-930"><a href="#cb71-930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-931"><a href="#cb71-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-932"><a href="#cb71-932" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{FielDHub}`</span></span>
<span id="cb71-933"><a href="#cb71-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-934"><a href="#cb71-934" aria-hidden="true" tabindex="-1"></a>Für die Erstellung des *incomplete block design* in der Shiny App schaue dir die Anleitung unter <span class="co">[</span><span class="ot">Generates a Resolvable Incomplete Block Design mit `{FielDHub}`</span><span class="co">](https://didiermurillof.github.io/FielDHub/reference/incomplete_blocks.html)</span> einmal an. Hier einmal der Code für die Erstellung in R. Leider ist das ganz viel rumprobieren, bis es dann mit den Parametern klappt. Dehalb empfhele ich dir hier auf jeden Fall die Shiny App, da kannst du viel einfach rumprobieren und mit den Anzahlen an Behandlungen und Blöcken spielen. Hier generierst du sehr viele Fehlermeldungen und versuchst dann ein Design zu finden was passt, dann musst du es ja noch visualisieren. Die Schritte sind dann in der Shiny App besser miteinander verwoben.</span>
<span id="cb71-935"><a href="#cb71-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-938"><a href="#cb71-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-939"><a href="#cb71-939" aria-hidden="true" tabindex="-1"></a>incomplete_block_obj <span class="ot">&lt;-</span> <span class="fu">incomplete_blocks</span>(<span class="at">t =</span> <span class="dv">6</span>,</span>
<span id="cb71-940"><a href="#cb71-940" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">k =</span> <span class="dv">3</span>,</span>
<span id="cb71-941"><a href="#cb71-941" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb71-942"><a href="#cb71-942" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">seed =</span> <span class="dv">1984</span>)</span>
<span id="cb71-943"><a href="#cb71-943" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-944"><a href="#cb71-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-945"><a href="#cb71-945" aria-hidden="true" tabindex="-1"></a>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst.</span>
<span id="cb71-946"><a href="#cb71-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-949"><a href="#cb71-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-950"><a href="#cb71-950" aria-hidden="true" tabindex="-1"></a>incomplete_block_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb71-951"><a href="#cb71-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb71-952"><a href="#cb71-952" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-953"><a href="#cb71-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-954"><a href="#cb71-954" aria-hidden="true" tabindex="-1"></a>Dann erstellen wir auch schon die @fig-exp-basic-incomplete-fieldhub mit dem *split plot design*. Da wir hier wieder eine relativ einfache Abbildung haben, geht es dann auch mit der Darstellung in <span class="in">`{FielDHub}`</span>. Leider sind auch hier die Zahlen teilweise sehr schwer auf den Farben zu erkennen.</span>
<span id="cb71-955"><a href="#cb71-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-958"><a href="#cb71-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-959"><a href="#cb71-959" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-960"><a href="#cb71-960" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-961"><a href="#cb71-961" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-basic-incomplete-fieldhub</span></span>
<span id="cb71-962"><a href="#cb71-962" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-963"><a href="#cb71-963" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb71-964"><a href="#cb71-964" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb71-965"><a href="#cb71-965" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Incomplete block design (2-faktoriell) für den Faktor `trt` randomisiert in den sechs Blöcken."</span></span>
<span id="cb71-966"><a href="#cb71-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-967"><a href="#cb71-967" aria-hidden="true" tabindex="-1"></a>incomplete_block_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb71-968"><a href="#cb71-968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-969"><a href="#cb71-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-970"><a href="#cb71-970" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{agricolae}` (2-faktoriell)</span></span>
<span id="cb71-971"><a href="#cb71-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-972"><a href="#cb71-972" aria-hidden="true" tabindex="-1"></a>Der Vorteil von <span class="in">`{agricolae}`</span> und der Funktion <span class="in">`design.bib()`</span> ist ganz klar die Effizienz und die optimale Verteilung der Behandlungsfaktoren auf die Blöcke. Wir können hier sicher sein das optimale Ergebnis der Randomisierung zu erhalten und müssen auch keine Sorge haben, das Level der Behandlungen abhanden gekommen sind. Deshalb kann ich hier die Funktion <span class="in">`design.bib()`</span> in <span class="in">`{agricolae}`</span> sehr empfehlen.</span>
<span id="cb71-973"><a href="#cb71-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-974"><a href="#cb71-974" aria-hidden="true" tabindex="-1"></a>Die Namen der Optionen sind nicht die Stärke von <span class="in">`{agricolae}`</span>, also haben wir hier wieder die alten Probleme. Wir müssen darauf achten, dass wir die Anzahl an Blöcken mit <span class="in">`k`</span> angeben. Wenn du zu wenig Blöcke bei zu vielen Behandlungslevel wählst, dann gibt dir die Funktion einen Fehler wieder und kein Ergebnis. An der Ausgabe der Funktion kannst du dann gleich deine Effizienz gegenüber einer vollständigen Randomisierung abschätzen.</span>
<span id="cb71-975"><a href="#cb71-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-978"><a href="#cb71-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-979"><a href="#cb71-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-980"><a href="#cb71-980" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-981"><a href="#cb71-981" aria-hidden="true" tabindex="-1"></a>bib_obj <span class="ot">&lt;-</span> <span class="fu">design.bib</span>(<span class="at">trt =</span> <span class="fu">c</span>(<span class="st">"ctrl"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>),</span>
<span id="cb71-982"><a href="#cb71-982" aria-hidden="true" tabindex="-1"></a>                      <span class="at">k =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">543</span>, <span class="at">serie =</span> <span class="dv">2</span>)</span>
<span id="cb71-983"><a href="#cb71-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-984"><a href="#cb71-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-985"><a href="#cb71-985" aria-hidden="true" tabindex="-1"></a>Wichtig ist hier, dass wir auf den <span class="in">`Efficiency factor`</span> schauen. Wir sind mit unserer Randomisierung des *incomplete block design* ungefähr zu 89% so gut wie das gleichwertige *randomized complete block design*. Das ist schonmal gut. Wir sparen Platz auf dem Feld oder dem Stall und sind trotzdem nicht so viel schlechter als ein vollständig randomisiertes Design. Aber Achtung, die Aussagekraft ist hier geringer, für Pilotstudien ist das immer okay, für echte Feldstudien zur Zulassung oder für wissenschaftliche Publikationen eher weniger bis gar nicht.</span>
<span id="cb71-986"><a href="#cb71-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-987"><a href="#cb71-987" aria-hidden="true" tabindex="-1"></a>Wir müssen in diesem Fall nicht so viel an den Daten bereinigen um uns gleich die Visualisierung anzuschauen. Das geht hier relativ einfach. Wir benennen nur die Spalten um und sind schon soweit fertig.</span>
<span id="cb71-988"><a href="#cb71-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-991"><a href="#cb71-991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-992"><a href="#cb71-992" aria-hidden="true" tabindex="-1"></a>bib_book_tbl <span class="ot">&lt;-</span> bib_obj <span class="sc">|&gt;</span> </span>
<span id="cb71-993"><a href="#cb71-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">"book"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-994"><a href="#cb71-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb71-995"><a href="#cb71-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"plots"</span>, <span class="st">"block"</span>, <span class="st">"trt"</span>))</span>
<span id="cb71-996"><a href="#cb71-996" aria-hidden="true" tabindex="-1"></a>bib_book_tbl</span>
<span id="cb71-997"><a href="#cb71-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-998"><a href="#cb71-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-999"><a href="#cb71-999" aria-hidden="true" tabindex="-1"></a>Dann ergänzen wir noch die Informationen zu den Spalten und den Zeilen, so dass wir dann auch gleich <span class="in">`desplot()`</span> nutzen können. Wir müssen hier nochmal nach den Spalten gruppieren, damit wir die Zeilen sauber zugeordnet kriegen. Wir haben ja nicht für jede Behandlung eine Zeile sondern eben weniger. Ja, man hätte auch mit der Information von <span class="in">`k = 3`</span> hier arbeiten können. So finde ich es aber schöner.</span>
<span id="cb71-1000"><a href="#cb71-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1003"><a href="#cb71-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1004"><a href="#cb71-1004" aria-hidden="true" tabindex="-1"></a>bib_plot_tbl <span class="ot">&lt;-</span> bib_book_tbl <span class="sc">|&gt;</span></span>
<span id="cb71-1005"><a href="#cb71-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cols =</span> <span class="fu">as.numeric</span>(block)) <span class="sc">|&gt;</span> </span>
<span id="cb71-1006"><a href="#cb71-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cols) <span class="sc">|&gt;</span> </span>
<span id="cb71-1007"><a href="#cb71-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb71-1008"><a href="#cb71-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1009"><a href="#cb71-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1010"><a href="#cb71-1010" aria-hidden="true" tabindex="-1"></a>Einmal der Vergleich zum <span class="in">`sketch`</span> aus der Ausgabe von <span class="in">`design.bib()`</span>. Siehst gut aus und entspricht unseren Erwartungen. Du siehst hier gut, dass im ersten Block die Kontrolle gar nicht enthalten ist.</span>
<span id="cb71-1011"><a href="#cb71-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1014"><a href="#cb71-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1015"><a href="#cb71-1015" aria-hidden="true" tabindex="-1"></a>bib_obj <span class="sc">|&gt;</span> </span>
<span id="cb71-1016"><a href="#cb71-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">"sketch"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-1017"><a href="#cb71-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb71-1018"><a href="#cb71-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1019"><a href="#cb71-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1020"><a href="#cb71-1020" aria-hidden="true" tabindex="-1"></a>In der @fig-exp-adv-8 sehen wir die Visualisierung unseres *incomplete block design* für den Faktor <span class="in">`trt`</span> randomisiert in den vier Blöcken. Ich finde die farbliche Hinterlegung sehr schön, da sieht man viel schneller die eigentliche Zuordnung der Behandlungslevel zu den Blöcken. Auch siehst du schön, dass in dem vierten Block die Behandlung <span class="in">`C`</span> gar nicht vorkommt. Was du dann nicht misst, kann auch nicht in der statistischen Auswertung berücksichtigt werden.</span>
<span id="cb71-1021"><a href="#cb71-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1024"><a href="#cb71-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1025"><a href="#cb71-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-1026"><a href="#cb71-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-1027"><a href="#cb71-1027" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-8</span></span>
<span id="cb71-1028"><a href="#cb71-1028" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-1029"><a href="#cb71-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb71-1030"><a href="#cb71-1030" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb71-1031"><a href="#cb71-1031" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Incomplete block design (2-faktoriell) für den Faktor `trt` randomisiert in den vier Blöcken."</span></span>
<span id="cb71-1032"><a href="#cb71-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(trt <span class="sc">~</span> cols <span class="sc">+</span> rows, <span class="at">flip =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-1033"><a href="#cb71-1033" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> trt, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">shorten =</span> <span class="st">"no"</span>,</span>
<span id="cb71-1034"><a href="#cb71-1034" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> block,</span>
<span id="cb71-1035"><a href="#cb71-1035" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> bib_plot_tbl,</span>
<span id="cb71-1036"><a href="#cb71-1036" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Incomplete block design (2-faktoriell)"</span>, </span>
<span id="cb71-1037"><a href="#cb71-1037" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-1038"><a href="#cb71-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1039"><a href="#cb71-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1040"><a href="#cb71-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">## Strip plot design (3-faktoriell) {#sec-strip-plot}</span></span>
<span id="cb71-1041"><a href="#cb71-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1042"><a href="#cb71-1042" aria-hidden="true" tabindex="-1"></a>Das Streifenparzellenversuch (eng. *strip plot design*) ist eigentlich ein doppeltes *split plot design* oder eben eine Erweiterung. Wo das *split plot design* in Spalten orientiert ist ergänzen wir jetzt durch das *strip plot design* noch die horizontale Dimension. Das heißt wir haben eine Randomisierung und Abhängigkeitsstruktur in den Spalten sowie in den Zeilen. Dabei orientieren wir uns an dem <span class="co">[</span><span class="ot">Strip-plot experiment of rice</span><span class="co">](https://kwstat.github.io/agridat/reference/gomez.stripplot.html)</span> aus @gomez1984statistical. Du findest dann das Datenbeispiel auch in <span class="in">`{agridat}`</span> als <span class="in">`data(gomez.stripplot)`</span>. Ich habe versucht jetzt die Daten in der Form nachzubauen und somit kannst du dann auch ähnliche Experimente planen.</span>
<span id="cb71-1043"><a href="#cb71-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1044"><a href="#cb71-1044" aria-hidden="true" tabindex="-1"></a>Unser *strip plot design* hat drei Wiederholungen mit <span class="in">`block`</span>, eine Sorte <span class="in">`trt_gen`</span> als horizontaler Streifen und Stickstoffdünger <span class="in">`trt_nitro`</span> als vertikaler Streifen. Das ganze klingt immer super abstrakt, deshalb gehe gerne gleich zur Auflösung in die @fig-exp-adv-9. Manchmal ist es besser sich gleich die Visualisierung anzuschauen und dann das folgende Modell.</span>
<span id="cb71-1045"><a href="#cb71-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1046"><a href="#cb71-1046" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-1047"><a href="#cb71-1047" aria-hidden="true" tabindex="-1"></a>y \sim \overbrace{trt_{gen}}^{f_1} + \underbrace{trt_{nitro}}_{f_2} + \overbrace{block}^{f_3}</span>
<span id="cb71-1048"><a href="#cb71-1048" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb71-1049"><a href="#cb71-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1050"><a href="#cb71-1050" aria-hidden="true" tabindex="-1"></a>mit</span>
<span id="cb71-1051"><a href="#cb71-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1052"><a href="#cb71-1052" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Behandlung <span class="in">`trt_gen`</span> und den sechs Linien als Level <span class="in">`G_1`</span> bis <span class="in">`G_6`</span>.</span>
<span id="cb71-1053"><a href="#cb71-1053" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Dünger <span class="in">`trt_nitro`</span> und den drei Düngestufen als Level <span class="in">`0`</span>, <span class="in">`60`</span> und <span class="in">`120`</span>.</span>
<span id="cb71-1054"><a href="#cb71-1054" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>dem Faktor Block <span class="in">`block`</span> und den drei Leveln <span class="in">`1`</span> bis <span class="in">`3`</span>.</span>
<span id="cb71-1055"><a href="#cb71-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1056"><a href="#cb71-1056" aria-hidden="true" tabindex="-1"></a>In der @fig-mermaid-stripplot dann einmal die Abhängigkeitsstruktur des *split plot design*. Wichtig ist hierbei, dass die genetischen Linien <span class="in">`trt_gen`</span> in den Zeilen <span class="in">`rows`</span> der Blöcke genestet und randomisiert sind. Wir sehen aber die Zeilen später nicht in der Auswertung. Die Zeilen werden durch den Faktor Block repräsentiert. Genauso ist es mit der Stickstoffbehandlung <span class="in">`trt_nitro`</span>, die dann in den Spalten <span class="in">`cols`</span> des Blocks genested und randomisiert wird. Auch hier sehen wir dann in der späteren Auswertung nur den Block.</span>
<span id="cb71-1057"><a href="#cb71-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1060"><a href="#cb71-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb71-1061"><a href="#cb71-1061" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-mermaid-stripplot</span></span>
<span id="cb71-1062"><a href="#cb71-1062" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-width: 6</span></span>
<span id="cb71-1063"><a href="#cb71-1063" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: "Schema der Abhängigkeitsstruktur des *split plot design*. Die genetischen Linien `trt_gen` sind in den Zeilen `rows` der Blöcke genestet und randomisiert. Die Stickstoffbehandlung `trt_nitro` ist dann in den Spalten `cols` des Blocks genested und randomisiert."</span></span>
<span id="cb71-1064"><a href="#cb71-1064" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb71-1065"><a href="#cb71-1065" aria-hidden="true" tabindex="-1"></a><span class="in">    A(trt_gen):::factor --- B(((nestet))) ---&gt; C(rows) --- E(block):::factor</span></span>
<span id="cb71-1066"><a href="#cb71-1066" aria-hidden="true" tabindex="-1"></a><span class="in">    F(trt_nitro):::factor --- G(((nestet))) ---&gt; H(cols) --- E</span></span>
<span id="cb71-1067"><a href="#cb71-1067" aria-hidden="true" tabindex="-1"></a><span class="in">    classDef factor fill:#56B4E9,stroke:#333,stroke-width:0.75px</span></span>
<span id="cb71-1068"><a href="#cb71-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1069"><a href="#cb71-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1070"><a href="#cb71-1070" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb71-1071"><a href="#cb71-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modell zur Auswertung</span></span>
<span id="cb71-1072"><a href="#cb71-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1073"><a href="#cb71-1073" aria-hidden="true" tabindex="-1"></a>Wir rechnen hier ein lineares gemischtes Modell für die Auswertung der Daten.</span>
<span id="cb71-1074"><a href="#cb71-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1077"><a href="#cb71-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1078"><a href="#cb71-1078" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb71-1079"><a href="#cb71-1079" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(yield <span class="sc">~</span> trt_gen <span class="sc">+</span> nitro <span class="sc">+</span> trt_gen<span class="sc">:</span>nitro <span class="sc">+</span> </span>
<span id="cb71-1080"><a href="#cb71-1080" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">|</span> block) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> block<span class="sc">:</span>nitro) <span class="sc">+</span> </span>
<span id="cb71-1081"><a href="#cb71-1081" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">|</span> block<span class="sc">:</span>trt_gen), </span>
<span id="cb71-1082"><a href="#cb71-1082" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> stripplot_tbl)</span>
<span id="cb71-1083"><a href="#cb71-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1084"><a href="#cb71-1084" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb71-1085"><a href="#cb71-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1086"><a href="#cb71-1086" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{agricolae}`</span></span>
<span id="cb71-1087"><a href="#cb71-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1088"><a href="#cb71-1088" aria-hidden="true" tabindex="-1"></a>Das *strip plot design* kann ich selber machen, aber hier fängt es dann an wirklich so kompliziert zu werden, dass es sich nicht mehr lohnt. Dafür haben wir dann in <span class="in">`{agricolae}`</span> die passende Funktion. Die würde ich dann auch immer empfehlen zu nutzen, dass macht das Leben wirklich einfacher. Wir müssen zwar wieder erstmal unsere Faktoren als Vektoren bauen und dann alles in den passenden Objekten ablegen, aber das ist nur wenig Aufwand im Vergleich zum Selbermachen.</span>
<span id="cb71-1089"><a href="#cb71-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1092"><a href="#cb71-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1093"><a href="#cb71-1093" aria-hidden="true" tabindex="-1"></a>trt_gen <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"G"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb71-1094"><a href="#cb71-1094" aria-hidden="true" tabindex="-1"></a>n_trt_gen <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_gen)</span>
<span id="cb71-1095"><a href="#cb71-1095" aria-hidden="true" tabindex="-1"></a>trt_nitro <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">120</span>)</span>
<span id="cb71-1096"><a href="#cb71-1096" aria-hidden="true" tabindex="-1"></a>n_trt_nitro <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(trt_nitro)</span>
<span id="cb71-1097"><a href="#cb71-1097" aria-hidden="true" tabindex="-1"></a>n_block <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb71-1098"><a href="#cb71-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1099"><a href="#cb71-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1100"><a href="#cb71-1100" aria-hidden="true" tabindex="-1"></a>Jetzt kommt der einzige wichtige Teil, damit du später die Zeilen- und Spaltenpositionen einfach zuweisen kannst. Du musst in die Option <span class="in">`trt1 =`</span> den *kürzen* Vektor packen. Hier hat der Dünger nur drei Level, also ist der Dünger in der Option <span class="in">`trt1 =`</span> vertreten. Dann nehmen wir den längeren Vektor für die genetischen Linien in die zweite Option <span class="in">`trt2 =`</span> mit rein. Nimm also erst den kurzen Vektor dann den langen Vektor, dann klappt es auch mit der späteren Zuweisung der Positionen leichter.</span>
<span id="cb71-1101"><a href="#cb71-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1104"><a href="#cb71-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1105"><a href="#cb71-1105" aria-hidden="true" tabindex="-1"></a>strip_obj <span class="ot">&lt;-</span> <span class="fu">design.strip</span>(<span class="at">trt1 =</span> trt_nitro, <span class="co"># kürzerer Vektor (hier der Länge 3) </span></span>
<span id="cb71-1106"><a href="#cb71-1106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trt2 =</span> trt_gen,   <span class="co"># längerer Vektor (hier der Länge 6)</span></span>
<span id="cb71-1107"><a href="#cb71-1107" aria-hidden="true" tabindex="-1"></a>                          <span class="at">r =</span> n_block, <span class="at">serie =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">543</span>)</span>
<span id="cb71-1108"><a href="#cb71-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1109"><a href="#cb71-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1110"><a href="#cb71-1110" aria-hidden="true" tabindex="-1"></a>Für die Zuweisung der richtigen Zeilen <span class="in">`rows`</span> und Spalten <span class="in">`cols`</span> im Positionsgrid müssen wir dann nicht so viel machen, wenn wir oben darauf geachtet haben, die Behandlungsfaktoren in der richtigen Reihenfolge den Optionen zuzuweisen. Die Zuweisung der <span class="in">`cols`</span> funktioniert also nur, wenn du in der Funktion <span class="in">`design.strip()`</span> wirklich den kürzeren vor dem längeren Vektor zuweist.</span>
<span id="cb71-1111"><a href="#cb71-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1114"><a href="#cb71-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1115"><a href="#cb71-1115" aria-hidden="true" tabindex="-1"></a>strip_plot_tbl <span class="ot">&lt;-</span> strip_obj<span class="sc">$</span>book <span class="sc">|&gt;</span> </span>
<span id="cb71-1116"><a href="#cb71-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand_grid</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span>(n_trt_nitro<span class="sc">*</span>n_block), </span>
<span id="cb71-1117"><a href="#cb71-1117" aria-hidden="true" tabindex="-1"></a>                        <span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span>n_trt_gen))</span>
<span id="cb71-1118"><a href="#cb71-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1119"><a href="#cb71-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1120"><a href="#cb71-1120" aria-hidden="true" tabindex="-1"></a>Dann sind wir schon soweit uns einmal in der @fig-exp-adv-9 das *strip plot design* anzuschauen. Du kannst sehr schon sehen, wie die genetischen Linien in den Zeilen randomisiert sind und die verschiedenen Stickstoffgaben dann in den Zeilen. Die drei Blöcke werden dann durch die dicken Linien dargestellt. Da wir es bei dem *strip plot design* häufig mit Großversuchen zu tun haben sind die Blöcke meistens durch Feldwege oder andere bauliche Bedingungen voneinander getrennt.</span>
<span id="cb71-1121"><a href="#cb71-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1124"><a href="#cb71-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1125"><a href="#cb71-1125" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-1126"><a href="#cb71-1126" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-1127"><a href="#cb71-1127" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-adv-9</span></span>
<span id="cb71-1128"><a href="#cb71-1128" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-1129"><a href="#cb71-1129" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb71-1130"><a href="#cb71-1130" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-1131"><a href="#cb71-1131" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Strip plot design (3-faktoriell) für den Faktor `trt_gen`, in den Zeilen randomisiert sowie dem Faktor `trt_nitro` in den Saplten randomisiert und in drei Blöcken genestet."</span></span>
<span id="cb71-1132"><a href="#cb71-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">desplot</span>(trt_gen <span class="sc">~</span> cols<span class="sc">*</span>rows,</span>
<span id="cb71-1133"><a href="#cb71-1133" aria-hidden="true" tabindex="-1"></a>        <span class="at">out1 =</span> block, </span>
<span id="cb71-1134"><a href="#cb71-1134" aria-hidden="true" tabindex="-1"></a>        <span class="at">out2 =</span> trt_nitro, <span class="at">out2.gpar =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">1</span>), </span>
<span id="cb71-1135"><a href="#cb71-1135" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.regions =</span> cbbPalette, </span>
<span id="cb71-1136"><a href="#cb71-1136" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> trt_nitro, <span class="at">cex =</span> <span class="dv">1</span>,</span>
<span id="cb71-1137"><a href="#cb71-1137" aria-hidden="true" tabindex="-1"></a>        <span class="at">show.key =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> strip_plot_tbl, <span class="at">shorten =</span> <span class="st">"no"</span>,</span>
<span id="cb71-1138"><a href="#cb71-1138" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Strip plot design (3-faktoriell)"</span>)</span>
<span id="cb71-1139"><a href="#cb71-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1140"><a href="#cb71-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1141"><a href="#cb71-1141" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... mit `{FielDHub}`</span></span>
<span id="cb71-1142"><a href="#cb71-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1143"><a href="#cb71-1143" aria-hidden="true" tabindex="-1"></a>Für die Erstellung des *strip plot design* in der Shiny App schaue dir die Anleitung unter <span class="co">[</span><span class="ot">Strip Plot Design mit `{FielDHub}`</span><span class="co">](https://didiermurillof.github.io/FielDHub/reference/strip_plot.html)</span> einmal an. Hier einmal der Code für die Erstellung in R. Der Code ist fast so einfach wie auch eben in <span class="in">`{agricolae}`</span>. Wir definieren wieder unseren horizontalen Parzellen <span class="in">`Hplots`</span> und dann noch die vertikalen Parzellen <span class="in">`Vplots`</span>. So wichtig ist die Zuordnung nicht. Du kannst ja auch einfach das Blatt drehen und dann sind die Parzellen anders angeordnet.</span>
<span id="cb71-1144"><a href="#cb71-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1147"><a href="#cb71-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1148"><a href="#cb71-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-1149"><a href="#cb71-1149" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-1150"><a href="#cb71-1150" aria-hidden="true" tabindex="-1"></a>strip_plot_obj <span class="ot">&lt;-</span> <span class="fu">strip_plot</span>(<span class="at">Hplots =</span> trt_nitro, <span class="co"># kürzerer Vektor (hier der Länge 3) </span></span>
<span id="cb71-1151"><a href="#cb71-1151" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Vplots =</span> trt_gen,   <span class="co"># längerer Vektor (hier der Länge 6)</span></span>
<span id="cb71-1152"><a href="#cb71-1152" aria-hidden="true" tabindex="-1"></a>                             <span class="at">b =</span> n_block)</span>
<span id="cb71-1153"><a href="#cb71-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1154"><a href="#cb71-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1155"><a href="#cb71-1155" aria-hidden="true" tabindex="-1"></a>Dann können wir uns einmal das erstellte Feldbuch wiedergeben lassen, was du dann auch in Excel raus schreiben kannst.</span>
<span id="cb71-1156"><a href="#cb71-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1159"><a href="#cb71-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1160"><a href="#cb71-1160" aria-hidden="true" tabindex="-1"></a>strip_plot_obj<span class="sc">$</span>fieldBook <span class="sc">|&gt;</span> </span>
<span id="cb71-1161"><a href="#cb71-1161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb71-1162"><a href="#cb71-1162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1163"><a href="#cb71-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1164"><a href="#cb71-1164" aria-hidden="true" tabindex="-1"></a>Dann erstellen wir auch schon die @fig-exp-basic-stripplot-fieldhub mit dem *strip plot design*. Da wir hier wieder eine relativ einfache Abbildung haben, geht es dann auch mit der Darstellung in <span class="in">`{FielDHub}`</span>. Leider sind auch hier die Zahlen teilweise sehr schwer auf den Farben zu erkennen und ich mag die Darstellung mit dem <span class="in">`|`</span> nicht. Das geht dann wirklich schöner wie du in der @fig-exp-adv-9 sehen kannst. Da lohnt sich dann auch die Arbeit mit <span class="in">`{desplot}`</span> nochmal aus dem Feldbuch was schöneres zu machen. Die Informationen sind ja da.</span>
<span id="cb71-1165"><a href="#cb71-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1168"><a href="#cb71-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb71-1169"><a href="#cb71-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb71-1170"><a href="#cb71-1170" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb71-1171"><a href="#cb71-1171" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-exp-basic-stripplot-fieldhub</span></span>
<span id="cb71-1172"><a href="#cb71-1172" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb71-1173"><a href="#cb71-1173" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb71-1174"><a href="#cb71-1174" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb71-1175"><a href="#cb71-1175" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Strip plot design (3-faktoriell) für den Faktor `trt_gen`, in den Zeilen randomisiert sowie dem Faktor `trt_nitro` in den Saplten randomisiert und in drei Blöcken genestet."</span></span>
<span id="cb71-1176"><a href="#cb71-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1177"><a href="#cb71-1177" aria-hidden="true" tabindex="-1"></a>strip_plot_obj <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb71-1178"><a href="#cb71-1178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb71-1179"><a href="#cb71-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-1180"><a href="#cb71-1180" aria-hidden="true" tabindex="-1"></a><span class="fu">## Referenzen {.unnumbered}</span></span>
</code><button title="In die Zwischenablage kopieren" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Bio Data Science wurde von <a href="https://www.hs-osnabrueck.de/prof-dr-jochen-kruppa/">Jochen Kruppa-Scheetz</a> geschrieben.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jkruppa/jkruppa.github.io/edit/master/experimental-design-advanced.qmd" class="toc-action"><i class="bi bi-github"></i>Seite editieren</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Problem melden</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/blob/master/experimental-design-advanced.qmd" class="toc-action"><i class="bi empty"></i>Quellcode anzeigen</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Dieses Openbook wurde mit <a href="https://quarto.org/">Quarto</a> erstellt.</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>