```{r echo = FALSE}
pacman::p_load(tidyverse, readxl, knitr, kableExtra, Hmisc, plyr)
```

# Die ANOVA {#sec-anova}

[Historisch betrachtet ist die ANOVA, *das* statistische Verfahren was gut per Hand ohne Computer berechnet werden kann. Daher war die ANOVA von den 20zigern bis in die frühen 90ziger des letzten Jahrhunderts *das* statistische Verfahren der Wahl.]{.aside}

::: callout-tip
## Einführung in die ANOVA per Video

Du findest auf YouTube [Grundlagen in R](https://www.youtube.com/playlist?list=PLe51bCp9JvEFUnFqaJG5aRmON9i1ZbOYC) als Video Reihe. Ich werde zwar alles nochmal hier als Text aufschreiben, aber manchmal ist das Sehen und Hören dann einfacher.
:::

Die ANOVA (eng. *analysis of variance*) ist wichtig. Was für ein schöner Satz um anzufangen. Wir brauchen die ANOVA aus mehreren Gründen. Die Hochzeiten der ANOVA sind eigentlich vorbei, wir haben in der Statistik für viele Fälle mittlerweile besser Werkzeuge, aber als Allrounder ist die ANOVA immer noch nutzbar.

::: column-margin
Die tolle Webseite [Data Science for Agriculture in R](https://schmidtpaul.github.io/DSFAIR/index.html) liefert eine Vielzahl von experimentellen Designs sowie deren Auswertung. Neben anderen komplexeren Designs, auch diese einfacheren Designs, die jeder kennen sollte.

-   [Completely randomized design](https://schmidtpaul.github.io/DSFAIR/CRD_Mead1993.html), ist das Standarddesign für ein Feldexperiment.

-   [Randomized complete block design (RCBD) with 1 factor](https://schmidtpaul.github.io/DSFAIR/RCBD_ClewerScarisbrick2001.html), beschreibt ein Experiment mit Blöcken und einem Behandlungsfaktor.

-   [Randomized complete block design (RCBD) with 2 factors](https://schmidtpaul.github.io/DSFAIR/RCBD_2f_rice.html), beschreibt ein Experiment mit Blöcken und einem Behandlungsfaktor sowie einem weiteren Faktor.

-   [Latin square design](https://schmidtpaul.github.io/DSFAIR/latsquare_Bridges1989.html), ist ein etwas spezielleres Design, wird aber auch viel genutzt.

Wir gehen in einem späteren Kapitel nochmal auf die experimentellen Designs ein.
:::

Wofür brauchen wir die ANOVA?

1)  Wir brauchen die ANOVA um mehr als zwei Gruppen *gleichzeitig* miteinander zu vergleichen. Das heißt wir haben einen Faktor mit mehr als zwei Levels und wollen wissen, ob sich *mindestens* zwei Level bzw. Gruppen im mittelwert unterscheiden.
2)  Wir brauchen die ANOVA und deren Varianzzerlegung in der Züchtung. Hier speilt die ANOVA eine gewichtige Rolle bei der Abschätzung des genetischen Effekts. Wir werden aktuell (Stand Ende 2022) hierauf noch nicht tiefer eingehen.
3)  Wir nutzen die ANOVA in vielen Anwendunsggebieten als eine Arte Vortest um zu schauen, ob sich ein Effekt in den Daten verbirgt. Eigentlich stammt dieses Ritual aus ANOVA als Vortest und dann ein Posthoc Test noch aus der Zeit, wo wir keine moderen Rechner zu Verfügung hatten. Damals machte diese Reihenfolge noch Sinn. Wir werdend arüber aber später nochmal lesen.
4)  Experimentelle Designs sind darauf ausgelegt mit der ANOVA ausgewertet zu werden. Insbesondere in den Agrawissenschaften hat die ANOVA daher eine historische Bedeutung. Insbesondere durch die enge Verzahnung vom Experiment auf dem Feld und der eigentlichen Auswertung mit der ANOVA.

Wir sehen also, dass die ANOVA zum einen alt ist, aber auch heute noch viel verwendet wird. Daher werden wir in diesem *langem* Kapitel uns einmal mit der ANOVA ausgiebig beschäftigen. Fangen wir also an, dieses großartige Schwerzeitaschenmesser der Statistik besser zu verstehen.

::: callout-note
## Was macht die ANOVA?

Die *einfaktorielle* ANOVA vergleicht die Parameter mehrerer Normalverteilungen miteinander. Oder etwas anders formuliert, vergleicht die ANOVA die Mittlelwerte von mehreren Gruppen bzw. Behandlungen miteinander.

Die *zweifaktorielle* ANOVA vergleicht die Parameter mehrerer Normalverteilungen miteinander von zwei Faktoren. Oder etwas anders formuliert, vergleicht die ANOVA die Mittlelwerte von mehreren Gruppen bzw. Behandlungen miteinander. Dabei kann die *zweifaktorielle* ANOVA auch die Interaktion zwischen zwei Variablen abbilden.
:::

::: {.callout-caution collapse="true"}
## Ein Wort zur Klausur

Wir rechnen keine ANOVA in der Klausur *per Hand* sondern interpretieren die Ausgabe der R Funktionen einer einfaktoriellen oder zweifaktoriellen ANOVA. Auch hier gilt, überprüfe was du in der Vorlesung gehört hast!

Bitte schau dir unbedingt die Aufgaben in den [gesammelten Klausurfragen auf GitHub](https://github.com/jkruppa/teaching/tree/main/Klausur) an um eine Idee zu haben, welche Fragen zu der ANOVA drankommen.
:::

## Genutzte R Pakete für das Kapitel

Wir wollen folgende R Pakete in diesem Kapitel nutzen.

```{r echo = TRUE}
pacman::p_load(tidyverse, magrittr, broom, 
               readxl, effectsize, ggpubr)
```

Am Ende des Kapitels findest du nochmal den gesamten R Code in einem Rutsch zum selber durchführen oder aber kopieren.

## Einfaktorielle ANOVA

Die einfaktorielle ANOVA ist die simpelste Form der ANOVA. Wir nutzen einen Faktor mit mehr als zwei Leveln. Im Rahmen der einfaktoriellen ANOVA wollen wir usn auch die ANOVA theoretisch einmal anschauen. Danach wie die einfaktorielle ANOVA in R genutzt wird. Ebenso wie wir die einfaktorielle ANOVA visualsieren. Abschließend müssen wir uns noch überlegen, ob es einen Effektschätzer für die einfaktorielle ANOVA gibt.

::: column-margin
![](images/angel_01.png){fig-align="center" width="50%"}

Die einfaktorielle ANOVA verlangt ein normalverteiltes $y$ sowie Varianzhomogenität über den Behandlungsfaktor $x$. Daher alle Level von $x$ sollen die gleiche Varianz haben.

Unsere Annahme an die Daten $D$ ist, dass das dein $y$ normalverteilt ist und das die Level vom $x$ homogen in den Varianzen sind. Später mehr dazu, wenn wir beides nicht vorliegen haben...
:::

### Daten für die einfaktorielle ANOVA

Wir wollen uns nun erstmal den einfachsten Fall anschauen mit einem simplen Datensatz. Wir nehmen ein normalverteiltes $y$ aus den Datensatz `flea_dog_cat_fox.csv` und einen Faktor mit mehr als zwei Leveln. Hätten wir nur zwei Level, dann können wir auch einen t-Test rechnen können.

Im Folgenden selektieren mit der Funktion `select()` die beiden Spalten `jump_length` als $y$ und die Spalte `animal` als $x$. Danach müssen wir noch die Variable `animal` in einen Faktor mit der Funktion `as_factor()` umwandeln.

```{r}
#| message: false

fac1_tbl <- read_csv2("data/flea_dog_cat_fox.csv") %>%
  select(animal, jump_length) %>% 
  mutate(animal = as_factor(animal))
```

Wir erhalten das Objekt `fac1_tbl` mit dem Datensatz in @tbl-data-anova-1 nochmal dargestellt.

```{r}
#| message: false
#| echo: false
#| tbl-cap: Selektierter Datensatz für die einfaktorielle ANOVA mit einer normalverteilten Variable `jump_length` und einem Faktor mit drei Leveln der Variable `animal`.
#| label: tbl-data-anova-1

fac1_tbl %>% kable(align = "c", "pipe")
```

Wir bauen daher mit den beiden Variablen mit dem Objekt `fac1_tbl` folgendes Modell für später:

$$
jump\_length \sim animal
$$

Bevor wir jetzt das Modell verwenden, müssen wir uns nochmal überlegen, welchen Schluß wir eigentlich über die Nullhypothese machen. Wir immer können wir nur die Nullhypothese ablehnen. Daher überlegen wir uns im Folgenden wie die Nullhypothese in der einfaktoriellen ANOVA aussieht. Dann bilden wir anhand der Nullhypothese noch die Alternativehypothese.

### Hypothesen für die einfaktorielle ANOVA

```{=tex}
\begin{align*}
H_0: &\; \bar{y}_{cat} = \bar{y}_{dog} = \bar{y}_{fox}\\
H_A: &\; \bar{y}_{cat} \ne \bar{y}_{dog}\\
\phantom{H_A:} &\; \bar{y}_{cat} \ne \bar{y}_{fox}\\
\phantom{H_A:} &\; \bar{y}_{dog} \ne \bar{y}_{fox}\\
\phantom{H_A:} &\; \mbox{für mindestens ein Paar}
\end{align*}
```
Text

### Einfaktoriellen ANOVA theoretisch

Decision rule: reject $H_0$ if $F > F_{df_A = k-1,\,df_E=N-k,\,1-\alpha}$

Wir haben ein balanciertes Design. Für eine ANOVA ist aber ein balanciertes Design nicht notwendig.

$\bar{y}_{..} = 7.34$

|       j        |  dog   |  cat   |  fox   |
|:--------------:|:------:|:------:|:------:|
|       1        |  5.7   |  3.2   |  7.7   |
|       2        |  8.9   |  2.2   |  8.1   |
|       3        |  11.8  |  5.4   |  9.1   |
|       4        |  8.2   |  4.1   |  9.7   |
|       5        |  5.6   |  4.3   |  10.6  |
|       6        |  9.1   |  7.9   |  8.6   |
|       7        |  7.6   |  6.1   |  10.3  |
| $\bar{y}_{i.}$ | $4.74$ | $8.13$ | $9.16$ |
|   $\beta_i$    | $-2.6$ | $0.79$ | $1.81$ |

: Test

text

::: column-page
| Varianzquelle |  df   |                             Sum of squares                             |               Mean squares               |           F$_{\boldsymbol{calc}}$            |
|:-------------:|:-----:|:----------------------------------------------------------------------:|:----------------------------------------:|:--------------------------------------------:|
|    animal     | $k-1$ |    $SS_{animal} = \sum_{i=1}^{k}n_i(\bar{y}_{i.} - \bar{y}_{..})^2$    | $MS_{animal} = \cfrac{SS_{animal}}{k-1}$ | $F_{calc} = \cfrac{MS_{animal}}{MS_{error}}$ |
|     error     | $n-k$ | $SS_{error} = \sum_{i=1}^{k}\sum_{j=1}^{n_i}(y_{ij} - \bar{y}_{i.})^2$ |  $MS_{error} = \cfrac{SS_{error}}{N-k}$  |                                              |
|     total     | $n-1$ | $SS_{total} = \sum_{i=1}^{k}\sum_{j=1}^{n_i}(y_{ij} - \bar{y}_{..})^2$ |                                          |                                              |

: Einfaktorielle Anova
:::

::: column-page
| Varianzquelle |   df   |    Sum of squares     |                Mean squares                |         F$_{\boldsymbol{calc}}$          |
|:-------------:|:------:|:---------------------:|:------------------------------------------:|:----------------------------------------:|
|    animal     | $3-1$  | $SS_{animal} = 74.68$ | $MS_{animal} = \cfrac{74.68}{3-1} = 37.34$ | $F_{calc} = \cfrac{37.34}{3.14} = 11.89$ |
|     error     | $21-3$ | $SS_{error} = 56.53$  |  $MS_{error} = \cfrac{56.53}{18} = 3.14$   |                                          |
|     total     | $21-1$ | $SS_{total} = 131.21$ |                                            |                                          |

: Einfaktorielle Anova Beispiel
:::

$F_{\alpha = 5\%} = `r round(qf(p=.05, df1=2, df2=18, lower.tail=FALSE), 2)`$

```{r}
#| message: false
#| echo: false
#| label: fig-anova-exp-1
#| fig-align: center
#| fig-height: 5
#| fig-width: 5
#| fig-cap: "Zusammenhang von Histogramm und Densityplot an der Anzahl der Flöhe auf 39 Hunden."

ggplot(fac1_tbl, aes(x = 1, y = jump_length)) + 
  geom_point() +
  theme_bw() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        legend.position="none") +
  ylab("") + xlab("")
```

```{r}
#| message: false
#| echo: false
#| label: fig-anova-exp-2
#| fig-align: center
#| fig-height: 5
#| fig-width: 5
#| fig-cap: "Zusammenhang von Histogramm und Densityplot an der Anzahl der Flöhe auf 39 Hunden."

ggplot(fac1_tbl, aes(x = 1, y = jump_length, color = animal)) + 
  geom_point() +
  ##scale_colour_manual(values = par$cbbPalette) +
  theme(legend.position="none") +
  theme_bw() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        legend.position="none") +
  ylab("") + xlab("")
```

```{r}
#| message: false
#| echo: false
#| label: fig-anova-exp-3
#| fig-align: center
#| fig-height: 5
#| fig-width: 5
#| fig-cap: "Zusammenhang von Histogramm und Densityplot an der Anzahl der Flöhe auf 39 Hunden."

ggplot(fac1_tbl, aes(x = animal, y = jump_length, color = animal)) + 
  geom_point() +
  ##scale_colour_manual(values = par$cbbPalette) +
  theme(legend.position="none") +
  theme_bw() +
  ylab("") + xlab("") 
```

```{r}
#| message: false
#| echo: false
#| label: fig-anova-exp-4
#| fig-align: center
#| fig-height: 5
#| fig-width: 5
#| fig-cap: "Zusammenhang von Histogramm und Densityplot an der Anzahl der Flöhe auf 39 Hunden."

ggplot(fac1_tbl, aes(x = animal, y = jump_length, color = animal)) + 
  geom_boxplot() +
  ##scale_colour_manual(values = par$cbbPalette) +
  theme(legend.position="none") +
  theme_bw() +
  theme(legend.position="none") +
  ylab("") + xlab("") 
```

```{r}
#| message: false
#| echo: false
#| label: fig-anova-exp-5
#| fig-align: center
#| fig-height: 5
#| fig-width: 5
#| fig-cap: "Zusammenhang von Histogramm und Densityplot an der Anzahl der Flöhe auf 39 Hunden."

stat <- ddply(fac1_tbl, "animal", summarize,
              mean = mean(jump_length, na.rm = TRUE),
              sd = round(sd(jump_length, na.rm = TRUE), 2))
grand_mean <- mean(fac1_tbl$jump_length, na.rm = TRUE)

ggplot(fac1_tbl, aes(x = animal, y = jump_length, color = animal)) + 
  geom_point() +
  theme_bw() +
  geom_jitter(position = position_jitter(width = 0.4))  +
  stat_summary(fun = mean, aes(ymin=..y.., ymax=..y..), 
               geom='errorbar', width = 0.65, color = "black", size = 1.25) +
  geom_hline(yintercept = mean(fac1_tbl$jump_length), size = 1.25, linetype = "dashed",
             alpha = 0.5) +
  annotate("text", x = 1:3, y = 7,
           label = round(stat$mean - grand_mean, 2)) +
  theme(legend.position="none") +
  scale_y_continuous(breaks = c(4.75, round(grand_mean, 2), 8.13, 9.16)) +
  ylab("") + xlab("")
```

```{r}
#| message: false
#| echo: false
#| label: fig-anova-exp-6
#| fig-align: center
#| fig-height: 5
#| fig-width: 6
#| fig-cap: "Zusammenhang von Histogramm und Densityplot an der Anzahl der Flöhe auf 39 Hunden."
#| fig-subcap: 
#|   - "Kein Effekt"
#|   - "Leichter Effekt"
#| layout-nrow: 1
#| column: page

no_effect_df <- setNames(stack(tibble(A = rnorm(20, 20, 1),
                                     B = rnorm(20, 20, 1),
                                     C = rnorm(20, 20, 1),
                                     D = rnorm(20, 20, 1))),
                        c("values", "trt"))

ggplot(no_effect_df, aes(x = trt, y = values, fill = trt)) + geom_boxplot() +
  theme_bw() +
  ##scale_fill_manual(values = par$cbbPalette) +
  theme(legend.position="none") +
  ylab("") + xlab("")

light_effect_df <- setNames(stack(tibble(A = rnorm(20, 20, 3),
                                         B = rnorm(20, 22, 4),
                                         C = rnorm(20, 26, 4),
                                         D = rnorm(20, 24, 3))),
                            c("values", "trt"))

ggplot(light_effect_df, aes(x = trt, y = values, fill = trt)) + geom_boxplot() +
  theme_bw() +
  ##scale_fill_manual(values = par$cbbPalette) +
  theme(legend.position="none") +
  ylab("") + xlab("")

```

Beispieldaten sind in @tbl-data-anova-1 abgebildet.

```{r}
#| message: false
#| echo: false
#| fig-align: center
#| fig-height: 5
#| fig-width: 5
#| fig-cap: Boxplot der Sprungweiten [cm] von Hunden und Katzen.
#| label: fig-boxplot-anova-1

ggplot(fac1_tbl, aes(x = animal, y = jump_length, 
                     fill = animal)) +
  geom_boxplot() +
  labs(x = "Tierart", y = "Sprungweite [cm]") +
  theme_bw() +
  theme(legend.position = "none") 

```

### Einfaktoriellen ANOVA in R

```{r}
fit_1 <-  lm(jump_length ~ animal, data = fac1_tbl) %>% 
  anova

fit_1

fit_1 %>% eta_squared
```

## Zweifaktorielle ANOVA

::: column-margin
![](images/angel_01.png){fig-align="center" width="50%"}

Die zweifaktorielle ANOVA verlangt ein normalverteiltes $y$ sowie Varianzhomogenität jeweils separat über beide Behandlungsfaktor $x_1$ und $x_2$. Daher alle Level von $x_1$ sollen die gleiche Varianz haben. Ebenso sollen alle Level von $x_2$ die gleiche Varianz haben.

Unsere Annahme an die Daten $D$ ist, dass das dein $y$ normalverteilt ist und das die Level vom $x_1$ und $x_2$ jewiels für sich homogen in den Varianzen sind. Später mehr dazu, wenn wir beides nicht vorliegen haben...
:::

### Daten für die zweifaktorielle ANOVA

```{r}
#| message: false

fac2_tbl <- read_csv2("data/flea_dog_cat_fox_site.csv") %>% 
  select(animal, site, jump_length) %>% 
  mutate(animal = as_factor(animal),
         site = as_factor(site))
```

```{r}
#| message: false
#| echo: false
#| tbl-cap: test caption
#| label: tbl-data-anova-2

fac2_tbl %>% kable(align = "c", "pipe")
```

### Hypothesen die zweifaktorielle ANOVA

Wir haben für jeden Faktor ein Hypothesenpaar.

Einmal für `animal`

```{=tex}
\begin{align*}
H_0: &\; \bar{y}_{cat} = \bar{y}_{dog} = \bar{y}_{fox}\\
H_A: &\; \bar{y}_{cat} \ne \bar{y}_{dog}\\
\phantom{H_A:} &\; \bar{y}_{cat} \ne \bar{y}_{fox}\\
\phantom{H_A:} &\; \bar{y}_{dog} \ne \bar{y}_{fox}\\
\phantom{H_A:} &\; \mbox{für mindestens ein Paar}
\end{align*}
```
Einmal für `site`

```{=tex}
\begin{align*}
H_0: &\; \bar{y}_{city} = \bar{y}_{smalltown} = \bar{y}_{village} = \bar{y}_{field}\\
H_A: &\; \bar{y}_{city} \ne \bar{y}_{smalltown}\\
\phantom{H_A:} &\; \bar{y}_{city} \ne \bar{y}_{village}\\
\phantom{H_A:} &\; \bar{y}_{city} \ne \bar{y}_{field}\\
\phantom{H_A:} &\; \bar{y}_{smalltown} \ne \bar{y}_{village}\\
\phantom{H_A:} &\; \bar{y}_{smalltown} \ne \bar{y}_{field}\\
\phantom{H_A:} &\; \bar{y}_{village} \ne \bar{y}_{field}\\
\phantom{H_A:} &\; \mbox{für mindestens ein Paar}
\end{align*}
```
Einmal für die Interaktion `animal:site`

```{=tex}
\begin{align*}
H_0: &\; \mbox{keine Interaktion}\\
H_A: &\; \mbox{eine Interaktion zwischen animal und site}
\end{align*}
```
Decision rule: reject $H_0$ if $F > F_{df_A = k-1,\,df_E=N-k,\,1-\alpha}$

### Zweifaktoriellen ANOVA in R

#### Ohne Interaktionsterm

Beispieldaten sind in @fig-boxplot-anova-2 abgebildet.

```{r}
#| message: false
#| echo: false
#| fig-align: center
#| fig-height: 5
#| fig-width: 6
#| fig-cap: Boxplot der Sprungweiten [cm] von Hunden und Katzen.
#| label: fig-boxplot-anova-2

ggplot(fac2_tbl, aes(x = animal, y = jump_length, 
                     fill = site)) +
  geom_boxplot() +
  labs(x = "Tierart", y = "Sprungweite [cm]") +
  theme_bw() 
```

```{r}
fit_2 <-  lm(jump_length ~ animal + site, data = fac2_tbl) %>% 
  anova

fit_2

fit_2 %>% tidy

fit_2 %>% eta_squared
```

::: column-page
| Varianzquelle |       df       | Sum of squares | Mean squares  |           F$_{\boldsymbol{calc}}$            |
|:-------------:|:--------------:|:--------------:|:-------------:|:--------------------------------------------:|
|    animal     |     $a-1$      | $SS_{animal}$  | $MS_{animal}$ | $F_{calc} = \cfrac{MS_{animal}}{MS_{error}}$ |
|     site      |     $b-1$      |  $SS_{site}$   |  $MS_{site}$  |  $F_{calc} = \cfrac{MS_{site}}{MS_{error}}$  |
|     error     | $n-(a-1)(b-1)$ |  $SS_{error}$  | $MS_{error}$  |                                              |
|     total     |     $n-1$      |  $SS_{total}$  |               |                                              |

: Zweifaktorielle Anova ohne Interaktionseffekt
:::

::: column-page
| Varianzquelle |        df        |     Sum of squares     |     Mean squares      |         F$_{\boldsymbol{calc}}$          |
|:-------------:|:----------------:|:----------------------:|:---------------------:|:----------------------------------------:|
|    animal     |      $3-1$       | $SS_{animal} = 180.03$ | $MS_{animal} = 90.02$ | $F_{calc} = \cfrac{90.02}{4.53} = 19.88$ |
|     site      |      $4-1$       |   $SS_{site} = 9.13$   |  $MS_{site} = 3.04$   |  $F_{calc} = \cfrac{3.04}{4.53} = 0.67$  |
|     error     | $120-(3-1)(4-1)$ | $SS_{error} = 516.17$  |  $MS_{error} = 4.53$  |                                          |
|     total     |     $120-1$      | $SS_{total} = 705.33$  |                       |                                          |

: Zweifaktorielle Anova ohne Interaktionseffekt
:::

#### Mit Interaktionssterm

```{r}
#| message: false
#| echo: false
#| fig-align: center
#| fig-height: 5
#| fig-width: 6
#| fig-cap: Boxplot der Sprungweiten [cm] von Hunden und Katzen.
#| label: fig-interact-anova-1

ggplot(fac2_tbl, aes(x = animal, y = jump_length,
                     color = site, group = site)) +
  stat_summary(fun = mean, geom = "point") +
  stat_summary(fun = mean, geom = "line") +
  theme_bw()

```

```{r}
fit_3 <-  lm(jump_length ~ animal + site + animal:site, data = fac2_tbl) %>% 
  anova

fit_3

fit_3 %>% tidy()

fit_3 %>% eta_squared
```

::: column-page
|    Varianzquelle     |      df      |      Sum of squares       |       Mean squares        |                 F$_{\boldsymbol{calc}}$                  |
|:--------------------:|:------------:|:-------------------------:|:-------------------------:|:--------------------------------------------------------:|
|        animal        |    $a-1$     |       $SS_{animal}$       |       $MS_{animal}$       |       $F_{calc} = \cfrac{MS_{animal}}{MS_{error}}$       |
|         site         |    $b-1$     |        $SS_{site}$        |        $MS_{site}$        |        $F_{calc} = \cfrac{MS_{site}}{MS_{error}}$        |
| animal $\times$ site | $(a-1)(b-1)$ | $SS_{animal \times site}$ | $MS_{animal \times site}$ | $F_{calc} = \cfrac{MS_{animal \times site}}{MS_{error}}$ |
|        error         |    $n-ab$    |       $SS_{error}$        |       $MS_{error}$        |                                                          |
|        total         |    $n-1$     |       $SS_{total}$        |                           |                                                          |

: Zweifaktorielle Anova mit Interaktionseffekt
:::

::: column-page
|    Varianzquelle     |         df          |           Sum of squares           |           Mean squares            |         F$_{\boldsymbol{calc}}$          |
|:--------------------:|:-------------------:|:----------------------------------:|:---------------------------------:|:----------------------------------------:|
|        animal        |        $3-1$        |       $SS_{animal} = 180.03$       |       $MS_{animal} = 90.02$       | $F_{calc} = \cfrac{90.02}{2.97} = 30.28$ |
|         site         |        $4-1$        |         $SS_{site} = 9.13$         |        $MS_{site} = 3.04$         |  $F_{calc} = \cfrac{3.04}{2.97} = 1.02$  |
| animal $\times$ site |    $(3-1)(4-1)$     | $SS_{animal \times site} = 195.12$ | $MS_{animal \times site} = 32.52$ | $F_{calc} = \cfrac{32.52}{2.97} = 10.94$ |
|        error         | $120 - (3 \cdot 4)$ |       $SS_{error} = 321.06$        |        $MS_{error} = 2.97$        |                                          |
|        total         |       $120-1$       |       $SS_{total} = 705.34$        |                                   |                                          |

: Zweifaktorielle Anova mit Interaktionseffekt
:::

## `ggpubr`

```{r}
#| message: false
#| warning: false
#| echo: false
#| fig-align: center
#| fig-height: 5
#| fig-width: 6
#| fig-cap: Boxplot der Sprungweiten [cm] von Hunden und Katzen.
#| label: fig-ggpubr-1

p <- ggboxplot(fac2_tbl, x = "animal", y = "jump_length",
               color = "animal", palette =c("#00AFBB", "#E7B800", "#FC4E07"),
               add = "jitter", shape = "animal")

my_comparisons <- list( c("cat", "dog"), c("dog", "fox"), c("cat", "fox") )
p + stat_compare_means(comparisons = my_comparisons) + 
  stat_compare_means(label.y = 27, method = "anova")                  


```

```{r}
#| message: false
#| warning: false
#| echo: false
#| fig-align: center
#| fig-height: 5
#| fig-width: 6
#| fig-cap: Boxplot der Sprungweiten [cm] von Hunden und Katzen.
#| label: fig-ggpubr-2
 
my_comparisons <- list( c("cat", "dog"), c("dog", "fox"), c("cat", "fox") )
         
ggviolin(fac2_tbl, x = "animal", y = "jump_length", fill = "animal",
         palette =c("#00AFBB", "#E7B800", "#FC4E07"),
         add = "boxplot", add.params = list(fill = "white"))+
  stat_compare_means(comparisons = my_comparisons, label = "p.signif") + 
  stat_compare_means(label.y = 27, method = "anova")                                      #
```
