Mit dem Boxplot können wir den Median und die Quartile visualisieren. In @fig-boxplot-drawn sehen wir einen Boxplot, der den Median und die Quartile visualisiert. Die Box wird aus dem IQR gebildet. Der Median wird als Strich in der Box gezeigt. Die Schnurrhaare (eng. *Whiskers*) sind das 1.5 fache des IQR. Punkte die außerhalb der Schnurrhaare liegen werden als einzelne Punkte dargestellt. Diese einzelnen Punkte werden auch als Ausreißer (eng. *Outlier*) bezeichnet.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-boxplot-drawn
#| fig-align: center
#| fig-height: 2.5
#| fig-width: 7
#| fig-cap: "Ein Boxplot zu Visualisierung der statistischen Maßzahlen Median und Quartile. Die Box wird aus dem IQR gebildet, welches die Distanz zwischen den $1^{st}$ und $3^{rd}$ Quartile entspricht. Der Median wird als Strich in der Box gezeigt. Die Schnurrhaare sind das 1.5-fache des IQR. Punkte die außerhalb der Schnurrhaare liegen werden als einzelne Punkte dargestellt. *[Zum Vergrößern anklicken]*"


tibble(x = c(1, 1.5, 14, 15, 17), y = 2) |> 
  ggplot(aes(x, y)) +
  theme_minimal() + 
  geom_point() +
  ylim(1, 3) +
  ## box 
  geom_rect(aes(xmin = 4, xmax = 10, ymin = 1.75, ymax = 2.25), fill = "gray75") +
  geom_segment(x = 4, y = 1.75, xend = 10, yend = 1.75, color = "black",
               linewidth = 1, linetype = 1) +
  geom_segment(x = 4, y = 2.25, xend = 10, yend = 2.25, color = "black",
               linewidth = 1, linetype = 1) +
  geom_segment(x = 4, y = 2.25, xend = 4, yend = 1.75, color = "black",
               linewidth = 1, linetype = 1) +
  geom_segment(x = 10, y = 2.25, xend = 10, yend = 1.75, color = "black",
               linewidth = 1, linetype = 1) +
  geom_segment(x = 8, y = 2.25, xend = 8, yend = 1.75, color = "black",
               linewidth = 1.5, linetype = 1) +
  geom_segment(x = 2.2, y = 2, xend = 4, yend = 2, color = "black",
               linewidth = 1, linetype = 1) +
  geom_segment(x = 10, y = 2, xend = 13, yend = 2, color = "black",
               linewidth = 1, linetype = 1) +
  annotate("text", x = 2.5, y = 2.75, label = expression(1^st), size = 6,
           color = "#CC79A7") +
  geom_curve(x = 2.7, y = 2.68, xend = 4, yend = 2.3, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.3, alpha = 0.3, color = "#CC79A7") +
  annotate("text", x = 6, y = 2.75, label = expression(Median), size = 6,
           color = "#CC79A7") +
  geom_curve(x = 7.15, y = 2.7, xend = 8, yend = 2.3, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.3, alpha = 0.3, color = "#CC79A7") +
  annotate("text", x = 11.5, y = 2.75, label = expression(3^rd), size = 6,
           color = "#CC79A7") +
  geom_curve(x = 11, y = 2.68, xend = 10, yend = 2.3, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.3, alpha = 0.3, color = "#CC79A7") +
  annotate("text", x = 15.5, y = 2.75, label = expression(Outlier), size = 6,
           color = "#0072B2") +
  geom_curve(x = 14.5, y = 2.68, xend = 14, yend = 2.075, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.3, alpha = 0.3, color = "#0072B2") +
  geom_curve(x = 15.5, y = 2.6, xend = 15.1, yend = 2.075, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.3, alpha = 0.3, color = "#0072B2") +
  geom_curve(x = 16.45, y = 2.68, xend = 17, yend = 2.075, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.3, alpha = 0.3, color = "#0072B2") +
  annotate("text", x = 2.5, y = 1.25, label = expression(Min), size = 6,
           color = "#D55E00") +
  geom_curve(x = 1.9, y = 1.25, xend = 1, yend = 1.9, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.3, alpha = 0.3, color = "#D55E00") +
  annotate("text", x = 15.5, y = 1.25, label = expression(Max), size = 6,
           color = "#D55E00") +
  geom_curve(x = 16.2, y = 1.25, xend = 17, yend = 1.9, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.3, alpha = 0.3, color = "#D55E00") +
  annotate("text", x = 4, y = 1.5, label = expression(1^st-1.5%*%IQR), size = 5,
           color = "#009E73", hjust = "left") +
  geom_curve(x = 3.9, y = 1.45, xend = 2.2, yend = 1.9, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.3, alpha = 0.3, color = "#009E73") +
  annotate("text", x = 11, y = 1.25, label = expression(3^rd+1.5%*%IQR), size = 5,
           color = "#009E73", hjust = "right") +
  geom_curve(x = 11.1, y = 1.2, xend = 13, yend = 1.9, linewidth = 0.5,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.3, alpha = 0.3, color = "#009E73") + 
  labs(x = "", y = "") +
  theme(legend.position = "none",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 

```

Wie erstellen wir nun einen Boxplot in R? Zuerst laden wir die Daten mit der Funktion `read_excel()` in R, wenn du die Daten als `.xlsx` Datei vorliegen hast.

```{r}
#| message: false
flea_dog_cat_tbl <- read_excel("data/flea_dog_cat.xlsx")
```

In @fig-boxplot-flea-0 ist der Boxplot für die Daten aus der Datei `flea_dog_cat.xlsx` dargestellt. Auf der x-Achse finden wir die Tierart als `cat` und `dog`. Auf der y-Achse ist die Sprungweite in \[cm\] dargestellt. Wir erkennen auf einen Blick, dass die Sprungweite von den Hundeflöhen weiter ist als die Sprungweite der Katzenflöhe. Im Weiteren können wir abschätzen, dass die Streuung etwa gleich groß ist. Die Boxen sind in etwa gleich groß und die Whiskers in etwa gleich lang.

```{r }
#| echo: true
#| message: false
#| label: fig-boxplot-flea-0
#| fig-align: center
#| fig-height: 4
#| fig-width: 6
#| fig-cap: "An 39 Hunden wurde die Anzahl an Flöhen gezählt."

ggplot(data = flea_dog_cat_tbl, aes(x = animal, y = jump_length,
                                    fill = animal)) +
  geom_boxplot() +
  theme_minimal() +
  labs(x = "Tierart", y = "Sprungweite [cm]") 

```

Wir neigen dazu die Boxplots und die Effekte zu überschätzen, wenn die Anzahl der Beobachtungen klein ist. Deshalb können wir mit dem `geom_jitter()` in der @fig-boxplot-flea-1 noch die Beobachtungen zu den Boxplot ergänzen. Die Funktion `geom_jitter()` streut die Punkte zufällig, so dass keine Punkte übereinander liegen. Wir haben hier die Streuweite durch die Option `width = 0.25` etwas eingeschränkt. Darüber hinaus habe wir das Aussehen der Punkte mit `shape = 1` geändert, so dass wir die Jitter-Punkte von den potenziellen Ausreißer-Punkten unterscheiden können. Du kannst auch andere Zahlen hinter `shape` eintragen um verschiedene Punktesymbole durchzuprobieren. Eine Übersicht an `shapes` findest du auch hier unter [Cookbook for R \> Graphs \> Shapes and line types](http://www.cookbook-r.com/Graphs/Shapes_and_line_types/).

```{r }
#| echo: true
#| message: false
#| label: fig-boxplot-flea-1
#| fig-align: center
#| fig-height: 4
#| fig-width: 6
#| fig-cap: "An 39 Hunden wurde die Anzahl an Flöhen gezählt zusammen mit den einzelnen Beobachtungen dargestellt."

ggplot(data = flea_dog_cat_tbl, aes(x = animal, y = jump_length,
                                    fill = animal)) +
  geom_boxplot() +
  geom_jitter(width = 0.25, shape = 1) +
  theme_minimal() +
  labs(x = "Tierart", y = "Sprungweite [cm]") 

```

Schau dir auch hier mal in den Zerforschenkasten an, da findest du dann noch mehr Inspiration aus anderen Abbildungen, die ich nachgebaut habe. Ich bin einmal über den Campus gelaufen und habe geschaut, welche Barplots so auf den Postern verwendet werden und habe hier auch einmal einen Boxplot aus dem Barplot gebaut.

::: {.callout-note collapse="true"}
## Zerforschen: Zweifaktorieller Barplot oder Boxplot

{{< include zerforschen/zerforschen-barplot-2fac.qmd >}}
:::

::: {.callout-note collapse="true"}
## Zerforschen: Boxplot für mehrere Outcomes

{{< include zerforschen/zerforschen-boxplot-mult.qmd >}}
:::
