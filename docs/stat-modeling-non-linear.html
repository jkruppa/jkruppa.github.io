<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Ein Kochbuch mit Rezepten aus der Bio Data Science, Biostatistik, Biometrie und Statistik">

<title>Bio Data Science - 58&nbsp; Nicht lineare Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./stat-modeling-robust-quantile.html" rel="next">
<link href="./stat-modeling-gee.html" rel="prev">
<link href="./cover2024_favi.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Bio Data Science - 58&nbsp; Nicht lineare Regression">
<meta property="og:description" content="Ein Kochbuch mit Rezepten der Bio Data Science, Biostatistik, Biometrie und Statistik">
<meta property="og:image" content="https://github.com/jkruppa/jkruppa.github.io/raw/master/cover2024.png">
<meta property="og:site_name" content="Bio Data Science">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./stat-modeling-preface.html">Statistisches Modellieren</a></li><li class="breadcrumb-item"><a href="./stat-modeling-non-linear.html"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Nicht lineare Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bio Data Science</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/jkruppa/jkruppa.github.io/" title="Quellcode" class="quarto-navigation-tool px-1" aria-label="Quellcode"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Dunkelmodus umschalten"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Willkommen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./organisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Organisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./literature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bibliothek</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forschungsprozess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Forschungsprozess</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./abschlussarbeit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Abschlussarbeit</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./example-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datenbeispiele</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-fleas-dogs-cats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Von Flöhen auf Tieren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-gummi-bears.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Von Gummibärchen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-complex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Von komplexeren Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-database.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Von Datenbanken</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./programing-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programmieren in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-letters-numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Daten in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Operatoren, Funktionen und Pakete</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Daten einlesen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Daten bearbeiten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Reguläre Ausdrücke</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-purrr-furrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ein <code>purrr</code> Cookbook</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programing-quarto-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Quarto und Shiny App</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./eda-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explorative Datenanalyse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Deskriptive Statistik</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Visualisierung von Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Verteilung von Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Transformieren von Daten</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-tests-preface-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Testen von Hypothesen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Die Testentscheidung</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-theorie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Die Testtheorie</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Der Effektschätzer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-pretest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Der Pre-Test oder Vortest</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./experimental-design-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experimentelle Designs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Versuchsplanung in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Einfache Designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fortgeschrittene Designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-samplesize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Fallzahlplanung</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-tests-preface-app.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistische Gruppenvergleiche</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Testen in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-ttest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Der t-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Die ANOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Die ANCOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-utest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Der Wilcoxon-Mann-Whitney-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-kruskal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Der Kruskal-Wallis-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-friedman.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Der Friedman Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-chi-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Der <span class="math inline">\(\mathcal{X}^2\)</span>-Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-anteil-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Der Anteilstest</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-diagnostic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Der diagnostische Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-trendtest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Der Trendtest</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-permutationstest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Der Permutationstest</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-tests-posthoc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Der Post-hoc-Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-linear-reg-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grundlagen des Modellierens</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-linear-reg-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Simple lineare Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Multiple lineare Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-linear-reg-quality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Modelgüte</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-linear-reg-corr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Korrelation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-outlier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Ausreißer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-variable-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Variablenselektion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-missing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Fehlende Werte</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-sensitivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Sensitivitätsanalyse</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./stat-modeling-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistisches Modellieren</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Modellieren in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-gaussian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Gaussian Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-beta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Beta Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-multinom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">Multinomiale / Ordinale Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">Logistische Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-prob-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">Linear Probability Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-mixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">Lineare gemischte Modelle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-gee.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">Generalized Estimating Equations (GEE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-non-linear.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Nicht lineare Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-robust-quantile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">Robuste und Quantilesregression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">60</span>&nbsp; <span class="chapter-title">Überlebenszeitanalysen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-noninferiority.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">61</span>&nbsp; <span class="chapter-title">Äquivalenz oder Nichtunterlegenheit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-meta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">62</span>&nbsp; <span class="chapter-title">Metaanalysen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">63</span>&nbsp; <span class="chapter-title">Clusteranalysen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">64</span>&nbsp; <span class="chapter-title">Multivariate Verfahren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stat-modeling-survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">65</span>&nbsp; <span class="chapter-title">Fragebogenanalyse</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./time-space-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Zeitliche und räumliche Analysen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-space-pseudo-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">66</span>&nbsp; <span class="chapter-title">Pseudo Zeitreihen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-space-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">67</span>&nbsp; <span class="chapter-title">Zeitreihen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-space-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">68</span>&nbsp; <span class="chapter-title">Räumliche Daten</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./classification-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Klassifikation oder maschinelles Lernen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">69</span>&nbsp; <span class="chapter-title">Grundlagen der Klassifikation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">70</span>&nbsp; <span class="chapter-title">Data splitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-pre-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">71</span>&nbsp; <span class="chapter-title">Data preprocessing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-model-compare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">72</span>&nbsp; <span class="chapter-title">Vergleich von Algorithmen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">73</span>&nbsp; <span class="chapter-title"><span class="math inline">\(k\)</span> nearest neighbor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-randomforest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">74</span>&nbsp; <span class="chapter-title">Decision trees</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">75</span>&nbsp; <span class="chapter-title">Support vector machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-neural-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">76</span>&nbsp; <span class="chapter-title">Neural networks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./abspann.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abspann</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-spielecke.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">77</span>&nbsp; <span class="chapter-title">Spielecke</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
  <li><a href="#genutzte-r-pakete" id="toc-genutzte-r-pakete" class="nav-link active" data-scroll-target="#genutzte-r-pakete"><span class="header-section-number">58.1</span> Genutzte R Pakete</a></li>
  <li><a href="#daten" id="toc-daten" class="nav-link" data-scroll-target="#daten"><span class="header-section-number">58.2</span> Daten</a></li>
  <li><a href="#visualisierung" id="toc-visualisierung" class="nav-link" data-scroll-target="#visualisierung"><span class="header-section-number">58.3</span> Visualisierung</a></li>
  <li><a href="#nonlinear-least-squares-mit-nls" id="toc-nonlinear-least-squares-mit-nls" class="nav-link" data-scroll-target="#nonlinear-least-squares-mit-nls"><span class="header-section-number">58.4</span> Nonlinear least-squares mit <code>nls()</code></a>
  <ul class="collapse">
  <li><a href="#von-wachstum" id="toc-von-wachstum" class="nav-link" data-scroll-target="#von-wachstum"><span class="header-section-number">58.4.1</span> … von Wachstum</a></li>
  <li><a href="#von-sättigung" id="toc-von-sättigung" class="nav-link" data-scroll-target="#von-sättigung"><span class="header-section-number">58.4.2</span> … von Sättigung</a></li>
  <li><a href="#von-zerfall" id="toc-von-zerfall" class="nav-link" data-scroll-target="#von-zerfall"><span class="header-section-number">58.4.3</span> … von Zerfall</a></li>
  <li><a href="#der-michaelis-menten-gleichung" id="toc-der-michaelis-menten-gleichung" class="nav-link" data-scroll-target="#der-michaelis-menten-gleichung"><span class="header-section-number">58.4.4</span> … der Michaelis-Menten Gleichung</a></li>
  </ul></li>
  <li><a href="#multivariate-fractional-polynomials-mit-mfp" id="toc-multivariate-fractional-polynomials-mit-mfp" class="nav-link" data-scroll-target="#multivariate-fractional-polynomials-mit-mfp"><span class="header-section-number">58.5</span> Multivariate Fractional Polynomials mit <code>{mfp}</code></a></li>
  <li><a href="#generalized-additive-models-gam-mit-mgcv" id="toc-generalized-additive-models-gam-mit-mgcv" class="nav-link" data-scroll-target="#generalized-additive-models-gam-mit-mgcv"><span class="header-section-number">58.6</span> Generalized Additive Models (GAM) mit <code>{mgcv}</code></a></li>
  <li><a href="#referenzen" id="toc-referenzen" class="nav-link" data-scroll-target="#referenzen">Referenzen</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jkruppa/jkruppa.github.io/edit/master/stat-modeling-non-linear.qmd" class="toc-action"><i class="bi bi-github"></i>Seite editieren</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Problem melden</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/blob/master/stat-modeling-non-linear.qmd" class="toc-action"><i class="bi empty"></i>Quellcode anzeigen</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./stat-modeling-preface.html">Statistisches Modellieren</a></li><li class="breadcrumb-item"><a href="./stat-modeling-non-linear.html"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Nicht lineare Regression</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-non-linear" class="quarto-section-identifier"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Nicht lineare Regression</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Gesamten Code zeigen</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Gesamten Code verbergen</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Quellcode anzeigen</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Letzte Änderung am 29. August 2024 um 13:55:26</em></p>
<blockquote class="blockquote">
<p><em>“And you may ask yourself; Well… How did I get here?; And you may ask yourself; ‘How do I work this?’” — Talking Heads - Once in a Lifetime</em></p>
</blockquote>
<p>Was wollen wir mit der nicht-linearen Regression erreichen? Zum einen erhalten wir durch die nicht-lineare Regression die Möglichkeit auch Abhängigkeiten zu modellieren, die nicht linear sind. Zum anderen wollen wir auch nicht nur Gruppen miteinander vergleichen, sondern auch Verläufe modellieren. Häufig sind diese Verläufe über die Zeit nicht linear. Es gibt Sättigungskurven oder aber auch einen exponentiellen Verfall oder ein exponentielles Wachstum. All dies können wir mit nicht-linearen Modellen abbilden und modellieren. Für Zeitreihen habe ich dann noch ein eigenes Kapitel geschrieben, hier wollen wir uns dann mal mit den Verläufen beschäftigen und schauen, dass wir die Koeffizienten einer Geradengleichung erhalten.</p>
<p>Wichtig hierbei ist, dass wir oft nicht statistisch Testen, sondern ein Modell haben wollen, dass die Punkte gut beschreibt. Mit Modell meinen wir hier die Gerade, die durch die Punkte läuft. Für diese Grade wollen wir die Koeffizienten schätzen also rausfinden, wie wir später die Gerade zeichnen könnten, wenn wir die Punkte nicht vorliegen hätten. Also die Frage beantworten, wie <span class="math inline">\(y\)</span> nicht-linear von <span class="math inline">\(x\)</span> abhängt. Wir immer gibt es eine Reihe von Möglichkeiten das Problem zu lösen einer Geradengleichung zu erhalten, die nicht linear ist. Normalerweise haben wir ja eine Regressionsgleichung für eine simple lineare Regression in der folgenden Form vorliegen.</p>
<p><span class="math display">\[
y \sim \beta_0 + \beta_1 \cdot x
\]</span></p>
<p>Wenn wir jetzt aber eine nicht-lineare Regression rechnen wollen, dann müssen wir hier zum Beispiel ein Polynom einfügen. Damit schreiben wir nicht mehr <span class="math inline">\(x\)</span> sondern <span class="math inline">\(x^b\)</span> und erhalten folgende, beispielhafte Formel. Warum beispielhaft? Je nach Fragestellung brauchen wir verschiedene Parameter die wir dann für den Kurvenverlauf bestimmen müssen.</p>
<p><span class="math display">\[
y \sim \beta_0 + \beta_1 \cdot x^b
\]</span></p>
<p>Dieses <span class="math inline">\(b\)</span> (eng. <em>power</em>) und die anderen Koeffizienten müssen wir jetzt irgendwie berechnen. Manchmal fällt das <span class="math inline">\(\beta_1\)</span> dann auch weg oder aber wir haben eben eine noch komplexere Art der mathematischen Darstellung. Wir gehen daher hier dann mal verschiedene Lösungen für das Problem durch. Nicht alle Lösungen liefern auch eine Geradengleichung, die du dann auch aufschreiben kannst.</p>
<p>Und damit kommen wir auch zu dem zentralen Problem. Woher weiß ich, welche Gerade oder Kurve ich berechnen will? Eine super Hilfestellung liefert die Seite <a href="https://www.statforbiology.com/2020/stat_nls_usefulfunctions/">A collection of self-starters for nonlinear regression in R</a>. Dort kannst du einmal schauen, welche Funktionen es gibt, die du dann zum Beispiel in <code>nls()</code> aus dem R Paket <code>{stats}</code> modellieren kannst. Das R Paket <code>{stats}</code> kommt gleich mit R mit und muss nicht installiert werden. Mit Modellieren meine ich dann, die Gradenfunktion bestimmen kannst. Die richtige Startfunktion zu finden ist aber wirklich nicht trivial. Dafür gibt es dann aber mit dem R Paket <code>{mfp}</code> eine Lösung, dafür kann das Paket dann andere Sachen nicht. Schau dich also einmal um und entscheide, was du brauchst um deine Fragestellung zu beantworten.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Weitere Tutorien für die Analyse von nicht-linearen Daten
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wie immer gibt es auch für die Frage nach dem Tutorium für die nicht-lineare Regression verschiedene Quellen. Ich kann noch folgende Informationen und Hilfen empfehlen.</p>
<ul>
<li>Das R Paket <code>{nlraa}</code> ist direkt für die Nutzung in den Agrarwissenschaften ausgelegt. Es finden sich auf der Hilfseite <a href="https://cran.r-project.org/web/packages/nlraa/vignettes/nlraa.html">nlraa: An R package for Nonlinear Regression Applications in Agricultural Research</a> auch komplexere Beispiele für die Modellierung von Daten.</li>
<li>Die Autoren <span class="citation" data-cites="archontoulis2015nonlinear">Archontoulis und Miguez (<a href="#ref-archontoulis2015nonlinear" role="doc-biblioref">2015</a>)</span> mit der wissenschaftlichen Veröffentlichung <a href="https://acsess.onlinelibrary.wiley.com/doi/pdf/10.2134/agronj2012.0506">Nonlinear Regression Models and Applications in Agricultural Research</a> liefern nochmal einen wunderbaren Überblick über die Möglichkeiten der nicht-linearen Regression in den Agrarwissenschaften.</li>
<li>Wenn es einfach nur eine Kurve durch die Punkte sein soll ohne eine mathematische Gleichung, dann kann das Tutorium zu <a href="https://andrewirwin.github.io/data-visualization/smoothing.html">GAM and LOESS smoothing</a> helfen. Denn weder GAM noch LOESS liefern eine Gleichung die du aufschreiben kannst, dafür sehr gute Anpassungen an Punkte.</li>
<li>Wie schon erwähnt, konzentrieren wir uns hier auf ein paar zentrale Pakete in R. Wir immer gibt es aber auch hier noch mehr wie bei dem Tutorium <a href="https://www.granvillematheson.com/post/nonlinear-modelling-using-nls-nlme-and-brms/">Nonlinear Modelling using nls, nlme and brms</a>. Du musst dann mal rechts und links schauen, auch für mich ist das ja eine Linksammlung zu der ich dann mal zurückkehre.</li>
<li>Der Blogeintrag <a href="https://davetang.org/muse/2013/05/09/on-curve-fitting/">On curve fitting using R</a> liefert nochmal die Lösung Daten mit der Funktion <code>poly()</code> in der Funktion <code>lm()</code> zu modellieren. Ich habe jetzt darauf verzichtet, da das Kapitel schon sehr voll war. Es spricht aber nichts dagegen, ein Problem der nicht linearen Regression mit einem Polinom zu lösen.</li>
</ul>
</div>
</div>
<p>Schaue dir auch die folgenden Zerforschenbeispiele einmal an, wenn dich mehr zu dem Thema der Abbildung von nicht-linearen Regressionen interessiert. Du findest in den Kästen Beispiele für Posterabbildungen zur nicht-linearen Regression, die ich dann zerforscht habe. Dann habe ich auch noch gleich die nicht-lineare Regression gerechnet um die Geradengleichungen sauber darzustellen.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Zerforschen: Nicht-lineare Regression
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In diesem Zerforschenbeispiel wollen wir uns eine <a href="#sec-non-linear">nicht-lineare Regression</a> anschauen. Auch hier stellt sich dann mal die Frage, ob die Modellierung in der vorliegenden Abbildung jetzt die beste Modellierung ist. Wir bleiben aber mal hier bei dem Nachbau und ergänzen dann noch zwei weitere Modellierungen. Du kannst gerne nochmal andere Modellierungen ausprobieren. Wir wollen also die folgende Abbildung einmal nachbauen.</p>
<div id="fig-simple-regression" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-simple-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/eda/zerforschen_regression_03.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1"><img src="images/eda/zerforschen_regression_03.jpeg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-simple-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.1— Ursprüngliche Abbildung, die nachgebaut werden soll. Eine nicht-lineare Regressionen mit der jeweiligen Regressionsgleichung und dem Bestimmtheitsmaß <span class="math inline">\(R^2\)</span>.
</figcaption>
</figure>
</div>
<p>Ich mache es mir hier wieder etwas einfacher und erstelle die Daten direkt in R. Dann sparen wir uns einmal das Einlesen von Daten und haben einen Schritt weniger.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>shoot_k_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k_in_shoot =</span> <span class="fu">c</span>(<span class="fl">3.7</span>, <span class="fl">4.1</span>, <span class="fl">4.2</span>, <span class="fl">4.3</span>, <span class="fl">4.3</span>, <span class="fl">4.4</span>, <span class="fl">4.6</span>, <span class="fl">4.65</span>, <span class="fl">5.7</span>, <span class="fl">5.7</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="dv">6</span>, <span class="fl">6.1</span>, <span class="fl">6.15</span>, <span class="fl">6.6</span>, <span class="fl">6.6</span>, <span class="fl">6.6</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">freshmass =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">82</span>, <span class="dv">87</span>, <span class="dv">83</span>, <span class="dv">81</span>, <span class="dv">80</span>, <span class="dv">79</span>, <span class="dv">78</span>, <span class="dv">72</span>, <span class="dv">81</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">59</span>, <span class="dv">70</span>, <span class="dv">63</span>, <span class="dv">39</span>, <span class="dv">30</span>, <span class="dv">28</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Im Folgenden schauen wir uns einmal drei Modellierungen der nicht-linearen Regression an. Einmal baue ich die originale Gleichung mit einem Polynom nach. Dann möchte ich wissen, ob nicht eine exponentielle Funktion ein besseres oder einfache Gleichung liefert. Am Ende nutzte ich nochmal das R Paket <code>mfp</code> mit der gleichnamigen Funktion um automatisiert das beste Polynom zu finden.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page"><code>nls()</code> mit Polynom</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><code>nls()</code> mit <code>exp()</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false"><code>mfp()</code></a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Dann bauen wir uns einmal das Polynom mit der Funktion <code>nls()</code>. Wir müssen hier Startwerte für unsere Koeffizienten <code>b1</code>, <code>b2</code> und <code>c</code> angeben. Wir haben aber Glück, dass es gleich auf Anhieb mit unseren einfachen Zahlen funktioniert.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fit_poly <span class="ot">&lt;-</span> <span class="fu">nls</span>(freshmass <span class="sc">~</span> b1 <span class="sc">*</span> k_in_shoot<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> b2 <span class="sc">*</span> k_in_shoot <span class="sc">+</span> c, <span class="at">data =</span> shoot_k_tbl, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">b2 =</span> <span class="dv">1</span>, <span class="at">c =</span> <span class="dv">1</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir uns auch schon die Koeffizienten der Gleichung wiedergeben lassen. Diese brauchen wir dann gleich, um einmal die Geradengleichung zusammenzusetzen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fit_poly <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
b1        |      -12.16
b2        |      111.95
c         |     -172.01</code></pre>
</div>
</div>
<p>Dann bauen wir auch schon gleich mal unsere nicht-lineare Gleichung zusammen. Du setzt einfach die Werte der Koeffizienten in die Geradengleichung ein und schon bist du fertig.</p>
<p><span class="math display">\[
freshmass = -12.16 \cdot (k\_in\_shoot)^2 + 111.95 \cdot k\_in\_shoot - 172.01
\]</span></p>
<p>Diese Gleichung bauen wir dann auch einmal als Funktion in R nach, um dann gleich mal zu schauen, wie gut unsere Kurve dann durch die Punkte läuft.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>shoot_k_nls_poly_func <span class="ot">&lt;-</span> \(x) {<span class="sc">-</span><span class="fl">12.16</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">111.95</span> <span class="sc">*</span> x <span class="sc">-</span> <span class="fl">172.01</span>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Am Ende brauche ich noch das Betimmtheitsmaß <span class="math inline">\(R^2\)</span> aus der Funktion <code>r2()</code>. Ich nutze hier immer die Funktion aus dem R Paket <code>{performance}</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(fit_poly)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.885</code></pre>
</div>
</div>
<p>Schön, damit haben wir fast den Wert wie auch in der ursprünglichen Abbildung. Schauen wir mal, ob wir den Wert noch besser hinkriegen.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Mir war dann die Idee mit dem Polynom etwas verspielt. Ich weiß, dass wir aus dem Polynom sehr gut dann den Extremwert bestimmen können, aber ich dachte vielleicht finden wir noch eine andere Funktion, die eventuell noch besser passt. Deshalb hier einmal eine einfache exponentielle Funktion.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fit_exp <span class="ot">&lt;-</span> <span class="fu">nls</span>(freshmass <span class="sc">~</span> b1 <span class="sc">*</span> <span class="fu">exp</span>(k_in_shoot) <span class="sc">+</span> c, <span class="at">data =</span> shoot_k_tbl, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">c =</span> <span class="dv">1</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir uns auch schon die Koeffizienten der Gleichung wiedergeben lassen. Diese brauchen wir dann gleich, um einmal die Geradengleichung zusammenzusetzen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fit_exp <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
b1        |       -0.07
c         |       89.45</code></pre>
</div>
</div>
<p>Dann bauen wir auch schon gleich mal unsere nicht-lineare Gleichung zusammen. Du setzt einfach die Werte der Koeffizienten in die Geradengleichung ein und schon bist du fertig. Das ist hier dann sogar noch einen Tick einfacher.</p>
<p><span class="math display">\[
freshmass = -0.07 \cdot e^{k\_in\_shoot} + 89.45
\]</span></p>
<p>Diese Gleichung bauen wir dann auch einmal als Funktion in R nach, um dann gleich mal zu schauen, wie gut unsere Kurve dann durch die Punkte läuft. Hier müssen wir dann eigentlich nur noch den Code von oben rüber kopieren.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>shoot_k_nls_exp_func <span class="ot">&lt;-</span> \(x) {<span class="sc">-</span><span class="fl">0.07</span> <span class="sc">*</span> <span class="fu">exp</span>(x) <span class="sc">+</span> <span class="fl">89.45</span>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Am Ende brauche ich noch das Betimmtheitsmaß <span class="math inline">\(R^2\)</span> aus der Funktion <code>r2()</code>. Ich nutze hier immer die Funktion aus dem R Paket <code>{performance}</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(fit_exp)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.898</code></pre>
</div>
</div>
<p>Gut, der ursprüngliche Wert war schon so gut, dass wir hier auch nur noch schwer eine Steigerung hinkriegen.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Das R Paket <code>{mfp}</code> macht uns das Leben leichter, da wir keine Startwerte oder eine Formal angeben müssen, wie wir dann mit Koeffizienten bestücken. Wir erhalten also beides. Zum einen die Formel die auf unsere Daten passt und zum anderen dann auch die Werte für die Formel. Das klingt gut, kommt aber wie immer auf das Ergebnis an. Wir müssen nur sagen, welcher Teil der <code>formula</code> dann ein Polynom <code>fp()</code> sein soll. In unserem Fall ist es natürlich die Variable <code>k_in_shoot</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fit_mfp <span class="ot">&lt;-</span> <span class="fu">mfp</span>(freshmass <span class="sc">~</span> <span class="fu">fp</span>(k_in_shoot), <span class="at">data =</span> shoot_k_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann schauen wir uns mal die geradengleichung an und sind leicht verstört, wie komplex die Gleichung ist.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit_mfp<span class="sc">$</span>formula</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>freshmass ~ I((k_in_shoot/10)^3) + I((k_in_shoot/10)^3 * log((k_in_shoot/10)))
&lt;environment: 0x1241f2e48&gt;</code></pre>
</div>
</div>
<p>Dann brauchen wir trotzdem die Koeffizienten, damit wir die Gleichung einmal erstellen können.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fit_mfp<span class="sc">$</span>coefficients </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Intercept k_in_shoot.1 k_in_shoot.2 
    37.55268   -578.20807  -1370.91131 </code></pre>
</div>
</div>
<p>Und da ist das Monster einer Gleichung. Ob das jetzt wirklich <em>besser</em> ist, werden wir dann gleich sehen. Aber komplexer ist die Gleichung auf alle Fälle. Ob sich das lohnt, wage ich gerade zu bezweifeln. Geschweige den diese Gleichung als was besseres als die beiden anderen Lösungen zu bezeichnen.</p>
<p><span class="math display">\[
\small
freshmass \sim 37.6 - 578.2 \cdot \left(\cfrac{k\_in\_shoot}{10}\right)^{3} - 1370.9 \cdot \left(\cfrac{k\_in\_shoot}{10}\right)^{3} \cdot \log\left(\cfrac{k\_in\_shoot}{10}\right)
\]</span></p>
<p>Ich breche mir dann noch einen ab, diese Gleichung dann einmal in R zu übersetzen. Sieht dann gar nicht mehr so schlimm aus, ist aber dennoch ein Brocken.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>shoot_k_mfp_func <span class="ot">&lt;-</span> \(x) {<span class="fl">37.55</span> <span class="sc">-</span> <span class="fl">578.20</span> <span class="sc">*</span> (x<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">3</span> <span class="sc">-</span> <span class="fl">1370.91</span> <span class="sc">*</span> (x<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="fu">log</span>(x<span class="sc">/</span><span class="dv">10</span>)}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Am Ende brauche ich noch das Betimmtheitsmaß <span class="math inline">\(R^2\)</span> aus der Funktion <code>r2()</code>. Ich nutze hier immer die Funktion aus dem R Paket <code>{performance}</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(fit_mfp)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.916</code></pre>
</div>
</div>
<p>Auch hier gilt, dass der ursprüngliche Wert schon so gut war, dass wir hier auch nur noch schwer eine Steigerung hinkriegen. Dafür haben wir dann eine super komplexe Gleichung erhalten. Da macht der Aufwand manchmal keien Sinn mehr.</p>
</div>
</div>
</div>
<p>Jetzt stellt sich natürlich die Frage des Maximums unserer Gradengleichung. Ich mache das jetzt nur für das Polynom aus der ursprünglichen Abbildung. Das ist jetzt der Vorteil unserer recht einfachen Gleichung eines Polynoms. Wir können diese Ableiten und dann Null setzen. So können wir schnell das Maximum berechnen. Das wäre natürlich bei komplizierteren Gleichungen dann schwerer und deshalb mache ich das auch nicht.</p>
<p><span class="math display">\[
\begin{align}
f(x) &amp; = -12.16 \cdot x^2 + 111.95 \cdot x - 172.01\\
f'(x) &amp;= -24.32 \cdot x + 111.95 \\
\end{align}
\]</span></p>
<p>Dann die erste Ableitung <span class="math inline">\(f'(x)\)</span> Null setzen und nach <span class="math inline">\(x\)</span> auflösen. Das geht bei der Formel sehr schnell. Das ist ja keine höhere Mathematik.</p>
<p><span class="math display">\[
x = \frac{-111.95}{-24.32} = 4.6
\]</span></p>
<p>Wir kriegen fast den gleichen Wert mit <span class="math inline">\(4.6\)</span> wie auch in der ursprünglichen Abbildung. Ob dieser Wert dann eine Aussagekraft hat, sei mal dahingestellt. Wenn du dir gleich die drei Modellierungen anschaust, dann siehst du, dass das Polynom natürlich für die beobachteten Punkte passt, aber für Werte davor schon eventuell nicht mehr. Da wir diese Werte aber nicht beobachten, ist es natürlich auch eine akademische Diskussion.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Orginal nachgebaut</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Mit <code>exp()</code> und <code>mfp()</code> nachgebaut</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>In der <a href="#fig-zerforschen-shoot_k-01-a" class="quarto-xref">Abbildung&nbsp;<span>58.2</span></a> siehst du dann die originale Abbildung einmal nachgebaut. Ich habe die Funktion in <code>geom_function()</code> etwas eher zeichnen lassen, aber da kannst du dann mit der Option <code>xlim</code> nachjustieren. Ich wollte einmal zeigen, wie die Funktion aussieht, wenn du frühere Werte vorhersagen wollen würdest. Sonst musste ich noch etwas mit den Pfeil spielen. Der Strich und der Kopf sind separat, damit es mit der gestrichelten Linie besser aussieht.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>shoot_k_tbl <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(k_in_shoot, freshmass)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"red4"</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> shoot_k_nls_poly_func, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">6.8</span>)) <span class="sc">+</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"K in shoot [% DM]"</span>, <span class="at">y =</span> <span class="fu">TeX</span>(r<span class="st">"(Shoot fresh mass \[g plant$^{-1}$\] - 34 DAP)"</span>)) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="fl">4.6</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="dv">100</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($y = -12.16 \cdot x^2 + 111.95 \cdot x - 172.01$)"</span>)) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="dv">95</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($R^2 = 0.89$)"</span>)) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">4.7</span>, <span class="at">y =</span> <span class="dv">30</span>, <span class="at">label =</span> <span class="st">"4.6%"</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">4.6</span>, <span class="at">y =</span> <span class="fu">shoot_k_nls_poly_func</span>(<span class="fl">4.6</span>), <span class="at">xend =</span> <span class="fl">4.6</span>, <span class="at">yend =</span> <span class="dv">20</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>, </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">4.6</span>, <span class="at">y =</span> <span class="dv">21</span>, <span class="at">xend =</span> <span class="fl">4.6</span>, <span class="at">yend =</span> <span class="dv">20</span>, </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-zerforschen-shoot_k-01-a" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-zerforschen-shoot_k-01-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-zerforschen-shoot_k-01-a-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2"><img src="stat-modeling-non-linear_files/figure-html/fig-zerforschen-shoot_k-01-a-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zerforschen-shoot_k-01-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.2— Visualisierung der nicht-linearen Regression mit einem Polynom aus der Funkion <code>nls()</code>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>In der folgenden <a href="#fig-zerforschen-shoot_k-01-b" class="quarto-xref">Abbildung&nbsp;<span>58.3</span></a> siehst du dann einmal die exponentiellen Funktion mit <code>nls()</code> sowie der algorithmisch erstellten Funktion aus dem R Paket <code>{mfp}</code>. Beide Funktionen treffen auch die Punkte sehr gut. Der Unterschied liegt dann vor den beobachteten Werten. Ich habe auch einmal die ursprüngliche Funktion aus einem Polynom über den gesamten Wertebereich ergänzt. Wenn dich nur der beobachtete Wertebereich interessiert, dann passen alle drei Modellierungen. Was davor passiert, ist auf jeden Fall nochmal spannend zu beobachten.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>shoot_k_tbl <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(k_in_shoot, freshmass)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"red4"</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> shoot_k_nls_poly_func, <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">6.8</span>)) <span class="sc">+</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> shoot_k_mfp_func, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">6.8</span>)) <span class="sc">+</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> shoot_k_nls_exp_func, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">6.8</span>)) <span class="sc">+</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"K in shoot [% DM]"</span>, <span class="at">y =</span> <span class="fu">TeX</span>(r<span class="st">"(Shoot fresh mass \[g plant$^{-1}$\] - 34 DAP)"</span>)) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="fl">4.6</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">4.7</span>, <span class="at">y =</span> <span class="dv">30</span>, <span class="at">label =</span> <span class="st">"4.6%"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">4.6</span>, <span class="at">y =</span> <span class="fu">shoot_k_nls_poly_func</span>(<span class="fl">4.6</span>), <span class="at">xend =</span> <span class="fl">4.6</span>, <span class="at">yend =</span> <span class="dv">20</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>, </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">4.6</span>, <span class="at">y =</span> <span class="dv">21</span>, <span class="at">xend =</span> <span class="fl">4.6</span>, <span class="at">yend =</span> <span class="dv">20</span>, </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.4</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.25</span>, <span class="at">y =</span> <span class="dv">100</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($y = -0.07 \cdot e^x + 89.45$)"</span>)) <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.25</span>, <span class="at">y =</span> <span class="dv">95</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($R^2 = 0.90$)"</span>)) <span class="sc">+</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.25</span>, <span class="at">y =</span> <span class="dv">38</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($y = 37.6 - 578.2 \cdot \left(</span><span class="sc">\f</span><span class="st">rac{x}{10}</span><span class="sc">\r</span><span class="st">ight)^{3} - 1370.9 \cdot \left(</span><span class="sc">\f</span><span class="st">rac{x}{10}</span><span class="sc">\r</span><span class="st">ight)^{3} \cdot \log\left(</span><span class="sc">\f</span><span class="st">rac{x}{10}</span><span class="sc">\r</span><span class="st">ight)$)"</span>)) <span class="sc">+</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.25</span>, <span class="at">y =</span> <span class="dv">33</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($R^2 = 0.92$)"</span>)) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-zerforschen-shoot_k-01-b" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-zerforschen-shoot_k-01-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-zerforschen-shoot_k-01-b-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3"><img src="stat-modeling-non-linear_files/figure-html/fig-zerforschen-shoot_k-01-b-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zerforschen-shoot_k-01-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.3— Visualisierung der nicht-linearen Regression auf einem erweiterten Wertebereich von <span class="math inline">\(x\)</span> mit einer exponentiellen Funktion mit <code>nls()</code> in Orange sowie der algorithmisch erstellten Funktion aus dem R Paket <code>{mfp}</code> in Dunkelgrün. Die graue Funktion stellt die ursprüngliche Funktion aus einem Polynom über den gesamten Wertebereich dar.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Zerforschen: Nicht-lineare Regression mit Zielbereich
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In diesem Zerforschenbeispiel schauen wir uns eine <a href="#sec-non-linear">nicht-lineare Regression</a> einmal genauer an. Ganz am Ende geht es dann auch nochmal ganz kurz um die Modellierung. Jetzt wollen wir uns aber erstmal die folgende Abbildung vornehmen und diese in <code>ggplot</code> nachbauen. Das wird eine echte Freude, denn die Abbildung ist wunderbar komplex. Wir haben zum einen die nicht-linearen Regressionsgeraden sowie deren Funktionen im Plot. Darüber hinaus dann noch ein Zielbereich mit einem Pfeil und einer Beschriftung. Am Ende müssen wir dann auch noch die Achsen mit den mathematischen Formeln beschriften. Wir haben also einiges zu tun.</p>
<div id="fig-ur-regression" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ur-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/eda/zerforschen_regression_01.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4"><img src="images/eda/zerforschen_regression_01.jpeg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ur-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.4— Ursprüngliche Abbildung, die nachgebaut werden soll. Zwei nicht-lineare Regession laufen durch Mittelwert plus/minus Standardabweichung. Im Weiteren sind die Regressionsgleichungen noch ergänzt sowie ein Zielbereich farblich hervorgehoben. Am Ende müssen dann die Achsen noch sauber beschriftet werden.
</figcaption>
</figure>
</div>
<p>Zuerst habe ich mir einmal einen leeren Plot erstellt in dem ich nur die Regressionsgleichungen abbilden werde. Aus den Gleichungen kann ich mir dann die Mittelwerte von dem <code>content</code> für die entsprechenden <code>iodine</code>-Werte berechnen. Also erstmal ein paar passende <span class="math inline">\(x\)</span>-Werte und die entsprechenden <span class="math inline">\(y\)</span>-Werte. Hierbei sind die <span class="math inline">\(y\)</span>-Werte nicht so wichtig, die werden wir uns ja mit den Regressionsgleichungen berechnen, aber wir brauchen ja die <span class="math inline">\(y\)</span>-Werte für unser Canvas. Die Funktion <code>ggplot()</code> muss ja wissen was auf <span class="math inline">\(x\)</span> und <span class="math inline">\(y\)</span> soll.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>func_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">iodine =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">content =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann schreibe ich mir noch über das <code>\(x){}</code> die Funktionen für die Regressionsgleichungen in R auf. Dabei ist <code>\(x){}</code> die Kurzschreibweise für <code>function(x){}</code>. Ich mache es mir hier nur etwas leichter.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ki_func <span class="ot">&lt;-</span> \(x) {<span class="sc">-</span><span class="dv">104</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">445</span> <span class="sc">*</span> x}</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>kio3_func <span class="ot">&lt;-</span> \(x) {<span class="sc">-</span><span class="dv">117</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">374</span> <span class="sc">*</span> x}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann schauen wir uns einmal die beiden Funktion mit dem <code>geom_function()</code> einmal in der <a href="#fig-ggplot-zerforschen-regression-1" class="quarto-xref">Abbildung&nbsp;<span>58.5</span></a> einmal an. Das <code>geom_function()</code> nimmt dabei eine definierte Funktion und berechnet dann die entsprechenden <span class="math inline">\(y\)</span>-Werte aus den <span class="math inline">\(x\)</span>-Werten.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> func_tbl, <span class="fu">aes</span>(<span class="at">x =</span> iodine, <span class="at">y =</span> content)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> ki_func, <span class="at">color =</span> cbbPalette[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> kio3_func, <span class="at">color =</span> cbbPalette[<span class="dv">3</span>], <span class="at">linetype =</span> <span class="st">'dashed'</span>) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ggplot-zerforschen-regression-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ggplot-zerforschen-regression-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-ggplot-zerforschen-regression-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5"><img src="stat-modeling-non-linear_files/figure-html/fig-ggplot-zerforschen-regression-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggplot-zerforschen-regression-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.5— Darstellung der beiden Regressionsgleichungen für <span class="math inline">\(KI\)</span> und <span class="math inline">\(KIO_3\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Anhand der beiden Funktionen kann ich mir jetzt auch die Mittelwerte berechnen. Die Mittelwerte sind ja die Werte, die sich für einen <code>iodine</code>-Wert auf der entsprechenden Regressionsgeraden ergeben. Hier also einmal alle meine Werte des <code>content</code> auf den beiden Geraden für die entsprechenden <code>iodine</code>-Werte.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">iodine =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">ki =</span> <span class="fu">ki_func</span>(iodine),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">kio3 =</span> <span class="fu">kio3_func</span>(iodine))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  iodine    ki  kio3
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0       0    0  
2   0.25  105.  86.2
3   0.5   196. 158. 
4   0.75  275. 215. 
5   1     341  257  
6   2     474  280  </code></pre>
</div>
</div>
<p>Ich habe mir dann die Mittelwerte genommen und für jede <code>iodine</code>/<code>ki</code>-Kombination noch zwei Werte ergänzt um dann noch etwas Streuung zu bekommen. So habe ich dann nur drei Beobachtungen pro Kombination, aber die Anzahl soll hier erstmal reichen. Du findest die Werte in der Datei <code>zerforschen_regression.xlsx</code>. Hier ist die Datei in einem Auszug dann einmal geladen und dargestellt.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>regression_tbl <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/zerforschen_regression.xlsx"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">as_factor</span>(type))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>regression_tbl </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 3
   type  iodine content
   &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 KI      0       0.1 
 2 KI      0       0.05
 3 KI      0       0.15
 4 KI      0.25  100   
 5 KI      0.25  105   
 6 KI      0.25  110   
 7 KI      0.5   180   
 8 KI      0.5   190   
 9 KI      0.5   200   
10 KI      0.75  275   
# ℹ 26 more rows</code></pre>
</div>
</div>
<p>Wir berechnen wie gewohnt die Mittelwerte und die Standardabweichungen um diese dann als Punkte und Fehlerbalken in der Abbildung darstellen zu können.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>stat_tbl <span class="ot">&lt;-</span> regression_tbl <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, iodine) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(content),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sd</span>(content))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>stat_tbl</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
# Groups:   type [2]
   type  iodine    mean      sd
   &lt;fct&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 KI      0      0.1    0.05  
 2 KI      0.25 105      5     
 3 KI      0.5  190     10     
 4 KI      0.75 262.    12.6   
 5 KI      1    340     30     
 6 KI      2    470     90     
 7 KIO3    0      0.117  0.0764
 8 KIO3    0.25  83.3    7.64  
 9 KIO3    0.5  142.    10.4   
10 KIO3    0.75 222.    10.4   
11 KIO3    1    260     30     
12 KIO3    2    275     50     </code></pre>
</div>
</div>
<p>So und nun geht es los. Ich habe dir den folgenden Code einmal annotiert. Klicke dafür dann einfach auf die Nummern um mehr Informationen zu erhalten. Der Code ist sehr umfangreich, aber die Abbildung ist ja auch recht komplex. Beachte im Besonderen den Abschnitt von weiter oben zu den <a href="eda-ggplot.html#sec-eda-tex">mathematischen Ausdrücken in den Achsenbeschriftungen</a>. Ich mache hier ja auch sehr viel um dann die mathematischen Ausdrücke richtig hinzukriegen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="annotated-cell-72"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-72-1"><a href="#annotated-cell-72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> stat_tbl, <span class="fu">aes</span>(<span class="at">x =</span> iodine, <span class="at">y =</span> mean,</span>
<span id="annotated-cell-72-2"><a href="#annotated-cell-72-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="annotated-cell-72-3"><a href="#annotated-cell-72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-72" data-target-annotation="1">1</button><span id="annotated-cell-72-4" class="code-annotation-target"><a href="#annotated-cell-72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> ki_func, <span class="at">color =</span> cbbPalette[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="annotated-cell-72-5"><a href="#annotated-cell-72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> kio3_func, <span class="at">color =</span> cbbPalette[<span class="dv">3</span>], <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="annotated-cell-72-6"><a href="#annotated-cell-72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-72" data-target-annotation="2">2</button><span id="annotated-cell-72-7" class="code-annotation-target"><a href="#annotated-cell-72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean<span class="sc">-</span>sd, <span class="at">ymax =</span> mean<span class="sc">+</span>sd),</span>
<span id="annotated-cell-72-8"><a href="#annotated-cell-72-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.03</span>) <span class="sc">+</span></span>
<span id="annotated-cell-72-9"><a href="#annotated-cell-72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>, <span class="dv">300</span>, <span class="dv">450</span>, <span class="dv">600</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">600</span>)) <span class="sc">+</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-72" data-target-annotation="3">3</button><span id="annotated-cell-72-10" class="code-annotation-target"><a href="#annotated-cell-72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_okabeito</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">TeX</span>(r<span class="st">"($KI$)"</span>), <span class="fu">TeX</span>(r<span class="st">"($KIO_3$)"</span>))) <span class="sc">+</span></span>
<span id="annotated-cell-72-11"><a href="#annotated-cell-72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Iodine"</span>,</span>
<span id="annotated-cell-72-12"><a href="#annotated-cell-72-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">TeX</span>(r<span class="st">"(Iodine supply $[kg\, l\, ha^{-1}]$)"</span>),</span>
<span id="annotated-cell-72-13"><a href="#annotated-cell-72-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">TeX</span>(r<span class="st">"(Iodine content $[\mu g\, l \, 100 g^{-1}\, f.m.]$)"</span>)) <span class="sc">+</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-72" data-target-annotation="4">4</button><span id="annotated-cell-72-14" class="code-annotation-target"><a href="#annotated-cell-72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="dv">500</span>, <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="annotated-cell-72-15"><a href="#annotated-cell-72-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($y = -98.41 \cdot x^2 + 432.09 \cdot x;\; R^2 = 0.957$)"</span>),</span>
<span id="annotated-cell-72-16"><a href="#annotated-cell-72-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> cbbPalette[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="annotated-cell-72-17"><a href="#annotated-cell-72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="dv">200</span>, <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="annotated-cell-72-18"><a href="#annotated-cell-72-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($y = -117.08 \cdot x^2 + 372.34 \cdot x;\; R^2 = 0.955$)"</span>),</span>
<span id="annotated-cell-72-19"><a href="#annotated-cell-72-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> cbbPalette[<span class="dv">3</span>]) <span class="sc">+</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-72" data-target-annotation="5">5</button><span id="annotated-cell-72-20" class="code-annotation-target"><a href="#annotated-cell-72-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">2</span>, <span class="at">ymin =</span> <span class="dv">50</span>, <span class="at">ymax =</span> <span class="dv">100</span>,</span>
<span id="annotated-cell-72-21"><a href="#annotated-cell-72-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> cbbPalette[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="annotated-cell-72-22"><a href="#annotated-cell-72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.525</span>, <span class="at">y =</span> <span class="dv">150</span>, <span class="at">label =</span> <span class="st">"Target range"</span>, <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="annotated-cell-72-23"><a href="#annotated-cell-72-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="annotated-cell-72-24"><a href="#annotated-cell-72-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_curve</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="dv">150</span>, <span class="at">xend =</span> <span class="fl">1.25</span>, <span class="at">yend =</span> <span class="dv">105</span>),</span>
<span id="annotated-cell-72-25"><a href="#annotated-cell-72-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">"#555555"</span>,</span>
<span id="annotated-cell-72-26"><a href="#annotated-cell-72-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-72-27"><a href="#annotated-cell-72-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">curvature =</span> <span class="fl">0.2</span>,</span>
<span id="annotated-cell-72-28"><a href="#annotated-cell-72-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.03</span>, <span class="st">"npc"</span>))) <span class="sc">+</span></span>
<span id="annotated-cell-72-29"><a href="#annotated-cell-72-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.11</span>, <span class="fl">0.8</span>),</span>
<span id="annotated-cell-72-30"><a href="#annotated-cell-72-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="annotated-cell-72-31"><a href="#annotated-cell-72-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">l =</span> <span class="dv">1</span>),</span>
<span id="annotated-cell-72-32"><a href="#annotated-cell-72-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text.align =</span> <span class="dv">0</span>) </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-72" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-72" data-code-lines="4,5" data-code-annotation="1">Hier werden die beiden nicht-linearen Kurven gezeichnet.</span>
</dd>
<dt data-target-cell="annotated-cell-72" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-72" data-code-lines="7,8" data-code-annotation="2">Hier werden die Fehlerbalken erstellt.</span>
</dd>
<dt data-target-cell="annotated-cell-72" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-72" data-code-lines="10" data-code-annotation="3">Hier passen wir die Labels in der Legende entsprechend an.</span>
</dd>
<dt data-target-cell="annotated-cell-72" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-72" data-code-lines="14,15,16,17,18,19" data-code-annotation="4">Hier schreiben wir die Regressionsgleichung für die jeweiligen Kurven hin.</span>
</dd>
<dt data-target-cell="annotated-cell-72" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-72" data-code-lines="20,21,22,23,24,25,26,27,28" data-code-annotation="5">Hier produzieren wir den blauen Bereich plus den Pfeil sowie die Beschreibung.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div id="fig-ggplot-zerforschen-regression-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ggplot-zerforschen-regression-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-ggplot-zerforschen-regression-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6"><img src="stat-modeling-non-linear_files/figure-html/fig-ggplot-zerforschen-regression-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggplot-zerforschen-regression-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.6— Einmal die komplexe Abbildung der nicht-linearen Regression in <code>ggplot</code> nachgebaut. Am Ende wurde es dann doch noch eine Legende und keine Beschriftung.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Und dann zum Abschluss nochmal die <a href="#sec-non-linear">nicht-lineare Regression</a> um zu schauen welche Koeffizienten der nicht-linearen Regression wir erhalten würden, wenn wir unsere selbst ausgedachten Daten nehmen würden. Wir nutzen hier einmal die Funktion <code>nls()</code> um die nicht-lineare Regression anzupassen und dann die Funktion <code>r2()</code> aus dem R Paket <code>performance</code> für unser Bestimmtheitsmaß <span class="math inline">\(R^2\)</span>. Das Ganze machen wir dann natürlich für beide Geraden, also einmal für <span class="math inline">\(KI\)</span> und einmal für <span class="math inline">\(KIO_3\)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Nicht-lineare Regression für <span class="math inline">\(KI\)</span></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Nicht-lineare Regression für <span class="math inline">\(KIO_3\)</span></a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(content <span class="sc">~</span> b1 <span class="sc">*</span> iodine<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> b2 <span class="sc">*</span> iodine, <span class="at">data =</span> <span class="fu">filter</span>(regression_tbl, type <span class="sc">==</span> <span class="st">"KI"</span>), </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">b2 =</span> <span class="dv">1</span>)) </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
b1        |      -98.41
b2        |      432.09</code></pre>
</div>
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(fit)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.957</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(content <span class="sc">~</span> b1 <span class="sc">*</span> iodine<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> b2 <span class="sc">*</span> iodine, <span class="at">data =</span> <span class="fu">filter</span>(regression_tbl, type <span class="sc">==</span> <span class="st">"KIO3"</span>), </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">b2 =</span> <span class="dv">1</span>)) </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
b1        |     -117.08
b2        |      372.34</code></pre>
</div>
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(fit)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.955</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Zerforschen: Nicht-lineare Regression und zwei <span class="math inline">\(\boldsymbol{y}\)</span>-Achsen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In diesem Zerforschenbeispiel wollen wir uns eine <a href="#sec-non-linear">nicht-lineare Regression</a> anschauen. Das besondere hier sind die zwei Achsen auf der linken und rechten Seite der Abbildung. Wir brauchen also eine zwei <span class="math inline">\(y\)</span>-Achse. Da wir auch zwei Geraden anpassen wollen, machen wir die Sache etwas komplizierter, aber es geht ja auch draum mal was Neues in <code>ggplot</code> zu lernen. Wir wollen also die folgende Abbildung einmal nachbauen.</p>
<div id="fig-ur-regression-02" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ur-regression-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/eda/zerforschen_regression_02.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" data-glightbox="description: .lightbox-desc-7"><img src="images/eda/zerforschen_regression_02.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ur-regression-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.7— Ursprüngliche Abbildung, die nachgebaut werden soll. Zwei nicht-lineare Regession mit zwei <span class="math inline">\(y\)</span>-Achsen.
</figcaption>
</figure>
</div>
<p>Hier möchte ich die Daten direkt in R erschaffen, dafür baue ich mir direkt ein <code>tibble</code> und nutze dann die Daten weiter. Natürlich kannst du auch hier eine Exceldatei erschaffen und dann die Exceldatei einlesen. Aber hier geht es so etwas schneller, wir haben ja nur eine handvoll von Beobachtungen vorliegen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>tree_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ph =</span> <span class="fu">c</span>(<span class="fl">3.8</span>, <span class="fl">4.3</span>, <span class="fl">4.4</span>, <span class="fl">4.8</span>, <span class="fl">5.2</span>, <span class="fl">5.3</span>, <span class="fl">5.4</span>, <span class="fl">5.6</span>, <span class="fl">5.8</span>),</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">boden =</span> <span class="fu">c</span>(<span class="fl">12.1</span>, <span class="fl">6.0</span>, <span class="fl">5.0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.8</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nadel =</span> <span class="fu">c</span>(<span class="fl">12.0</span>, <span class="fl">7.0</span>, <span class="dv">12</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">6</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Wenn dich nicht interessiert, wie die Geradengleichung entsteht, dann überspringe einfach den nächsten Kasten. Ich nutze hier eine <a href="#sec-non-linear">nicht-lineare Regression</a> um auf die Werte der Gleichungen für Nadeln und Blatt zu kommen. Spannenderweise kann ich die Werte in der Orginalabbildung nicht reproduzieren. Aber gut, wir nutzen dann die Koeffizienten, die zu den Daten passen.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Nicht-lineare Regression für Boden</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Nicht-lineare Regression für Nadeln</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(boden <span class="sc">~</span> b1 <span class="sc">*</span> <span class="fu">exp</span>(ph<span class="sc">*</span>b2), <span class="at">data =</span> tree_tbl, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">b2 =</span> <span class="dv">0</span>)) </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
b1        |    10496.50
b2        |       -1.77</code></pre>
</div>
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(fit)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.974</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(nadel <span class="sc">~</span> b1 <span class="sc">*</span> <span class="fu">exp</span>(ph<span class="sc">*</span>b2), <span class="at">data =</span> tree_tbl, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b1 =</span> <span class="dv">1</span>, <span class="at">b2 =</span> <span class="dv">0</span>)) </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
b1        |       49.20
b2        |       -0.38</code></pre>
</div>
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(fit)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.543</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Wir erhalten dann die Koeffizienten für die beiden folgenden Funktionen aus der nicht-linearen Regression aus den obigen Tabs. Wir brauchen zwei Geradengleichungen, da wir ja einmal die Nadeln und einmal die Blätter abbilden müssen. Auch hier bauen wir uns dann einmal eine Funktion zusammen. Beide Funktionen nutzen wir dann gleich für die Funktion <code>geom_function()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>nadel_func <span class="ot">&lt;-</span> \(x) {<span class="fl">49.20</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.38</span> <span class="sc">*</span> x)}</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>boden_func <span class="ot">&lt;-</span> \(x) {<span class="fl">10496.50</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">1.77</span> <span class="sc">*</span> x)}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Der zentrale Punkt hier ist die zweite <span class="math inline">\(y\)</span>-Achse, die wir über <code>sec_axis()</code> definieren. Hier musst du schauen, dass die zweite Achse ein Verhältnis zu der ersten Achse ist. Hier haben wir auf der linken Seite maximal 15 und auf der rechten Seite maximal 600. Daher ist das Verhältnis der Achsen zueinander 600 zu 15. Mehr dazu dann auf der Hilfeseite <a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">Specify a secondary axis</a>. Wir fangen auch mit einem leeren Plot an und legen dann alle anderen <code>geom</code>-Funktionen darüber. Das macht uns die Konstruktion etwas einfacher, da wir dann die Punkte und Geraden besser einzeichnen können. Wir nutzen dann auch hier das R Paket <code>latex2exp</code> umd die mathematischen Formeln in der Legende zu erstellen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> tree_tbl, <span class="fu">aes</span>(<span class="at">x =</span> ph, <span class="at">y =</span> boden), <span class="at">color =</span> cbbPalette[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> tree_tbl, <span class="fu">aes</span>(<span class="at">x =</span> ph, <span class="at">y =</span> nadel), <span class="at">color =</span> cbbPalette[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> boden_func, <span class="at">color =</span> cbbPalette[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> nadel_func, <span class="at">color =</span> cbbPalette[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">*</span> <span class="dv">600</span><span class="sc">/</span><span class="dv">15</span>, <span class="at">name =</span> <span class="st">"Al-Gehalt Nadeln</span><span class="sc">\n</span><span class="st"> [mg/kg TM]"</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>, <span class="dv">300</span>, <span class="dv">450</span>, <span class="dv">600</span>)),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">"Al-Gehalt Boden</span><span class="sc">\n</span><span class="st"> [mg/kg TM]"</span>) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">3.5</span>, <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">4.25</span>, <span class="fl">4.5</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">12.5</span>), <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Boden"</span>, <span class="st">"Nadeln"</span>), <span class="at">color =</span> cbbPalette[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">4</span>)], <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"pH-Wert des Bodens"</span>) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">3.75</span>, <span class="at">y =</span> <span class="fl">0.4</span>, <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($y = 10496.50 \cdot e^{-1.77\cdot x}\; R^2 = 0.974$)"</span>), </span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> cbbPalette[<span class="dv">7</span>]) <span class="sc">+</span> </span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">4.25</span>, <span class="at">y =</span> <span class="dv">11</span>, <span class="at">hjust =</span> <span class="st">"left"</span>, </span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">TeX</span>(r<span class="st">"($y = 49.20 \cdot e^{-0.38\cdot x}\; R^2 = 0.543$)"</span>), </span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> cbbPalette[<span class="dv">4</span>]) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ggplot-zerforschen-regression-2-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ggplot-zerforschen-regression-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-ggplot-zerforschen-regression-2-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" data-glightbox="description: .lightbox-desc-8"><img src="stat-modeling-non-linear_files/figure-html/fig-ggplot-zerforschen-regression-2-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ggplot-zerforschen-regression-2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.8— Einmal die komplexe Abbildung der nicht-linearen Regression in <code>ggplot</code> nachgebaut. Für beide Quellen Nadeln und Boden wurde jewiels eine eigene <span class="math inline">\(y\)</span>-Achse erstellt. Die Regressionsgleichungen aus der Orginalabbildung entsprechen nicht den Werten hier in der Abbildung.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="genutzte-r-pakete" class="level2" data-number="58.1">
<h2 data-number="58.1" class="anchored" data-anchor-id="genutzte-r-pakete"><span class="header-section-number">58.1</span> Genutzte R Pakete</h2>
<p>Wir wollen folgende R Pakete in diesem Kapitel nutzen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, magrittr, broom, nlraa, modelsummary,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>               parameters, performance, see, mgcv, mfp, marginaleffects,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>               gratia, readxl, nlstools, janitor, ggeffects, nls.multstart,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>               conflicted)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>cb_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>An der Seite des Kapitels findest du den Link <em>Quellcode anzeigen</em>, über den du Zugang zum gesamten R-Code dieses Kapitels erhältst.</p>
</section>
<section id="daten" class="level2" data-number="58.2">
<h2 data-number="58.2" class="anchored" data-anchor-id="daten"><span class="header-section-number">58.2</span> Daten</h2>
<p>In unserem Datenbeispiel schauen wir uns die Wachstumskurve von Hühnchen an. Wir verfolgen das Gewicht über 36 Tage. Dabei messen wir an jedem Tag eine unterschiedliche Anzahl an Kücken bzw. Hünchen. Wir wissen auch nicht, ob wir immer die gleichen Hühnchen jedes Mal messen. Dafür war die Hühnchenmastanlage zu groß. Wir wissen aber wie alt jedes Hühnchen bei der Messung war.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>chicken_tbl <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"data/chicken_growth.csv"</span>)  </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In <a href="#tbl-chicken" class="quarto-xref">Tabelle&nbsp;<span>58.1</span></a> sehen wir nochmal die Daten für die ersten drei und die letzten drei Zeilen. Alleine überschlagsmäßig sehen wir schon, dass wir es nicht mit einem linearen Anstieg des Gewichtes zu tun haben. Wenn wir einen linearen Anstieg hätten, dann würde ein Hühnchen, dass am Tag 1 ca. 48g wiegt, nach 36 Tagen ca. 1728g wiegen. Das ist hier eindeutig nicht der Fall. Wir haben vermutlich einen nicht-linearen Zusammenhang.</p>
<div class="cell">
<div id="tbl-chicken" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-chicken-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;58.1— Auszug aus Hühnchendatensatz.
</figcaption>
<div aria-describedby="tbl-chicken-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">age</th>
<th style="text-align: center;">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">48</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">46</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">44</td>
</tr>
<tr class="even">
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
</tr>
<tr class="odd">
<td style="text-align: center;">36</td>
<td style="text-align: center;">2286</td>
</tr>
<tr class="even">
<td style="text-align: center;">36</td>
<td style="text-align: center;">2278</td>
</tr>
<tr class="odd">
<td style="text-align: center;">36</td>
<td style="text-align: center;">2309</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Schauen wir uns die Daten dann gleich einmal in einer Visualisierung mit <code>ggplot()</code> an um besser zu verstehen wie die Zusammenhänge in dem Datensatz sind.</p>
<p>Neben dem Hünchendatensatz haben wir noch einen Datenstatz zu dem Wachstum von Wasserlinsen. Wir haben einmal händisch die Dichte bestimmt <code>duckweeds_density</code> und einmal mit einem Sensor gemessen. Dabei sind die Einheiten der Sensorwerte erstmal egal, wir wollen aber später eben nur mit einem Sensor messen und dann auf den Wasserlinsengehalt zurückschließen. Wir haben hier eher eine Sätigungskurve vorliegen, denn die Dichte der Wasserlinsen ist ja von der Oberfläche begrenzt. Auch können sich die Wasserlinsen nicht beliebig teilen, es gibt ja nur eine begrenzte Anzahl an Ressourcen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>duckweeds_tbl <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/duckweeds_density.xlsx"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#tbl-duckweeds" class="quarto-xref">Tabelle&nbsp;<span>58.2</span></a> siehst du dann einmal einen Auszug aus den Daten zu den Wasserlinsen. Es ist ein sehr einfacher Datensatz mit nur zwei Spalten. Wie du siehst, scheint sich das bei der nicht linearen Regression durchzuziehen. Es gehen auch komplexere Modelle, aber dann kann ich die Ergebnisse schlechter visualisieren.</p>
<div class="cell">
<div id="tbl-duckweeds" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-duckweeds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;58.2— Auszug aus Wasserlinsendatensatz.
</figcaption>
<div aria-describedby="tbl-duckweeds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">duckweeds_density</th>
<th style="text-align: center;">sensor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">4.8</td>
<td style="text-align: center;">0.4303</td>
</tr>
<tr class="even">
<td style="text-align: center;">4.8</td>
<td style="text-align: center;">0.4763</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4.8</td>
<td style="text-align: center;">0.4954</td>
</tr>
<tr class="even">
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
</tr>
<tr class="odd">
<td style="text-align: center;">53.2</td>
<td style="text-align: center;">2.1187</td>
</tr>
<tr class="even">
<td style="text-align: center;">53.2</td>
<td style="text-align: center;">2.1296</td>
</tr>
<tr class="odd">
<td style="text-align: center;">53.2</td>
<td style="text-align: center;">2.1246</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Auch die Wasserlinsendaten wollen wir uns erstmal in einer Abbildung anschauen und dann sehen, ob wir eine Kurve durch die Punkte gelegt kriegen.</p>
</section>
<section id="visualisierung" class="level2 page-columns page-full" data-number="58.3">
<h2 data-number="58.3" class="anchored" data-anchor-id="visualisierung"><span class="header-section-number">58.3</span> Visualisierung</h2>
<p>In <a href="#fig-nls-00-1" class="quarto-xref">Abbildung&nbsp;<span>58.9 (a)</span></a> sehen wir die Visualisierung der Hühnchengewichte nach Alter in Tagen. Zum einen sehen wir wie das Körpergewicht exponentiell ansteigt. Zum anderen sehen wir in <a href="#fig-nls-00-2" class="quarto-xref">Abbildung&nbsp;<span>58.9 (b)</span></a>, dass auch eine <span class="math inline">\(log\)</span>-transformiertes <span class="math inline">\(y\)</span> nicht zu einem linearen Zusammenhang führt. Der Zusammenhang zwischen dem Körpergewicht und der Lebensalter bleibt nicht-linear.</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center">
<div id="fig-nls-00" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-nls-00-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-nls-00" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-nls-00-1" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-nls-00-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-00-1.png" class="lightbox page-columns page-full" data-gallery="fig-nls-00" data-glightbox="description: .lightbox-desc-9"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-00-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page" data-ref-parent="fig-nls-00" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-nls-00-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Ohne transformierten <span class="math inline">\(y\)</span>.
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-nls-00" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-nls-00-2" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-nls-00-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-00-2.png" class="lightbox page-columns page-full" data-gallery="fig-nls-00" data-glightbox="description: .lightbox-desc-10"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-00-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page" data-ref-parent="fig-nls-00" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-nls-00-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Mit <span class="math inline">\(log\)</span>-transformierten <span class="math inline">\(y\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-00-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.9— Visualisierung der Hühnchengewichte nach Alter in Tagen. Auch mit <span class="math inline">\(log\)</span>-transformierten Körpergewicht liegt immer noch kein linearer Zusammenhang zwischen dem Lebensalter und dem Körpergewicht vor.
</figcaption>
</figure>
</div>
</div>
<p>Deshalb wollen wir den Zusammenhang zwischen dem Körpergewicht der Hühnchen und dem Lebensalter einmal mit einer nicht-linearen Regression modellieren. Wir sind also nicht so sehr an <span class="math inline">\(p\)</span>-Werten interessiert, wir sehen ja, dass die gerade ansteigt, sondern wollen wissen wie die Koeffizienten einer möglichen exponentiellen Gleichung aussehen.</p>
<p>Für die Visualisierung der Wasserlinsendaten in der <a href="#fig-gam-duckweeds-01" class="quarto-xref">Abbildung&nbsp;<span>58.10</span></a> verzichte ich einmal auf die logarithmische Darstellung. Wir wollen hier dann eine Kurve durch die Punkte legen so wie die Daten sind. Auffällig ist erstmal, dass wir sehr viel weniger Beobachtungen und auch Dichtemesspunkte auf der <span class="math inline">\(x\)</span>-Achse haben. Wir haben dann zu den jeweiligen Wasserlinsendichten dann drei Sensormessungen. Das könnte noch etwas herausfordernd bei der Modellierung werden.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-gam-duckweeds-01" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gam-duckweeds-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-gam-duckweeds-01-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" data-glightbox="description: .lightbox-desc-11"><img src="stat-modeling-non-linear_files/figure-html/fig-gam-duckweeds-01-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gam-duckweeds-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.10— Visualisierung der Sensorwerte nach Wasserlinsendichte. Pro Dichtewert liegen drei Sensormessungen vor.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="nonlinear-least-squares-mit-nls" class="level2" data-number="58.4">
<h2 data-number="58.4" class="anchored" data-anchor-id="nonlinear-least-squares-mit-nls"><span class="header-section-number">58.4</span> Nonlinear least-squares mit <code>nls()</code></h2>
<p>Zum nicht-linearen Modellieren nutzen wir die Funktion <code>nls()</code> (eng. <em>nonlinear least-squares</em>). Die Funktion <code>nls()</code> ist das nicht-lineare Äquivalent zu der linearen Funktion <code>lm()</code>. Nur müssen wir mit der <code>nls()</code> Funktion etwas anders umgehen. Zum einen müssen wir die <code>formula()</code> anders definieren. Der große Vorteil von <code>nls()</code> ist, dass wir hier auch die Koeffizienten unser Geradengleichung wiederkriegen. In den anderen Möglichkeiten kriegen wir dann teilweise nicht die Informationen zu einer Kurve wieder. Wir haben dann zwar ein wunderbares Modell, können das Modell aber nicht einfach als eine mathematische Gleichung aufschreiben. Daher hier <code>nls()</code> etwas ausführlicher, da wir dann mit <code>nls()</code> schon die Sachen auch erhalten, die wir meist wollen.</p>
<section id="von-wachstum" class="level3" data-number="58.4.1">
<h3 data-number="58.4.1" class="anchored" data-anchor-id="von-wachstum"><span class="header-section-number">58.4.1</span> … von Wachstum</h3>
<p>In unserem Hühnchenbeispiel nehmen ein exponentielles Wachstum an. Daher brauchen wir einen geschätzten Koeffizienten für den Exponenten des Alters sowie einen Intercept. Wir gehen nicht davon aus, dass die Hühnchen mit einem Gewicht von 0g auf die Welt bzw. in die Mastanlage kommen. Unsere Formel sehe dann wie folgt aus.</p>
<p><span class="math display">\[
weight \sim \beta_0 + age^{\beta_1}
\]</span></p>
<p>Da wir in R keine <span class="math inline">\(\beta\)</span>’s schreiben können nutzen wir die Buchstaben <code>b0</code> für <span class="math inline">\(\beta_0\)</span> und <code>b1</code> für <span class="math inline">\(\beta_1\)</span>. Im Prinzip könnten wir auch andere Buchstaben nehmen, aber so bleiben wir etwas konsistenter zu der linearen Regression. Somit sieht die Gleichung dann in R wie folgt aus.</p>
<p><span class="math display">\[
weight \sim b_0 + age^{b_1}
\]</span></p>
<p>Wichtig hier, wir müssen R noch mitteilen, dass wir <code>age</code> hoch <code>b1</code> rechnen wollen. Um das auch wirklich so zu erhalten, zwingen wir R mit der Funktion <code>I()</code> auch wirklich einen Exponenten zu berechnen. Wenn wir nicht das <code>I()</code> nutzen, dann kann es sein, dass wir aus versehen eine Schreibweise für eine Abkürzung in der <code>formula</code> Umgebung nutzen.</p>
<p>Im Weiteren sucht die Funktion iterativ die besten Werte für <code>b0</code> und <code>b1</code>. Deshalb müssen wir der Funktion <code>nls()</code> Startwerte mitgeben, die in etwa passen könnten. Hier tippe ich mal auf ein <code>b0 = 1</code> und ein <code>b1 = 1</code>. Wenn wir einen Fehler wiedergegeben bekommen, dann können wir auch noch an den Werten drehen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">1</span>, <span class="at">b1 =</span> <span class="dv">1</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bessere Startwerte für <code>nls()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Leider müssen wir in <code>nls()</code> die Startwerte selber raten. Das kannst du natürlich aus der Abbildung der Daten abschätzen, aber ich muss sagen, dass mir das immer sehr schwer fällt. Deshalb gibt es da einen Trick. Wir rechnen ein lineares Modell und zwar logarithmieren wir beide Seiten der Gleichung. Dann können wir die Koeffizienten aus dem Modell als Startwerte nehmen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> <span class="fu">log</span>(age), chicken_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(weight) ~ log(age), data = chicken_tbl)

Coefficients:
(Intercept)     log(age)  
      3.475        1.085  </code></pre>
</div>
</div>
<p>Manchmal musst du auch nur die linke Seite logarithmieren.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> age, chicken_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Es hängt dann immer etwas vom Modell ab und wie die Werte dann anschließend in <code>nls()</code> konvergieren. Ich habe eigentlich immer mit einem der beiden Methoden Startwerte gefunden. Wir nehmen hier mal die Startwerte aus dem ersten Ansatz mit der doppelten Logarithmierung.</p>
<p>Wir erhalten hier für den <code>Intercept</code> den Wert 3.475 und für die Steigung den Wert 1.085. Da in meiner obigen Gleichung die Steigung <code>b1</code> ist und der <code>Intercept</code> dann <code>b0</code> setzen wir die Zahlen entsprechend ein. Für den <code>Intercept</code> müssen wir dann noch den Exponenten wählen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="fu">exp</span>(<span class="fl">3.475</span>), <span class="at">b1 =</span> <span class="fl">1.085</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Nonlinear regression model
  model: weight ~ b0 + I(age^b1)
   data: chicken_tbl
    b0     b1 
92.198  2.178 
 residual sum-of-squares: 4725115

Number of iterations to convergence: 7 
Achieved convergence tolerance: 1.175e-06</code></pre>
</div>
</div>
<p>Jetzt sollten wir keine Fehlermeldung erhalten haben, dass unser Modell nicht konvergiert ist oder anderweitig kein Optimum gefunden hat.</p>
<p>Das <a href="https://github.com/padpadpadpad/nls.multstart">R Paket <code>{nls.multstart}</code></a> versucht das Problem der Startwerte nochmal algorithmisch zu lösen. Wenn du also keine guten Startwerte mit den Trick über <code>lm()</code> findest, dann ist das R Paket hier nochmal ein guter Startpunkt. Es geht auch komplexer wie das Tutorium unter <a href="https://www.granvillematheson.com/post/nonlinear-modelling-using-nls-nlme-and-brms/">Nonlinear Modelling using nls, nlme and brms</a> nochmal zeigt.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nls_multstart</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">0</span>, <span class="at">b1 =</span> <span class="dv">0</span>),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="cn">Inf</span>, <span class="at">b1 =</span> <span class="cn">Inf</span>),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">start_lower =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">0</span>, <span class="at">b1 =</span> <span class="dv">0</span>),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">start_upper =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">500</span>, <span class="at">b1 =</span> <span class="dv">5</span>),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter =</span> <span class="dv">500</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Nonlinear regression model
  model: weight ~ b0 + I(age^b1)
   data: data
    b0     b1 
92.198  2.178 
 residual sum-of-squares: 4725115

Number of iterations to convergence: 11 
Achieved convergence tolerance: 1.49e-08</code></pre>
</div>
</div>
<p>Natürlich kommt hier das Gleiche raus, aber manchmal findet man dann wirklich nicht die passenden Startwerte. Die Funktion macht ja nichts anderes als der ursprünglichen <code>nls()</code> Funktion etwas unter die Arme zugreifen.</p>
</div>
</div>
<p>Wir nutzen wieder die Funktion <code>model_parameters()</code> aus dem R Paket <code>{parameters}</code> um uns eine aufgeräumte Ausgabe wiedergeben zu lassen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
b0        |       92.20
b1        |        2.18</code></pre>
</div>
</div>
<p>Die <span class="math inline">\(p\)</span>-Werte interessieren uns nicht weiter. Wir sehen ja, dass wir einen Effekt von dem Alter auf das Körpergewicht haben. Das überrascht auch nicht weiter. Wir wollen ja die Koeffizienten <span class="math inline">\(\beta_0\)</span> und <span class="math inline">\(\beta_1\)</span> um die Gleichung zu vervollständigen. Mit dem Ergebnis aus der Funktion <code>nls()</code> können wir jetzt wie folgt schreiben.</p>
<p><span class="math display">\[
weight \sim 92.20 + age^{2.18}
\]</span></p>
<p>Damit haben wir dann auch unsere nicht-lineare Regressionsgleichung erhalten. Passt den die Gleichung auch zu unseren Daten? Das können wir einfach überprüfen. Dafür müssen wir nur in die Funktion <code>predict()</code> unser Objekt des Fits unseres nicht-linearen Modells <code>fit</code> stecken und erhalten die vorhergesagten Werte für jedes <span class="math inline">\(x\)</span> in unserem Datensatz. Oder etwas kürzer, wir erhalten die “Gerade” der Funktion mit den Koeffizienten aus dem <code>nls()</code> Modell wieder. In <a href="#fig-nls-01" class="quarto-xref">Abbildung&nbsp;<span>58.11</span></a> sehen wir die gefittete Gerade.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-01" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-01-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" data-glightbox="description: .lightbox-desc-12"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-01-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.11— Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Wie wir erkennen können sieht die Modellierung einigermaßen gut aus. Wir haben zwar einige leichte Abweichungen von den Beobachtungen zu der geschätzten Geraden, aber im Prinzip könnten wir mit der Modellierung leben. Wir hätten jetzt also eine nicht-lineare Gleichung die den Zusammenhang zwischen Körpergewicht und Lebensalter von Hühnchen beschreibt. Die Verwendung von <code>nest()</code> und <code>map()</code> ist schon erweiterete Programmierung in R. Du findest hier mehr über <a href="https://cran.r-project.org/web/packages/broom/vignettes/broom_and_dplyr.html">broom and dplyr</a> und die Anwendung auf mehrere Datensätze.</p>
<p>Nun könnte man argumentieren, dass wir vielleicht unterschiedliche Abschnitte des Wachstums vorliegen haben. Also werden wir einmal das Alter in Tagen in vier gleich große Teile mit der Funktion <code>cut_number()</code> schneiden. Beachte bitte, dass in jeder Gruppe gleich viele Beobachtungen sind. Du kannst sonst händisch über <code>case_when()</code> innerhalb von <code>mutate()</code> dir eigene Gruppen bauen. Wir nutzen auch die Funktion <code>map()</code> um über alle Subgruppen des Datensatzes dann ein <code>nls()</code> laufen zu lassen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>nls_tbl <span class="ot">&lt;-</span> chicken_tbl <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="fu">as_factor</span>(<span class="fu">cut_number</span>(age, <span class="dv">4</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(grp) <span class="sc">|&gt;</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nls_fit =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> .x, </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">1</span>, <span class="at">b1 =</span> <span class="dv">2</span>))),</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred =</span> <span class="fu">map</span>(nls_fit, <span class="sc">~</span><span class="fu">predict</span>(.x))) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Um den Codeblock oben kurz zu erklären. Wir rechnen vier nicht-lineare Regressionen auf den vier Altersgruppen. Dann müssen wir uns noch die vorhergesagten Werte wiedergeben lassen damit wir die gefittete Gerade zeichnen können. Wir nutzen dazu die Funktion <code>unnest()</code> um die Daten zusammen mit den vorhergesagten Werten zu erhalten.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>nls_pred_tbl <span class="ot">&lt;-</span> nls_tbl <span class="sc">|&gt;</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(data, pred))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In <a href="#fig-nls-02" class="quarto-xref">Abbildung&nbsp;<span>58.12</span></a> sehen wir die vier einzelnen Geraden für die vier Altersgruppen. Wir sind visuell besser als über alle Altersgruppen hinweg. Das ist doch mal ein schönes Ergebnis.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-nls-02" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-02-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" data-glightbox="description: .lightbox-desc-13"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-02-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.12— Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung aufgeteilt nach vier Altersgruppen.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Wir können uns jetzt noch die <code>b0</code> und <code>b1</code> für jede der vier Altergruppen wiedergeben lassen. Wir räumen etwas auf und geben über <code>select()</code> nur die Spalten wieder, die wir auch brauchen und uns interessieren.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>nls_tbl <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tidied =</span> <span class="fu">map</span>(nls_fit, tidy)) <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(tidied) <span class="sc">|&gt;</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grp, term, estimate) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
# Groups:   grp [4]
  grp     term  estimate
  &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;
1 [1,2]   b0       44.4 
2 [1,2]   b1        4.21
3 (2,8]   b0       60.1 
4 (2,8]   b1        2.42
5 (8,25]  b0      128.  
6 (8,25]  b1        2.18
7 (25,36] b0      330.  
8 (25,36] b1        2.14</code></pre>
</div>
</div>
<p>Was sehen wir? Wir erhalten insgesamt acht Koeffizienten und können darüber dann unsere vier exponentiellen Gleichungen für unsere Altergruppen erstellen. Wir sehen, dass besonders in der ersten Gruppe des Alters von 1 bis 2 Tagen wir den Intercept überschätzen und den Exponenten unterschätzen. In den anderen Altersgruppen passt dann der Exponent wieder zu unserem ursprünglichen Modell über alle Altersgruppen.</p>
<p><span class="math display">\[
weight_{[1-2]} \sim 44.4 + age^{4.21}
\]</span></p>
<p><span class="math display">\[
weight_{(2-8]} \sim 60.1 + age^{2.42}
\]</span></p>
<p><span class="math display">\[
weight_{(8-25]} \sim 128.0 + age^{2.18}
\]</span></p>
<p><span class="math display">\[
weight_{(25-36]} \sim 330.0 + age^{2.14}
\]</span></p>
<p>Je nachdem wie zufrieden wir jetzt mit den Ergebnissen der Modellierung sind, könnten wir auch andere Altersgruppen noch mit einfügen. Wir belassen es bei dieser Modellierung und schauen uns nochmal die andere Richtung an.</p>
</section>
<section id="von-sättigung" class="level3" data-number="58.4.2">
<h3 data-number="58.4.2" class="anchored" data-anchor-id="von-sättigung"><span class="header-section-number">58.4.2</span> … von Sättigung</h3>
<p>Schauen wir uns jetzt einmal ein Beispiel der Sättigung an. Hier nehmen wir dann eine <em>Power</em>-Funktion in der Form <span class="math inline">\(y = a + x^b\)</span>. Wir könnten noch eine Konstante <span class="math inline">\(c\)</span> als Multiplikator einfügen, wir schauen jetzt aber mal, ob unsere einfache Parametrisierung jetzt funktioniert. Prinzipiell sehen ja unsere Punkte wie eine <em>Power</em>-Funktion aus. Daher bauen wir uns einmal die Fomel in <code>nls()</code> und lassen uns die Koeffizienten <span class="math inline">\(a\)</span> und <span class="math inline">\(b\)</span> wiedergeben. Dann schauen wir, ob die Koeffizienten Sinn machen und die Punkte auch gut beschreiben.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>duckweeds_nls_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(sensor <span class="sc">~</span> a <span class="sc">+</span> <span class="fu">I</span>(duckweeds_density<span class="sc">^</span>b), <span class="at">data =</span> duckweeds_tbl, </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">start =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>duckweeds_nls_fit </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Nonlinear regression model
  model: sensor ~ a + I(duckweeds_density^b)
   data: duckweeds_tbl
      a       b 
-1.1468  0.2975 
 residual sum-of-squares: 0.08168

Number of iterations to convergence: 5 
Achieved convergence tolerance: 1.432e-06</code></pre>
</div>
</div>
<p>Schauen wir uns einmal das Bestimmtheitsmaß <span class="math inline">\(R^2\)</span> für die Anpassung an. Das ist ja immer unser erstes abstraktes Maß für die Modellgüte und wie gut die Kurve durch die Punkte gelaufen ist. Das sieht doch schon sehr gut aus. Wir wollen den Wert aber dann noch gleich einmal visuell überprüfen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>duckweeds_nls_fit <span class="sc">|&gt;</span> <span class="fu">r2</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.986</code></pre>
</div>
</div>
<p>Dann können wir auch schon die mathematische Gleichung aufschreiben. Wir haben einen negativen <span class="math inline">\(y\)</span>-Achsenabschnitt <span class="math inline">\(a\)</span> sowie eine <em>Power</em> kleiner als 1. Damit sollte unsere Kurve mit steigenden <span class="math inline">\(x\)</span>-Werten abflachen. Ich kann mir immer nicht vorstellen, wie so eine Funktion aussehen würde, dafür fehlt mir die mathematische Phantasie.</p>
<p><span class="math display">\[
sensor = -1.1468 + duckweeds\_density^{0.2975}
\]</span></p>
<p>Dann wollen wir einmal die Funktion visualisieren. Wir haben zwei Möglichkeiten. Entweder bauen wir uns die mathematische Funktion in R nach und plotten dann die mathematische Funktion mit <code>geom_function()</code> oder wir nutzen nur den Fit <code>duckweeds_nls_fit</code> direkt in <code>ggplot()</code>. Erstes erlaubt nochmal sicherzugehen, dass wir auch die mathematische Funktion richtig aufgeschrieben haben. Wenn du die nicht brauchst, dann ist die zweite Variante natürlich weit effizienter.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Mit <code>geom_function()</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Mit <code>geom_line()</code> und <code>predict()</code></a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>Jetzt nehmen wir einmal unsere Koeffizienten aus dem <code>nls()</code>-Modell und bauen uns eine Funktion nach. Das ist im Prinzip die mathematische Formel nur in der Schreibweise in R.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>duckweed_func <span class="ot">&lt;-</span> \(x){<span class="sc">-</span><span class="fl">1.1468</span> <span class="sc">+</span> x<span class="sc">^</span>{<span class="fl">0.2975</span>}} </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir auch schon die Kurve durch die Punkte in der folgenden Abbildung legen. Da wir hier eine Funktion vorliegen haben, ist der Verlauf auch sehr schön glatt. Wir sehen aber auch, dass die Funktion sehr schön passt. Die Kurve läuft gut durch die Punkte. Etwas was wir auch schon von dem <span class="math inline">\(R^2\)</span> erwartet hatten.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> duckweed_func, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-duckweed-01a" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-duckweed-01a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-01a-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" data-glightbox="description: .lightbox-desc-14"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-01a-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-duckweed-01a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.13— Angepasste Kurve aus der Funktion <code>nls()</code> dargestellt mit der Funktion <code>geom_function()</code>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>Schneller geht es in der Funktion <code>geom_line()</code> und <code>predict()</code>, wo wir dann die Anpassung unseres Modells direkt als <span class="math inline">\(y\)</span>-Werte übergeben. Da wir hier jetzt nur die <span class="math inline">\(x\)</span>-Werte nutzen, die wir auch in den Daten vorliegen haben, wirkt die Kurve bei so wenigen Messpunkten auf der <span class="math inline">\(x\)</span>-Achse etwas stufig. Aber auch hier sehen wir, dass die Kurve gut durch unsere Punkte läuft. Diese Variante ist die etwas schnellere, wenn du nicht an der mathematischen Formulierung interessiert bist.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(duckweeds_nls_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-duckweed-01b" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-duckweed-01b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-01b-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" data-glightbox="description: .lightbox-desc-15"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-01b-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-duckweed-01b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.14— Angepasste Kurve aus der Funktion <code>nls()</code> dargestellt mit der Funktion <code>geom_line()</code> und <code>predict()</code>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Jetzt bietet es sich nochmal an die Vorhersageintervalle oder Prädiktionsintervalle (eng. <em>prediction interval</em>) der Abbildung hinzuzufügen. Neben den Vorhersageintervallen könntne wir auch die 95% Konfidenzintervalle (eng. <em>confidence interval</em>) hinzufügen. Hier müssen wir gleich entscheiden, was wir eigentlich zeigen wollen. Wir müssen also zwischen den beiden Intervallen unterscheiden. Vorhersageintervalle machen eine Aussage zu der Genauigkeit von zukünftigen Beobachtungen wohingegen die die Konfidenzintervalle eine Aussage über die Koeffizienten des Modells treffen. Mehr dazu gibt es auch hier Stack Exchange unter <a href="https://stats.stackexchange.com/questions/225652/prediction-interval-vs-confidence-interval-in-linear-regression-analysis">Prediction interval vs.&nbsp;confidence interval in linear regression analysis</a>. Konfidenzintervalle geben dir also die Bandbreite wieder in der die Gerade verläuft. Dafür nutzen die Konfidenzintervalle die Daten und geben dir ein Intervall an, in dem die Gerade durch die Koeffizienten des Modells mit 95% Sicherheit verläuft. Das Vorhersageintervall gibt dir an mit welchen Bereich zukünftige Beobachtung mit 95% Sicherheit fallen werden. Das Vorhersageintervall ist breiter als das Konfidenzintervall und nicht jede Methode liefert auch beide Intervalle.</p>
<p>Es ist uns möglich über Bootstrap, also einer Simulation aus unseren Daten, ein Vorhersageintervall sowie ein Konfidenzintervall zu generieren. Zu dem Bootstrapverfahren kannst du in den Klassifikationskapiteln mehr lesen. Ich nutze hier 500 Simulationen um mir die Intervalle ausgeben zu lassen. Bei einer echten Analyse würde ich die Anzahl auf 1000 bis 2000 setzen. Wir brauchen also als erstes unser Bootstrapobjekt mit dem wir dann in den Tabs weitermachen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>nls_boot_obj <span class="ot">&lt;-</span> <span class="fu">nlsBoot</span>(duckweeds_nls_fit, <span class="at">niter =</span> <span class="dv">500</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ich habe jetzt das Prädiktionsintervall und das Konfidenzintervall jeweils in einem der Tabs berechnet. Wenn du deine Daten auswertest musst du dich dann für ein Intervall entscheiden. Meistens nutzen wir das Konfidenzintervall, da die Interpretation und die Darstellung im Allgemeinen bekannter ist.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Vorhersageintervall (eng. <em>prediction interval</em>)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Konfidenzintervall (eng. <em>confidence interval</em>)</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>Um das Vorhersageintervall zu erstellen nutzen wir die Funktion <code>nlsBootPredict()</code> und übergeben als neue Daten unseren Datensatz. Dann müssen wir natürlich noch als Option <code>interval = "prediction"</code> wählen um das Vorhersageintervall wiedergegeben zu bekommen. Ich muss dann noch etwas aufräumen und auch die <span class="math inline">\(x\)</span>-Werte wieder ergänzen damit wir gleich alles in <code>ggplot()</code> darstellen können. Auch nerven mich die doppelten Werte, die brauche ich nicht für die Darstellung und entferne sie über <code>distinct()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pred_plim_tbl <span class="ot">&lt;-</span> <span class="fu">nlsBootPredict</span>(nls_boot_obj, <span class="at">newdata =</span> duckweeds_tbl, <span class="at">interval =</span> <span class="st">"prediction"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duckweeds_density =</span> duckweeds_tbl<span class="sc">$</span>duckweeds_density) <span class="sc">|&gt;</span> </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>pred_plim_tbl</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  median x2_5_percent x97_5_percent duckweeds_density
   &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;
1  0.460        0.249         0.565               4.8
2  1.08         0.872         1.19               14.5
3  1.44         1.22          1.55               24.2
4  1.71         1.50          1.82               33.9
5  1.93         1.71          2.04               43.5
6  2.12         1.90          2.23               53.2</code></pre>
</div>
</div>
<p>Aus der mittleren Abweichung des Medians zu der unteren 2.5% Grenze <code>x2_5_percent</code> sowie zu der oberen 97.5% Grenze <code>x97_5_percent</code> lässt sich leicht noch eine Konstante <span class="math inline">\(\phi\)</span> errechnen, die wir dann zu unserer mathematischen Formel ergänzen können. Dann hätten wir auch die mathematische Formel für die obere und untere Kurve des Vorhersageintervalls. Im Prinzip ist das Vorhersageintervall ja nur eine verschobene Kurve der ursprünglichen Geradengleichung. Wir subtrahieren und addieren also unser <span class="math inline">\(\phi\)</span> jeweils zu dem <span class="math inline">\(y\)</span>-Achsenabschnitt von <span class="math inline">\(-1.1468\)</span> aus dem <code>nls()</code>-Modell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_plim_tbl, x2_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.2169113</code></pre>
</div>
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_plim_tbl, x97_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1086924</code></pre>
</div>
</div>
<p>Damit hätten wir dann für die 2.5% und 97.% Grenzen des Vorhersageintervalls folgende mathematische Formel. Ich ersetze hier einmal <span class="math inline">\(duckweeds\_density\)</span> durch <span class="math inline">\(x\)</span> um die Formel etwas aufzuräumen und zu kürzen.</p>
<p><span class="math display">\[
[-1.358 + x^{0.298}; \; -1.031 + x^{0.298}]
\]</span></p>
<p>Wir machen es uns etwas einfacher und nutzen hier dann die Funktion <code>geom_ribbon()</code> um die Fläche des Vorhersageintervalls. Wir nutzen hier also nicht die Informationen aus unserem <code>nls()</code>-Modell direkt sondern erschaffen uns die Informationen nochmal über eine Bootstrapsimulation. Es ist einfach noch ein Extraschritt, wenn du eben noch ein Intervall haben willst. Nicht immer ist es notwendig und die Breite des Vorhersageintervalls hängt auch maßgeblich von der Anzahl an Beobachtungen ab.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_plim_tbl, <span class="fu">aes</span>(<span class="at">y =</span> median), <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_plim_tbl, <span class="at">fill =</span> <span class="st">"#CC79A7"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> duckweeds_density, <span class="at">ymin =</span> x2_5_percent, <span class="at">ymax =</span> x97_5_percent), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-duckweed-02" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-duckweed-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-02-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" data-glightbox="description: .lightbox-desc-16"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-02-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-duckweed-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.15— Angepasste Kurve aus der Funktion <code>nls()</code> zusammen mit dem Vorhersageintervall.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>Um das Konfidenzintervall zu erstellen nutzen wir ebenfalls die Funktion <code>nlsBootPredict()</code> und übergeben als neue Daten unseren Datensatz. Dann müssen wir natürlich noch als Option <code>interval = "confidence"</code> auswählen um das Konfidenzintervall wiedergegeben zu bekommen. Ich muss dann auch hier aufräumen und die <span class="math inline">\(x\)</span>-Werte wieder ergänzen damit wir gleich alles in <code>ggplot()</code> darstellen können. Auch nerven mich die doppelten Werte, die brauche ich nicht für die Darstellung und entferne sie über <code>distinct()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>pred_clim_tbl <span class="ot">&lt;-</span> <span class="fu">nlsBootPredict</span>(nls_boot_obj, <span class="at">newdata =</span> duckweeds_tbl, <span class="at">interval =</span> <span class="st">"confidence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duckweeds_density =</span> duckweeds_tbl<span class="sc">$</span>duckweeds_density) <span class="sc">|&gt;</span> </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>pred_clim_tbl </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  median x2_5_percent x97_5_percent duckweeds_density
   &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;
1  0.450        0.388         0.505               4.8
2  1.07         1.03          1.11               14.5
3  1.43         1.40          1.46               24.2
4  1.71         1.67          1.74               33.9
5  1.93         1.88          1.96               43.5
6  2.12         2.06          2.16               53.2</code></pre>
</div>
</div>
<p>Aus der mittleren Abweichung des Medians zu der unteren 2.5% Grenze <code>x2_5_percent</code> sowie zu der oberen 97.5% Grenze <code>x97_5_percent</code> lässt sich leicht noch eine Konstante <span class="math inline">\(\phi\)</span> errechnen, die wir dann zu unserer mathematischen Formel ergänzen können. Dann hätten wir auch die mathematische Formel für die obere und untere Kurve des Konfidenzintervalls. Im Prinzip ist das Konfidenzintervall ja nur eine verschobene Kurve der ursprünglichen Geradengleichung. Wir subtrahieren und addieren also unser <span class="math inline">\(\phi\)</span> jeweils zu dem <span class="math inline">\(y\)</span>-Achsenabschnitt von <span class="math inline">\(-1.1468\)</span> aus dem <code>nls()</code>-Modell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_clim_tbl, x2_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.04496175</code></pre>
</div>
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_clim_tbl, x97_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03759294</code></pre>
</div>
</div>
<p>Damit hätten wir dann für die 2.5% und 97.% Grenzen des Konfidenzintervalls folgende mathematische Formel. Ich ersetze hier einmal <span class="math inline">\(duckweeds\_density\)</span> durch <span class="math inline">\(x\)</span> um die Formel etwas aufzuräumen und zu kürzen.</p>
<p><span class="math display">\[
[-1.1978 + x^{0.298}; \; -1.1098 + x^{0.298}]
\]</span></p>
<p>Wir machen es uns einfacher und nutzen hier dann die Funktion <code>geom_ribbon()</code> um die Fläche des Konfidenzintervalls. Wir nutzen hier also nicht die Informationen aus unserem <code>nls()</code>-Modell direkt sondern erschaffen uns die Informationen nochmal über eine Bootstrapsimulation. Es ist einfach noch ein Extraschritt, wenn du eben noch ein Intervall haben willst. Nicht immer ist es notwendig und die Breite des Konfidenzintervalls hängt auch maßgeblich von der Anzahl an Beobachtungen ab.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_clim_tbl, <span class="fu">aes</span>(<span class="at">y =</span> median), <span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_clim_tbl, <span class="at">fill =</span> <span class="st">"#0072B2"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> duckweeds_density, <span class="at">ymin =</span> x2_5_percent, <span class="at">ymax =</span> x97_5_percent), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-duckweed-03" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-duckweed-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-03-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" data-glightbox="description: .lightbox-desc-17"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-duckweed-03-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-duckweed-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.16— Angepasste Kurve aus der Funktion <code>nls()</code> zusammen mit dem Konfidenzintervall.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="von-zerfall" class="level3" data-number="58.4.3">
<h3 data-number="58.4.3" class="anchored" data-anchor-id="von-zerfall"><span class="header-section-number">58.4.3</span> … von Zerfall</h3>
<p>Nachdem wir uns einem exponentiellen Anstieg und die Sättigung angeschaut haben, wollen weit uns nun einmal mit einem exponentiellen Zerfall beschäftigen. Wir betrachten einen exponentziellen Zerfall einer Blattläuse Population. Wir wollen die folgende Gleichung lösen und die Werte für die Konstante <span class="math inline">\(a\)</span> und den Exponenten <span class="math inline">\(\beta_1\)</span> schätzen. Nun haben wir diesmal keinen Intercept vorliegen.</p>
<p><span class="math display">\[
count \sim a \cdot week^{\beta_1}
\]</span></p>
<p>Die Daten sind angelegt an ein Experiment zu Blattlauskontrolle. Wir haben ein neues Biopestizid welchen wir auf die Blattläuse auf Rosen sprühen. Wir zählen dann automatisiert über eine Kamera und Bilderkennung wie viele Blattläuse sich nach den Wochen des wiederholten Sprühens noch auf den Rosen befinden. Wir erhalten damit folgende Daten im Objekt <code>exp_tbl</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20221018</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>exp_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">count =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">17906</span>, <span class="at">sd =</span> <span class="dv">17906</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>  <span class="dv">5303</span>, <span class="at">sd =</span>  <span class="dv">5303</span><span class="sc">/</span><span class="dv">4</span>),</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>  <span class="dv">2700</span>, <span class="at">sd =</span>  <span class="dv">2700</span><span class="sc">/</span><span class="dv">4</span>),</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>  <span class="dv">1696</span>, <span class="at">sd =</span>  <span class="dv">1696</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>   <span class="dv">947</span>, <span class="at">sd =</span>   <span class="dv">947</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>   <span class="dv">362</span>, <span class="at">sd =</span>   <span class="dv">362</span><span class="sc">/</span><span class="dv">4</span>)), </span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weeks =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">each =</span> <span class="dv">10</span>)) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Wir müssen ja wieder die Startwerte in der Funktion <code>nls()</code> angeben. Meistens raten wir diese oder schauen auf die Daten um zu sehen wo diese Werte in etwa liegen könnten. Dann kann die Funktion <code>nls()</code> diese Startwerte dann optimieren. Es gibt aber noch einen anderen Trick. Wir rechnen eine <em>lineare</em> Regression über die <span class="math inline">\(log\)</span>-transformierten Daten und nehmen dann die Koeffizienten aus dem linearen Modell als Startwerte für unsere nicht-lineare Regression.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(count) <span class="sc">~</span> <span class="fu">log</span>(weeks), exp_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(count) ~ log(weeks), data = exp_tbl)

Coefficients:
(Intercept)   log(weeks)  
      9.961       -2.024  </code></pre>
</div>
</div>
<p>Aus der linearen Regression erhalten wir einen Intercept von <span class="math inline">\(9.961\)</span> und eine Steigung von <span class="math inline">\(-2.025\)</span>. Wir exponieren den Intercept und erhalten den Wert für <span class="math inline">\(a\)</span> mit <span class="math inline">\(\exp(9.961)\)</span>. Für den Exponenten <span class="math inline">\(b1\)</span> tragen wir den Wert <span class="math inline">\(-2.025\)</span> als Startwert ein. Mit diesem Trick erhalten wir etwas bessere Startwerte und müssen nicht so viel rumprobieren.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(count <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">I</span>(weeks<span class="sc">^</span>b1), <span class="at">data =</span> exp_tbl, </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="fu">exp</span>(<span class="fl">9.961</span>), <span class="at">b1 =</span> <span class="sc">-</span><span class="fl">2.025</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Wir können uns noch die Koeffizienten wiedergeben lassen und die Geradengleichung vervollständigen. Wie du siehst sind die Werte natürlich anders als die Startwerte. Wir hätten aber ziemlich lange rumprobieren müssen bis wir nahe genug an die Startwerte gekommen wären damit die Funktion <code>nls()</code> iterativ eine Lösung für die Gleichung findet.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
a         |    17812.11
b1        |       -1.69</code></pre>
</div>
</div>
<p>Abschließend können wir dann die Koeffizienten in die Geradengleichung eintragen.</p>
<p><span class="math display">\[
count \sim 17812.11 \cdot week^{-1.69}
\]</span></p>
<p>In <a href="#fig-nls-03" class="quarto-xref">Abbildung&nbsp;<span>58.17</span></a> sehen wir die Daten zusammen mit der gefitteten Gerade aus der nicht-linearen Regression. Wir sehen, dass die Gerade ziemlich gut durch die Mitte der jeweiligen Punkte läuft.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exp_tbl, <span class="fu">aes</span>(weeks, count)) <span class="sc">+</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(fit)), <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-03" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-03-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" data-glightbox="description: .lightbox-desc-18"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-03-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.17— Visualisierung der Sterberate von Blattläusen nach Aufbringen eines Bio-Pestizides mit der nicht-linearen Regressionsgleichung.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="der-michaelis-menten-gleichung" class="level3" data-number="58.4.4">
<h3 data-number="58.4.4" class="anchored" data-anchor-id="der-michaelis-menten-gleichung"><span class="header-section-number">58.4.4</span> … der Michaelis-Menten Gleichung</h3>
<p>In diesem Abschnitt wollen wir uns mit dem Modellieren einer Sättigungskurve beschäftigen. Daher bietet sich natürlich die Michaelis-Menten-Gleichung an. Die Daten in <code>enzyme.csv</code> geben die Geschwindigkeit <span class="math inline">\(v\)</span> des Enzyms saure Phosphatase (<span class="math inline">\(\mu mol/min\)</span>) bei verschiedenen Konzentrationen des Substrats Nitrophenolphosphat, [S] (mM), an. Die Daten können mit der Michaelis-Menten-Gleichung modelliert werden und somit kann eine nichtlineare Regression kann verwendet werden, um <span class="math inline">\(K_M\)</span> und <span class="math inline">\(v_{max}\)</span> zu schätzen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>enzyme_tbl <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">file.path</span>(<span class="st">"data/enzyme.csv"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">S =</span> concentration, <span class="at">v =</span> rate)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In <a href="#tbl-enzyme" class="quarto-xref">Tabelle&nbsp;<span>58.3</span></a> sehen wir einen Auszug aus den Enzymedaten. Eigentlich relativ klar. Wir haben eine Konzentration <span class="math inline">\(S\)</span> vorliegen und eine Geschwindigkeit <span class="math inline">\(v\)</span>.</p>
<div class="cell">
<div id="tbl-enzyme" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-enzyme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;58.3— Auszug aus Enzymedatensatz.
</figcaption>
<div aria-describedby="tbl-enzyme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">S</th>
<th style="text-align: center;">v</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2.78</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: center;">3.35</td>
</tr>
<tr class="even">
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
</tr>
<tr class="odd">
<td style="text-align: center;">48</td>
<td style="text-align: center;">11.04</td>
</tr>
<tr class="even">
<td style="text-align: center;">49</td>
<td style="text-align: center;">9.18</td>
</tr>
<tr class="odd">
<td style="text-align: center;">50</td>
<td style="text-align: center;">11.56</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Schauen wir uns die Daten einmal in der <a href="#fig-nls-04" class="quarto-xref">Abbildung&nbsp;<span>58.18</span></a> an. Wir legen die Konzentration <span class="math inline">\(S\)</span> auf die <span class="math inline">\(x\)</span>-Achse und Geschwindigkeit <span class="math inline">\(v\)</span> auf die <span class="math inline">\(y\)</span>-Achse.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(enzyme_tbl, <span class="fu">aes</span>(<span class="at">x =</span> S, <span class="at">y =</span> v)) <span class="sc">+</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"[S] / mM"</span>, <span class="at">y =</span> <span class="fu">expression</span>(v<span class="sc">/</span><span class="st">"µmol "</span> <span class="sc">*</span> min<span class="sc">^-</span><span class="dv">1</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-04" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-04-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" data-glightbox="description: .lightbox-desc-19"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-04-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.18— Visualisierung der Geschwindigkeit <span class="math inline">\(v\)</span> des Enzyms saure Phosphatase bei verschiedenen Konzentrationen des Substrats Nitrophenolphosphat.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Die Reaktionsgleichung abgeleitet aus der Michaelis-Menten-Kinetik lässt sich allgemein wie folgt darstellen. Wir haben die Konzentration <span class="math inline">\(S\)</span> und die Geschwindigkeit <span class="math inline">\(v\)</span> gegeben und wollen nun über eine nicht-lineare Regression die Werte für <span class="math inline">\(v_{max}\)</span> und <span class="math inline">\(K_M\)</span> schätzen.</p>
<p><span class="math display">\[
v = \cfrac{v_{max} \cdot S}{K_M + S}
\]</span></p>
<p>Dabei gibt <span class="math inline">\(v\)</span> die initiale Reaktionsgeschwindigkeit bei einer bestimmten Substratkonzentration [S] an. Mit <span class="math inline">\(v_{max}\)</span> beschreiben wir die maximale Reaktionsgeschwindigkeit. Eine Kenngröße für eine enzymatische Reaktion ist die Michaeliskonstante <span class="math inline">\(K_M\)</span>. Sie hängt von der jeweiligen enzymatischen Reaktion ab. <span class="math inline">\(K_M\)</span> gibt die Substratkonzentration an, bei der die Umsatzgeschwindigkeit halbmaximal ist und somit <span class="math inline">\(v = 1/2 \cdot v_{max}\)</span> ist. Wir haben dann die Halbsättigung vorliegen.</p>
<p>Bauen wir also die GLeichung in R nach und geben die Startwerte für <span class="math inline">\(v_{max}\)</span> und <span class="math inline">\(K_M\)</span> für die Funktion <code>nls()</code> vor. Die Funktion <code>nls()</code> versucht jetzt die beste Lösung für die beiden Koeffizienten zu finden.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>enzyme_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(v <span class="sc">~</span> vmax <span class="sc">*</span> S <span class="sc">/</span>( KM <span class="sc">+</span> S ), <span class="at">data  =</span> enzyme_tbl,</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="at">vmax =</span> <span class="dv">9</span>, <span class="at">KM =</span> <span class="dv">2</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Wir können uns dann die Koeffizienten ausgeben lassen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>enzyme_fit <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter | Coefficient
-----------------------
vmax      |       11.85
KM        |        4.28</code></pre>
</div>
</div>
<p>Jetzt müssen wir die Michaelis-Menten-Gleichung nur noch um die Koeffizienten ergänzen.</p>
<p><span class="math display">\[
v = \cfrac{11.85 \cdot S}{4.28 + S}
\]</span></p>
<p>In der <a href="#fig-nls-05" class="quarto-xref">Abbildung&nbsp;<span>58.19</span></a> können wir die gefittete Gerade nochmal überprüfen und schauen ob das Modellieren geklappt hat. Ja, hat es die Gerade läuft direkt mittig durch die Punkte.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(enzyme_tbl, <span class="fu">aes</span>(<span class="at">x =</span> S, <span class="at">y =</span> v)) <span class="sc">+</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(enzyme_fit)), <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"[S] / mM"</span>, <span class="at">y =</span> <span class="fu">expression</span>(v<span class="sc">/</span><span class="st">"µmol "</span> <span class="sc">*</span> min<span class="sc">^-</span><span class="dv">1</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-05" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-05-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" data-glightbox="description: .lightbox-desc-20"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-05-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.19— Visualisierung der Michaelis-Menten-Kinetik zusammen mit der gefitteten Gerade aus einer nicht-linearen Regression.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="multivariate-fractional-polynomials-mit-mfp" class="level2" data-number="58.5">
<h2 data-number="58.5" class="anchored" data-anchor-id="multivariate-fractional-polynomials-mit-mfp"><span class="header-section-number">58.5</span> Multivariate Fractional Polynomials mit <code>{mfp}</code></h2>
<p>Manchmal haben wir keine Ahnung, welche mathematische Formel denn überhaupt passen könnte. Ohne eine mathematische Formel können wir dann auch schlecht in <code>nls()</code> Startwerte angeben. Ohne die Angabe von Startwerten für die Formel können wir dann auch nichts rechnen. Die wenigsten Menschen haben eine exponentielle Idee im Kopf, wenn sie eine Kurve sehen. Aus dem Grund wurden die <em>Multivariate Fractional Polynomials</em> (abk. <em>mfp</em>) entwickelt, die dir dann eine Formel wiedergeben. Das Schöne daran ist, dass du einfach nur sagen musst, welche Variable als Polynom in die Formel soll und den Rest macht die Funktion <code>mfp</code> aus dem gleichnamigen R Paket <code>{mfp}</code> dann für sich. Hier sei auch einmal auf das Tutorial <a href="https://towardsdatascience.com/multivariate-fractional-polynomials-why-isnt-this-used-more-1a1fa9ead12c">Multivariate Fractional Polynomials: Why Isn’t This Used More?</a> verwiesen. Die Entwickler des R Paketes <code>{mfp}</code> haben auch eine eigene Hilfeseite unter <a href="https://mfp.imbi.uni-freiburg.de/">Multivariable Fractional Polynomials (MFP)</a> eingerichtet. Wir immer ist das Thema zu groß, daher hier nur die simple Anwendung.</p>
<p>Der wichtigste Schritt ist einmal die Variable zu bezeichnen, die als Polynom behandelt werden soll. Wir machen das hier mit der Funktion <code>fp()</code>. Wir sagen damit der Funktion <code>mfp()</code>, dass wir bitte die Koeffizienten und eine “Hochzahl” <span class="math inline">\(a\)</span> für das Alter haben wollen. Wir erhalten also die Koeffizienten für die folgende mathematische Formel mit Zahlen wieder.</p>
<p><span class="math display">\[
weight \sim \beta_0 + \beta_1 \cdot age^{a}
\]</span></p>
<p>Dann rechnen wir also einfach schnelle einmal das Modell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>mfp_fit <span class="ot">&lt;-</span> <span class="fu">mfp</span>(weight <span class="sc">~</span> <span class="fu">fp</span>(age), <span class="at">data =</span> chicken_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Wir können dann auch gleich einmal in die Zusammenfassung reinschauen und sehen, was dort für eine Formel für das Alter <code>age</code> geschätzt wurde.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mfp_fit) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = weight ~ I((age/10)^2), data = chicken_tbl)

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     66.300      8.229   8.057 1.62e-14 ***
I((age/10)^2)  188.226      1.520 123.839  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 13642.51)

    Null deviance: 213533638  on 317  degrees of freedom
Residual deviance:   4311034  on 316  degrees of freedom
AIC: 3934.1

Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
<p>Es ist auch möglich sich die Formel direkt wiedergeben zu lassen. Hier ist dann wichtig zu verstehen, was wir dort sehen. Die Funktion <code>mfp()</code> testet immer verschiedene ganzzahlige <code>a</code>-Werte für die Potenz. Dann versucht die Funktion <code>mfp()</code> die restlichen Koeffizienten optimal den Daten anzupassen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>mfp_fit<span class="sc">$</span>formula</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>weight ~ I((age/10)^2)
&lt;environment: 0x130acaae0&gt;</code></pre>
</div>
</div>
<p>Nun haben wir erstmal die Informationen über das Alter und die Potenz <span class="math inline">\(a\)</span> und wie diese beiden miteinander zusammengehören. Jetzt fehlen aber noch die Koeffizienten für die Steigung und den y-Achsenabschnitt. Die haben wir auch oben in der <code>summary()</code> gesehen, aber wir können uns die Werte auch separat anzeigen lassen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>mfp_fit<span class="sc">$</span>coefficients </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept     age.1 
 66.30015 188.22589 </code></pre>
</div>
</div>
<p>Dann können wir auch einmal die etwas kompliziertere mathematische Gleichung aufschreiben. Da wir an ganzzahlige Potenzen gebunden sind, muss der Rest etwas anderes aussehen. Aber die Formel geht eigentlich noch. Da wir eben auch eine ganzzahlige Potenz haben, können wir auch selber mit einem Taschenrechner rechnen. Das wird ja bei Kommazahlen schon etwas mühseliger.</p>
<p><span class="math display">\[
weight \sim 66.3 + 188 \cdot \left(\cfrac{age}{10}\right)^{2}
\]</span></p>
<p>Dann können wir die Funktion auch schon in R übersetzen. Wir machen eigentlich nichts anderes als das wir das <span class="math inline">\(age\)</span> durch durch <span class="math inline">\(x\)</span> ersetzen, was generischer ist. Und wir brauchen diese Art der Darstellung dann auch in <code>ggplot()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>age_func <span class="ot">&lt;-</span> \(x) {<span class="fl">66.3</span> <span class="sc">+</span> <span class="dv">188</span> <span class="sc">*</span> (x<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#fig-nls-mfp-1" class="quarto-xref">Abbildung&nbsp;<span>58.20</span></a> sehen wir einmal das Ergebnis der Anpassung. Ich habe hier einmal beides gemacht, einmal mit der Funktion <code>geom_function()</code> und einmal mit <code>geom_line()</code> und <code>predict()</code>. So kannst du mal sehen, dass wir hier das gleiche rauskriegen. Die erste Variante ist eben die bessere, wenn du auch die mathematische Gleichung angeben wilst. Dann bist du dir sicher, dass auch die Gleichung zu der angepassten Kurve passt.</p>
<div class="cell" data-layout-nrow="1" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> age_func, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(mfp_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-nls-mfp-1" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-mfp-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-nls-mfp-1" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-nls-mfp-1-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-nls-mfp-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-mfp-1-1.png" class="lightbox" data-gallery="fig-nls-mfp-1" data-glightbox="description: .lightbox-desc-21"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-mfp-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-nls-mfp-1" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-nls-mfp-1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) … mit <code>geom_function()</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-nls-mfp-1" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-nls-mfp-1-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-nls-mfp-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-mfp-1-2.png" class="lightbox" data-gallery="fig-nls-mfp-1" data-glightbox="description: .lightbox-desc-22"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-mfp-1-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-nls-mfp-1" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-nls-mfp-1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) … mit <code>geom_line()</code> und <code>predict()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-mfp-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.20— Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung nach der Funktion <code>mfp()</code>. Die geschätzten Kurven sind natürlich in beiden Fälle die gleichen Kurven. Es geht hier um die Form der Umsetzung in <code>{ggplot}</code>.
</figcaption>
</figure>
</div>
</div>
<p>Und welche der beiden mathematischen Gleichungen ist denn nun besser? Dafür fitten wir nochmal das <code>nls()</code> Modell von oben und vergleichen das Modell einmal zu dem <code>mfp()</code>-Modell von eben.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>nls_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">1</span>, <span class="at">b1 =</span> <span class="dv">1</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In der <a href="#tbl-model-comp-nls-mfp" class="quarto-xref">Tabelle&nbsp;<span>58.4</span></a> sehen wir die Funktion <code>modelsummary()</code> und den entsprechenden Modellvergleich der beiden Modelle zu Anpassung einer nicht-linearen Regression. Welche der beiden Modelle und damit mathematischen Gleichungen beschreibt unsere Daten besser? Leider ist es so, dass wir aus dem <code>nls()</code>-Modell nicht so viele Informationen erhalten wie es zu wünschen wäre. Wir könnten das AIC als Kriterium nehmen und da gilt, dass ein kleineres AIC besser ist, nehmen wir das <code>mfp()</code>-Modell.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">lst</span>(<span class="st">"nls Modell"</span> <span class="ot">=</span> nls_fit,</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"mfp Modell"</span> <span class="ot">=</span> mfp_fit))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-model-comp-nls-mfp" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-comp-nls-mfp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;58.4— Modellvergleich für das <code>nls()</code> Modell mit dem <code>mfp()</code> Modell. Wir vergleichen hier nur die beiden Modelle, da beide Modelle eine mathematische Gleichung wiedergeben, die wir dann berichten können.
</figcaption>
<div aria-describedby="tbl-model-comp-nls-mfp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
 

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinytable_2xfdzd86wd7knxntoi4e</title>
    <style>
.table td.tinytable_css_4jdu9k4uoljttp0qnjlr, .table th.tinytable_css_4jdu9k4uoljttp0qnjlr {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_22jvzahsw36xay2g68hb, .table th.tinytable_css_22jvzahsw36xay2g68hb {    text-align: left; }
.table td.tinytable_css_erbbu6h89yzr1twztnpi, .table th.tinytable_css_erbbu6h89yzr1twztnpi {    text-align: center; }
.table td.tinytable_css_6ndqrcmzv8cq9sc6as70, .table th.tinytable_css_6ndqrcmzv8cq9sc6as70 {    text-align: center; }
.table td.tinytable_css_qzcoe5p2z0g7f8mgewke, .table th.tinytable_css_qzcoe5p2z0g7f8mgewke {    border-bottom: solid 0.05em black; }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
  

  
    <div class="container">
      <table class="table table-borderless" id="tinytable_2xfdzd86wd7knxntoi4e" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">nls Modell</th>
                <th scope="col">mfp Modell</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>b0           </td>
                  <td>92.198              </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(8.319)             </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>b1           </td>
                  <td>2.178               </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.002)             </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>(Intercept)  </td>
                  <td>                    </td>
                  <td>66.300   </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>                    </td>
                  <td>(8.229)  </td>
                </tr>
                <tr>
                  <td>I((age/10)^2)</td>
                  <td>                    </td>
                  <td>188.226  </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>                    </td>
                  <td>(1.520)  </td>
                </tr>
                <tr>
                  <td>Num.Obs.     </td>
                  <td>318                 </td>
                  <td>318      </td>
                </tr>
                <tr>
                  <td>R2           </td>
                  <td>                    </td>
                  <td>0.980    </td>
                </tr>
                <tr>
                  <td>AIC          </td>
                  <td>3963.3              </td>
                  <td>3934.1   </td>
                </tr>
                <tr>
                  <td>BIC          </td>
                  <td>3974.6              </td>
                  <td>3945.4   </td>
                </tr>
                <tr>
                  <td>Log.Lik.     </td>
                  <td>-1978.632           </td>
                  <td>-1964.050</td>
                </tr>
                <tr>
                  <td>RMSE         </td>
                  <td>                    </td>
                  <td>116.43   </td>
                </tr>
                <tr>
                  <td>isConv       </td>
                  <td>TRUE                </td>
                  <td>         </td>
                </tr>
                <tr>
                  <td>finTol       </td>
                  <td>3.25578530276516e-08</td>
                  <td>         </td>
                </tr>
        </tbody>
      </table>
    </div>

    <script>
      function styleCell_tinytable_r0xfkd9wmu1wi9ozajms(i, j, css_id) {
        var table = document.getElementById("tinytable_2xfdzd86wd7knxntoi4e");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_2xfdzd86wd7knxntoi4e');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_r0xfkd9wmu1wi9ozajms(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_2xfdzd86wd7knxntoi4e");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(0, 0, 'tinytable_css_4jdu9k4uoljttp0qnjlr') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(0, 1, 'tinytable_css_4jdu9k4uoljttp0qnjlr') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(0, 2, 'tinytable_css_4jdu9k4uoljttp0qnjlr') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(0, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(1, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(2, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(3, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(4, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(5, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(6, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(7, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(8, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(9, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(10, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(11, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(12, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(13, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(14, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(15, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(16, 0, 'tinytable_css_22jvzahsw36xay2g68hb') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(0, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(1, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(2, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(3, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(4, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(5, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(6, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(7, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(8, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(9, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(10, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(11, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(12, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(13, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(14, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(15, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(16, 1, 'tinytable_css_erbbu6h89yzr1twztnpi') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(0, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(1, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(2, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(3, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(4, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(5, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(6, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(7, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(8, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(9, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(10, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(11, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(12, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(13, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(14, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(15, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(16, 2, 'tinytable_css_6ndqrcmzv8cq9sc6as70') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(8, 0, 'tinytable_css_qzcoe5p2z0g7f8mgewke') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(8, 1, 'tinytable_css_qzcoe5p2z0g7f8mgewke') })
window.addEventListener('load', function () { styleCell_tinytable_r0xfkd9wmu1wi9ozajms(8, 2, 'tinytable_css_qzcoe5p2z0g7f8mgewke') })
    </script>

  


</div>
</div>
</figure>
</div>
</div>
<p>Und am Ende nochmal, wie gut war die Anpassung des Modells an die Daten<em>punkte</em> eigentlich? Hier können wir dann wieder das Bestimmtheitsmaß <span class="math inline">\(R^2\)</span> nutzen. Wie immer siehst du Bestimmtheitsmaß <span class="math inline">\(R^2\)</span> auch in der <code>summary()</code> aber hier dann einmal als direkter Aufruf.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>mfp_fit <span class="sc">|&gt;</span> <span class="fu">r2</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.980</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>nls_fit <span class="sc">|&gt;</span> <span class="fu">r2</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  R2: 0.978</code></pre>
</div>
</div>
<p>Da sich jetzt die beiden Bestimmtheitsmaße <span class="math inline">\(R^2\)</span> wirklich nicht unterscheiden, ist es wohl eher eine Frage des Geschmacks, welche mathematische Formel besser passt. In unserem Beispiel sind ja auch die eher jüngeren Hühner das Problem und nicht so die etwas älteren Hühner. Aber diese Frage lasse ich dann mal offen, du kannst oben die <code>map()</code> Funktion auch mit <code>mfp()</code> laufen lassen.</p>
</section>
<section id="generalized-additive-models-gam-mit-mgcv" class="level2" data-number="58.6">
<h2 data-number="58.6" class="anchored" data-anchor-id="generalized-additive-models-gam-mit-mgcv"><span class="header-section-number">58.6</span> Generalized Additive Models (GAM) mit <code>{mgcv}</code></h2>
<p>Neben den Modellen, die uns eine mathematische Funktion wiedergeben, gibt es natürlich noch Modelle, die effizienter und besser sind. Diese Effizienz und bessere Modellanpassung bezahlen wir dann aber mit der schwierigeren Darstellbarkeit als Formel. Wenn du also ein Modell anpassen willst, was sehr gut durch Punkte läuft und dann dieses Modell nutzen willst um zukünftige Werte vorherzusagen, dann kannst du <a href="https://m-clark.github.io/generalized-additive-models/">Generalized Additive Models</a> (abk. <em>GAM</em>) nutzen. Du erhälst aber keine Formel wieder sondern das Modell liegt dann als Objekt in R vor. Damit kannst du dann arbeiten und Prognosen rechnen aber keine Formel in deine Abbildung schreiben. Es gibt zu GAM einmal das gute Tutorium <a href="https://www.stat.cmu.edu/~cshalizi/ADAfaEPoV/">Advanced Data Analysis from an Elementary Point of View</a> sowie das <a href="https://gavinsimpson.github.io/gratia/">R Paket {gratia}</a>, welches bei der Darstellung von einem GAM-Modell hilft. Aber nochmal, wenn du eine Formel in deine Abbildung schreiben willst, dann ist das <em>Generalized Additive Model</em> nicht die Antwort auf deine Frage. Selbst wenn ein GAM das beste Modell sein sollte, was du findest. Die Hilfeseite <a href="https://www.r-bloggers.com/2021/03/how-to-solve-common-problems-with-gams/">How to solve common problems with GAMs</a> ist auch ein guter Anlaufpunkt, wenn mal eine GAM_modellierung nicht funktionieren will.</p>
<p>Wenn wir jetzt ein GAM rechnen wollen, dann müssen wir einmal über die Funktion <code>s()</code> dem GAM mitteilen, welcher der variablen als Polynom in das Modell rein soll. Das ist sehr ähnlich dem <code>mfp</code>-Modell und der Funktion <code>fp()</code>. Wie immer kannst du der Funktion <code>s()</code> noch zusätzliche Informationen mitgeben aber das übersteigt diese Einführung hier.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>gam_fit <span class="ot">&lt;-</span> <span class="fu">gam</span>(weight <span class="sc">~</span> <span class="fu">s</span>(age), <span class="at">data =</span> chicken_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Und dann können wir uns auch schon die Modellgüte des GAM einmal anschauen. Das ist eigentlich das Schöne der Implementierung in dem R Paket <code>{mgvc}</code>, dass wir hier auch alle Helferfunktionen der anderen Pakete nutzen können.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>gam_fit <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_performance</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC      |     AICc |      BIC |    R2 |    RMSE |   Sigma
----------------------------------------------------------
3932.049 | 3932.316 | 3954.467 | 0.980 | 114.984 | 115.891</code></pre>
</div>
</div>
<p>Wir sehen auch hier, dass wir ein sehr gutes Modell mit einem Bestimmtheitsmaße <span class="math inline">\(R^2\)</span> von <span class="math inline">\(98\%\)</span>. Wir könnten uns auch die Modellkoeffizienten anschauen, aber leider kriegen wir hier nur die Information, ob der Intercept signifikant unterschiedliche von der Null ist und ob wir einen signifikanten Anstieg haben. Beides ist zwar nett, aber interessiert uns eher nicht in unsere Fragestellungen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>gam_fit <span class="sc">|&gt;</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter   | Coefficient |   SE |           95% CI | t(313.04) |      p
------------------------------------------------------------------------
(Intercept) |      683.11 | 6.50 | [670.32, 695.89] |    105.11 | &lt; .001

# Smooth Terms

Parameter         |       F |   df |      p
-------------------------------------------
Smooth term (age) | 3229.85 | 3.96 | &lt; .001</code></pre>
</div>
</div>
<p>Dann können wir auch in der <a href="#fig-nls-gam-1" class="quarto-xref">Abbildung&nbsp;<span>58.21</span></a> einmal das Modell sehen. Wir sehen, dass wir eine sehr gute Modellanpassung haben. Wir können also das Modell gut nutzen um das Gewicht von zukünftigen Hünchen zu schätzen. Eine mathematische Formel erhalten wir aber nicht.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(gam_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-gam-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-gam-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-gam-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23" data-glightbox="description: .lightbox-desc-23"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-gam-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-gam-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.21— Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Dann machen wir das auch gleich mal in dem wir uns drei Hühnchen mit einem Alter von 10, 20 und 30 Tagen vorgeben. Wir wollen jetzt das Gewicht der drei Hühnchen vorhersagen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>test_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dafür können wir dann die Funktion <code>predict()</code> nutzen in der wir dann zum einen unser Modell <code>gam_fit</code> eingeben sowie die Testdaten <code>test_tbl</code> mit den drei Altersangaben für die drei neuen Hühnchen. Wir erhalten dann das vorhergesagt Gewicht an den drei Zeitpunkten. Ob das jetzt sinnvoll ist oder nicht, hängt wie immer von der Fragestellung ab. Hier sei es einfach einmal präsentiert.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(gam_fit, <span class="at">newdata =</span> test_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3 
 276.0335  826.0534 1783.0346 </code></pre>
</div>
</div>
<p>Damit sind wir schon fast durch mit dem ersten Beispiel und GAM. In <code>{ggplot}</code> musst du aber gar nicht den langen Weg gehen, wenn du nur mit GAM eine Kurve in deine Punkte zeichnen willst. Das geht sehr einfach mit der Funktion <code>stat_smooth()</code>. Du hast dann auch dort die Möglichkeit neben GAM auch andere Arten der Anpassung einer Funktion an deine Daten zu wählen.</p>
<p>Als zweites Beispiel wollen wir uns nochmal die Wasserlinsen anschauen und sehen, was passiert, wenn wir weniger Messpunkte auf der <span class="math inline">\(x\)</span>-Achse haben als bei unseren Hühnchendaten. Wenn du zu wenige Beobachtungen auf der <span class="math inline">\(x\)</span>-Achse hast, dann kann das GAM-Modell Probleme bekommen eine Anpassung zu rechnen. Hier hat mir dann die Seite <a href="https://www.r-bloggers.com/2021/03/how-to-solve-common-problems-with-gams/">How to solve common problems with GAMs</a> sehr geholfen. Ich musste einfach die Anzahl an Dimensionen <span class="math inline">\(k\)</span> für den Glättungsterm auf eine niedrigere Zahl setzen. Wenn du also zu wenige Messwerte hast, dann ist das Setzen von <span class="math inline">\(k&lt;5\)</span> eine guter Startpunkt.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>duckweeds_gam_fit <span class="ot">&lt;-</span> <span class="fu">gam</span>(sensor <span class="sc">~</span> <span class="fu">s</span>(duckweeds_density, <span class="at">k =</span> <span class="dv">3</span>), <span class="at">data =</span> duckweeds_tbl)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Dann können wir uns auch schon in der <a href="#fig-nls-ggplot-gam-fit" class="quarto-xref">Abbildung&nbsp;<span>58.22</span></a> die Anpassung der Kurve aus GAM an die Beobachtungen anschauen. Da die Methode keine mathematische Formel oder entaprechende Koeffizienten wiedergibt, müssen wir hier mit der <code>predict()</code> Funktion arbeiten. Das Ergebnis sieht aber sehr gut aus, wir laufen mit der Kurve sehr gut durch die Beobachtungen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(duckweeds_gam_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nls-ggplot-gam-fit" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-ggplot-gam-fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-ggplot-gam-fit-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24" data-glightbox="description: .lightbox-desc-24"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-ggplot-gam-fit-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-ggplot-gam-fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.22— Angepasste Kurve aus der Funktion <code>gam()</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Wenn wir GAM nutzen dann können wir uns auf verschiedenen Wegen ein Konfidenzintervall wiedergeben lassen. Ein Vorhersageintervall ist nur mit sehr viel Arbeit und eigenem Programmieren möglich. Mir was das in dem Tutorium <a href="https://mikl.dk/post/2019-prediction-intervals-for-gam/">Prediction intervals for Generalized Additive Models (GAMs)</a> einfach zu krass. Für mich lohnt es sich nicht auf die Art und Weise ein Vorhersageintervall zu berechnen, da bleibe ich lieber bei den Implementierungen, die es schon gibt. Daher jetzt einmal das Konfidenzintervall aus dem <a href="https://strengejacke.github.io/ggeffects/index.html">R Paket <code>{ggeffects}</code></a>, dem <a href="https://marginaleffects.com/">R Paket <code>{marginaleffects}</code></a> sowie dem <a href="https://gavinsimpson.github.io/gratia/reference/confint.gam.html">R Paket <code>{gratia}</code></a>. Wie immer ist es auch eien Sammlung an Möglichkeiten. Wenn ich entscheiden müsste, dann würde ich das R Paket <code>{marginaleffects}</code> bevorzugen, die Funktionalität ist einfach. Das R Paket <code>{gratia}</code> hat den Vorteil für GAM-Modelle entwickelt zus ein.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Mit <code>{marginaleffects}</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Mit <code>{gratia}</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Mit <code>{ggeffects}</code></a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p>Das R Paket <code>{marginaleffects}</code> erlaubt es ziemlich direkt die vorhergesagten Werte über die Funktion <code>predictions()</code> aus den Daten zu erhalten. Es gibt auch eine Hilfeseite unter <a href="https://marginaleffects.com/vignettes/gam.html">GAM – Estimate a Generalized Additive Model</a>. Wir müssen hier noch etwas aufräumen und die doppelten Werte für die Wasserlinsendichte über die Funktion <code>distinct()</code> entfernen. Wir erhalten hier auch etwas mehr Informationen also wir in den anderen Paekten wiedergegeben kriegen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>marg_pred_tbl <span class="ot">&lt;-</span> <span class="fu">predictions</span>(duckweeds_gam_fit, <span class="at">newdata =</span> duckweeds_tbl) <span class="sc">|&gt;</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(duckweeds_density, sensor, estimate, std.error, conf.low, conf.high) <span class="sc">|&gt;</span> </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>marg_pred_tbl </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  duckweeds_density sensor estimate std.error conf.low conf.high
              &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1               4.8  0.430    0.489    0.0372    0.416     0.562
2              14.5  0.965    0.994    0.0228    0.949     1.04 
3              24.2  1.45     1.43     0.0258    1.38      1.48 
4              33.9  1.72     1.75     0.0257    1.70      1.80 
5              43.5  1.98     1.95     0.0227    1.91      2.00 
6              53.2  2.12     2.09     0.0372    2.02      2.16 </code></pre>
</div>
</div>
<p>Im Folgenden werde ich gleich die Ausgabe <code>marg_pred_tbl</code> nutzen um in dem <code>ggplot</code> die Konfidenzintervalle einmal zu visualisieren. Da wir alle Informationen haben, geht das sehr direkt aus der Funktion heraus.</p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p>Das R Paket <code>{gratia}</code> erlaubt mit der Funktion <code>confint()</code> die Konfidenzintervalle des GAM-Modells zu schätzen. Hier müssen wir dann einiges angeben. Wenn du die Option <code>shift = TRUE</code> vergisst, dann wird nicht der Intercept auf die Konfidenzintervalle addiert und dein Konfidenzintervall liegt dann sauber auf dem Ursprung. Das war super nervig rauszufinden warum das am Anfang so war. Auch heißt es hier mal <code>data</code> statt <code>newdata</code>, aber das war dann schon nicht das Problem mehr. Auch hier schmeiße ich am Ende alle doppelten Wasserlinsendichten aus den Daten mit der Funktion <code>distinct()</code> raus.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>gratia_pred_tbl <span class="ot">&lt;-</span> <span class="fu">confint</span>(duckweeds_gam_fit, <span class="at">parm =</span> <span class="st">"s(duckweeds_density)"</span>, </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">shift =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"confidence"</span>, <span class="at">data =</span> duckweeds_tbl) <span class="sc">|&gt;</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(duckweeds_density, .estimate, .se, .lower_ci, .upper_ci) <span class="sc">|&gt;</span> </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>gratia_pred_tbl </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  duckweeds_density .estimate    .se .lower_ci .upper_ci
              &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1               4.8   -0.961  0.0372   -1.03     -0.888 
2              14.5   -0.456  0.0228   -0.501    -0.412 
3              24.2   -0.0214 0.0258   -0.0719    0.0291
4              33.9    0.298  0.0257    0.248     0.349 
5              43.5    0.502  0.0227    0.457     0.547 
6              53.2    0.638  0.0372    0.565     0.711 </code></pre>
</div>
</div>
<p>Neben der Funktion <code>confint()</code> hat das R Paket noch eine weitreichende Fülle an zusätzlichen Funktionen für die Darstellung von komplexeren GAM-Modellen. Es lohnt sich also auf jeden Fall einmal die <a href="https://gavinsimpson.github.io/gratia/">Hilfeseite von <code>{gratia}</code></a> zu besuchen und mehr über das R Paket zu erfahren, wenn du tiefergreifend mit der Modellierung von GAM’s beginnen willst.</p>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<p>R Paket <code>{ggeffects}</code> liefert mit der Funktion <code>ggpredict()</code> eine super aufgeräumte Funktion um die vorhergesagten Werte von dem Sensor für die Wasserlinsendichte zu erhalten. Dann kriegen wir auch noch ein Konfidenzintervall dazu. Der einzige Manko ist, dass wir die Ausgabe für die weitere Verwertung dann etwas mehr bearbeiten müssen.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>gg_pred_obj <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(duckweeds_gam_fit, <span class="at">terms =</span> <span class="st">"duckweeds_density"</span>) </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>gg_pred_obj</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Predicted values of sensor

duckweeds_density | Predicted |     95% CI
------------------------------------------
             4.80 |      0.49 | 0.41, 0.57
            14.50 |      0.99 | 0.95, 1.04
            24.20 |      1.43 | 1.37, 1.48
            33.90 |      1.75 | 1.69, 1.80
            43.50 |      1.95 | 1.90, 2.00
            53.20 |      2.09 | 2.01, 2.17</code></pre>
</div>
</div>
<p>Wenn du die Ausgabe dann weiter verwenden willst, dann musst du hier noch etwas mehr Arbeit rein stecken und die Ausgabe dann über die Umwandlung in einen <code>tibble</code> weiterverarbeiten.</p>
</div>
</div>
</div>
<p>In der <a href="#fig-gam-duckweed-02" class="quarto-xref">Abbildung&nbsp;<span>58.23</span></a> siehst du dann einmal die angepasste Kurve aus der Funktion <code>gam()</code> zusammen mit dem Konfidenzintervall aus <code>{marginaleffects}</code>. Wenn du oben in den Tabs einmal die Ausgaben aus den Funktionen vergleichst, wirst du feststellen, dass die numerischen Werte alle sehr ähnlich sind. Daher ist es eher eine Geschmacks- und Anwendungsfrage, welches Paket du verwendest. Wenn du viel mit GAM-Modellen rechnest, dann kannst du auch alles sehr gut in der Umgebung des R Paketes <code>{gratia}</code> machen. Die Kurve läuft jedenfalls super durch unser Konfidenzintervall, daher können wir uns ziemlich sicher sein, gute Koeffizienten für das GAM-Modell gefunden zu haben. Wie schon oben geschrieben, an ein mathematisches Modell mit Funktion kommst du in GAM nicht ran. Dafür musst du dann eine andere Implementierung wie <code>nls()</code> oder <code>mfp()</code> nutzen.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(marg_pred_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), <span class="at">fill =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> estimate), <span class="at">color =</span> cb_pal[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-gam-duckweed-02" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gam-duckweed-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-gam-duckweed-02-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25" data-glightbox="description: .lightbox-desc-25"><img src="stat-modeling-non-linear_files/figure-html/fig-gam-duckweed-02-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gam-duckweed-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.23— Angepasste Kurve aus der Funktion <code>gam()</code> zusammen mit dem Konfidenzintervall aus <code>{marginaleffects}</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Gam und Loess in <code>{ggplot}</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <code>{ggplot}</code> können wir direkt über die Funktion <code>stat_smooth()</code> eine Kurve durch unsere Punkte legen. Wenn du mehr Lesen willst, dann empfehle ich einmal das Tutorium zu <a href="https://andrewirwin.github.io/data-visualization/smoothing.html">GAM and LOESS smoothing</a>. Ich gehe hier nicht weiter auf die <a href="https://thomasleeper.com/Rcourse/Tutorials/localregression.html">Local Regression (LOESS)</a> ein, da wir weder ein Bestimmtheitsmaße <span class="math inline">\(R^2\)</span> noch eine mathematische Geradengleichung. Daher lohnt sich aus meiner Sicht die Anwendung der Funktion <code>loess()</code> einfach in der Praxis nicht. für die Visualisierung mag es aber dann doch sinnvoll sein. Damit können wir auch einfach eine GAM oder Loess-Funktion in <code>ggplot()</code> direkt anwenden ohne über zusätzliche Pakete oder Funktionen zu gehen.</p>
<div class="cell" data-layout-nrow="1" data-layout-align="center">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>) <span class="sc">+</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-nls-ggplot-gam" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nls-ggplot-gam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-nls-ggplot-gam" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-nls-ggplot-gam" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-nls-ggplot-gam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="stat-modeling-non-linear_files/figure-html/fig-nls-ggplot-gam-1.png" class="lightbox" data-gallery="fig-nls-ggplot-gam" data-glightbox="description: .lightbox-desc-26"><img src="stat-modeling-non-linear_files/figure-html/fig-nls-ggplot-gam-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-nls-ggplot-gam" width="576"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-nls-ggplot-gam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) GAM
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nls-ggplot-gam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;58.24— Direkte Anwednung von GAM und Loess in <code>ggplot()</code> ohne eine zusätzliche Funktion.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>R Code [zeigen / verbergen]</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="stat-modeling-non-linear_files/figure-html/unnamed-chunk-99-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="stat-modeling-non-linear_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="referenzen" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="referenzen">Referenzen</h2>


<!-- -->

<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">Abbildung&nbsp;58.1— Ursprüngliche Abbildung, die nachgebaut werden soll. Eine nicht-lineare Regressionen mit der jeweiligen Regressionsgleichung und dem Bestimmtheitsmaß <span class="math inline">\(R^2\)</span>.</span>
<span class="glightbox-desc lightbox-desc-2">Abbildung&nbsp;58.2— Visualisierung der nicht-linearen Regression mit einem Polynom aus der Funkion <code>nls()</code>.</span>
<span class="glightbox-desc lightbox-desc-3">Abbildung&nbsp;58.3— Visualisierung der nicht-linearen Regression auf einem erweiterten Wertebereich von <span class="math inline">\(x\)</span> mit einer exponentiellen Funktion mit <code>nls()</code> in Orange sowie der algorithmisch erstellten Funktion aus dem R Paket <code>{mfp}</code> in Dunkelgrün. Die graue Funktion stellt die ursprüngliche Funktion aus einem Polynom über den gesamten Wertebereich dar.</span>
<span class="glightbox-desc lightbox-desc-4">Abbildung&nbsp;58.4— Ursprüngliche Abbildung, die nachgebaut werden soll. Zwei nicht-lineare Regession laufen durch Mittelwert plus/minus Standardabweichung. Im Weiteren sind die Regressionsgleichungen noch ergänzt sowie ein Zielbereich farblich hervorgehoben. Am Ende müssen dann die Achsen noch sauber beschriftet werden.</span>
<span class="glightbox-desc lightbox-desc-5">Abbildung&nbsp;58.5— Darstellung der beiden Regressionsgleichungen für <span class="math inline">\(KI\)</span> und <span class="math inline">\(KIO_3\)</span>.</span>
<span class="glightbox-desc lightbox-desc-6">Abbildung&nbsp;58.6— Einmal die komplexe Abbildung der nicht-linearen Regression in <code>ggplot</code> nachgebaut. Am Ende wurde es dann doch noch eine Legende und keine Beschriftung.</span>
<span class="glightbox-desc lightbox-desc-7">Abbildung&nbsp;58.7— Ursprüngliche Abbildung, die nachgebaut werden soll. Zwei nicht-lineare Regession mit zwei <span class="math inline">\(y\)</span>-Achsen.</span>
<span class="glightbox-desc lightbox-desc-8">Abbildung&nbsp;58.8— Einmal die komplexe Abbildung der nicht-linearen Regression in <code>ggplot</code> nachgebaut. Für beide Quellen Nadeln und Boden wurde jewiels eine eigene <span class="math inline">\(y\)</span>-Achse erstellt. Die Regressionsgleichungen aus der Orginalabbildung entsprechen nicht den Werten hier in der Abbildung.</span>
<span class="glightbox-desc lightbox-desc-9">Abbildung&nbsp;58.9&nbsp;(a)— Ohne transformierten <span class="math inline">\(y\)</span>.</span>
<span class="glightbox-desc lightbox-desc-10">Abbildung&nbsp;58.9&nbsp;(b)— Mit <span class="math inline">\(log\)</span>-transformierten <span class="math inline">\(y\)</span>.</span>
<span class="glightbox-desc lightbox-desc-11">Abbildung&nbsp;58.10— Visualisierung der Sensorwerte nach Wasserlinsendichte. Pro Dichtewert liegen drei Sensormessungen vor.</span>
<span class="glightbox-desc lightbox-desc-12">Abbildung&nbsp;58.11— Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung.</span>
<span class="glightbox-desc lightbox-desc-13">Abbildung&nbsp;58.12— Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung aufgeteilt nach vier Altersgruppen.</span>
<span class="glightbox-desc lightbox-desc-14">Abbildung&nbsp;58.13— Angepasste Kurve aus der Funktion <code>nls()</code> dargestellt mit der Funktion <code>geom_function()</code>.</span>
<span class="glightbox-desc lightbox-desc-15">Abbildung&nbsp;58.14— Angepasste Kurve aus der Funktion <code>nls()</code> dargestellt mit der Funktion <code>geom_line()</code> und <code>predict()</code>.</span>
<span class="glightbox-desc lightbox-desc-16">Abbildung&nbsp;58.15— Angepasste Kurve aus der Funktion <code>nls()</code> zusammen mit dem Vorhersageintervall.</span>
<span class="glightbox-desc lightbox-desc-17">Abbildung&nbsp;58.16— Angepasste Kurve aus der Funktion <code>nls()</code> zusammen mit dem Konfidenzintervall.</span>
<span class="glightbox-desc lightbox-desc-18">Abbildung&nbsp;58.17— Visualisierung der Sterberate von Blattläusen nach Aufbringen eines Bio-Pestizides mit der nicht-linearen Regressionsgleichung.</span>
<span class="glightbox-desc lightbox-desc-19">Abbildung&nbsp;58.18— Visualisierung der Geschwindigkeit <span class="math inline">\(v\)</span> des Enzyms saure Phosphatase bei verschiedenen Konzentrationen des Substrats Nitrophenolphosphat.</span>
<span class="glightbox-desc lightbox-desc-20">Abbildung&nbsp;58.19— Visualisierung der Michaelis-Menten-Kinetik zusammen mit der gefitteten Gerade aus einer nicht-linearen Regression.</span>
<span class="glightbox-desc lightbox-desc-21">Abbildung&nbsp;58.20&nbsp;(a)— … mit <code>geom_function()</code></span>
<span class="glightbox-desc lightbox-desc-22">Abbildung&nbsp;58.20&nbsp;(b)— … mit <code>geom_line()</code> und <code>predict()</code></span>
<span class="glightbox-desc lightbox-desc-23">Abbildung&nbsp;58.21— Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung.</span>
<span class="glightbox-desc lightbox-desc-24">Abbildung&nbsp;58.22— Angepasste Kurve aus der Funktion <code>gam()</code>.</span>
<span class="glightbox-desc lightbox-desc-25">Abbildung&nbsp;58.23— Angepasste Kurve aus der Funktion <code>gam()</code> zusammen mit dem Konfidenzintervall aus <code>{marginaleffects}</code>.</span>
<span class="glightbox-desc lightbox-desc-26">Abbildung&nbsp;58.24&nbsp;(a)— GAM</span>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-archontoulis2015nonlinear" class="csl-entry" role="listitem">
Archontoulis SV, Miguez FE. 2015. Nonlinear regression models and applications in agricultural research. Agronomy Journal 107: 786–798.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./stat-modeling-gee.html" class="pagination-link" aria-label="Generalized Estimating Equations (GEE)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">Generalized Estimating Equations (GEE)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./stat-modeling-robust-quantile.html" class="pagination-link" aria-label="Robuste und Quantilesregression">
        <span class="nav-page-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">Robuste und Quantilesregression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Quellcode</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb142" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Nicht lineare Regression {#sec-non-linear}</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, readxl, knitr, kableExtra, see, latex2exp, mfp)</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>cb_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, </span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>*Letzte Änderung am `r format(fs::file_info("stat-modeling-non-linear.qmd")$modification_time, '%d. %B %Y um %H:%M:%S')`*</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *"And you may ask yourself; Well... How did I get here?; And you may ask yourself; 'How do I work this?'" --- Talking Heads - Once in a Lifetime*</span></span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>Was wollen wir mit der nicht-linearen Regression erreichen? Zum einen erhalten wir durch die nicht-lineare Regression die Möglichkeit auch Abhängigkeiten zu modellieren, die nicht linear sind. Zum anderen wollen wir auch nicht nur Gruppen miteinander vergleichen, sondern auch Verläufe modellieren. Häufig sind diese Verläufe über die Zeit nicht linear. Es gibt Sättigungskurven oder aber auch einen exponentiellen Verfall oder ein exponentielles Wachstum. All dies können wir mit nicht-linearen Modellen abbilden und modellieren. Für Zeitreihen habe ich dann noch ein eigenes Kapitel geschrieben, hier wollen wir uns dann mal mit den Verläufen beschäftigen und schauen, dass wir die Koeffizienten einer Geradengleichung erhalten.</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>Wichtig hierbei ist, dass wir oft nicht statistisch Testen, sondern ein Modell haben wollen, dass die Punkte gut beschreibt. Mit Modell meinen wir hier die Gerade, die durch die Punkte läuft. Für diese Grade wollen wir die Koeffizienten schätzen also rausfinden, wie wir später die Gerade zeichnen könnten, wenn wir die Punkte nicht vorliegen hätten. Also die Frage beantworten, wie $y$ nicht-linear von $x$ abhängt. Wir immer gibt es eine Reihe von Möglichkeiten das Problem zu lösen einer Geradengleichung zu erhalten, die nicht linear ist. Normalerweise haben wir ja eine Regressionsgleichung für eine simple lineare Regression in der folgenden Form vorliegen.</span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>y \sim \beta_0 + \beta_1 \cdot x</span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>Wenn wir jetzt aber eine nicht-lineare Regression rechnen wollen, dann müssen wir hier zum Beispiel ein Polynom einfügen. Damit schreiben wir nicht mehr $x$ sondern $x^b$ und erhalten folgende, beispielhafte Formel. Warum beispielhaft? Je nach Fragestellung brauchen wir verschiedene Parameter die wir dann für den Kurvenverlauf bestimmen müssen.</span>
<span id="cb142-25"><a href="#cb142-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-26"><a href="#cb142-26" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-27"><a href="#cb142-27" aria-hidden="true" tabindex="-1"></a>y \sim \beta_0 + \beta_1 \cdot x^b</span>
<span id="cb142-28"><a href="#cb142-28" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-29"><a href="#cb142-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-30"><a href="#cb142-30" aria-hidden="true" tabindex="-1"></a>Dieses $b$ (eng. *power*) und die anderen Koeffizienten müssen wir jetzt irgendwie berechnen. Manchmal fällt das $\beta_1$ dann auch weg oder aber wir haben eben eine noch komplexere Art der mathematischen Darstellung. Wir gehen daher hier dann mal verschiedene Lösungen für das Problem durch. Nicht alle Lösungen liefern auch eine Geradengleichung, die du dann auch aufschreiben kannst.</span>
<span id="cb142-31"><a href="#cb142-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-32"><a href="#cb142-32" aria-hidden="true" tabindex="-1"></a>Und damit kommen wir auch zu dem zentralen Problem. Woher weiß ich, welche Gerade oder Kurve ich berechnen will? Eine super Hilfestellung liefert die Seite <span class="co">[</span><span class="ot">A collection of self-starters for nonlinear regression in R</span><span class="co">](https://www.statforbiology.com/2020/stat_nls_usefulfunctions/)</span>. Dort kannst du einmal schauen, welche Funktionen es gibt, die du dann zum Beispiel in <span class="in">`nls()`</span> aus dem R Paket <span class="in">`{stats}`</span> modellieren kannst. Das R Paket <span class="in">`{stats}`</span> kommt gleich mit R mit und muss nicht installiert werden. Mit Modellieren meine ich dann, die Gradenfunktion bestimmen kannst. Die richtige Startfunktion zu finden ist aber wirklich nicht trivial. Dafür gibt es dann aber mit dem R Paket <span class="in">`{mfp}`</span> eine Lösung, dafür kann das Paket dann andere Sachen nicht. Schau dich also einmal um und entscheide, was du brauchst um deine Fragestellung zu beantworten.</span>
<span id="cb142-33"><a href="#cb142-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-34"><a href="#cb142-34" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb142-35"><a href="#cb142-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Weitere Tutorien für die Analyse von nicht-linearen Daten</span></span>
<span id="cb142-36"><a href="#cb142-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-37"><a href="#cb142-37" aria-hidden="true" tabindex="-1"></a>Wie immer gibt es auch für die Frage nach dem Tutorium für die nicht-lineare Regression verschiedene Quellen. Ich kann noch folgende Informationen und Hilfen empfehlen.</span>
<span id="cb142-38"><a href="#cb142-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-39"><a href="#cb142-39" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Das R Paket <span class="in">`{nlraa}`</span> ist direkt für die Nutzung in den Agrarwissenschaften ausgelegt. Es finden sich auf der Hilfseite <span class="co">[</span><span class="ot">nlraa: An R package for Nonlinear Regression Applications in Agricultural Research</span><span class="co">](https://cran.r-project.org/web/packages/nlraa/vignettes/nlraa.html)</span> auch komplexere Beispiele für die Modellierung von Daten.</span>
<span id="cb142-40"><a href="#cb142-40" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Die Autoren @archontoulis2015nonlinear mit der wissenschaftlichen Veröffentlichung <span class="co">[</span><span class="ot">Nonlinear Regression Models and Applications in Agricultural Research</span><span class="co">](https://acsess.onlinelibrary.wiley.com/doi/pdf/10.2134/agronj2012.0506)</span> liefern nochmal einen wunderbaren Überblick über die Möglichkeiten der nicht-linearen Regression in den Agrarwissenschaften.</span>
<span id="cb142-41"><a href="#cb142-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Wenn es einfach nur eine Kurve durch die Punkte sein soll ohne eine mathematische Gleichung, dann kann das Tutorium zu <span class="co">[</span><span class="ot">GAM and LOESS smoothing</span><span class="co">](https://andrewirwin.github.io/data-visualization/smoothing.html)</span> helfen. Denn weder GAM noch LOESS liefern eine Gleichung die du aufschreiben kannst, dafür sehr gute Anpassungen an Punkte.</span>
<span id="cb142-42"><a href="#cb142-42" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Wie schon erwähnt, konzentrieren wir uns hier auf ein paar zentrale Pakete in R. Wir immer gibt es aber auch hier noch mehr wie bei dem Tutorium <span class="co">[</span><span class="ot">Nonlinear Modelling using nls, nlme and brms</span><span class="co">](https://www.granvillematheson.com/post/nonlinear-modelling-using-nls-nlme-and-brms/)</span>. Du musst dann mal rechts und links schauen, auch für mich ist das ja eine Linksammlung zu der ich dann mal zurückkehre.</span>
<span id="cb142-43"><a href="#cb142-43" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Der Blogeintrag <span class="co">[</span><span class="ot">On curve fitting using R</span><span class="co">](https://davetang.org/muse/2013/05/09/on-curve-fitting/)</span> liefert nochmal die Lösung Daten mit der Funktion <span class="in">`poly()`</span> in der Funktion <span class="in">`lm()`</span> zu modellieren. Ich habe jetzt darauf verzichtet, da das Kapitel schon sehr voll war. Es spricht aber nichts dagegen, ein Problem der nicht linearen Regression mit einem Polinom zu lösen.</span>
<span id="cb142-44"><a href="#cb142-44" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-45"><a href="#cb142-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-46"><a href="#cb142-46" aria-hidden="true" tabindex="-1"></a>Schaue dir auch die folgenden Zerforschenbeispiele einmal an, wenn dich mehr zu dem Thema der Abbildung von nicht-linearen Regressionen interessiert. Du findest in den Kästen Beispiele für Posterabbildungen zur nicht-linearen Regression, die ich dann zerforscht habe. Dann habe ich auch noch gleich die nicht-lineare Regression gerechnet um die Geradengleichungen sauber darzustellen.</span>
<span id="cb142-47"><a href="#cb142-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-48"><a href="#cb142-48" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb142-49"><a href="#cb142-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Zerforschen: Nicht-lineare Regression</span></span>
<span id="cb142-50"><a href="#cb142-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-51"><a href="#cb142-51" aria-hidden="true" tabindex="-1"></a>{{&lt; include zerforschen/zerforschen-non-linear-simple.qmd &gt;}}</span>
<span id="cb142-52"><a href="#cb142-52" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-53"><a href="#cb142-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-54"><a href="#cb142-54" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb142-55"><a href="#cb142-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Zerforschen: Nicht-lineare Regression mit Zielbereich</span></span>
<span id="cb142-56"><a href="#cb142-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-57"><a href="#cb142-57" aria-hidden="true" tabindex="-1"></a>{{&lt; include zerforschen/zerforschen-non-linear-target.qmd &gt;}}</span>
<span id="cb142-58"><a href="#cb142-58" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-59"><a href="#cb142-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-60"><a href="#cb142-60" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb142-61"><a href="#cb142-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## Zerforschen: Nicht-lineare Regression und zwei $\boldsymbol{y}$-Achsen</span></span>
<span id="cb142-62"><a href="#cb142-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-63"><a href="#cb142-63" aria-hidden="true" tabindex="-1"></a>{{&lt; include zerforschen/zerforschen-non-linear-2axis.qmd &gt;}}</span>
<span id="cb142-64"><a href="#cb142-64" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-65"><a href="#cb142-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-66"><a href="#cb142-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## Genutzte R Pakete</span></span>
<span id="cb142-67"><a href="#cb142-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-68"><a href="#cb142-68" aria-hidden="true" tabindex="-1"></a>Wir wollen folgende R Pakete in diesem Kapitel nutzen.</span>
<span id="cb142-69"><a href="#cb142-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-72"><a href="#cb142-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-73"><a href="#cb142-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-74"><a href="#cb142-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-75"><a href="#cb142-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-76"><a href="#cb142-76" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, magrittr, broom, nlraa, modelsummary,</span>
<span id="cb142-77"><a href="#cb142-77" aria-hidden="true" tabindex="-1"></a>               parameters, performance, see, mgcv, mfp, marginaleffects,</span>
<span id="cb142-78"><a href="#cb142-78" aria-hidden="true" tabindex="-1"></a>               gratia, readxl, nlstools, janitor, ggeffects, nls.multstart,</span>
<span id="cb142-79"><a href="#cb142-79" aria-hidden="true" tabindex="-1"></a>               conflicted)</span>
<span id="cb142-80"><a href="#cb142-80" aria-hidden="true" tabindex="-1"></a>cb_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, </span>
<span id="cb142-81"><a href="#cb142-81" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</span>
<span id="cb142-82"><a href="#cb142-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-83"><a href="#cb142-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-84"><a href="#cb142-84" aria-hidden="true" tabindex="-1"></a>An der Seite des Kapitels findest du den Link *Quellcode anzeigen*, über den du Zugang zum gesamten R-Code dieses Kapitels erhältst.</span>
<span id="cb142-85"><a href="#cb142-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-86"><a href="#cb142-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Daten</span></span>
<span id="cb142-87"><a href="#cb142-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-88"><a href="#cb142-88" aria-hidden="true" tabindex="-1"></a>In unserem Datenbeispiel schauen wir uns die Wachstumskurve von Hühnchen an. Wir verfolgen das Gewicht über 36 Tage. Dabei messen wir an jedem Tag eine unterschiedliche Anzahl an Kücken bzw. Hünchen. Wir wissen auch nicht, ob wir immer die gleichen Hühnchen jedes Mal messen. Dafür war die Hühnchenmastanlage zu groß. Wir wissen aber wie alt jedes Hühnchen bei der Messung war.</span>
<span id="cb142-89"><a href="#cb142-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-92"><a href="#cb142-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-93"><a href="#cb142-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-94"><a href="#cb142-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-95"><a href="#cb142-95" aria-hidden="true" tabindex="-1"></a>chicken_tbl <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"data/chicken_growth.csv"</span>)  </span>
<span id="cb142-96"><a href="#cb142-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-97"><a href="#cb142-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-98"><a href="#cb142-98" aria-hidden="true" tabindex="-1"></a>In @tbl-chicken sehen wir nochmal die Daten für die ersten drei und die letzten drei Zeilen. Alleine überschlagsmäßig sehen wir schon, dass wir es nicht mit einem linearen Anstieg des Gewichtes zu tun haben. Wenn wir einen linearen Anstieg hätten, dann würde ein Hühnchen, dass am Tag 1 ca. 48g wiegt, nach 36 Tagen ca. 1728g wiegen. Das ist hier eindeutig nicht der Fall. Wir haben vermutlich einen nicht-linearen Zusammenhang.</span>
<span id="cb142-99"><a href="#cb142-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-102"><a href="#cb142-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-103"><a href="#cb142-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb142-104"><a href="#cb142-104" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-105"><a href="#cb142-105" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-106"><a href="#cb142-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-chicken</span></span>
<span id="cb142-107"><a href="#cb142-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Auszug aus Hühnchendatensatz."</span></span>
<span id="cb142-108"><a href="#cb142-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-109"><a href="#cb142-109" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">head</span>(chicken_tbl, <span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb142-110"><a href="#cb142-110" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="st">"..."</span>, <span class="at">times =</span> <span class="fu">ncol</span>(chicken_tbl)),</span>
<span id="cb142-111"><a href="#cb142-111" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tail</span>(chicken_tbl, <span class="at">n =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb142-112"><a href="#cb142-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="st">"pipe"</span>)</span>
<span id="cb142-113"><a href="#cb142-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-114"><a href="#cb142-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-115"><a href="#cb142-115" aria-hidden="true" tabindex="-1"></a>Schauen wir uns die Daten dann gleich einmal in einer Visualisierung mit <span class="in">`ggplot()`</span> an um besser zu verstehen wie die Zusammenhänge in dem Datensatz sind.</span>
<span id="cb142-116"><a href="#cb142-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-117"><a href="#cb142-117" aria-hidden="true" tabindex="-1"></a>Neben dem Hünchendatensatz haben wir noch einen Datenstatz zu dem Wachstum von Wasserlinsen. Wir haben einmal händisch die Dichte bestimmt <span class="in">`duckweeds_density`</span> und einmal mit einem Sensor gemessen. Dabei sind die Einheiten der Sensorwerte erstmal egal, wir wollen aber später eben nur mit einem Sensor messen und dann auf den Wasserlinsengehalt zurückschließen. Wir haben hier eher eine Sätigungskurve vorliegen, denn die Dichte der Wasserlinsen ist ja von der Oberfläche begrenzt. Auch können sich die Wasserlinsen nicht beliebig teilen, es gibt ja nur eine begrenzte Anzahl an Ressourcen.</span>
<span id="cb142-118"><a href="#cb142-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-121"><a href="#cb142-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-122"><a href="#cb142-122" aria-hidden="true" tabindex="-1"></a>duckweeds_tbl <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/duckweeds_density.xlsx"</span>)</span>
<span id="cb142-123"><a href="#cb142-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-124"><a href="#cb142-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-125"><a href="#cb142-125" aria-hidden="true" tabindex="-1"></a>In der @tbl-duckweeds siehst du dann einmal einen Auszug aus den Daten zu den Wasserlinsen. Es ist ein sehr einfacher Datensatz mit nur zwei Spalten. Wie du siehst, scheint sich das bei der nicht linearen Regression durchzuziehen. Es gehen auch komplexere Modelle, aber dann kann ich die Ergebnisse schlechter visualisieren.</span>
<span id="cb142-126"><a href="#cb142-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-129"><a href="#cb142-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-130"><a href="#cb142-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb142-131"><a href="#cb142-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-132"><a href="#cb142-132" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-133"><a href="#cb142-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-duckweeds</span></span>
<span id="cb142-134"><a href="#cb142-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Auszug aus Wasserlinsendatensatz."</span></span>
<span id="cb142-135"><a href="#cb142-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-136"><a href="#cb142-136" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">head</span>(duckweeds_tbl, <span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb142-137"><a href="#cb142-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="st">"..."</span>, <span class="at">times =</span> <span class="fu">ncol</span>(duckweeds_tbl)),</span>
<span id="cb142-138"><a href="#cb142-138" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tail</span>(duckweeds_tbl, <span class="at">n =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb142-139"><a href="#cb142-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="st">"pipe"</span>)</span>
<span id="cb142-140"><a href="#cb142-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-141"><a href="#cb142-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-142"><a href="#cb142-142" aria-hidden="true" tabindex="-1"></a>Auch die Wasserlinsendaten wollen wir uns erstmal in einer Abbildung anschauen und dann sehen, ob wir eine Kurve durch die Punkte gelegt kriegen.</span>
<span id="cb142-143"><a href="#cb142-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-144"><a href="#cb142-144" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualisierung</span></span>
<span id="cb142-145"><a href="#cb142-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-146"><a href="#cb142-146" aria-hidden="true" tabindex="-1"></a>In @fig-nls-00-1 sehen wir die Visualisierung der Hühnchengewichte nach Alter in Tagen. Zum einen sehen wir wie das Körpergewicht exponentiell ansteigt. Zum anderen sehen wir in @fig-nls-00-2, dass auch eine $log$-transformiertes $y$ nicht zu einem linearen Zusammenhang führt. Der Zusammenhang zwischen dem Körpergewicht und der Lebensalter bleibt nicht-linear.</span>
<span id="cb142-147"><a href="#cb142-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-150"><a href="#cb142-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-151"><a href="#cb142-151" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb142-152"><a href="#cb142-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-153"><a href="#cb142-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb142-154"><a href="#cb142-154" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-00</span></span>
<span id="cb142-155"><a href="#cb142-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-156"><a href="#cb142-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-157"><a href="#cb142-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-158"><a href="#cb142-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Hühnchengewichte nach Alter in Tagen. Auch mit $log$-transformierten Körpergewicht liegt immer noch kein linearer Zusammenhang zwischen dem Lebensalter und dem Körpergewicht vor. "</span></span>
<span id="cb142-159"><a href="#cb142-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb142-160"><a href="#cb142-160" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Ohne transformierten $y$."</span></span>
<span id="cb142-161"><a href="#cb142-161" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Mit $log$-transformierten $y$."</span></span>
<span id="cb142-162"><a href="#cb142-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 1</span></span>
<span id="cb142-163"><a href="#cb142-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb142-164"><a href="#cb142-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-165"><a href="#cb142-165" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-166"><a href="#cb142-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-167"><a href="#cb142-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-168"><a href="#cb142-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Alter der Hühnchen"</span>, <span class="at">y =</span> <span class="st">"Tagesgewicht in [g]"</span>)</span>
<span id="cb142-169"><a href="#cb142-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-170"><a href="#cb142-170" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, <span class="fu">log</span>(weight))) <span class="sc">+</span></span>
<span id="cb142-171"><a href="#cb142-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-172"><a href="#cb142-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-173"><a href="#cb142-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Alter der Hühnchen"</span>, <span class="at">y =</span> <span class="st">"Tagesgewicht in [g]"</span>)</span>
<span id="cb142-174"><a href="#cb142-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-175"><a href="#cb142-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-176"><a href="#cb142-176" aria-hidden="true" tabindex="-1"></a>Deshalb wollen wir den Zusammenhang zwischen dem Körpergewicht der Hühnchen und dem Lebensalter einmal mit einer nicht-linearen Regression modellieren. Wir sind also nicht so sehr an $p$-Werten interessiert, wir sehen ja, dass die gerade ansteigt, sondern wollen wissen wie die Koeffizienten einer möglichen exponentiellen Gleichung aussehen.</span>
<span id="cb142-177"><a href="#cb142-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-178"><a href="#cb142-178" aria-hidden="true" tabindex="-1"></a>Für die Visualisierung der Wasserlinsendaten in der @fig-gam-duckweeds-01 verzichte ich einmal auf die logarithmische Darstellung. Wir wollen hier dann eine Kurve durch die Punkte legen so wie die Daten sind. Auffällig ist erstmal, dass wir sehr viel weniger Beobachtungen und auch Dichtemesspunkte auf der $x$-Achse haben. Wir haben dann zu den jeweiligen Wasserlinsendichten dann drei Sensormessungen. Das könnte noch etwas herausfordernd bei der Modellierung werden.</span>
<span id="cb142-179"><a href="#cb142-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-182"><a href="#cb142-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-183"><a href="#cb142-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-184"><a href="#cb142-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-185"><a href="#cb142-185" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-186"><a href="#cb142-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-gam-duckweeds-01</span></span>
<span id="cb142-187"><a href="#cb142-187" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-188"><a href="#cb142-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-189"><a href="#cb142-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-190"><a href="#cb142-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Sensorwerte nach Wasserlinsendichte. Pro Dichtewert liegen drei Sensormessungen vor."</span></span>
<span id="cb142-191"><a href="#cb142-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-192"><a href="#cb142-192" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb142-193"><a href="#cb142-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-194"><a href="#cb142-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-195"><a href="#cb142-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span>
<span id="cb142-196"><a href="#cb142-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-197"><a href="#cb142-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-198"><a href="#cb142-198" aria-hidden="true" tabindex="-1"></a><span class="fu">## Nonlinear least-squares mit `nls()`</span></span>
<span id="cb142-199"><a href="#cb142-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-200"><a href="#cb142-200" aria-hidden="true" tabindex="-1"></a>Zum nicht-linearen Modellieren nutzen wir die Funktion <span class="in">`nls()`</span> (eng. *nonlinear least-squares*). Die Funktion <span class="in">`nls()`</span> ist das nicht-lineare Äquivalent zu der linearen Funktion <span class="in">`lm()`</span>. Nur müssen wir mit der <span class="in">`nls()`</span> Funktion etwas anders umgehen. Zum einen müssen wir die <span class="in">`formula()`</span> anders definieren. Der große Vorteil von <span class="in">`nls()`</span> ist, dass wir hier auch die Koeffizienten unser Geradengleichung wiederkriegen. In den anderen Möglichkeiten kriegen wir dann teilweise nicht die Informationen zu einer Kurve wieder. Wir haben dann zwar ein wunderbares Modell, können das Modell aber nicht einfach als eine mathematische Gleichung aufschreiben. Daher hier <span class="in">`nls()`</span> etwas ausführlicher, da wir dann mit <span class="in">`nls()`</span> schon die Sachen auch erhalten, die wir meist wollen.</span>
<span id="cb142-201"><a href="#cb142-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-202"><a href="#cb142-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... von Wachstum</span></span>
<span id="cb142-203"><a href="#cb142-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-204"><a href="#cb142-204" aria-hidden="true" tabindex="-1"></a>In unserem Hühnchenbeispiel nehmen ein exponentielles Wachstum an. Daher brauchen wir einen geschätzten Koeffizienten für den Exponenten des Alters sowie einen Intercept. Wir gehen nicht davon aus, dass die Hühnchen mit einem Gewicht von 0g auf die Welt bzw. in die Mastanlage kommen. Unsere Formel sehe dann wie folgt aus.</span>
<span id="cb142-205"><a href="#cb142-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-206"><a href="#cb142-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-207"><a href="#cb142-207" aria-hidden="true" tabindex="-1"></a>weight \sim \beta_0 + age^{\beta_1}</span>
<span id="cb142-208"><a href="#cb142-208" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-209"><a href="#cb142-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-210"><a href="#cb142-210" aria-hidden="true" tabindex="-1"></a>Da wir in R keine $\beta$'s schreiben können nutzen wir die Buchstaben <span class="in">`b0`</span> für $\beta_0$ und <span class="in">`b1`</span> für $\beta_1$. Im Prinzip könnten wir auch andere Buchstaben nehmen, aber so bleiben wir etwas konsistenter zu der linearen Regression. Somit sieht die Gleichung dann in R wie folgt aus.</span>
<span id="cb142-211"><a href="#cb142-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-212"><a href="#cb142-212" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-213"><a href="#cb142-213" aria-hidden="true" tabindex="-1"></a>weight \sim b_0 + age^{b_1}</span>
<span id="cb142-214"><a href="#cb142-214" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-215"><a href="#cb142-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-216"><a href="#cb142-216" aria-hidden="true" tabindex="-1"></a>Wichtig hier, wir müssen R noch mitteilen, dass wir <span class="in">`age`</span> hoch <span class="in">`b1`</span> rechnen wollen. Um das auch wirklich so zu erhalten, zwingen wir R mit der Funktion <span class="in">`I()`</span> auch wirklich einen Exponenten zu berechnen. Wenn wir nicht das <span class="in">`I()`</span> nutzen, dann kann es sein, dass wir aus versehen eine Schreibweise für eine Abkürzung in der <span class="in">`formula`</span> Umgebung nutzen.</span>
<span id="cb142-217"><a href="#cb142-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-218"><a href="#cb142-218" aria-hidden="true" tabindex="-1"></a>Im Weiteren sucht die Funktion iterativ die besten Werte für <span class="in">`b0`</span> und <span class="in">`b1`</span>. Deshalb müssen wir der Funktion <span class="in">`nls()`</span> Startwerte mitgeben, die in etwa passen könnten. Hier tippe ich mal auf ein <span class="in">`b0 = 1`</span> und ein <span class="in">`b1 = 1`</span>. Wenn wir einen Fehler wiedergegeben bekommen, dann können wir auch noch an den Werten drehen.</span>
<span id="cb142-219"><a href="#cb142-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-222"><a href="#cb142-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-223"><a href="#cb142-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb142-224"><a href="#cb142-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-225"><a href="#cb142-225" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb142-226"><a href="#cb142-226" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">1</span>, <span class="at">b1 =</span> <span class="dv">1</span>))</span>
<span id="cb142-227"><a href="#cb142-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-228"><a href="#cb142-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-229"><a href="#cb142-229" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb142-230"><a href="#cb142-230" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bessere Startwerte für `nls()`</span></span>
<span id="cb142-231"><a href="#cb142-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-232"><a href="#cb142-232" aria-hidden="true" tabindex="-1"></a>Leider müssen wir in <span class="in">`nls()`</span> die Startwerte selber raten. Das kannst du natürlich aus der Abbildung der Daten abschätzen, aber ich muss sagen, dass mir das immer sehr schwer fällt. Deshalb gibt es da einen Trick. Wir rechnen ein lineares Modell und zwar logarithmieren wir beide Seiten der Gleichung. Dann können wir die Koeffizienten aus dem Modell als Startwerte nehmen.</span>
<span id="cb142-233"><a href="#cb142-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-236"><a href="#cb142-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-237"><a href="#cb142-237" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> <span class="fu">log</span>(age), chicken_tbl)</span>
<span id="cb142-238"><a href="#cb142-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-239"><a href="#cb142-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-240"><a href="#cb142-240" aria-hidden="true" tabindex="-1"></a>Manchmal musst du auch nur die linke Seite logarithmieren.</span>
<span id="cb142-241"><a href="#cb142-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-244"><a href="#cb142-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-245"><a href="#cb142-245" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb142-246"><a href="#cb142-246" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> age, chicken_tbl)</span>
<span id="cb142-247"><a href="#cb142-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-248"><a href="#cb142-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-249"><a href="#cb142-249" aria-hidden="true" tabindex="-1"></a>Es hängt dann immer etwas vom Modell ab und wie die Werte dann anschließend in <span class="in">`nls()`</span> konvergieren. Ich habe eigentlich immer mit einem der beiden Methoden Startwerte gefunden. Wir nehmen hier mal die Startwerte aus dem ersten Ansatz mit der doppelten Logarithmierung.</span>
<span id="cb142-250"><a href="#cb142-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-251"><a href="#cb142-251" aria-hidden="true" tabindex="-1"></a>Wir erhalten hier für den <span class="in">`Intercept`</span> den Wert 3.475 und für die Steigung den Wert 1.085. Da in meiner obigen Gleichung die Steigung <span class="in">`b1`</span> ist und der <span class="in">`Intercept`</span> dann <span class="in">`b0`</span> setzen wir die Zahlen entsprechend ein. Für den <span class="in">`Intercept`</span> müssen wir dann noch den Exponenten wählen.</span>
<span id="cb142-252"><a href="#cb142-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-255"><a href="#cb142-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-256"><a href="#cb142-256" aria-hidden="true" tabindex="-1"></a><span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb142-257"><a href="#cb142-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="fu">exp</span>(<span class="fl">3.475</span>), <span class="at">b1 =</span> <span class="fl">1.085</span>))</span>
<span id="cb142-258"><a href="#cb142-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-259"><a href="#cb142-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-260"><a href="#cb142-260" aria-hidden="true" tabindex="-1"></a>Jetzt sollten wir keine Fehlermeldung erhalten haben, dass unser Modell nicht konvergiert ist oder anderweitig kein Optimum gefunden hat.</span>
<span id="cb142-261"><a href="#cb142-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-262"><a href="#cb142-262" aria-hidden="true" tabindex="-1"></a>Das <span class="co">[</span><span class="ot">R Paket `{nls.multstart}`</span><span class="co">](https://github.com/padpadpadpad/nls.multstart)</span> versucht das Problem der Startwerte nochmal algorithmisch zu lösen. Wenn du also keine guten Startwerte mit den Trick über <span class="in">`lm()`</span> findest, dann ist das R Paket hier nochmal ein guter Startpunkt. Es geht auch komplexer wie das Tutorium unter <span class="co">[</span><span class="ot">Nonlinear Modelling using nls, nlme and brms</span><span class="co">](https://www.granvillematheson.com/post/nonlinear-modelling-using-nls-nlme-and-brms/)</span> nochmal zeigt.</span>
<span id="cb142-263"><a href="#cb142-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-266"><a href="#cb142-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-267"><a href="#cb142-267" aria-hidden="true" tabindex="-1"></a><span class="fu">nls_multstart</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb142-268"><a href="#cb142-268" aria-hidden="true" tabindex="-1"></a>              <span class="at">lower =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">0</span>, <span class="at">b1 =</span> <span class="dv">0</span>),</span>
<span id="cb142-269"><a href="#cb142-269" aria-hidden="true" tabindex="-1"></a>              <span class="at">upper =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="cn">Inf</span>, <span class="at">b1 =</span> <span class="cn">Inf</span>),</span>
<span id="cb142-270"><a href="#cb142-270" aria-hidden="true" tabindex="-1"></a>              <span class="at">start_lower =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">0</span>, <span class="at">b1 =</span> <span class="dv">0</span>),</span>
<span id="cb142-271"><a href="#cb142-271" aria-hidden="true" tabindex="-1"></a>              <span class="at">start_upper =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">500</span>, <span class="at">b1 =</span> <span class="dv">5</span>),</span>
<span id="cb142-272"><a href="#cb142-272" aria-hidden="true" tabindex="-1"></a>              <span class="at">iter =</span> <span class="dv">500</span>)</span>
<span id="cb142-273"><a href="#cb142-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-274"><a href="#cb142-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-275"><a href="#cb142-275" aria-hidden="true" tabindex="-1"></a>Natürlich kommt hier das Gleiche raus, aber manchmal findet man dann wirklich nicht die passenden Startwerte. Die Funktion macht ja nichts anderes als der ursprünglichen <span class="in">`nls()`</span> Funktion etwas unter die Arme zugreifen.</span>
<span id="cb142-276"><a href="#cb142-276" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-277"><a href="#cb142-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-278"><a href="#cb142-278" aria-hidden="true" tabindex="-1"></a>Wir nutzen wieder die Funktion <span class="in">`model_parameters()`</span> aus dem R Paket <span class="in">`{parameters}`</span> um uns eine aufgeräumte Ausgabe wiedergeben zu lassen.</span>
<span id="cb142-279"><a href="#cb142-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-282"><a href="#cb142-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-283"><a href="#cb142-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-284"><a href="#cb142-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-285"><a href="#cb142-285" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb142-286"><a href="#cb142-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-287"><a href="#cb142-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span>
<span id="cb142-288"><a href="#cb142-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-289"><a href="#cb142-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-290"><a href="#cb142-290" aria-hidden="true" tabindex="-1"></a>Die $p$-Werte interessieren uns nicht weiter. Wir sehen ja, dass wir einen Effekt von dem Alter auf das Körpergewicht haben. Das überrascht auch nicht weiter. Wir wollen ja die Koeffizienten $\beta_0$ und $\beta_1$ um die Gleichung zu vervollständigen. Mit dem Ergebnis aus der Funktion <span class="in">`nls()`</span> können wir jetzt wie folgt schreiben.</span>
<span id="cb142-291"><a href="#cb142-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-292"><a href="#cb142-292" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-293"><a href="#cb142-293" aria-hidden="true" tabindex="-1"></a>weight \sim 92.20 + age^{2.18}</span>
<span id="cb142-294"><a href="#cb142-294" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-295"><a href="#cb142-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-296"><a href="#cb142-296" aria-hidden="true" tabindex="-1"></a>Damit haben wir dann auch unsere nicht-lineare Regressionsgleichung erhalten. Passt den die Gleichung auch zu unseren Daten? Das können wir einfach überprüfen. Dafür müssen wir nur in die Funktion <span class="in">`predict()`</span> unser Objekt des Fits unseres nicht-linearen Modells <span class="in">`fit`</span> stecken und erhalten die vorhergesagten Werte für jedes $x$ in unserem Datensatz. Oder etwas kürzer, wir erhalten die "Gerade" der Funktion mit den Koeffizienten aus dem <span class="in">`nls()`</span> Modell wieder. In @fig-nls-01 sehen wir die gefittete Gerade.</span>
<span id="cb142-297"><a href="#cb142-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-300"><a href="#cb142-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-301"><a href="#cb142-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-302"><a href="#cb142-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-303"><a href="#cb142-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-304"><a href="#cb142-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-01</span></span>
<span id="cb142-305"><a href="#cb142-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-306"><a href="#cb142-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-307"><a href="#cb142-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-308"><a href="#cb142-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung."</span></span>
<span id="cb142-309"><a href="#cb142-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-310"><a href="#cb142-310" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-311"><a href="#cb142-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb142-312"><a href="#cb142-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-313"><a href="#cb142-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-314"><a href="#cb142-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-315"><a href="#cb142-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-316"><a href="#cb142-316" aria-hidden="true" tabindex="-1"></a>Wie wir erkennen können sieht die Modellierung einigermaßen gut aus. Wir haben zwar einige leichte Abweichungen von den Beobachtungen zu der geschätzten Geraden, aber im Prinzip könnten wir mit der Modellierung leben. Wir hätten jetzt also eine nicht-lineare Gleichung die den Zusammenhang zwischen Körpergewicht und Lebensalter von Hühnchen beschreibt. Die Verwendung von <span class="in">`nest()`</span> und <span class="in">`map()`</span> ist schon erweiterete Programmierung in R. Du findest hier mehr über <span class="co">[</span><span class="ot">broom and dplyr</span><span class="co">](https://cran.r-project.org/web/packages/broom/vignettes/broom_and_dplyr.html)</span> und die Anwendung auf mehrere Datensätze.</span>
<span id="cb142-317"><a href="#cb142-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-318"><a href="#cb142-318" aria-hidden="true" tabindex="-1"></a>Nun könnte man argumentieren, dass wir vielleicht unterschiedliche Abschnitte des Wachstums vorliegen haben. Also werden wir einmal das Alter in Tagen in vier gleich große Teile mit der Funktion <span class="in">`cut_number()`</span> schneiden. Beachte bitte, dass in jeder Gruppe gleich viele Beobachtungen sind. Du kannst sonst händisch über <span class="in">`case_when()`</span> innerhalb von <span class="in">`mutate()`</span> dir eigene Gruppen bauen. Wir nutzen auch die Funktion <span class="in">`map()`</span> um über alle Subgruppen des Datensatzes dann ein <span class="in">`nls()`</span> laufen zu lassen.</span>
<span id="cb142-319"><a href="#cb142-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-322"><a href="#cb142-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-323"><a href="#cb142-323" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb142-324"><a href="#cb142-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-325"><a href="#cb142-325" aria-hidden="true" tabindex="-1"></a>nls_tbl <span class="ot">&lt;-</span> chicken_tbl <span class="sc">|&gt;</span> </span>
<span id="cb142-326"><a href="#cb142-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grp =</span> <span class="fu">as_factor</span>(<span class="fu">cut_number</span>(age, <span class="dv">4</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb142-327"><a href="#cb142-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(grp) <span class="sc">|&gt;</span> </span>
<span id="cb142-328"><a href="#cb142-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-329"><a href="#cb142-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nls_fit =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> .x, </span>
<span id="cb142-330"><a href="#cb142-330" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">1</span>, <span class="at">b1 =</span> <span class="dv">2</span>))),</span>
<span id="cb142-331"><a href="#cb142-331" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred =</span> <span class="fu">map</span>(nls_fit, <span class="sc">~</span><span class="fu">predict</span>(.x))) </span>
<span id="cb142-332"><a href="#cb142-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-333"><a href="#cb142-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-334"><a href="#cb142-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-335"><a href="#cb142-335" aria-hidden="true" tabindex="-1"></a>Um den Codeblock oben kurz zu erklären. Wir rechnen vier nicht-lineare Regressionen auf den vier Altersgruppen. Dann müssen wir uns noch die vorhergesagten Werte wiedergeben lassen damit wir die gefittete Gerade zeichnen können. Wir nutzen dazu die Funktion <span class="in">`unnest()`</span> um die Daten zusammen mit den vorhergesagten Werten zu erhalten.</span>
<span id="cb142-336"><a href="#cb142-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-339"><a href="#cb142-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-340"><a href="#cb142-340" aria-hidden="true" tabindex="-1"></a>nls_pred_tbl <span class="ot">&lt;-</span> nls_tbl <span class="sc">|&gt;</span> </span>
<span id="cb142-341"><a href="#cb142-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(data, pred))</span>
<span id="cb142-342"><a href="#cb142-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-343"><a href="#cb142-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-344"><a href="#cb142-344" aria-hidden="true" tabindex="-1"></a>In @fig-nls-02 sehen wir die vier einzelnen Geraden für die vier Altersgruppen. Wir sind visuell besser als über alle Altersgruppen hinweg. Das ist doch mal ein schönes Ergebnis.</span>
<span id="cb142-345"><a href="#cb142-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-348"><a href="#cb142-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-349"><a href="#cb142-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb142-350"><a href="#cb142-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-351"><a href="#cb142-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-02</span></span>
<span id="cb142-352"><a href="#cb142-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-353"><a href="#cb142-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-354"><a href="#cb142-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-355"><a href="#cb142-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung aufgeteilt nach vier Altersgruppen."</span></span>
<span id="cb142-356"><a href="#cb142-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-357"><a href="#cb142-357" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-358"><a href="#cb142-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> nls_pred_tbl, <span class="fu">aes</span>(age, pred, <span class="at">color =</span> grp), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb142-359"><a href="#cb142-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-360"><a href="#cb142-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-361"><a href="#cb142-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_okabeito</span>()</span>
<span id="cb142-362"><a href="#cb142-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-363"><a href="#cb142-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-364"><a href="#cb142-364" aria-hidden="true" tabindex="-1"></a>Wir können uns jetzt noch die <span class="in">`b0`</span> und <span class="in">`b1`</span> für jede der vier Altergruppen wiedergeben lassen. Wir räumen etwas auf und geben über <span class="in">`select()`</span> nur die Spalten wieder, die wir auch brauchen und uns interessieren.</span>
<span id="cb142-365"><a href="#cb142-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-368"><a href="#cb142-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-369"><a href="#cb142-369" aria-hidden="true" tabindex="-1"></a>nls_tbl <span class="sc">|&gt;</span> </span>
<span id="cb142-370"><a href="#cb142-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tidied =</span> <span class="fu">map</span>(nls_fit, tidy)) <span class="sc">|&gt;</span> </span>
<span id="cb142-371"><a href="#cb142-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(tidied) <span class="sc">|&gt;</span> </span>
<span id="cb142-372"><a href="#cb142-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grp, term, estimate) </span>
<span id="cb142-373"><a href="#cb142-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-374"><a href="#cb142-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-375"><a href="#cb142-375" aria-hidden="true" tabindex="-1"></a>Was sehen wir? Wir erhalten insgesamt acht Koeffizienten und können darüber dann unsere vier exponentiellen Gleichungen für unsere Altergruppen erstellen. Wir sehen, dass besonders in der ersten Gruppe des Alters von 1 bis 2 Tagen wir den Intercept überschätzen und den Exponenten unterschätzen. In den anderen Altersgruppen passt dann der Exponent wieder zu unserem ursprünglichen Modell über alle Altersgruppen.</span>
<span id="cb142-376"><a href="#cb142-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-377"><a href="#cb142-377" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-378"><a href="#cb142-378" aria-hidden="true" tabindex="-1"></a>weight_{<span class="co">[</span><span class="ot">1-2</span><span class="co">]</span>} \sim 44.4 + age^{4.21}</span>
<span id="cb142-379"><a href="#cb142-379" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-380"><a href="#cb142-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-381"><a href="#cb142-381" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-382"><a href="#cb142-382" aria-hidden="true" tabindex="-1"></a>weight_{(2-8]} \sim 60.1 + age^{2.42}</span>
<span id="cb142-383"><a href="#cb142-383" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-384"><a href="#cb142-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-385"><a href="#cb142-385" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-386"><a href="#cb142-386" aria-hidden="true" tabindex="-1"></a>weight_{(8-25]} \sim 128.0 + age^{2.18}</span>
<span id="cb142-387"><a href="#cb142-387" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-388"><a href="#cb142-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-389"><a href="#cb142-389" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-390"><a href="#cb142-390" aria-hidden="true" tabindex="-1"></a>weight_{(25-36]} \sim 330.0 + age^{2.14}</span>
<span id="cb142-391"><a href="#cb142-391" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-392"><a href="#cb142-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-393"><a href="#cb142-393" aria-hidden="true" tabindex="-1"></a>Je nachdem wie zufrieden wir jetzt mit den Ergebnissen der Modellierung sind, könnten wir auch andere Altersgruppen noch mit einfügen. Wir belassen es bei dieser Modellierung und schauen uns nochmal die andere Richtung an.</span>
<span id="cb142-394"><a href="#cb142-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-395"><a href="#cb142-395" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... von Sättigung</span></span>
<span id="cb142-396"><a href="#cb142-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-397"><a href="#cb142-397" aria-hidden="true" tabindex="-1"></a>Schauen wir uns jetzt einmal ein Beispiel der Sättigung an. Hier nehmen wir dann eine *Power*-Funktion in der Form $y = a + x^b$. Wir könnten noch eine Konstante $c$ als Multiplikator einfügen, wir schauen jetzt aber mal, ob unsere einfache Parametrisierung jetzt funktioniert. Prinzipiell sehen ja unsere Punkte wie eine *Power*-Funktion aus. Daher bauen wir uns einmal die Fomel in <span class="in">`nls()`</span> und lassen uns die Koeffizienten $a$ und $b$ wiedergeben. Dann schauen wir, ob die Koeffizienten Sinn machen und die Punkte auch gut beschreiben.</span>
<span id="cb142-398"><a href="#cb142-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-401"><a href="#cb142-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-402"><a href="#cb142-402" aria-hidden="true" tabindex="-1"></a>duckweeds_nls_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(sensor <span class="sc">~</span> a <span class="sc">+</span> <span class="fu">I</span>(duckweeds_density<span class="sc">^</span>b), <span class="at">data =</span> duckweeds_tbl, </span>
<span id="cb142-403"><a href="#cb142-403" aria-hidden="true" tabindex="-1"></a>                         <span class="at">start =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>))</span>
<span id="cb142-404"><a href="#cb142-404" aria-hidden="true" tabindex="-1"></a>duckweeds_nls_fit </span>
<span id="cb142-405"><a href="#cb142-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-406"><a href="#cb142-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-407"><a href="#cb142-407" aria-hidden="true" tabindex="-1"></a>Schauen wir uns einmal das Bestimmtheitsmaß $R^2$ für die Anpassung an. Das ist ja immer unser erstes abstraktes Maß für die Modellgüte und wie gut die Kurve durch die Punkte gelaufen ist. Das sieht doch schon sehr gut aus. Wir wollen den Wert aber dann noch gleich einmal visuell überprüfen.</span>
<span id="cb142-408"><a href="#cb142-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-411"><a href="#cb142-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-412"><a href="#cb142-412" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-413"><a href="#cb142-413" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-414"><a href="#cb142-414" aria-hidden="true" tabindex="-1"></a>duckweeds_nls_fit <span class="sc">|&gt;</span> <span class="fu">r2</span>()</span>
<span id="cb142-415"><a href="#cb142-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-416"><a href="#cb142-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-417"><a href="#cb142-417" aria-hidden="true" tabindex="-1"></a>Dann können wir auch schon die mathematische Gleichung aufschreiben. Wir haben einen negativen $y$-Achsenabschnitt $a$ sowie eine *Power* kleiner als 1. Damit sollte unsere Kurve mit steigenden $x$-Werten abflachen. Ich kann mir immer nicht vorstellen, wie so eine Funktion aussehen würde, dafür fehlt mir die mathematische Phantasie.</span>
<span id="cb142-418"><a href="#cb142-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-419"><a href="#cb142-419" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-420"><a href="#cb142-420" aria-hidden="true" tabindex="-1"></a>sensor = -1.1468 + duckweeds<span class="sc">\_</span>density^{0.2975}</span>
<span id="cb142-421"><a href="#cb142-421" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-422"><a href="#cb142-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-423"><a href="#cb142-423" aria-hidden="true" tabindex="-1"></a>Dann wollen wir einmal die Funktion visualisieren. Wir haben zwei Möglichkeiten. Entweder bauen wir uns die mathematische Funktion in R nach und plotten dann die mathematische Funktion mit <span class="in">`geom_function()`</span> oder wir nutzen nur den Fit <span class="in">`duckweeds_nls_fit`</span> direkt in <span class="in">`ggplot()`</span>. Erstes erlaubt nochmal sicherzugehen, dass wir auch die mathematische Funktion richtig aufgeschrieben haben. Wenn du die nicht brauchst, dann ist die zweite Variante natürlich weit effizienter.</span>
<span id="cb142-424"><a href="#cb142-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-425"><a href="#cb142-425" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb142-426"><a href="#cb142-426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mit `geom_function()`</span></span>
<span id="cb142-427"><a href="#cb142-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-428"><a href="#cb142-428" aria-hidden="true" tabindex="-1"></a>Jetzt nehmen wir einmal unsere Koeffizienten aus dem <span class="in">`nls()`</span>-Modell und bauen uns eine Funktion nach. Das ist im Prinzip die mathematische Formel nur in der Schreibweise in R.</span>
<span id="cb142-429"><a href="#cb142-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-432"><a href="#cb142-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-433"><a href="#cb142-433" aria-hidden="true" tabindex="-1"></a>duckweed_func <span class="ot">&lt;-</span> \(x){<span class="sc">-</span><span class="fl">1.1468</span> <span class="sc">+</span> x<span class="sc">^</span>{<span class="fl">0.2975</span>}} </span>
<span id="cb142-434"><a href="#cb142-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-435"><a href="#cb142-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-436"><a href="#cb142-436" aria-hidden="true" tabindex="-1"></a>Dann können wir auch schon die Kurve durch die Punkte in der folgenden Abbildung legen. Da wir hier eine Funktion vorliegen haben, ist der Verlauf auch sehr schön glatt. Wir sehen aber auch, dass die Funktion sehr schön passt. Die Kurve läuft gut durch die Punkte. Etwas was wir auch schon von dem $R^2$ erwartet hatten.</span>
<span id="cb142-437"><a href="#cb142-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-440"><a href="#cb142-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-441"><a href="#cb142-441" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-442"><a href="#cb142-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-443"><a href="#cb142-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-444"><a href="#cb142-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-duckweed-01a</span></span>
<span id="cb142-445"><a href="#cb142-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-446"><a href="#cb142-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-447"><a href="#cb142-447" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-448"><a href="#cb142-448" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Angepasste Kurve aus der Funktion `nls()` dargestellt mit der Funktion `geom_function()`."</span></span>
<span id="cb142-449"><a href="#cb142-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-450"><a href="#cb142-450" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb142-451"><a href="#cb142-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> duckweed_func, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb142-452"><a href="#cb142-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-453"><a href="#cb142-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-454"><a href="#cb142-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span>
<span id="cb142-455"><a href="#cb142-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-456"><a href="#cb142-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-457"><a href="#cb142-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mit `geom_line()` und `predict()`</span></span>
<span id="cb142-458"><a href="#cb142-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-459"><a href="#cb142-459" aria-hidden="true" tabindex="-1"></a>Schneller geht es in der Funktion <span class="in">`geom_line()`</span> und <span class="in">`predict()`</span>, wo wir dann die Anpassung unseres Modells direkt als $y$-Werte übergeben. Da wir hier jetzt nur die $x$-Werte nutzen, die wir auch in den Daten vorliegen haben, wirkt die Kurve bei so wenigen Messpunkten auf der $x$-Achse etwas stufig. Aber auch hier sehen wir, dass die Kurve gut durch unsere Punkte läuft. Diese Variante ist die etwas schnellere, wenn du nicht an der mathematischen Formulierung interessiert bist.</span>
<span id="cb142-460"><a href="#cb142-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-463"><a href="#cb142-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-464"><a href="#cb142-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-465"><a href="#cb142-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-466"><a href="#cb142-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-467"><a href="#cb142-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-duckweed-01b</span></span>
<span id="cb142-468"><a href="#cb142-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-469"><a href="#cb142-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-470"><a href="#cb142-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-471"><a href="#cb142-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Angepasste Kurve aus der Funktion `nls()` dargestellt mit der Funktion `geom_line()` und `predict()`."</span></span>
<span id="cb142-472"><a href="#cb142-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-473"><a href="#cb142-473" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb142-474"><a href="#cb142-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(duckweeds_nls_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb142-475"><a href="#cb142-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-476"><a href="#cb142-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-477"><a href="#cb142-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span>
<span id="cb142-478"><a href="#cb142-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-479"><a href="#cb142-479" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-480"><a href="#cb142-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-481"><a href="#cb142-481" aria-hidden="true" tabindex="-1"></a>Jetzt bietet es sich nochmal an die Vorhersageintervalle oder Prädiktionsintervalle (eng. *prediction interval*) der Abbildung hinzuzufügen. Neben den Vorhersageintervallen könntne wir auch die 95% Konfidenzintervalle (eng. *confidence interval*) hinzufügen. Hier müssen wir gleich entscheiden, was wir eigentlich zeigen wollen. Wir müssen also zwischen den beiden Intervallen unterscheiden. Vorhersageintervalle machen eine Aussage zu der Genauigkeit von zukünftigen Beobachtungen wohingegen die die Konfidenzintervalle eine Aussage über die Koeffizienten des Modells treffen. Mehr dazu gibt es auch hier Stack Exchange unter <span class="co">[</span><span class="ot">Prediction interval vs. confidence interval in linear regression analysis</span><span class="co">](https://stats.stackexchange.com/questions/225652/prediction-interval-vs-confidence-interval-in-linear-regression-analysis)</span>. Konfidenzintervalle geben dir also die Bandbreite wieder in der die Gerade verläuft. Dafür nutzen die Konfidenzintervalle die Daten und geben dir ein Intervall an, in dem die Gerade durch die Koeffizienten des Modells mit 95% Sicherheit verläuft. Das Vorhersageintervall gibt dir an mit welchen Bereich zukünftige Beobachtung mit 95% Sicherheit fallen werden. Das Vorhersageintervall ist breiter als das Konfidenzintervall und nicht jede Methode liefert auch beide Intervalle.</span>
<span id="cb142-482"><a href="#cb142-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-483"><a href="#cb142-483" aria-hidden="true" tabindex="-1"></a>Es ist uns möglich über Bootstrap, also einer Simulation aus unseren Daten, ein Vorhersageintervall sowie ein Konfidenzintervall zu generieren. Zu dem Bootstrapverfahren kannst du in den Klassifikationskapiteln mehr lesen. Ich nutze hier 500 Simulationen um mir die Intervalle ausgeben zu lassen. Bei einer echten Analyse würde ich die Anzahl auf 1000 bis 2000 setzen. Wir brauchen also als erstes unser Bootstrapobjekt mit dem wir dann in den Tabs weitermachen.</span>
<span id="cb142-484"><a href="#cb142-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-487"><a href="#cb142-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-488"><a href="#cb142-488" aria-hidden="true" tabindex="-1"></a>nls_boot_obj <span class="ot">&lt;-</span> <span class="fu">nlsBoot</span>(duckweeds_nls_fit, <span class="at">niter =</span> <span class="dv">500</span>)</span>
<span id="cb142-489"><a href="#cb142-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-490"><a href="#cb142-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-491"><a href="#cb142-491" aria-hidden="true" tabindex="-1"></a>Ich habe jetzt das Prädiktionsintervall und das Konfidenzintervall jeweils in einem der Tabs berechnet. Wenn du deine Daten auswertest musst du dich dann für ein Intervall entscheiden. Meistens nutzen wir das Konfidenzintervall, da die Interpretation und die Darstellung im Allgemeinen bekannter ist.</span>
<span id="cb142-492"><a href="#cb142-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-493"><a href="#cb142-493" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb142-494"><a href="#cb142-494" aria-hidden="true" tabindex="-1"></a><span class="fu">## Vorhersageintervall (eng. *prediction interval*)</span></span>
<span id="cb142-495"><a href="#cb142-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-496"><a href="#cb142-496" aria-hidden="true" tabindex="-1"></a>Um das Vorhersageintervall zu erstellen nutzen wir die Funktion <span class="in">`nlsBootPredict()`</span> und übergeben als neue Daten unseren Datensatz. Dann müssen wir natürlich noch als Option <span class="in">`interval = "prediction"`</span> wählen um das Vorhersageintervall wiedergegeben zu bekommen. Ich muss dann noch etwas aufräumen und auch die $x$-Werte wieder ergänzen damit wir gleich alles in <span class="in">`ggplot()`</span> darstellen können. Auch nerven mich die doppelten Werte, die brauche ich nicht für die Darstellung und entferne sie über <span class="in">`distinct()`</span>.</span>
<span id="cb142-497"><a href="#cb142-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-500"><a href="#cb142-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-501"><a href="#cb142-501" aria-hidden="true" tabindex="-1"></a>pred_plim_tbl <span class="ot">&lt;-</span> <span class="fu">nlsBootPredict</span>(nls_boot_obj, <span class="at">newdata =</span> duckweeds_tbl, <span class="at">interval =</span> <span class="st">"prediction"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb142-502"><a href="#cb142-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-503"><a href="#cb142-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-504"><a href="#cb142-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duckweeds_density =</span> duckweeds_tbl<span class="sc">$</span>duckweeds_density) <span class="sc">|&gt;</span> </span>
<span id="cb142-505"><a href="#cb142-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb142-506"><a href="#cb142-506" aria-hidden="true" tabindex="-1"></a>pred_plim_tbl</span>
<span id="cb142-507"><a href="#cb142-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-508"><a href="#cb142-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-509"><a href="#cb142-509" aria-hidden="true" tabindex="-1"></a>Aus der mittleren Abweichung des Medians zu der unteren 2.5% Grenze <span class="in">`x2_5_percent`</span> sowie zu der oberen 97.5% Grenze <span class="in">`x97_5_percent`</span> lässt sich leicht noch eine Konstante $\phi$ errechnen, die wir dann zu unserer mathematischen Formel ergänzen können. Dann hätten wir auch die mathematische Formel für die obere und untere Kurve des Vorhersageintervalls. Im Prinzip ist das Vorhersageintervall ja nur eine verschobene Kurve der ursprünglichen Geradengleichung. Wir subtrahieren und addieren also unser $\phi$ jeweils zu dem $y$-Achsenabschnitt von $-1.1468$ aus dem <span class="in">`nls()`</span>-Modell.</span>
<span id="cb142-510"><a href="#cb142-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-513"><a href="#cb142-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-514"><a href="#cb142-514" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_plim_tbl, x2_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb142-515"><a href="#cb142-515" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_plim_tbl, x97_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb142-516"><a href="#cb142-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-517"><a href="#cb142-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-518"><a href="#cb142-518" aria-hidden="true" tabindex="-1"></a>Damit hätten wir dann für die 2.5% und 97.% Grenzen des Vorhersageintervalls folgende mathematische Formel. Ich ersetze hier einmal $duckweeds<span class="sc">\_</span>density$ durch $x$ um die Formel etwas aufzuräumen und zu kürzen.</span>
<span id="cb142-519"><a href="#cb142-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-520"><a href="#cb142-520" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-521"><a href="#cb142-521" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">-1.358 + x^{0.298}; \; -1.031 + x^{0.298}</span><span class="co">]</span></span>
<span id="cb142-522"><a href="#cb142-522" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-523"><a href="#cb142-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-524"><a href="#cb142-524" aria-hidden="true" tabindex="-1"></a>Wir machen es uns etwas einfacher und nutzen hier dann die Funktion <span class="in">`geom_ribbon()`</span> um die Fläche des Vorhersageintervalls. Wir nutzen hier also nicht die Informationen aus unserem <span class="in">`nls()`</span>-Modell direkt sondern erschaffen uns die Informationen nochmal über eine Bootstrapsimulation. Es ist einfach noch ein Extraschritt, wenn du eben noch ein Intervall haben willst. Nicht immer ist es notwendig und die Breite des Vorhersageintervalls hängt auch maßgeblich von der Anzahl an Beobachtungen ab.</span>
<span id="cb142-525"><a href="#cb142-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-528"><a href="#cb142-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-529"><a href="#cb142-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-530"><a href="#cb142-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-531"><a href="#cb142-531" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-532"><a href="#cb142-532" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-duckweed-02</span></span>
<span id="cb142-533"><a href="#cb142-533" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-534"><a href="#cb142-534" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-535"><a href="#cb142-535" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-536"><a href="#cb142-536" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Angepasste Kurve aus der Funktion `nls()` zusammen mit dem Vorhersageintervall."</span></span>
<span id="cb142-537"><a href="#cb142-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-538"><a href="#cb142-538" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb142-539"><a href="#cb142-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_plim_tbl, <span class="fu">aes</span>(<span class="at">y =</span> median), <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb142-540"><a href="#cb142-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_plim_tbl, <span class="at">fill =</span> <span class="st">"#CC79A7"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb142-541"><a href="#cb142-541" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> duckweeds_density, <span class="at">ymin =</span> x2_5_percent, <span class="at">ymax =</span> x97_5_percent), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb142-542"><a href="#cb142-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-543"><a href="#cb142-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-544"><a href="#cb142-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span>
<span id="cb142-545"><a href="#cb142-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-546"><a href="#cb142-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-547"><a href="#cb142-547" aria-hidden="true" tabindex="-1"></a><span class="fu">## Konfidenzintervall (eng. *confidence interval*)</span></span>
<span id="cb142-548"><a href="#cb142-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-549"><a href="#cb142-549" aria-hidden="true" tabindex="-1"></a>Um das Konfidenzintervall zu erstellen nutzen wir ebenfalls die Funktion <span class="in">`nlsBootPredict()`</span> und übergeben als neue Daten unseren Datensatz. Dann müssen wir natürlich noch als Option <span class="in">`interval = "confidence"`</span> auswählen um das Konfidenzintervall wiedergegeben zu bekommen. Ich muss dann auch hier aufräumen und die $x$-Werte wieder ergänzen damit wir gleich alles in <span class="in">`ggplot()`</span> darstellen können. Auch nerven mich die doppelten Werte, die brauche ich nicht für die Darstellung und entferne sie über <span class="in">`distinct()`</span>.</span>
<span id="cb142-550"><a href="#cb142-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-553"><a href="#cb142-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-554"><a href="#cb142-554" aria-hidden="true" tabindex="-1"></a>pred_clim_tbl <span class="ot">&lt;-</span> <span class="fu">nlsBootPredict</span>(nls_boot_obj, <span class="at">newdata =</span> duckweeds_tbl, <span class="at">interval =</span> <span class="st">"confidence"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb142-555"><a href="#cb142-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-556"><a href="#cb142-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-557"><a href="#cb142-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duckweeds_density =</span> duckweeds_tbl<span class="sc">$</span>duckweeds_density) <span class="sc">|&gt;</span> </span>
<span id="cb142-558"><a href="#cb142-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb142-559"><a href="#cb142-559" aria-hidden="true" tabindex="-1"></a>pred_clim_tbl </span>
<span id="cb142-560"><a href="#cb142-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-561"><a href="#cb142-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-562"><a href="#cb142-562" aria-hidden="true" tabindex="-1"></a>Aus der mittleren Abweichung des Medians zu der unteren 2.5% Grenze <span class="in">`x2_5_percent`</span> sowie zu der oberen 97.5% Grenze <span class="in">`x97_5_percent`</span> lässt sich leicht noch eine Konstante $\phi$ errechnen, die wir dann zu unserer mathematischen Formel ergänzen können. Dann hätten wir auch die mathematische Formel für die obere und untere Kurve des Konfidenzintervalls. Im Prinzip ist das Konfidenzintervall ja nur eine verschobene Kurve der ursprünglichen Geradengleichung. Wir subtrahieren und addieren also unser $\phi$ jeweils zu dem $y$-Achsenabschnitt von $-1.1468$ aus dem <span class="in">`nls()`</span>-Modell.</span>
<span id="cb142-563"><a href="#cb142-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-566"><a href="#cb142-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-567"><a href="#cb142-567" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_clim_tbl, x2_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb142-568"><a href="#cb142-568" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(pred_clim_tbl, x97_5_percent <span class="sc">-</span> median) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb142-569"><a href="#cb142-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-570"><a href="#cb142-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-571"><a href="#cb142-571" aria-hidden="true" tabindex="-1"></a>Damit hätten wir dann für die 2.5% und 97.% Grenzen des Konfidenzintervalls folgende mathematische Formel. Ich ersetze hier einmal $duckweeds<span class="sc">\_</span>density$ durch $x$ um die Formel etwas aufzuräumen und zu kürzen.</span>
<span id="cb142-572"><a href="#cb142-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-573"><a href="#cb142-573" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-574"><a href="#cb142-574" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">-1.1978 + x^{0.298}; \; -1.1098 + x^{0.298}</span><span class="co">]</span></span>
<span id="cb142-575"><a href="#cb142-575" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-576"><a href="#cb142-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-577"><a href="#cb142-577" aria-hidden="true" tabindex="-1"></a>Wir machen es uns einfacher und nutzen hier dann die Funktion <span class="in">`geom_ribbon()`</span> um die Fläche des Konfidenzintervalls. Wir nutzen hier also nicht die Informationen aus unserem <span class="in">`nls()`</span>-Modell direkt sondern erschaffen uns die Informationen nochmal über eine Bootstrapsimulation. Es ist einfach noch ein Extraschritt, wenn du eben noch ein Intervall haben willst. Nicht immer ist es notwendig und die Breite des Konfidenzintervalls hängt auch maßgeblich von der Anzahl an Beobachtungen ab.</span>
<span id="cb142-578"><a href="#cb142-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-581"><a href="#cb142-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-582"><a href="#cb142-582" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-583"><a href="#cb142-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-584"><a href="#cb142-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-585"><a href="#cb142-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-duckweed-03</span></span>
<span id="cb142-586"><a href="#cb142-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-587"><a href="#cb142-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-588"><a href="#cb142-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-589"><a href="#cb142-589" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Angepasste Kurve aus der Funktion `nls()` zusammen mit dem Konfidenzintervall."</span></span>
<span id="cb142-590"><a href="#cb142-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-591"><a href="#cb142-591" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb142-592"><a href="#cb142-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_clim_tbl, <span class="fu">aes</span>(<span class="at">y =</span> median), <span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb142-593"><a href="#cb142-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_clim_tbl, <span class="at">fill =</span> <span class="st">"#0072B2"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb142-594"><a href="#cb142-594" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> duckweeds_density, <span class="at">ymin =</span> x2_5_percent, <span class="at">ymax =</span> x97_5_percent), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb142-595"><a href="#cb142-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-596"><a href="#cb142-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-597"><a href="#cb142-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Gemessene Dichte der Wasserlinsen"</span>, <span class="at">y =</span> <span class="st">"Sensorwert"</span>)</span>
<span id="cb142-598"><a href="#cb142-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-599"><a href="#cb142-599" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-600"><a href="#cb142-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-601"><a href="#cb142-601" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... von Zerfall</span></span>
<span id="cb142-602"><a href="#cb142-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-603"><a href="#cb142-603" aria-hidden="true" tabindex="-1"></a>Nachdem wir uns einem exponentiellen Anstieg und die Sättigung angeschaut haben, wollen weit uns nun einmal mit einem exponentiellen Zerfall beschäftigen. Wir betrachten einen exponentziellen Zerfall einer Blattläuse Population. Wir wollen die folgende Gleichung lösen und die Werte für die Konstante $a$ und den Exponenten $\beta_1$ schätzen. Nun haben wir diesmal keinen Intercept vorliegen.</span>
<span id="cb142-604"><a href="#cb142-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-605"><a href="#cb142-605" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-606"><a href="#cb142-606" aria-hidden="true" tabindex="-1"></a>count \sim a \cdot week^{\beta_1}</span>
<span id="cb142-607"><a href="#cb142-607" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-608"><a href="#cb142-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-609"><a href="#cb142-609" aria-hidden="true" tabindex="-1"></a>Die Daten sind angelegt an ein Experiment zu Blattlauskontrolle. Wir haben ein neues Biopestizid welchen wir auf die Blattläuse auf Rosen sprühen. Wir zählen dann automatisiert über eine Kamera und Bilderkennung wie viele Blattläuse sich nach den Wochen des wiederholten Sprühens noch auf den Rosen befinden. Wir erhalten damit folgende Daten im Objekt <span class="in">`exp_tbl`</span>.</span>
<span id="cb142-610"><a href="#cb142-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-613"><a href="#cb142-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-614"><a href="#cb142-614" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20221018</span>)</span>
<span id="cb142-615"><a href="#cb142-615" aria-hidden="true" tabindex="-1"></a>exp_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">count =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">17906</span>, <span class="at">sd =</span> <span class="dv">17906</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb142-616"><a href="#cb142-616" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>  <span class="dv">5303</span>, <span class="at">sd =</span>  <span class="dv">5303</span><span class="sc">/</span><span class="dv">4</span>),</span>
<span id="cb142-617"><a href="#cb142-617" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>  <span class="dv">2700</span>, <span class="at">sd =</span>  <span class="dv">2700</span><span class="sc">/</span><span class="dv">4</span>),</span>
<span id="cb142-618"><a href="#cb142-618" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>  <span class="dv">1696</span>, <span class="at">sd =</span>  <span class="dv">1696</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb142-619"><a href="#cb142-619" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>   <span class="dv">947</span>, <span class="at">sd =</span>   <span class="dv">947</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb142-620"><a href="#cb142-620" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span>   <span class="dv">362</span>, <span class="at">sd =</span>   <span class="dv">362</span><span class="sc">/</span><span class="dv">4</span>)), </span>
<span id="cb142-621"><a href="#cb142-621" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weeks =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">each =</span> <span class="dv">10</span>)) </span>
<span id="cb142-622"><a href="#cb142-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-623"><a href="#cb142-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-624"><a href="#cb142-624" aria-hidden="true" tabindex="-1"></a>Wir müssen ja wieder die Startwerte in der Funktion <span class="in">`nls()`</span> angeben. Meistens raten wir diese oder schauen auf die Daten um zu sehen wo diese Werte in etwa liegen könnten. Dann kann die Funktion <span class="in">`nls()`</span> diese Startwerte dann optimieren. Es gibt aber noch einen anderen Trick. Wir rechnen eine *lineare* Regression über die $log$-transformierten Daten und nehmen dann die Koeffizienten aus dem linearen Modell als Startwerte für unsere nicht-lineare Regression.</span>
<span id="cb142-625"><a href="#cb142-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-628"><a href="#cb142-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-629"><a href="#cb142-629" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(count) <span class="sc">~</span> <span class="fu">log</span>(weeks), exp_tbl)</span>
<span id="cb142-630"><a href="#cb142-630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-631"><a href="#cb142-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-632"><a href="#cb142-632" aria-hidden="true" tabindex="-1"></a>Aus der linearen Regression erhalten wir einen Intercept von $9.961$ und eine Steigung von $-2.025$. Wir exponieren den Intercept und erhalten den Wert für $a$ mit $\exp(9.961)$. Für den Exponenten $b1$ tragen wir den Wert $-2.025$ als Startwert ein. Mit diesem Trick erhalten wir etwas bessere Startwerte und müssen nicht so viel rumprobieren.</span>
<span id="cb142-633"><a href="#cb142-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-636"><a href="#cb142-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-637"><a href="#cb142-637" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb142-638"><a href="#cb142-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-639"><a href="#cb142-639" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(count <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">I</span>(weeks<span class="sc">^</span>b1), <span class="at">data =</span> exp_tbl, </span>
<span id="cb142-640"><a href="#cb142-640" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="fu">exp</span>(<span class="fl">9.961</span>), <span class="at">b1 =</span> <span class="sc">-</span><span class="fl">2.025</span>))</span>
<span id="cb142-641"><a href="#cb142-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-642"><a href="#cb142-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-643"><a href="#cb142-643" aria-hidden="true" tabindex="-1"></a>Wir können uns noch die Koeffizienten wiedergeben lassen und die Geradengleichung vervollständigen. Wie du siehst sind die Werte natürlich anders als die Startwerte. Wir hätten aber ziemlich lange rumprobieren müssen bis wir nahe genug an die Startwerte gekommen wären damit die Funktion <span class="in">`nls()`</span> iterativ eine Lösung für die Gleichung findet.</span>
<span id="cb142-644"><a href="#cb142-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-647"><a href="#cb142-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-648"><a href="#cb142-648" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-649"><a href="#cb142-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-650"><a href="#cb142-650" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb142-651"><a href="#cb142-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-652"><a href="#cb142-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span>
<span id="cb142-653"><a href="#cb142-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-654"><a href="#cb142-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-655"><a href="#cb142-655" aria-hidden="true" tabindex="-1"></a>Abschließend können wir dann die Koeffizienten in die Geradengleichung eintragen.</span>
<span id="cb142-656"><a href="#cb142-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-657"><a href="#cb142-657" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-658"><a href="#cb142-658" aria-hidden="true" tabindex="-1"></a>count \sim 17812.11 \cdot week^{-1.69}</span>
<span id="cb142-659"><a href="#cb142-659" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-660"><a href="#cb142-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-661"><a href="#cb142-661" aria-hidden="true" tabindex="-1"></a>In @fig-nls-03 sehen wir die Daten zusammen mit der gefitteten Gerade aus der nicht-linearen Regression. Wir sehen, dass die Gerade ziemlich gut durch die Mitte der jeweiligen Punkte läuft.</span>
<span id="cb142-662"><a href="#cb142-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-665"><a href="#cb142-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-666"><a href="#cb142-666" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-667"><a href="#cb142-667" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-668"><a href="#cb142-668" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-669"><a href="#cb142-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-03</span></span>
<span id="cb142-670"><a href="#cb142-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-671"><a href="#cb142-671" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-672"><a href="#cb142-672" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-673"><a href="#cb142-673" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Sterberate von Blattläusen nach Aufbringen eines Bio-Pestizides mit der nicht-linearen Regressionsgleichung."</span></span>
<span id="cb142-674"><a href="#cb142-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-675"><a href="#cb142-675" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exp_tbl, <span class="fu">aes</span>(weeks, count)) <span class="sc">+</span></span>
<span id="cb142-676"><a href="#cb142-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-677"><a href="#cb142-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-678"><a href="#cb142-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(fit)), <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb142-679"><a href="#cb142-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb142-680"><a href="#cb142-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-681"><a href="#cb142-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-682"><a href="#cb142-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-683"><a href="#cb142-683" aria-hidden="true" tabindex="-1"></a><span class="fu">### ... der Michaelis-Menten Gleichung</span></span>
<span id="cb142-684"><a href="#cb142-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-685"><a href="#cb142-685" aria-hidden="true" tabindex="-1"></a>In diesem Abschnitt wollen wir uns mit dem Modellieren einer Sättigungskurve beschäftigen. Daher bietet sich natürlich die Michaelis-Menten-Gleichung an. Die Daten in <span class="in">`enzyme.csv`</span> geben die Geschwindigkeit $v$ des Enzyms saure Phosphatase ($\mu mol/min$) bei verschiedenen Konzentrationen des Substrats Nitrophenolphosphat, <span class="sc">\[</span>S<span class="sc">\]</span> (mM), an. Die Daten können mit der Michaelis-Menten-Gleichung modelliert werden und somit kann eine nichtlineare Regression kann verwendet werden, um $K_M$ und $v_{max}$ zu schätzen.</span>
<span id="cb142-686"><a href="#cb142-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-689"><a href="#cb142-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-690"><a href="#cb142-690" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-691"><a href="#cb142-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-692"><a href="#cb142-692" aria-hidden="true" tabindex="-1"></a>enzyme_tbl <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">file.path</span>(<span class="st">"data/enzyme.csv"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb142-693"><a href="#cb142-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">S =</span> concentration, <span class="at">v =</span> rate)</span>
<span id="cb142-694"><a href="#cb142-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-695"><a href="#cb142-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-696"><a href="#cb142-696" aria-hidden="true" tabindex="-1"></a>In @tbl-enzyme sehen wir einen Auszug aus den Enzymedaten. Eigentlich relativ klar. Wir haben eine Konzentration $S$ vorliegen und eine Geschwindigkeit $v$.</span>
<span id="cb142-697"><a href="#cb142-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-700"><a href="#cb142-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-701"><a href="#cb142-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb142-702"><a href="#cb142-702" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-703"><a href="#cb142-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-704"><a href="#cb142-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-enzyme</span></span>
<span id="cb142-705"><a href="#cb142-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Auszug aus Enzymedatensatz.</span></span>
<span id="cb142-706"><a href="#cb142-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-707"><a href="#cb142-707" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">head</span>(enzyme_tbl, <span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb142-708"><a href="#cb142-708" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="st">"..."</span>, <span class="at">times =</span> <span class="fu">ncol</span>(enzyme_tbl)),</span>
<span id="cb142-709"><a href="#cb142-709" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tail</span>(enzyme_tbl, <span class="at">n =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb142-710"><a href="#cb142-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"c"</span>, <span class="st">"pipe"</span>)</span>
<span id="cb142-711"><a href="#cb142-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-712"><a href="#cb142-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-713"><a href="#cb142-713" aria-hidden="true" tabindex="-1"></a>Schauen wir uns die Daten einmal in der @fig-nls-04 an. Wir legen die Konzentration $S$ auf die $x$-Achse und Geschwindigkeit $v$ auf die $y$-Achse.</span>
<span id="cb142-714"><a href="#cb142-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-717"><a href="#cb142-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-718"><a href="#cb142-718" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-719"><a href="#cb142-719" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-720"><a href="#cb142-720" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-721"><a href="#cb142-721" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-04</span></span>
<span id="cb142-722"><a href="#cb142-722" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-723"><a href="#cb142-723" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-724"><a href="#cb142-724" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-725"><a href="#cb142-725" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Geschwindigkeit $v$ des Enzyms saure Phosphatase bei verschiedenen Konzentrationen des Substrats Nitrophenolphosphat."</span></span>
<span id="cb142-726"><a href="#cb142-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-727"><a href="#cb142-727" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(enzyme_tbl, <span class="fu">aes</span>(<span class="at">x =</span> S, <span class="at">y =</span> v)) <span class="sc">+</span></span>
<span id="cb142-728"><a href="#cb142-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-729"><a href="#cb142-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-730"><a href="#cb142-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"[S] / mM"</span>, <span class="at">y =</span> <span class="fu">expression</span>(v<span class="sc">/</span><span class="st">"µmol "</span> <span class="sc">*</span> min<span class="sc">^-</span><span class="dv">1</span>))</span>
<span id="cb142-731"><a href="#cb142-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-732"><a href="#cb142-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-733"><a href="#cb142-733" aria-hidden="true" tabindex="-1"></a>Die Reaktionsgleichung abgeleitet aus der Michaelis-Menten-Kinetik lässt sich allgemein wie folgt darstellen. Wir haben die Konzentration $S$ und die Geschwindigkeit $v$ gegeben und wollen nun über eine nicht-lineare Regression die Werte für $v_{max}$ und $K_M$ schätzen.</span>
<span id="cb142-734"><a href="#cb142-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-735"><a href="#cb142-735" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-736"><a href="#cb142-736" aria-hidden="true" tabindex="-1"></a>v = \cfrac{v_{max} \cdot S}{K_M + S}</span>
<span id="cb142-737"><a href="#cb142-737" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-738"><a href="#cb142-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-739"><a href="#cb142-739" aria-hidden="true" tabindex="-1"></a>Dabei gibt $v$ die initiale Reaktionsgeschwindigkeit bei einer bestimmten Substratkonzentration <span class="sc">\[</span>S<span class="sc">\]</span> an. Mit $v_{max}$ beschreiben wir die maximale Reaktionsgeschwindigkeit. Eine Kenngröße für eine enzymatische Reaktion ist die Michaeliskonstante $K_M$. Sie hängt von der jeweiligen enzymatischen Reaktion ab. $K_M$ gibt die Substratkonzentration an, bei der die Umsatzgeschwindigkeit halbmaximal ist und somit $v = 1/2 \cdot v_{max}$ ist. Wir haben dann die Halbsättigung vorliegen.</span>
<span id="cb142-740"><a href="#cb142-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-741"><a href="#cb142-741" aria-hidden="true" tabindex="-1"></a>Bauen wir also die GLeichung in R nach und geben die Startwerte für $v_{max}$ und $K_M$ für die Funktion <span class="in">`nls()`</span> vor. Die Funktion <span class="in">`nls()`</span> versucht jetzt die beste Lösung für die beiden Koeffizienten zu finden.</span>
<span id="cb142-742"><a href="#cb142-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-745"><a href="#cb142-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-746"><a href="#cb142-746" aria-hidden="true" tabindex="-1"></a>enzyme_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(v <span class="sc">~</span> vmax <span class="sc">*</span> S <span class="sc">/</span>( KM <span class="sc">+</span> S ), <span class="at">data  =</span> enzyme_tbl,</span>
<span id="cb142-747"><a href="#cb142-747" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="at">vmax =</span> <span class="dv">9</span>, <span class="at">KM =</span> <span class="dv">2</span>))</span>
<span id="cb142-748"><a href="#cb142-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-749"><a href="#cb142-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-750"><a href="#cb142-750" aria-hidden="true" tabindex="-1"></a>Wir können uns dann die Koeffizienten ausgeben lassen.</span>
<span id="cb142-751"><a href="#cb142-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-754"><a href="#cb142-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-755"><a href="#cb142-755" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-756"><a href="#cb142-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-757"><a href="#cb142-757" aria-hidden="true" tabindex="-1"></a>enzyme_fit <span class="sc">|&gt;</span> </span>
<span id="cb142-758"><a href="#cb142-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-759"><a href="#cb142-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Parameter, Coefficient)</span>
<span id="cb142-760"><a href="#cb142-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-761"><a href="#cb142-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-762"><a href="#cb142-762" aria-hidden="true" tabindex="-1"></a>Jetzt müssen wir die Michaelis-Menten-Gleichung nur noch um die Koeffizienten ergänzen.</span>
<span id="cb142-763"><a href="#cb142-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-764"><a href="#cb142-764" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-765"><a href="#cb142-765" aria-hidden="true" tabindex="-1"></a>v = \cfrac{11.85 \cdot S}{4.28 + S}</span>
<span id="cb142-766"><a href="#cb142-766" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-767"><a href="#cb142-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-768"><a href="#cb142-768" aria-hidden="true" tabindex="-1"></a>In der @fig-nls-05 können wir die gefittete Gerade nochmal überprüfen und schauen ob das Modellieren geklappt hat. Ja, hat es die Gerade läuft direkt mittig durch die Punkte.</span>
<span id="cb142-769"><a href="#cb142-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-772"><a href="#cb142-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-773"><a href="#cb142-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-774"><a href="#cb142-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-775"><a href="#cb142-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-776"><a href="#cb142-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-05</span></span>
<span id="cb142-777"><a href="#cb142-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-778"><a href="#cb142-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-779"><a href="#cb142-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-780"><a href="#cb142-780" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Michaelis-Menten-Kinetik zusammen mit der gefitteten Gerade aus einer nicht-linearen Regression."</span></span>
<span id="cb142-781"><a href="#cb142-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-782"><a href="#cb142-782" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(enzyme_tbl, <span class="fu">aes</span>(<span class="at">x =</span> S, <span class="at">y =</span> v)) <span class="sc">+</span></span>
<span id="cb142-783"><a href="#cb142-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-784"><a href="#cb142-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-785"><a href="#cb142-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(enzyme_fit)), <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb142-786"><a href="#cb142-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"[S] / mM"</span>, <span class="at">y =</span> <span class="fu">expression</span>(v<span class="sc">/</span><span class="st">"µmol "</span> <span class="sc">*</span> min<span class="sc">^-</span><span class="dv">1</span>))</span>
<span id="cb142-787"><a href="#cb142-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-788"><a href="#cb142-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-789"><a href="#cb142-789" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multivariate Fractional Polynomials mit `{mfp}`</span></span>
<span id="cb142-790"><a href="#cb142-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-791"><a href="#cb142-791" aria-hidden="true" tabindex="-1"></a>Manchmal haben wir keine Ahnung, welche mathematische Formel denn überhaupt passen könnte. Ohne eine mathematische Formel können wir dann auch schlecht in <span class="in">`nls()`</span> Startwerte angeben. Ohne die Angabe von Startwerten für die Formel können wir dann auch nichts rechnen. Die wenigsten Menschen haben eine exponentielle Idee im Kopf, wenn sie eine Kurve sehen. Aus dem Grund wurden die *Multivariate Fractional Polynomials* (abk. *mfp*) entwickelt, die dir dann eine Formel wiedergeben. Das Schöne daran ist, dass du einfach nur sagen musst, welche Variable als Polynom in die Formel soll und den Rest macht die Funktion <span class="in">`mfp`</span> aus dem gleichnamigen R Paket <span class="in">`{mfp}`</span> dann für sich. Hier sei auch einmal auf das Tutorial <span class="co">[</span><span class="ot">Multivariate Fractional Polynomials: Why Isn’t This Used More?</span><span class="co">](https://towardsdatascience.com/multivariate-fractional-polynomials-why-isnt-this-used-more-1a1fa9ead12c)</span> verwiesen. Die Entwickler des R Paketes <span class="in">`{mfp}`</span> haben auch eine eigene Hilfeseite unter <span class="co">[</span><span class="ot">Multivariable Fractional Polynomials (MFP)</span><span class="co">](https://mfp.imbi.uni-freiburg.de/)</span> eingerichtet. Wir immer ist das Thema zu groß, daher hier nur die simple Anwendung.</span>
<span id="cb142-792"><a href="#cb142-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-793"><a href="#cb142-793" aria-hidden="true" tabindex="-1"></a>Der wichtigste Schritt ist einmal die Variable zu bezeichnen, die als Polynom behandelt werden soll. Wir machen das hier mit der Funktion <span class="in">`fp()`</span>. Wir sagen damit der Funktion <span class="in">`mfp()`</span>, dass wir bitte die Koeffizienten und eine "Hochzahl" $a$ für das Alter haben wollen. Wir erhalten also die Koeffizienten für die folgende mathematische Formel mit Zahlen wieder.</span>
<span id="cb142-794"><a href="#cb142-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-795"><a href="#cb142-795" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-796"><a href="#cb142-796" aria-hidden="true" tabindex="-1"></a>weight \sim \beta_0 + \beta_1 \cdot age^{a}</span>
<span id="cb142-797"><a href="#cb142-797" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-798"><a href="#cb142-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-799"><a href="#cb142-799" aria-hidden="true" tabindex="-1"></a>Dann rechnen wir also einfach schnelle einmal das Modell.</span>
<span id="cb142-800"><a href="#cb142-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-803"><a href="#cb142-803" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-804"><a href="#cb142-804" aria-hidden="true" tabindex="-1"></a>mfp_fit <span class="ot">&lt;-</span> <span class="fu">mfp</span>(weight <span class="sc">~</span> <span class="fu">fp</span>(age), <span class="at">data =</span> chicken_tbl)</span>
<span id="cb142-805"><a href="#cb142-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-806"><a href="#cb142-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-807"><a href="#cb142-807" aria-hidden="true" tabindex="-1"></a>Wir können dann auch gleich einmal in die Zusammenfassung reinschauen und sehen, was dort für eine Formel für das Alter <span class="in">`age`</span> geschätzt wurde.</span>
<span id="cb142-808"><a href="#cb142-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-811"><a href="#cb142-811" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-812"><a href="#cb142-812" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mfp_fit) </span>
<span id="cb142-813"><a href="#cb142-813" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-814"><a href="#cb142-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-815"><a href="#cb142-815" aria-hidden="true" tabindex="-1"></a>Es ist auch möglich sich die Formel direkt wiedergeben zu lassen. Hier ist dann wichtig zu verstehen, was wir dort sehen. Die Funktion <span class="in">`mfp()`</span> testet immer verschiedene ganzzahlige <span class="in">`a`</span>-Werte für die Potenz. Dann versucht die Funktion <span class="in">`mfp()`</span> die restlichen Koeffizienten optimal den Daten anzupassen.</span>
<span id="cb142-816"><a href="#cb142-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-819"><a href="#cb142-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-820"><a href="#cb142-820" aria-hidden="true" tabindex="-1"></a>mfp_fit<span class="sc">$</span>formula</span>
<span id="cb142-821"><a href="#cb142-821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-822"><a href="#cb142-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-823"><a href="#cb142-823" aria-hidden="true" tabindex="-1"></a>Nun haben wir erstmal die Informationen über das Alter und die Potenz $a$ und wie diese beiden miteinander zusammengehören. Jetzt fehlen aber noch die Koeffizienten für die Steigung und den y-Achsenabschnitt. Die haben wir auch oben in der <span class="in">`summary()`</span> gesehen, aber wir können uns die Werte auch separat anzeigen lassen.</span>
<span id="cb142-824"><a href="#cb142-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-827"><a href="#cb142-827" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-828"><a href="#cb142-828" aria-hidden="true" tabindex="-1"></a>mfp_fit<span class="sc">$</span>coefficients </span>
<span id="cb142-829"><a href="#cb142-829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-830"><a href="#cb142-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-831"><a href="#cb142-831" aria-hidden="true" tabindex="-1"></a>Dann können wir auch einmal die etwas kompliziertere mathematische Gleichung aufschreiben. Da wir an ganzzahlige Potenzen gebunden sind, muss der Rest etwas anderes aussehen. Aber die Formel geht eigentlich noch. Da wir eben auch eine ganzzahlige Potenz haben, können wir auch selber mit einem Taschenrechner rechnen. Das wird ja bei Kommazahlen schon etwas mühseliger.</span>
<span id="cb142-832"><a href="#cb142-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-833"><a href="#cb142-833" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-834"><a href="#cb142-834" aria-hidden="true" tabindex="-1"></a>weight \sim 66.3 + 188 \cdot \left(\cfrac{age}{10}\right)^{2}</span>
<span id="cb142-835"><a href="#cb142-835" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb142-836"><a href="#cb142-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-837"><a href="#cb142-837" aria-hidden="true" tabindex="-1"></a>Dann können wir die Funktion auch schon in R übersetzen. Wir machen eigentlich nichts anderes als das wir das $age$ durch durch $x$ ersetzen, was generischer ist. Und wir brauchen diese Art der Darstellung dann auch in <span class="in">`ggplot()`</span>.</span>
<span id="cb142-838"><a href="#cb142-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-841"><a href="#cb142-841" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-842"><a href="#cb142-842" aria-hidden="true" tabindex="-1"></a>age_func <span class="ot">&lt;-</span> \(x) {<span class="fl">66.3</span> <span class="sc">+</span> <span class="dv">188</span> <span class="sc">*</span> (x<span class="sc">/</span><span class="dv">10</span>)<span class="sc">^</span><span class="dv">2</span>}</span>
<span id="cb142-843"><a href="#cb142-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-844"><a href="#cb142-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-845"><a href="#cb142-845" aria-hidden="true" tabindex="-1"></a>In der @fig-nls-mfp-1 sehen wir einmal das Ergebnis der Anpassung. Ich habe hier einmal beides gemacht, einmal mit der Funktion <span class="in">`geom_function()`</span> und einmal mit <span class="in">`geom_line()`</span> und <span class="in">`predict()`</span>. So kannst du mal sehen, dass wir hier das gleiche rauskriegen. Die erste Variante ist eben die bessere, wenn du auch die mathematische Gleichung angeben wilst. Dann bist du dir sicher, dass auch die Gleichung zu der angepassten Kurve passt.</span>
<span id="cb142-846"><a href="#cb142-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-849"><a href="#cb142-849" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-850"><a href="#cb142-850" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-851"><a href="#cb142-851" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-852"><a href="#cb142-852" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-853"><a href="#cb142-853" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-mfp-1</span></span>
<span id="cb142-854"><a href="#cb142-854" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-855"><a href="#cb142-855" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-856"><a href="#cb142-856" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-857"><a href="#cb142-857" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung nach der Funktion `mfp()`. Die geschätzten Kurven sind natürlich in beiden Fälle die gleichen Kurven. Es geht hier um die Form der Umsetzung in `{ggplot}`."</span></span>
<span id="cb142-858"><a href="#cb142-858" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb142-859"><a href="#cb142-859" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "... mit `geom_function()`"</span></span>
<span id="cb142-860"><a href="#cb142-860" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "... mit `geom_line()` und `predict()`"</span></span>
<span id="cb142-861"><a href="#cb142-861" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 1</span></span>
<span id="cb142-862"><a href="#cb142-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-863"><a href="#cb142-863" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-864"><a href="#cb142-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> age_func, <span class="at">color =</span> <span class="st">"#CC79A7"</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb142-865"><a href="#cb142-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-866"><a href="#cb142-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-867"><a href="#cb142-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-868"><a href="#cb142-868" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-869"><a href="#cb142-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(mfp_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb142-870"><a href="#cb142-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-871"><a href="#cb142-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-872"><a href="#cb142-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-873"><a href="#cb142-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-874"><a href="#cb142-874" aria-hidden="true" tabindex="-1"></a>Und welche der beiden mathematischen Gleichungen ist denn nun besser? Dafür fitten wir nochmal das <span class="in">`nls()`</span> Modell von oben und vergleichen das Modell einmal zu dem <span class="in">`mfp()`</span>-Modell von eben.</span>
<span id="cb142-875"><a href="#cb142-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-878"><a href="#cb142-878" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-879"><a href="#cb142-879" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb142-880"><a href="#cb142-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-881"><a href="#cb142-881" aria-hidden="true" tabindex="-1"></a>nls_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(weight <span class="sc">~</span> b0 <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span>b1), <span class="at">data =</span> chicken_tbl, </span>
<span id="cb142-882"><a href="#cb142-882" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="fu">c</span>(<span class="at">b0 =</span> <span class="dv">1</span>, <span class="at">b1 =</span> <span class="dv">1</span>))</span>
<span id="cb142-883"><a href="#cb142-883" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-884"><a href="#cb142-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-885"><a href="#cb142-885" aria-hidden="true" tabindex="-1"></a>In der @tbl-model-comp-nls-mfp sehen wir die Funktion <span class="in">`modelsummary()`</span> und den entsprechenden Modellvergleich der beiden Modelle zu Anpassung einer nicht-linearen Regression. Welche der beiden Modelle und damit mathematischen Gleichungen beschreibt unsere Daten besser? Leider ist es so, dass wir aus dem <span class="in">`nls()`</span>-Modell nicht so viele Informationen erhalten wie es zu wünschen wäre. Wir könnten das AIC als Kriterium nehmen und da gilt, dass ein kleineres AIC besser ist, nehmen wir das <span class="in">`mfp()`</span>-Modell.</span>
<span id="cb142-886"><a href="#cb142-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-889"><a href="#cb142-889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-890"><a href="#cb142-890" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-891"><a href="#cb142-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-892"><a href="#cb142-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-893"><a href="#cb142-893" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Modellvergleich für das `nls()` Modell mit dem `mfp()` Modell. Wir vergleichen hier nur die beiden Modelle, da beide Modelle eine mathematische Gleichung wiedergeben, die wir dann berichten können."</span></span>
<span id="cb142-894"><a href="#cb142-894" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-model-comp-nls-mfp</span></span>
<span id="cb142-895"><a href="#cb142-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-896"><a href="#cb142-896" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">lst</span>(<span class="st">"nls Modell"</span> <span class="ot">=</span> nls_fit,</span>
<span id="cb142-897"><a href="#cb142-897" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"mfp Modell"</span> <span class="ot">=</span> mfp_fit))</span>
<span id="cb142-898"><a href="#cb142-898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-899"><a href="#cb142-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-900"><a href="#cb142-900" aria-hidden="true" tabindex="-1"></a>Und am Ende nochmal, wie gut war die Anpassung des Modells an die Daten*punkte* eigentlich? Hier können wir dann wieder das Bestimmtheitsmaß $R^2$ nutzen. Wie immer siehst du Bestimmtheitsmaß $R^2$ auch in der <span class="in">`summary()`</span> aber hier dann einmal als direkter Aufruf.</span>
<span id="cb142-901"><a href="#cb142-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-904"><a href="#cb142-904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-905"><a href="#cb142-905" aria-hidden="true" tabindex="-1"></a>mfp_fit <span class="sc">|&gt;</span> <span class="fu">r2</span>()</span>
<span id="cb142-906"><a href="#cb142-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-907"><a href="#cb142-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-910"><a href="#cb142-910" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-911"><a href="#cb142-911" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-912"><a href="#cb142-912" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-913"><a href="#cb142-913" aria-hidden="true" tabindex="-1"></a>nls_fit <span class="sc">|&gt;</span> <span class="fu">r2</span>()</span>
<span id="cb142-914"><a href="#cb142-914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-915"><a href="#cb142-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-916"><a href="#cb142-916" aria-hidden="true" tabindex="-1"></a>Da sich jetzt die beiden Bestimmtheitsmaße $R^2$ wirklich nicht unterscheiden, ist es wohl eher eine Frage des Geschmacks, welche mathematische Formel besser passt. In unserem Beispiel sind ja auch die eher jüngeren Hühner das Problem und nicht so die etwas älteren Hühner. Aber diese Frage lasse ich dann mal offen, du kannst oben die <span class="in">`map()`</span> Funktion auch mit <span class="in">`mfp()`</span> laufen lassen.</span>
<span id="cb142-917"><a href="#cb142-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-918"><a href="#cb142-918" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generalized Additive Models (GAM) mit `{mgcv}`</span></span>
<span id="cb142-919"><a href="#cb142-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-920"><a href="#cb142-920" aria-hidden="true" tabindex="-1"></a>Neben den Modellen, die uns eine mathematische Funktion wiedergeben, gibt es natürlich noch Modelle, die effizienter und besser sind. Diese Effizienz und bessere Modellanpassung bezahlen wir dann aber mit der schwierigeren Darstellbarkeit als Formel. Wenn du also ein Modell anpassen willst, was sehr gut durch Punkte läuft und dann dieses Modell nutzen willst um zukünftige Werte vorherzusagen, dann kannst du <span class="co">[</span><span class="ot">Generalized Additive Models</span><span class="co">](https://m-clark.github.io/generalized-additive-models/)</span> (abk. *GAM*) nutzen. Du erhälst aber keine Formel wieder sondern das Modell liegt dann als Objekt in R vor. Damit kannst du dann arbeiten und Prognosen rechnen aber keine Formel in deine Abbildung schreiben. Es gibt zu GAM einmal das gute Tutorium [Advanced Data Analysis from an Elementary Point of View](https://www.stat.cmu.edu/~cshalizi/ADAfaEPoV/) sowie das [R Paket {gratia}](https://gavinsimpson.github.io/gratia/), welches bei der Darstellung von einem GAM-Modell hilft. Aber nochmal, wenn du eine Formel in deine Abbildung schreiben willst, dann ist das *Generalized Additive Model* nicht die Antwort auf deine Frage. Selbst wenn ein GAM das beste Modell sein sollte, was du findest. Die Hilfeseite <span class="co">[</span><span class="ot">How to solve common problems with GAMs</span><span class="co">](https://www.r-bloggers.com/2021/03/how-to-solve-common-problems-with-gams/)</span> ist auch ein guter Anlaufpunkt, wenn mal eine GAM_modellierung nicht funktionieren will.</span>
<span id="cb142-921"><a href="#cb142-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-922"><a href="#cb142-922" aria-hidden="true" tabindex="-1"></a>Wenn wir jetzt ein GAM rechnen wollen, dann müssen wir einmal über die Funktion <span class="in">`s()`</span> dem GAM mitteilen, welcher der variablen als Polynom in das Modell rein soll. Das ist sehr ähnlich dem <span class="in">`mfp`</span>-Modell und der Funktion <span class="in">`fp()`</span>. Wie immer kannst du der Funktion <span class="in">`s()`</span> noch zusätzliche Informationen mitgeben aber das übersteigt diese Einführung hier.</span>
<span id="cb142-923"><a href="#cb142-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-926"><a href="#cb142-926" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-927"><a href="#cb142-927" aria-hidden="true" tabindex="-1"></a>gam_fit <span class="ot">&lt;-</span> <span class="fu">gam</span>(weight <span class="sc">~</span> <span class="fu">s</span>(age), <span class="at">data =</span> chicken_tbl)</span>
<span id="cb142-928"><a href="#cb142-928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-929"><a href="#cb142-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-930"><a href="#cb142-930" aria-hidden="true" tabindex="-1"></a>Und dann können wir uns auch schon die Modellgüte des GAM einmal anschauen. Das ist eigentlich das Schöne der Implementierung in dem R Paket <span class="in">`{mgvc}`</span>, dass wir hier auch alle Helferfunktionen der anderen Pakete nutzen können.</span>
<span id="cb142-931"><a href="#cb142-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-934"><a href="#cb142-934" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-935"><a href="#cb142-935" aria-hidden="true" tabindex="-1"></a>gam_fit <span class="sc">|&gt;</span> </span>
<span id="cb142-936"><a href="#cb142-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_performance</span>()</span>
<span id="cb142-937"><a href="#cb142-937" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-938"><a href="#cb142-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-939"><a href="#cb142-939" aria-hidden="true" tabindex="-1"></a>Wir sehen auch hier, dass wir ein sehr gutes Modell mit einem Bestimmtheitsmaße $R^2$ von $98\%$. Wir könnten uns auch die Modellkoeffizienten anschauen, aber leider kriegen wir hier nur die Information, ob der Intercept signifikant unterschiedliche von der Null ist und ob wir einen signifikanten Anstieg haben. Beides ist zwar nett, aber interessiert uns eher nicht in unsere Fragestellungen.</span>
<span id="cb142-940"><a href="#cb142-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-943"><a href="#cb142-943" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-944"><a href="#cb142-944" aria-hidden="true" tabindex="-1"></a>gam_fit <span class="sc">|&gt;</span> </span>
<span id="cb142-945"><a href="#cb142-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>() </span>
<span id="cb142-946"><a href="#cb142-946" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-947"><a href="#cb142-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-948"><a href="#cb142-948" aria-hidden="true" tabindex="-1"></a>Dann können wir auch in der @fig-nls-gam-1 einmal das Modell sehen. Wir sehen, dass wir eine sehr gute Modellanpassung haben. Wir können also das Modell gut nutzen um das Gewicht von zukünftigen Hünchen zu schätzen. Eine mathematische Formel erhalten wir aber nicht.</span>
<span id="cb142-949"><a href="#cb142-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-952"><a href="#cb142-952" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-953"><a href="#cb142-953" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-954"><a href="#cb142-954" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-955"><a href="#cb142-955" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-956"><a href="#cb142-956" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-gam-1</span></span>
<span id="cb142-957"><a href="#cb142-957" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-958"><a href="#cb142-958" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-959"><a href="#cb142-959" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-960"><a href="#cb142-960" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Visualisierung der Hühnchengewichte nach Alter in Tagen mit der geschätzen nicht-linearen Regressionsgleichung."</span></span>
<span id="cb142-961"><a href="#cb142-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-962"><a href="#cb142-962" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-963"><a href="#cb142-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(gam_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb142-964"><a href="#cb142-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-965"><a href="#cb142-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-966"><a href="#cb142-966" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-967"><a href="#cb142-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-968"><a href="#cb142-968" aria-hidden="true" tabindex="-1"></a>Dann machen wir das auch gleich mal in dem wir uns drei Hühnchen mit einem Alter von 10, 20 und 30 Tagen vorgeben. Wir wollen jetzt das Gewicht der drei Hühnchen vorhersagen.</span>
<span id="cb142-969"><a href="#cb142-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-972"><a href="#cb142-972" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-973"><a href="#cb142-973" aria-hidden="true" tabindex="-1"></a>test_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>))</span>
<span id="cb142-974"><a href="#cb142-974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-975"><a href="#cb142-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-976"><a href="#cb142-976" aria-hidden="true" tabindex="-1"></a>Dafür können wir dann die Funktion <span class="in">`predict()`</span> nutzen in der wir dann zum einen unser Modell <span class="in">`gam_fit`</span> eingeben sowie die Testdaten <span class="in">`test_tbl`</span> mit den drei Altersangaben für die drei neuen Hühnchen. Wir erhalten dann das vorhergesagt Gewicht an den drei Zeitpunkten. Ob das jetzt sinnvoll ist oder nicht, hängt wie immer von der Fragestellung ab. Hier sei es einfach einmal präsentiert.</span>
<span id="cb142-977"><a href="#cb142-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-980"><a href="#cb142-980" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-981"><a href="#cb142-981" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(gam_fit, <span class="at">newdata =</span> test_tbl)</span>
<span id="cb142-982"><a href="#cb142-982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-983"><a href="#cb142-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-984"><a href="#cb142-984" aria-hidden="true" tabindex="-1"></a>Damit sind wir schon fast durch mit dem ersten Beispiel und GAM. In <span class="in">`{ggplot}`</span> musst du aber gar nicht den langen Weg gehen, wenn du nur mit GAM eine Kurve in deine Punkte zeichnen willst. Das geht sehr einfach mit der Funktion <span class="in">`stat_smooth()`</span>. Du hast dann auch dort die Möglichkeit neben GAM auch andere Arten der Anpassung einer Funktion an deine Daten zu wählen.</span>
<span id="cb142-985"><a href="#cb142-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-986"><a href="#cb142-986" aria-hidden="true" tabindex="-1"></a>Als zweites Beispiel wollen wir uns nochmal die Wasserlinsen anschauen und sehen, was passiert, wenn wir weniger Messpunkte auf der $x$-Achse haben als bei unseren Hühnchendaten. Wenn du zu wenige Beobachtungen auf der $x$-Achse hast, dann kann das GAM-Modell Probleme bekommen eine Anpassung zu rechnen. Hier hat mir dann die Seite <span class="co">[</span><span class="ot">How to solve common problems with GAMs</span><span class="co">](https://www.r-bloggers.com/2021/03/how-to-solve-common-problems-with-gams/)</span> sehr geholfen. Ich musste einfach die Anzahl an Dimensionen $k$ für den Glättungsterm auf eine niedrigere Zahl setzen. Wenn du also zu wenige Messwerte hast, dann ist das Setzen von $k&lt;5$ eine guter Startpunkt.</span>
<span id="cb142-987"><a href="#cb142-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-990"><a href="#cb142-990" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-991"><a href="#cb142-991" aria-hidden="true" tabindex="-1"></a>duckweeds_gam_fit <span class="ot">&lt;-</span> <span class="fu">gam</span>(sensor <span class="sc">~</span> <span class="fu">s</span>(duckweeds_density, <span class="at">k =</span> <span class="dv">3</span>), <span class="at">data =</span> duckweeds_tbl)</span>
<span id="cb142-992"><a href="#cb142-992" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-993"><a href="#cb142-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-994"><a href="#cb142-994" aria-hidden="true" tabindex="-1"></a>Dann können wir uns auch schon in der @fig-nls-ggplot-gam-fit die Anpassung der Kurve aus GAM an die Beobachtungen anschauen. Da die Methode keine mathematische Formel oder entaprechende Koeffizienten wiedergibt, müssen wir hier mit der <span class="in">`predict()`</span> Funktion arbeiten. Das Ergebnis sieht aber sehr gut aus, wir laufen mit der Kurve sehr gut durch die Beobachtungen.</span>
<span id="cb142-995"><a href="#cb142-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-998"><a href="#cb142-998" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-999"><a href="#cb142-999" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-1000"><a href="#cb142-1000" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-1001"><a href="#cb142-1001" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-1002"><a href="#cb142-1002" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-ggplot-gam-fit</span></span>
<span id="cb142-1003"><a href="#cb142-1003" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-1004"><a href="#cb142-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-1005"><a href="#cb142-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-1006"><a href="#cb142-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Angepasste Kurve aus der Funktion `gam()`."</span></span>
<span id="cb142-1007"><a href="#cb142-1007" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(duckweeds_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb142-1008"><a href="#cb142-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-1009"><a href="#cb142-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(duckweeds_gam_fit)), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#CC79A7"</span>) <span class="sc">+</span></span>
<span id="cb142-1010"><a href="#cb142-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-1011"><a href="#cb142-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-1012"><a href="#cb142-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1013"><a href="#cb142-1013" aria-hidden="true" tabindex="-1"></a>Wenn wir GAM nutzen dann können wir uns auf verschiedenen Wegen ein Konfidenzintervall wiedergeben lassen. Ein Vorhersageintervall ist nur mit sehr viel Arbeit und eigenem Programmieren möglich. Mir was das in dem Tutorium <span class="co">[</span><span class="ot">Prediction intervals for Generalized Additive Models (GAMs)</span><span class="co">](https://mikl.dk/post/2019-prediction-intervals-for-gam/)</span> einfach zu krass. Für mich lohnt es sich nicht auf die Art und Weise ein Vorhersageintervall zu berechnen, da bleibe ich lieber bei den Implementierungen, die es schon gibt. Daher jetzt einmal das Konfidenzintervall aus dem <span class="co">[</span><span class="ot">R Paket `{ggeffects}`</span><span class="co">](https://strengejacke.github.io/ggeffects/index.html)</span>, dem <span class="co">[</span><span class="ot">R Paket `{marginaleffects}`</span><span class="co">](https://marginaleffects.com/)</span> sowie dem <span class="co">[</span><span class="ot">R Paket `{gratia}`</span><span class="co">](https://gavinsimpson.github.io/gratia/reference/confint.gam.html)</span>. Wie immer ist es auch eien Sammlung an Möglichkeiten. Wenn ich entscheiden müsste, dann würde ich das R Paket <span class="in">`{marginaleffects}`</span> bevorzugen, die Funktionalität ist einfach. Das R Paket <span class="in">`{gratia}`</span> hat den Vorteil für GAM-Modelle entwickelt zus ein.</span>
<span id="cb142-1014"><a href="#cb142-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1015"><a href="#cb142-1015" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb142-1016"><a href="#cb142-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mit `{marginaleffects}`</span></span>
<span id="cb142-1017"><a href="#cb142-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1018"><a href="#cb142-1018" aria-hidden="true" tabindex="-1"></a>Das R Paket <span class="in">`{marginaleffects}`</span> erlaubt es ziemlich direkt die vorhergesagten Werte über die Funktion <span class="in">`predictions()`</span> aus den Daten zu erhalten. Es gibt auch eine Hilfeseite unter <span class="co">[</span><span class="ot">GAM -- Estimate a Generalized Additive Model</span><span class="co">](https://marginaleffects.com/vignettes/gam.html)</span>. Wir müssen hier noch etwas aufräumen und die doppelten Werte für die Wasserlinsendichte über die Funktion <span class="in">`distinct()`</span> entfernen. Wir erhalten hier auch etwas mehr Informationen also wir in den anderen Paekten wiedergegeben kriegen.</span>
<span id="cb142-1019"><a href="#cb142-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1022"><a href="#cb142-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-1023"><a href="#cb142-1023" aria-hidden="true" tabindex="-1"></a>marg_pred_tbl <span class="ot">&lt;-</span> <span class="fu">predictions</span>(duckweeds_gam_fit, <span class="at">newdata =</span> duckweeds_tbl) <span class="sc">|&gt;</span> </span>
<span id="cb142-1024"><a href="#cb142-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb142-1025"><a href="#cb142-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(duckweeds_density, sensor, estimate, std.error, conf.low, conf.high) <span class="sc">|&gt;</span> </span>
<span id="cb142-1026"><a href="#cb142-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb142-1027"><a href="#cb142-1027" aria-hidden="true" tabindex="-1"></a>marg_pred_tbl </span>
<span id="cb142-1028"><a href="#cb142-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-1029"><a href="#cb142-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1030"><a href="#cb142-1030" aria-hidden="true" tabindex="-1"></a>Im Folgenden werde ich gleich die Ausgabe <span class="in">`marg_pred_tbl`</span> nutzen um in dem <span class="in">`ggplot`</span> die Konfidenzintervalle einmal zu visualisieren. Da wir alle Informationen haben, geht das sehr direkt aus der Funktion heraus.</span>
<span id="cb142-1031"><a href="#cb142-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1032"><a href="#cb142-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mit `{gratia}`</span></span>
<span id="cb142-1033"><a href="#cb142-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1034"><a href="#cb142-1034" aria-hidden="true" tabindex="-1"></a>Das R Paket <span class="in">`{gratia}`</span> erlaubt mit der Funktion <span class="in">`confint()`</span> die Konfidenzintervalle des GAM-Modells zu schätzen. Hier müssen wir dann einiges angeben. Wenn du die Option <span class="in">`shift = TRUE`</span> vergisst, dann wird nicht der Intercept auf die Konfidenzintervalle addiert und dein Konfidenzintervall liegt dann sauber auf dem Ursprung. Das war super nervig rauszufinden warum das am Anfang so war. Auch heißt es hier mal <span class="in">`data`</span> statt <span class="in">`newdata`</span>, aber das war dann schon nicht das Problem mehr. Auch hier schmeiße ich am Ende alle doppelten Wasserlinsendichten aus den Daten mit der Funktion <span class="in">`distinct()`</span> raus.</span>
<span id="cb142-1035"><a href="#cb142-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1038"><a href="#cb142-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-1039"><a href="#cb142-1039" aria-hidden="true" tabindex="-1"></a>gratia_pred_tbl <span class="ot">&lt;-</span> <span class="fu">confint</span>(duckweeds_gam_fit, <span class="at">parm =</span> <span class="st">"s(duckweeds_density)"</span>, </span>
<span id="cb142-1040"><a href="#cb142-1040" aria-hidden="true" tabindex="-1"></a>                           <span class="at">shift =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"confidence"</span>, <span class="at">data =</span> duckweeds_tbl) <span class="sc">|&gt;</span> </span>
<span id="cb142-1041"><a href="#cb142-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(duckweeds_density, .estimate, .se, .lower_ci, .upper_ci) <span class="sc">|&gt;</span> </span>
<span id="cb142-1042"><a href="#cb142-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(duckweeds_density, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb142-1043"><a href="#cb142-1043" aria-hidden="true" tabindex="-1"></a>gratia_pred_tbl </span>
<span id="cb142-1044"><a href="#cb142-1044" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-1045"><a href="#cb142-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1046"><a href="#cb142-1046" aria-hidden="true" tabindex="-1"></a>Neben der Funktion <span class="in">`confint()`</span> hat das R Paket noch eine weitreichende Fülle an zusätzlichen Funktionen für die Darstellung von komplexeren GAM-Modellen. Es lohnt sich also auf jeden Fall einmal die <span class="co">[</span><span class="ot">Hilfeseite von `{gratia}`</span><span class="co">](https://gavinsimpson.github.io/gratia/)</span> zu besuchen und mehr über das R Paket zu erfahren, wenn du tiefergreifend mit der Modellierung von GAM's beginnen willst.</span>
<span id="cb142-1047"><a href="#cb142-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1048"><a href="#cb142-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mit `{ggeffects}`</span></span>
<span id="cb142-1049"><a href="#cb142-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1050"><a href="#cb142-1050" aria-hidden="true" tabindex="-1"></a>R Paket <span class="in">`{ggeffects}`</span> liefert mit der Funktion <span class="in">`ggpredict()`</span> eine super aufgeräumte Funktion um die vorhergesagten Werte von dem Sensor für die Wasserlinsendichte zu erhalten. Dann kriegen wir auch noch ein Konfidenzintervall dazu. Der einzige Manko ist, dass wir die Ausgabe für die weitere Verwertung dann etwas mehr bearbeiten müssen.</span>
<span id="cb142-1051"><a href="#cb142-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1054"><a href="#cb142-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-1055"><a href="#cb142-1055" aria-hidden="true" tabindex="-1"></a>gg_pred_obj <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(duckweeds_gam_fit, <span class="at">terms =</span> <span class="st">"duckweeds_density"</span>) </span>
<span id="cb142-1056"><a href="#cb142-1056" aria-hidden="true" tabindex="-1"></a>gg_pred_obj</span>
<span id="cb142-1057"><a href="#cb142-1057" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-1058"><a href="#cb142-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1059"><a href="#cb142-1059" aria-hidden="true" tabindex="-1"></a>Wenn du die Ausgabe dann weiter verwenden willst, dann musst du hier noch etwas mehr Arbeit rein stecken und die Ausgabe dann über die Umwandlung in einen <span class="in">`tibble`</span> weiterverarbeiten.</span>
<span id="cb142-1060"><a href="#cb142-1060" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-1061"><a href="#cb142-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1062"><a href="#cb142-1062" aria-hidden="true" tabindex="-1"></a>In der @fig-gam-duckweed-02 siehst du dann einmal die angepasste Kurve aus der Funktion <span class="in">`gam()`</span> zusammen mit dem Konfidenzintervall aus <span class="in">`{marginaleffects}`</span>. Wenn du oben in den Tabs einmal die Ausgaben aus den Funktionen vergleichst, wirst du feststellen, dass die numerischen Werte alle sehr ähnlich sind. Daher ist es eher eine Geschmacks- und Anwendungsfrage, welches Paket du verwendest. Wenn du viel mit GAM-Modellen rechnest, dann kannst du auch alles sehr gut in der Umgebung des R Paketes <span class="in">`{gratia}`</span> machen. Die Kurve läuft jedenfalls super durch unser Konfidenzintervall, daher können wir uns ziemlich sicher sein, gute Koeffizienten für das GAM-Modell gefunden zu haben. Wie schon oben geschrieben, an ein mathematisches Modell mit Funktion kommst du in GAM nicht ran. Dafür musst du dann eine andere Implementierung wie <span class="in">`nls()`</span> oder <span class="in">`mfp()`</span> nutzen.</span>
<span id="cb142-1063"><a href="#cb142-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1066"><a href="#cb142-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-1067"><a href="#cb142-1067" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-1068"><a href="#cb142-1068" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-1069"><a href="#cb142-1069" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-1070"><a href="#cb142-1070" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-gam-duckweed-02</span></span>
<span id="cb142-1071"><a href="#cb142-1071" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-1072"><a href="#cb142-1072" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-1073"><a href="#cb142-1073" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-1074"><a href="#cb142-1074" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Angepasste Kurve aus der Funktion `gam()` zusammen mit dem Konfidenzintervall aus `{marginaleffects}`."</span></span>
<span id="cb142-1075"><a href="#cb142-1075" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb142-1076"><a href="#cb142-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(marg_pred_tbl, <span class="fu">aes</span>(duckweeds_density, sensor)) <span class="sc">+</span></span>
<span id="cb142-1077"><a href="#cb142-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), <span class="at">fill =</span> <span class="st">"grey90"</span>) <span class="sc">+</span></span>
<span id="cb142-1078"><a href="#cb142-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-1079"><a href="#cb142-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> estimate), <span class="at">color =</span> cb_pal[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb142-1080"><a href="#cb142-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-1081"><a href="#cb142-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1082"><a href="#cb142-1082" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-1083"><a href="#cb142-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1084"><a href="#cb142-1084" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb142-1085"><a href="#cb142-1085" aria-hidden="true" tabindex="-1"></a><span class="fu">## Gam und Loess in `{ggplot}`</span></span>
<span id="cb142-1086"><a href="#cb142-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1087"><a href="#cb142-1087" aria-hidden="true" tabindex="-1"></a>In <span class="in">`{ggplot}`</span> können wir direkt über die Funktion <span class="in">`stat_smooth()`</span> eine Kurve durch unsere Punkte legen. Wenn du mehr Lesen willst, dann empfehle ich einmal das Tutorium zu <span class="co">[</span><span class="ot">GAM and LOESS smoothing</span><span class="co">](https://andrewirwin.github.io/data-visualization/smoothing.html)</span>. Ich gehe hier nicht weiter auf die <span class="co">[</span><span class="ot">Local Regression (LOESS)</span><span class="co">](https://thomasleeper.com/Rcourse/Tutorials/localregression.html)</span> ein, da wir weder ein Bestimmtheitsmaße $R^2$ noch eine mathematische Geradengleichung. Daher lohnt sich aus meiner Sicht die Anwendung der Funktion <span class="in">`loess()`</span> einfach in der Praxis nicht. für die Visualisierung mag es aber dann doch sinnvoll sein. Damit können wir auch einfach eine GAM oder Loess-Funktion in <span class="in">`ggplot()`</span> direkt anwenden ohne über zusätzliche Pakete oder Funktionen zu gehen.</span>
<span id="cb142-1088"><a href="#cb142-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1091"><a href="#cb142-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-1092"><a href="#cb142-1092" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb142-1093"><a href="#cb142-1093" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb142-1094"><a href="#cb142-1094" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb142-1095"><a href="#cb142-1095" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nls-ggplot-gam</span></span>
<span id="cb142-1096"><a href="#cb142-1096" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb142-1097"><a href="#cb142-1097" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb142-1098"><a href="#cb142-1098" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb142-1099"><a href="#cb142-1099" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Direkte Anwednung von GAM und Loess in `ggplot()` ohne eine zusätzliche Funktion."</span></span>
<span id="cb142-1100"><a href="#cb142-1100" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb142-1101"><a href="#cb142-1101" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "GAM"</span></span>
<span id="cb142-1102"><a href="#cb142-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Loess"</span></span>
<span id="cb142-1103"><a href="#cb142-1103" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 1</span></span>
<span id="cb142-1104"><a href="#cb142-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1105"><a href="#cb142-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1106"><a href="#cb142-1106" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-1107"><a href="#cb142-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>) <span class="sc">+</span></span>
<span id="cb142-1108"><a href="#cb142-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-1109"><a href="#cb142-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-1110"><a href="#cb142-1110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-1111"><a href="#cb142-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1114"><a href="#cb142-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb142-1115"><a href="#cb142-1115" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(chicken_tbl, <span class="fu">aes</span>(age, weight)) <span class="sc">+</span></span>
<span id="cb142-1116"><a href="#cb142-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb142-1117"><a href="#cb142-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb142-1118"><a href="#cb142-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb142-1119"><a href="#cb142-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb142-1120"><a href="#cb142-1120" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb142-1121"><a href="#cb142-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-1122"><a href="#cb142-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">## Referenzen {.unnumbered}</span></span>
</code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Bio Data Science wurde von <a href="https://www.hs-osnabrueck.de/prof-dr-jochen-kruppa/">Jochen Kruppa-Scheetz</a> geschrieben.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jkruppa/jkruppa.github.io/edit/master/stat-modeling-non-linear.qmd" class="toc-action"><i class="bi bi-github"></i>Seite editieren</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Problem melden</a></li><li><a href="https://github.com/jkruppa/jkruppa.github.io/blob/master/stat-modeling-non-linear.qmd" class="toc-action"><i class="bi empty"></i>Quellcode anzeigen</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Dieses Openbook wurde mit <a href="https://quarto.org/">Quarto</a> erstellt.</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","closeEffect":"zoom","openEffect":"zoom","descPosition":"bottom","loop":false});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>