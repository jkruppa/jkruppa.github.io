```{r echo = FALSE}
pacman::p_load(tidyverse, readxl, knitr, kableExtra, openxlsx)
```

# Von Flöhen auf Tieren {#sec-example-3}

*Version vom `r format(Sys.time(), '%B %d, %Y um %H:%M:%S')`*

## Von Flöhen auf Hunde, Katzen und Füchsen

```{r }
#| echo: false
#| message: false

data_tbl <- read_csv2("data/flea_dog_cat.csv")
```

Wir wollen jetzt das Beispiel von den Hunde- und Katzenflöhen um eine *weitere* Spezies erweitern. Warum machen wir das? Später wollen wir uns anschauen, wie sich verschiedene Gruppen oder Behandlungen voneinander unterscheiden. Wir brauchen alos mehr Spezies. Wir nehmen noch die Füchse mit dazu und fragen uns, wie sieht es mit der Sprungfähigkeit von Hunde-, Katzen- und Fuchsflöhen aus?

```{r echo = FALSE}
#| label: tbl-dog-cat-fox
#| tbl-cap: Sprunglängen [cm] für Hunde-, Katzen- und Fuchsflöhe. 

y_jump_fox <- c(7.7, 8.1, 9.1, 9.7, 10.6, 8.6, 10.3)
y_grade_fox <- c(5, 4, 4, 5, 4, 4, 3)
y_count_fox <- c(21, 25, 31, 12, 28, 18, 19)
y_infected_fox <- c(1, 1, 1, 1, 0, 1, 0)

data_tbl <- rbind(data_tbl,  
                  tibble(fox = y_jump_fox) %>%
                    gather(animal, jump_length) %>%
                    mutate(flea_count = c(y_count_fox),
                           grade = c(y_grade_fox),
                           infected = c(y_infected_fox)))

write.csv2(data_tbl, "data/flea_dog_cat_fox.csv", row.names = FALSE)
write.xlsx(data_tbl, "data/flea_dog_cat_fox.xlsx", rowNames = FALSE)


data_tbl %>%
  kable(align = "c", "pipe")

```

Der Datensatz in @tbl-dog-cat-fox beginnt schon recht groß zu werden. Deshalb brauchen wir auch R als Werkzeug um große Datensätze auswerten zu können.

::: callout-tip
## Datei für von Flöhen auf Tieren

Du findest die Datei `flea_dog_cat_fox.xlsx` auf GitHub [jkruppa.github.io/data/](https://github.com/jkruppa/jkruppa.github.io/tree/master/data) als Excel oder auch als CSV.
:::

## Von Flöhen auf Tieren in Habitaten {#sec-example-4}

Wir schauen uns in diesem Beispiel wiederum drei Tierarten an: Hunde, Katzen und Füchse. Auf diesen Tierarten messen wir die Sprunglänge von jeweils zehn Tieren. Im Vergleich zu dem vorherigen Beispiel erweitern wir die Daten um eine Spalte `site` in der wir vier verschiedene Messorte protokollieren. Es ergibt sich folgende @tbl-example-4 und die dazugehörige @fig-example-4.

```{r }
#| message: false
#| echo: false

set.seed(20220812)
data_tbl <- expand_grid(animal = 1:3, site = 1:4, rep = 1:10) %>% 
  mutate(jump_length = round(8 + 5 * animal + 2.5 * site - 1.5 * animal * site + rnorm(n(), 0, 2), 2),
         animal = factor(animal, labels = c("cat", "dog", "fox")),
         site = factor(site, labels = c("city", "smalltown", "village", "field")))

write.csv2(data_tbl, "data/flea_dog_cat_fox_site.csv", row.names = FALSE)
write.xlsx(data_tbl, "data/flea_dog_cat_fox_site.xlsx", rowNames = FALSE)
```

```{r}
#| message: false
#| echo: false
#| tbl-cap: Sprunglängen [cm] für Hunde-, Katzen- und Fuchsflöhe in verschiedenen Habitaten. 
#| label: tbl-example-4

data_tbl %>%
  kable(align = "c", "pipe")
```

[Über die explorative Datenanalyse erfährst du mehr im @sec-eda-ggplot]{.aside}

Die Datentabelle ist in dieser Form schon fast nicht mehr überschaubar. Daher hilft hier die explorative Datenanalyse weiter. Wir schauen uns daher die Daten einmal als einen Boxplot in @fig-example-4 an. Wir sehen hier, dass wir drei Tierarten an vier Orten die Sprungweite in \[cm\] gemessen haben.

```{r}
#| message: false
#| echo: false
#| fig-align: center
#| fig-height: 4
#| fig-width: 6
#| fig-cap: Boxplot der Sprungweiten [cm] für Hunde-, Katzen- und Fuchsflöhe in verschiedenen Habitaten.
#| label: fig-example-4

ggplot(data_tbl, aes(animal, jump_length, fill = site)) + 
  geom_boxplot() +
  labs(x = "Tierart", y = "Sprungweite [cm]") +
  theme_bw() 
```

::: callout-tip
## Datei für von Flöhen auf Tieren in Habitaten

Du findest die Datei `flea_dog_cat_fox_site.xlsx` auf GitHub [jkruppa.github.io/data/](https://github.com/jkruppa/jkruppa.github.io/tree/master/data) als Excel oder auch als CSV.
:::
