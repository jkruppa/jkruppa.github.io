```{r echo = FALSE}
pacman::p_load(tidyverse, readxl, knitr, kableExtra, gghalves,
               ggdist, patchwork, see, ggmosaic, ggsignif,
               latex2exp)
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", 
                "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# Statistisches Modellieren {#sec-stat-model-preface}

*Letzte Änderung am `r format(fs::file_info("stat-modeling-preface.qmd")$modification_time, '%d. %B %Y um %H:%M:%S')`*

> *"Sei bereit, sei bereit, sonst kommst du nicht sehr weit; Dann tut's dir später leid, drum sei bereit; sei bereit sei bereit, sei clever und gescheit; so bist du gegen jeden Test gefeit" --- Jan Delay Ziegen Song (sei Bereit)*

Was ist statistisches Modellieren? In diesem und den nun folgenden Kapitel wollen wir uns mit den Grundlagen der *multiplen* linearen Regression beschäftigen. Deshalb hier nochmal die Wiederholung was eine [multiple lineare Regression](#sec-mult-reg-basic) ist. Wir erinnern uns, dass wir ein Outcome $y$, was einer Verteilung folgt, sowie mehrere Einflussvariable $x_1$ bis $x_p$ vorliegen haben. Wir wollen jetzt herausfinden, welchen Einfluss oder Effekt die $x_1, ..., x_p$ auf das $y$ hat. Sehr simple gesprochen legen wir eine Gerade durch eine *mehrdimensionale* Punktewolke.

Wir erinnern und nochmal, das ein *simples* lineares Modell nur ein $x_1$ hat:

$$
y \sim x_1
$$

Ein *multiples* lineares Modell hat von $x_1$ bis $x_p$ Einflussvariablen:

$$
y \sim x_1 + x_2 + ... + x_p
$$

Wir brauchen viele der Konzepte aus den vorherigen Kapiteln zur Modellgüte sowie Konfidenzintervallen. Vieles fällt hier zusammen. Schau dir ruhig nochmal die vorherigen Kapitel an, wenn dir etwas unklar ist. Häufig wollen wir auch etwas spezifischer sein. Wir schreiben daher einen Faktor mit einem $f$ wie folgt.

$$
y \sim f_1
$$

Wenn wir dann noch einen Block mit hinzunehmen, dann erweitern wir das Modell um einen Blockfaktor mit einem $b$ wie folgt.

$$
y \sim f_1 + b_1
$$

Es kann auch sein, dass wir noch einen zufälligen Effekt (eng. *random effect*) mit in das Modell nehmen wollen. Wir bezeichnen einen zufälligen Effekt mit einem $z$ wie folgt.

$$
y \sim f_1 + z_1
$$

Ich habe aber noch ein Video eingesprochen, dass dir eventuell helfen wird.

{{< video https://youtu.be/2fXExWzipDI >}}

## Das Regressionskreuz

In diesem Kapitel wollen wir uns mit der Grundlage der multiplen linearen Regression beschäftigen. Das heist wir schauen uns Modelle mit mehreren $x$ an. Wir haben also nicht mehr nur eine Einflussvariable auf der rechten Seite der Gleichung sondern meist mehrere. Je nachdem wie diese $x$ beschaffen sind, müssen wir die $x$ auch interpretieren. Wir unterscheiden in vier Arten von $x$.

1)  Das zu betrachtende $x$ ist eine Variable mit **kontinuierlichen Zahlen** (siehe @sec-interpret-x-cont)
2)  Das zu betrachtende $x$ ist eine Variablen mit **einem Faktor mit zwei Leveln** (siehe @sec-interpret-x-cat2).
3)  Das zu betrachtende $x$ ist eine Variablen mit **einem Faktor mit mehr als zwei Leveln** (siehe @sec-interpret-x-cat3).
4)  Das zu betrachtende $x$ ist eine Variable, die einen **Block oder Cluster** beschreibt (siehe @sec-mixed).

Wir finden die Fälle 1) bis 3) in der in den Spalten wieder.

Neben dem $x$ müssen wir auch das $y$ in diesem Kapitel betrachten. Das $y$ kann aus verschiedenen Verteilungen kommen. Häufig nehmen wir an, dass das $y$ normalverteilt ist, das muss das $y$ aber nicht sein. Je nachdem wir das $y$ verteilt ist, rechen wir eine andere multiple Regression.

1)  Das zu betrachtende $y$ folgt einer **Normalverteilung** bzw. entstammt einer **Gaussian** Vertreilungsfamilie. Wir wollen dann eine multiple Gaussian Regression rechen.
2)  Das zu betrachtende $y$ folgt einer **Poissonverteilung** bzw. entstammt einer Poisson Vertreilungsfamilie. Wir wollen dann eine multiple Poisson Regression rechen.
3)  Das zu betrachtende $y$ folgt einer **Ordinalen- oder Multinominalenverteilung** bzw. entstammt einer Ordinalen- oder Multinominalen Vertreilungsfamilie. Wir wollen dann eine multiple ordinale oder multinominale Regression rechen.
4)  Das zu betrachtende $y$ folgt einer **Binomialverteilung** bzw. entstammt einer Binomialen Vertreilungsfamilie. Wir wollen dann eine multiple logistische Regression rechen.

Wir finden die Fälle 1) bis 4) in der in den Zeilen wieder.

::: callout-note
## Wo sind die Barplots?

Text
:::

::: callout-note
## Wir mitteln uns die Welt, wie sie mir gefällt...

> "2 x 3 macht 4; Widdewiddewitt; und Drei macht Neune!; Wir machen uns die Welt; Widdewidde wie sie uns gefällt..." --- Hey Pippi Langstrumpf

Test
:::

## Gaussian

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-scatter-modeling-R-01
#| fig-align: center
#| fig-height: 5
#| fig-width: 15
#| fig-cap: "Verschiedene Ziele und Möglichkeiten des statistischen Modellierens. Grob können die Möglichkeiten in drei große thematische Zusammenhänge eingeteilt werden."
#| column: page

set.seed(20240329)

cross_tbl <- tibble(x_num = seq(0, 5, 0.1),
                    x_fct = gl(3, 17, labels = c("A", "B", "C")),
                    y_normal = 0 + 1.2 * x_num + rnorm(length(x_num), 0, 2),
                    y_pois = round(0 + 0.8 * x_num + rnorm(length(x_num), 0, 1)),
                    y_grad = case_when(y_normal < 1 ~ 0,
                                       y_normal >= 1 & y_normal < 3 ~ 1,
                                       y_normal >= 3 ~ 2),
                    y_beta = (y_normal - min(y_normal))/(max(y_normal) - min(y_normal)),
                    y_binom = ifelse(y_normal <= 3, 0, 1))

gg_template <- ggplot() +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text = element_text(size = 12),
        axis.title = element_text(size = 14, face = "bold"),
        title = element_text(size = 14, face = "bold"),
        plot.caption = element_text(face = "italic"),
        legend.position = "none") +
  scale_color_okabeito() +
  scale_fill_okabeito() 
  
p11 <- gg_template %+%
  cross_tbl + 
  aes(x_num, y_normal) +
  geom_point() +
  labs(x = "Kontinuierlich", y = "Kontinuierlich",
       title = "Lineare Regression",
       subtitle = "Regressionsgleichung, Korrelation und\nBestimmtheitsmaß") +
  annotate("text", x = 1, y = 7, hjust = "left", color = "black", size = 4, 
           label = TeX(r"($y = 0.02 + 1.04 \cdot x$)")) +
  annotate("text", x = 1, y = 6.25, hjust = "left", color = "black", size = 4, 
           label = TeX(r"($r = 0.76\; (p<0.001)$)")) +
  annotate("text", x = 1, y = 5.5, hjust = "left", color = "black", size = 4, 
           label = TeX(r"($R^2 = 0.58$)")) +
  geom_smooth(method = "lm", se = FALSE, color = "gray") +
  geom_curve(x = 2.6, y = 7, xend = 4.5, yend = 4.8,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.5) 

p12 <- gg_template %+%
  cross_tbl + 
  aes(x_fct, y_normal, fill = x_fct) +
  geom_boxplot(width = 0.15, outlier.shape = NA) +
  stat_dots(side = "left", justification = 1.12, binwidth = 0.01,
            dotsize = 25) +
  annotate("text", x = 1, y = 9, hjust = "right", color = "black", size = 4, 
           label = TeX(r"($ANOVA < 0.05$)")) +
  annotate("text", x = c(1, 2, 3), y = c(4, 8, 9),
          label = c("a", "ab", "b"), size = 5, fontface = 2) +
  labs(x = "Kategoriell (>2 Level)", y = "Kontinuierlich",
       title = "Multipler Gruppenvergleich",
       subtitle = "ANOVA, Paarweiser Vergleich und\ncompact letter display",
       caption = "Auch mit Kruskal-Wallis-Test möglich.") +
  scale_y_continuous(expand = expand_scale(mult = c(0.1, 0.1)))

p13 <- gg_template %+%
  filter(cross_tbl, x_fct != "C") + 
  aes(x_fct, y_normal, fill = x_fct) +
  geom_boxplot(width = 0.15, outlier.shape = NA) +
  stat_dots(side = "left", justification = 1.12, binwidth = 0.01,
            dotsize = 23) +
  geom_signif(comparisons = list(c("A", "B")),
              map_signif_level = TRUE, textsize = 6) +
  labs(x = "Kategoriell (2 Level)", y = "Kontinuierlich",
       title = "Gruppenvergleich",
       subtitle = "Student t-Test, Welch t-Test oder\nWilcoxon-Mann-Whitney-Test") +
  scale_y_continuous(expand = expand_scale(mult = c(0.1, 0.1)))

p11 + p12 + p13 +
  plot_layout(ncol = 3) +
  plot_annotation(tag_levels = 'A')

```

## Poisson

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-scatter-modeling-R-02
#| fig-align: center
#| fig-height: 5
#| fig-width: 15
#| fig-cap: "Verschiedene Ziele und Möglichkeiten des statistischen Modellierens. Grob können die Möglichkeiten in drei große thematische Zusammenhänge eingeteilt werden."
#| column: page

gg_template <- ggplot() +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        #axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text = element_text(size = 12),
        axis.title = element_text(size = 14, face = "bold"),
        title = element_text(size = 14, face = "bold"),
        plot.caption = element_text(face = "italic"),
        legend.position = "none") +
  scale_color_okabeito() +
  scale_fill_okabeito() 

p21 <- gg_template %+%
  filter(cross_tbl, y_pois >= 0) + 
  aes(x_num, y_pois) +
  geom_point() +
  geom_hline(yintercept = 0, color = "gray") +
  labs(x = "Kontinuierlich", y = "Kontinuierlich",
       title = "Poisson Regression",
       subtitle = "Regressionsgleichung, Korrelation und\nBestimmtheitsmaß") +
  annotate("text", x = 4, y = 1.5, hjust = "left", color = "black", size = 4, 
           label = "0 Zählungen", fontface = 2) +
  geom_curve(x = 3.9, y = 1.5, xend = 2, yend = 0.1,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.5) +
  scale_y_continuous(labels = c(0, "", "", ""),
                     expand = expand_scale(mult = c(0.05, 0.1)))

p22 <- gg_template %+%
  filter(cross_tbl, y_pois >= 0) +  
  aes(x_fct, y_pois, fill = x_fct) +
  geom_boxplot(width = 0.15, outlier.shape = NA) +
  geom_hline(yintercept = 0, color = "gray") +
  stat_dots(side = "left", justification = 1.12, binwidth = 0.01,
            dotsize = 15) +
  annotate("text", x = 2, y = 6, hjust = "right", color = "black", size = 4, 
           label = TeX(r"($Kruskal-Wallis-Test < 0.05$)")) +
  annotate("text", x = c(1, 2, 3), y = c(3, 5, 6),
          label = c("a", "ab", "b"), size = 5, fontface = 2) +
  labs(x = "Kategoriell (>2 Level)", y = "Kontinuierlich",
       title = "Multipler Gruppenvergleich",
       subtitle = "Kruskal-Wallis-Test, Paarweiser Vergleich und\ncompact letter display",
       caption = "Auch mit ANOVA möglich.") +
  scale_y_continuous(labels = c(0, "", "", ""),
                     expand = expand_scale(mult = c(0.05, 0.1)))

p23 <- gg_template %+%
  filter(cross_tbl, x_fct != "C" & y_pois >= 0) + 
  aes(x_fct, y_pois, fill = x_fct) +
  geom_boxplot(width = 0.15, outlier.shape = NA) +
  geom_hline(yintercept = 0, color = "gray") +
  stat_dots(side = "left", justification = 1.12, binwidth = 0.01,
            dotsize = 12) +
  geom_signif(comparisons = list(c("A", "B")),
              map_signif_level = TRUE, textsize = 6) +
  labs(x = "Kategoriell (2 Level)", y = "Kontinuierlich",
       title = "Gruppenvergleich",
       subtitle = "Wilcoxon-Mann-Whitney-Test",
       caption = "Auch mit Welch t-Test möglich.") +
  scale_y_continuous(labels = c(0, "", "", "", "", ""),
                     expand = expand_scale(mult = c(0.05, 0.1)))

p21 + p22 + p23 +
  plot_layout(ncol = 3) +
  plot_annotation(tag_levels = 'A')
```

## Beta

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-scatter-modeling-R-03
#| fig-align: center
#| fig-height: 5
#| fig-width: 15
#| fig-cap: "Verschiedene Ziele und Möglichkeiten des statistischen Modellierens. Grob können die Möglichkeiten in drei große thematische Zusammenhänge eingeteilt werden."
#| column: page


gg_template <- ggplot() +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        #axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text = element_text(size = 12),
        axis.title = element_text(size = 14, face = "bold"),
        title = element_text(size = 14, face = "bold"),
        plot.caption = element_text(face = "italic"),
        legend.position = "none") +
  scale_color_okabeito() +
  scale_fill_okabeito() 

p31 <- gg_template %+%
  filter(cross_tbl, y_beta >= 0) + 
  geom_hline(yintercept = c(0, 1), color = "gray") +
  aes(x_num, y_beta) +
  geom_point() +
  annotate("text", x = 4, y = 0.1, hjust = "left", color = "black", size = 4, 
           label = "0%", fontface = 2) +
  geom_curve(x = 3.9, y = 0.1, xend = 2, yend = 0.01,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.5) +
  annotate("text", x = 1, y = 0.9, hjust = "left", color = "black", size = 4, 
           label = "100%", fontface = 2) +
  geom_curve(x = 1.6, y = 0.9, xend = 3.5, yend = 0.99,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.5) +
  scale_y_continuous(labels = scales::percent) +
  labs(x = "Kontinuierlich", y = "Kontinuierlich",
       title = "Beta Regression",
       subtitle = "Regressionsgleichung, Korrelation und\nBestimmtheitsmaß") 

p32 <- gg_template %+%
  filter(cross_tbl, y_beta >= 0 & y_beta < 0.8) +  
  aes(x_fct, y_beta, fill = x_fct) +
  geom_boxplot(width = 0.15, outlier.shape = NA) +
  stat_dots(side = "left", justification = 1.12, binwidth = 0.005,
            dotsize = 5) +
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,1)) +
  labs(x = "Kategoriell (>2 Level)", y = "Kontinuierlich",
       title = "Multipler Gruppenvergleich",
       subtitle = "Kruskal-Wallis-Test, Paarweiser Vergleich und\ncompact letter display",
       caption = "Auch mit ANOVA möglich.") +
    annotate("text", x = 2, y = 0.9, hjust = "right", color = "black", size = 4, 
           label = TeX(r"(Kruskal-Wallis-Test < 0.05$)")) +
    annotate("text", x = c(1, 2, 3), y = c(0.6, 0.75, 0.85),
          label = c("a", "ab", "b"), size = 5, fontface = 2) 

p33 <- gg_template %+%
  filter(cross_tbl, x_fct != "C" & y_beta >= 0 & y_beta < 0.8) + 
  aes(x_fct, y_beta, fill = x_fct) +
  geom_boxplot(width = 0.15, outlier.shape = NA) +
  stat_dots(side = "left", justification = 1.12, binwidth = 0.005,
            dotsize = 5) + 
  scale_y_continuous(labels = scales::percent,
                     limits = c(0,1)) +
  geom_signif(comparisons = list(c("A", "B")),
              map_signif_level = TRUE, textsize = 6) +
  labs(x = "Kategoriell (2 Level)", y = "Kontinuierlich",
       title = "Gruppenvergleich",
       subtitle = "Wilcoxon-Mann-Whitney-Test",
       caption = "Auch mit Welch t-Test möglich.")

p31 + p32 + p33 +
  plot_layout(ncol = 3)
```

## Ordinal

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-scatter-modeling-R-04
#| fig-align: center
#| fig-height: 5
#| fig-width: 15
#| fig-cap: "Verschiedene Ziele und Möglichkeiten des statistischen Modellierens. Grob können die Möglichkeiten in drei große thematische Zusammenhänge eingeteilt werden."
#| column: page

p41 <- gg_template %+%
  filter(cross_tbl, y_grad >= 0) + 
  aes(x_num, y_grad, color = as_factor(y_grad)) +
  geom_point() +
  scale_y_continuous(breaks = c(0, 1, 2), labels = c(0, 1, 2)) +
  labs(x = "Kontinuierlich", y = "Kategoriell (>2 Level)",
       title = "Ordinale Regression",
       subtitle = "Regressionsgleichung, Korrelation und\nBestimmtheitsmaß") +
  annotate("text", x = 1, y = 1.5, hjust = "center", color = "black", size = 4, 
           label = "Stärkste Ausprägung", fontface = 2) +
  geom_curve(x = 2.1, y = 1.5, xend = 4, yend = 1.95,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.5, color = "black") +
  annotate("text", x = 3.8, y = 0.5, hjust = "center", color = "black", size = 4, 
           label = "Schwächste Ausprägung", fontface = 2) +
  geom_curve(x = 2.5, y = 0.5, xend = 1, yend = 0.05,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = 0.5, color = "black")

p42 <- gg_template %+%
  filter(cross_tbl, y_grad >= 0) + 
  geom_mosaic(aes(x = product(y_grad, x_fct), fill = y_grad)) +
  labs(x = "Kategoriell (>2 Level)", y = "Kategoriell (>2 Level)",
       title = "Multipler Gruppenvergleich",
       subtitle = "Chi Quadrat Test, Paarweiser Vergleich und\ncompact letter display")

p43 <- gg_template %+%
  filter(cross_tbl, x_fct != "C" & y_grad >= 0) + 
  geom_mosaic(aes(x = product(y_grad, x_fct), fill = y_grad)) +
  labs(x = "Kategoriell (2 Level)", y = "Kategoriell (>2 Level)",
       title = "Gruppenvergleich",
       subtitle = "Chi Quadrat Test")


p41 + p42 + p43 +
  plot_layout(ncol = 3)
```

## Binomial

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-scatter-modeling-R-05
#| fig-align: center
#| fig-height: 5
#| fig-width: 15
#| fig-cap: "Verschiedene Ziele und Möglichkeiten des statistischen Modellierens. Grob können die Möglichkeiten in drei große thematische Zusammenhänge eingeteilt werden."
#| column: page

log_fit <- glm(y_binom ~x_num, data = cross_tbl, family = binomial)

p51 <- gg_template %+%
  filter(cross_tbl, y_binom >= 0) + 
  aes(x_num, y_binom, color = as_factor(y_binom)) +
  geom_point() +
  scale_y_continuous(breaks = c(0, 1), labels = c(0, 1)) +
  labs(x = "Kontinuierlich", y = "Kategoriell (2 Level)",
       title = "Logistische Regression",
       subtitle = "Regressionsgleichung, Korrelation und\nBestimmtheitsmaß") +
  geom_line(aes(y = predict(log_fit, type = "response")), color = "gray",
            linewidth = 1)  

p52 <- gg_template %+%
  filter(cross_tbl, y_binom >= 0) + 
  geom_mosaic(aes(x = product(y_binom, x_fct), fill = y_binom)) +
  labs(x = "Kategoriell (>2 Level)", y = "Kategoriell (2 Level)",
       title = "Multipler Gruppenvergleich",
       subtitle = "Chi Quadrat Test, Paarweiser Vergleich und\ncompact letter display")

p53 <- gg_template %+%
  filter(cross_tbl, x_fct != "C" & y_binom >= 0) + 
  geom_mosaic(aes(x = product(y_binom, x_fct), fill = y_binom)) +
  labs(x = "Kategoriell (2 Level)", y = "Kategoriell (2 Level)",
       title = "Gruppenvergleich",
       subtitle = "Chi Quadrat Test")


p51 + p52 + p53 +
  plot_layout(ncol = 3)

```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-scatter-modeling-R-06
#| fig-align: center
#| fig-height: 5
#| fig-width: 15
#| fig-cap: "Verschiedene Ziele und Möglichkeiten des statistischen Modellierens. Grob können die Möglichkeiten in drei große thematische Zusammenhänge eingeteilt werden."
#| column: page

sum_prob_tbl <- filter(cross_tbl, y_binom >= 0) |> 
  group_by(x_fct) |> 
  summarise(y_binom_sd = sd(y_binom),
            y_binom = mean(y_binom))

p61 <- gg_template %+%
  filter(cross_tbl, y_binom >= 0 & x_fct != "B") + 
  aes(x_num, y_binom, color = as_factor(y_binom)) +
  geom_point(shape = 21, aes(fill = as_factor(y_binom)), color = "black") + 
  scale_y_continuous(breaks = c(0, 1), labels = c(0, 1),
                     expand = expand_scale(mult = c(0.05, 0.15))) +
  labs(x = "Kontinuierlich", y = "Kategoriell (2 Level)",
       title = "Probability Model",
       subtitle = "Regressionsgleichung, Korrelation und\nBestimmtheitsmaß") +
  geom_smooth(method = "lm", se = FALSE, color = "gray", fullrange = TRUE) +
  #scale_x_continuous(expand = expand_scale(mult = c(0.1, 0.1))) +
  xlim(-0.8, 5.8) +
  annotate("text", x = 1, y = 0.75, hjust = "center", color = "black", size = 4, 
           label = "Werte >1 geschätzt", fontface = 2) +
  geom_curve(x = 1, y = 0.8, xend = 5, yend = 1.05,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.5, color = "black") +
  annotate("text", x = 3.8, y = 0.25, hjust = "center", color = "black", size = 4, 
           label = "Werte <0 geschätzt", fontface = 2) +
  geom_curve(x = 3.8, y = 0.2, xend = 0, yend = -0.05,
             arrow = arrow(length = unit(0.03, "npc"), type = "closed"),
             curvature = -0.5, color = "black")

p62 <- gg_template %+%
  filter(cross_tbl, y_binom >= 0) +
  aes(x_fct, y_binom, fill = as_factor(y_binom)) +
  scale_y_continuous(breaks = c(0, 1), labels = c(0, 1),
                     expand = expand_scale(mult = c(0.05, 0.1))) +
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.5) +  
  geom_errorbar(data = sum_prob_tbl, aes(ymax = y_binom + y_binom_sd, 
                                         ymin = y_binom - y_binom_sd), width=.1) +
  geom_errorbar(data = sum_prob_tbl, aes(ymax = y_binom + y_binom_sd/sqrt(51), 
                                         ymin = y_binom - y_binom_sd/sqrt(51)), 
                width=.1, position = position_nudge(0.1), color = "black", alpha = 0.7) +
  geom_point(data = sum_prob_tbl, aes(y = y_binom), shape = 23, size = 4,
             fill = "#CC79A7") +
  annotate("text", x = 1.15, y = 0.48, hjust = "center", color = "black", size = 4, 
           label = "SD", fontface = 3) +
  annotate("text", x = 1.22, y = 0.21, hjust = "center", color = "black", size = 4, 
           label = "SE", fontface = 3) +
  labs(x = "Kategoriell (>2 Level)", y = "Kategoriell (2 Level)",
       title = "Multipler Gruppenvergleich",
       subtitle = "ANOVA, Paarweiser Vergleich und\ncompact letter display",
       caption = "Auch mit Kruskal-Wallis-Test möglich.") +
  annotate("text", x = c(1, 2, 3), y = c(0.525, 0.925, 1.3),
           label = c("a", "ab", "b"), size = 5, fontface = 2) +
  annotate("text", x = 1, y = 1.2, hjust = "center", color = "black", size = 4, 
           label = TeX(r"($ANOVA < 0.05$)")) 

p63 <- gg_template %+%
  filter(cross_tbl, x_fct != "B" & y_binom >= 0) + 
  aes(x_fct, y_binom, fill = as_factor(y_binom)) +
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.5) +  
  geom_errorbar(data = filter(sum_prob_tbl, x_fct != "B"), 
                aes(ymax = y_binom + y_binom_sd, ymin = y_binom - y_binom_sd), width=.1) +
  geom_errorbar(data = filter(sum_prob_tbl, x_fct != "B"), 
                aes(ymax = y_binom + y_binom_sd/sqrt(51), 
                    ymin = y_binom - y_binom_sd/sqrt(51)), 
                width=.1, position = position_nudge(0.1), color = "black", alpha = 0.7) +
  geom_point(data = filter(sum_prob_tbl, x_fct != "B"), 
             aes(y = y_binom), shape = 23, size = 4, fill = "#CC79A7") +
  labs(x = "Kategoriell (2 Level)", y = "Kategoriell (2 Level)",
       title = "Gruppenvergleich",
       subtitle = "Student t-Test, Welch t-Test oder\nWilcoxon-Mann-Whitney-Test") +
    geom_signif(comparisons = list(c("A", "C")),
                map_signif_level = TRUE, textsize = 6) +
  scale_y_continuous(expand = expand_scale(mult = c(0.05, 0.1)),
                     breaks = c(0, 1), labels = c(0, 1))


p61 + p62 + p63 +
  plot_layout(ncol = 3)

```
