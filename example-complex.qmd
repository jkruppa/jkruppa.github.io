# Von komplexeren Daten {#sec-example-complex}

```{r}
#| message: false
#| echo: false

pacman::p_load(readxl, knitr, kableExtra, tidyverse, magrittr, conflicted, broom,
               simstudy, openxlsx, 
               parameters, performance, gtsummary)
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("mutate", "dplyr")

```

*Version vom `r format(Sys.time(), '%B %d, %Y um %H:%M:%S')`*

![](images/caution.png){fig-align="center" width="50%"}

## Von infizierten Ferkeln

```{r}
#| message: false
#| echo: false

set.seed(20220929)
## data generation
def <- defData(varname = "age", dist = "normal", formula = "60", variance = 20)
def <- defData(def, varname = "sex", formula = "0.4;0.6", dist = "categorical")
def <- defData(def, varname = "location", formula = "0.3;0.2;0.2;0.3",
               dist = "categorical")
def <- defData(def, varname = "activity", formula = "10 + 2 * sex", variance = 2)
def <- defData(def, varname = "CRP", formula = "20", variance = 2)
def <- defData(def, varname = "frailty", formula = "0.5;0.35;0.15", dist = "categorical")
def <- defData(def, varname = "bloodpressure", formula = "60 - 2 * sex", variance = 10)
def <- defData(def, varname = "weight", formula = "20 - 1 * sex", variance = 2)
def <- defData(def, varname = "creatinin", formula = "5", variance = 2)
def <- defData(def, varname = "infected", formula = "-10 + 0.5 * sex +
0.5 * frailty + 2 * CRP + 0.05 * creatinin + 0.2 * bloodpressure + 0.01 * weight", dist = "normal", variance = 10)

pig_tbl <- genData(rpois(1, 400), def) %>% 
  select(-id) %>% 
  mutate(across(where(is.numeric), round, 2),
         sex  = factor(sex, labels = c("female", "male")),
         location = factor(location, labels = c("north", "northeast", "west", "northwest")),
         frailty = factor(frailty, labels = c("robust", "pre-frail", "frail")),
         infected = ifelse(infected >= 42, 1, 0))

write.xlsx(pig_tbl, "data/infected_pigs.xlsx", rowNames = FALSE)
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-example-pigs
#| tbl-cap: Auszug aus dem Daten zu den kranken Ferkeln.
#| column: page

pig_tbl <- read_excel("data/infected_pigs.xlsx") 

rbind(head(pig_tbl),
      rep("...", times = ncol(pig_tbl)),
      tail(pig_tbl)) %>% 
  kable(align = "c", "pipe")
```

## Von langnasigen Hechten

::: column-margin
Die Daten zu den langnasigen Hechten stammt von [Salvatore S. Mangiafico - An R Companion for the Handbook of Biological Statistics](https://rcompanion.org/rcompanion/e_05.html).
:::

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-example-longnose
#| tbl-cap: Auszug aus dem Daten zu den kranken Ferkeln.
#| column: page


longnose_tbl <- read_csv("data/longnose.csv") 

rbind(head(longnose_tbl),
      rep("...", times = ncol(longnose_tbl)),
      tail(longnose_tbl)) %>% 
  kable(align = "c", "pipe")

```
