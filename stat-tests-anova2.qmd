```{r echo = FALSE}
#| message: false
#| echo: false
#| warning: false
pacman::p_load(tidyverse, readxl, knitr, kableExtra, Hmisc, plyr,
               patchwork, ggforce, see, sjPlot, conflicted)
set.seed(202434)
conflicts_prefer(dplyr::summarise)
conflicts_prefer(dplyr::summarize)
conflicts_prefer(dplyr::mutate)
conflicts_prefer(magrittr::set_names)
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| cache: true
#| label: source-anova-plots
source("stat-tests-anova_plot/anova_plots.R")
```

# Die ANOVA {#sec-anova}

*Letzte Änderung am `r format(fs::file_info("stat-tests-anova2.qmd")$modification_time, '%d. %B %Y um %H:%M:%S')`*

> *"Yeah, I might seem so strong; Yeah, I might speak so long; I've never been so wrong." --- London Grammar, Strong*

Die ANOVA (eng. *analysis of variance*) ist wichtig. Was für ein schöner Satz um anzufangen. Historisch betrachtet ist die ANOVA, *das* statistische Verfahren was gut per Hand ohne Computer berechnet werden kann. Daher war die ANOVA von den 20zigern bis in die frühen 90ziger des letzten Jahrhunderts *das* statistische Verfahren der Wahl. Wir brauchen daher die ANOVA aus mehreren Gründen. Die Hochzeiten der ANOVA sind eigentlich vorbei, wir haben in der Statistik für viele Fälle mittlerweile besser Werkzeuge, aber als Allrounder ist die ANOVA immer noch nutzbar. Insbesondere wenn wir uns mit einem faktoriellen Design beschäftigen, dann komt die Stärke der ANOVA voll zu tragen. Da wir in den agrarwissenschaften eben dann doch sehr viele Feldexperimente in einem faktoriellen Design vorliegen haben, hat auch die ANOVA ihren Platz in der praktischen Auswertung. Wir werden immer wieder auf die ANOVA inhaltlich zurück kommen und in vielen Abschlussarbeiten wird die ANOVA immer noch als integraler Bestandteil genutzt. Wofür und wann brauchen wir die ANOVA, wenn wir Daten auswerten?

::: callout-tip
## Keine Zeit? Dann nutze gleich das R Paket `{afex}`!

Dieses Kapitel ist lang und vieles habe ich hier gerechnet, damit du es nicht musst. Wenn du keine Zeit hast, dann springe gleich in den [Abschnitt mit dem effektiven Pfad mit `{emmeans}`](#sec-emmeans) und lasse den Rest links und rechts liegen. Wir freuen uns das es den Rest gibt, aber du willst ja fertig werden und nicht staunen, was andere so alles entwickelt haben. Und das ist vollkommen okay!
:::

#### Normalverteilung und Varianzhomogenität {.unnumbered .unlisted}

> *"ANOVAs are generally robust to “light” heteroscedasticity, but there are various other methods (not available in afex) for getting robust error estimates."* --- [Testing the Assumptions of ANOVAs](https://cran.r-project.org/web/packages/afex/vignettes/assumptions_of_ANOVAs.html)

#### Hypothesen {.unnumbered .unlisted}

Die ANOVA betrachtet die Mittelwerte und nutzt die Varianzen um einen Unterschied nachzuweisen. Daher haben wir in der Nullhypothese als Gleichheitshypothese. In unserem Beispiel lautet die Nullhypothese, dass die Mittelwerte jedes Levels des Faktors `animal` gleich sind.

::: panel-tabset
## Faktor mit $2$ Leveln

$$
H_0: \; \bar{y}_{A.1} = \bar{y}_{A.2}
$$ text

$$
H_A: \; \bar{y}_{A.1} \neq \bar{y}_{A.2}
$$

## Faktor mit $\geq 3$ Leveln

Wir

$$
H_0: \; \bar{y}_{A.1} = \bar{y}_{A.2} = \bar{y}_{A.3} 
$$

$$
\begin{aligned}
H_A: &\; \bar{y}_{A.1} \ne \bar{y}_{A.2}\\
\phantom{H_A:} &\; \bar{y}_{A.1} \ne \bar{y}_{A.3}\\
\phantom{H_A:} &\; \bar{y}_{A.2} \ne \bar{y}_{A.3}\\
\phantom{H_A:} &\; \mbox{für mindestens einen Vergleich}
\end{aligned}
$$
:::

#### Das faktorielle Modell {.unnumbered .unlisted}

Beginnen wir also mit der Festlegung welche Art der Analyse wir rechnen wollen. Wir schauen uns jetzt einmal das einfaktorielle sowie das zweifaktorielle Modell näher an. Du könntest auch mehr als zwei Faktoren auswerten wollen, aber dann musst du einmal in ein anderes Kapitel wechseln. Wir beginnen hier mit dem einfacheren Fall oder auch den häufigsten. Zurst einmal haben wir ein faktorielles Modell vorliegen. Hier einmal die generelle Form mit belieb vielen Faktoren $f$.

$$
y \sim f_1 + f_2 + ... + f_p + f_1 \times f_2 + ... + f_1 \times f_2 \times f_3
$$

mit

-   $y$ gleich dem Messwert oder Outcome
-   $f_1 + f_2 + ... + f_p$ gleich experimenteller Faktoren
-   $f_1 \times f_2$ gleich einem beispielhaften Interaktionsterm erster Ordnung
-   $f_1 \times f_2 \times f_3$ gleich einem beispielhaften Interaktionsterm zweiter Ordnung

Zusätzlich können noch Interaktionsterme höherer Ordnungen entstehen, aber hier wird es extrem schwierig diese Interaktionsterme dann auch zu interpretieren. Wir werden uns aber in diesem Kapitel auf ein einfaktorielles sowie zweifaktorielles Modell beschränken. Wenn du theoretisch das zweifaktorielle Modell anwenden kannst, dann kannst auch mit mehr Faktoren einen Post-hoc Test rechnen.

#### Welche Pakete gibt es eigentlich? {.unnumbered .unlisted}

Wenn um die Anwendung der ANOVA in R geht, dann haben wir eine Menge Pakete zur Auswahl. Wie immer macht die Fragestellung und das gewählte Modell den Großteil der Entscheidungsindung aus. Ich zeige dir später in der Anwendung dann auch alle Pakete einmal, gebe dir dann aber auch immer eine Empfehlung mit. In der folgenden Tabelle gebe ich dir einmal eine kurze Übersicht über die beiden Annahmen an die ANOVA. Normalerweise brauchen wir einen normalverteilten Messwert $y$ und Varianzhomogenität in den Faktoren. In den letzten Jahren wurden aber noch weitere Implementierungen der ANOVA entwickelt, so dass hier auch Alternativen vorliegen.

|                            | `{base}` | `{car}`  | `{afex}` | `{WRS2}` | Excel |
|:---------------------------|:--------:|:--------:|:--------:|:--------:|:-----:|
| **Normalverteilt** $y$     |    ja    |    ja    |    ja    |   nein   |  ja   |
| **Varianzhomogenität** $f$ |    ja    | optional |    ja    |   nein   |  ja   |

: Übersicht über vier ausgewählte in diesem Kapitel. {#tbl--anova-übersicht}

Gehen wir jetzt mal die Pakete durch. Wir immer gibt es einiges an Möglichkeiten und ich zeige dir hier eben die Auswahl. Es gibt hier das ein oder andere noch zu beachten, aber da gehe ich dann bei den jeweiligen Methoden drauf ein. Es macht eben dann doch einen Unterschied ob ich eine einfaktorielle oder komplexere ANOVA rechnen will. Nicht alles geht in allen R Pakten oder gar Excel.

Der Standard mit der Funktion `aov()` aus `{base}`

:   Die Standardfunktion `aov()` erlaubt es eine einfaktorielle oder zweifaktorielle ANOVA direkt auf einem Datensatz zu rechnen. Hier brauchen wir nur ein Modell in der in R üblichen Formelschreibweise `y ~ f`. Du kannst diesen Ansatz als schnelle ANOVA begreifen. Dein Messwert $y$ muss hier normalverteilt sein.

Der erweiterte Standard mit der Funktion `anova()` aus `{base}`

:   Die Funktion `anova()` erlaubt es auch auf anderen Modellen eine ANOVA zu rechnen. Wi nutzen hier die Funktion `lm()`, die einen normalverteilten Messwert $y$ annimmt. Es ginge aber auch mit anderen Modellierungen und der Funktion `glm()` für Zähldaten einer Possionverteilung oder noch anderen Verteilungen.

Mit der Funktion `Anova()` aus `{car}`

:   Das [R Paket `{car}`](https://cran.r-project.org/web/packages/car/index.html) bietet eine Verbesserung der Standardfunktionen der ANOVA an. Insbesondere die Berücksichtigung und die Modellierung eines Interaktionseffektes in einer zweifaktoriellen ANOVA sticht heraus. Daher ist die Funktion hier etwas flexibeler als der Standard. In einer einfaktoriellen ANOVA bemerkst du keinen Unterschied.

Mit den ANOVA Funktionen aus `{afex}`

:   Wir können die ANOVA auch anwenden, wenn wir Messwiederholungen vorliegen haben. Daher bietet sich hier das [R Paket `{afex}`](https://github.com/singmann/afex)an. Du musst bei den Funktionen von `{afex}` immer eine ID mitlaufen lassen, die angibt welche Individuen wiederholt gemessen wurden. Also hat jede Zeile eine Nummer, die beschreibt welche Beobachtung hier vorliegt. Besonders wichtig bei Messungen über die ZEit.

Mit den ANOVA Funktionen aus `{WRS2}`

:   Eine Annahme an die ANOVA ist, dass wir es mit normalverteilten Messwerten $y$ sowie Varianzhomogenität in den Faktoren $f$ vorliegen haben. Das R Paket `{WRS2}` mit der hervorragenden Vingette [Robust Statistical Methods Using WRS2](https://cran.r-project.org/web/packages/WRS2/vignettes/WRS2.pdf) erlaubt nun aber diese beiden Annahmen zu umgehen und bietet eine robuste ANOVA an. Robust meint hier, dass wir uns nicht um die Normalverteilung und Varianzhomogenität kümmern müssen.

Mit Excel

:   Hier muss ich sagen, dass es schon etwas weh tut die einfaktorielle und zweifaktorielle ANOVA in Excel zu rechnen. Ich habe dir bei der einfaktoriellen sowie der zweifaktoriellen ANOVA ein Video für die ANOVA in Excel ergänzt. Eigentlich ist es nur der letzte Strohhalm, wenn du keine Zeit mehr hast dich in R nochmal einzuarbeiten.

::: callout-tip
## Weitere Tutorien für die ANOVA

Wir oben schon erwähnt, kann dieses Kapitel nicht alle Themen der ANOVA abarbeiten. Daher präsentiere ich hier eine Liste von Literatur und Links, die mich für dieses Kapitel hier inspiriert haben. Nicht alles habe ich genutzt, aber vielleicht ist für dich was dabei.

-   [ANOVA in R](https://www.datanovia.com/en/lessons/anova-in-r/)
-   [One-Way ANOVA Test in R](https://www.sthda.com/english/wiki/one-way-anova-test-in-r)
-   [Two-Way ANOVA Test in R](https://www.sthda.com/english/wiki/two-way-anova-test-in-r)
-   [MANOVA Test in R: Multivariate Analysis of Variance](https://www.sthda.com/english/wiki/manova-test-in-r-multivariate-analysis-of-variance)
-   [ANOVA in R \| A Complete Step-by-Step Guide with Examples](https://www.scribbr.com/statistics/anova-in-r/)
:::

## Theoretischer Hintergrund

Im folgenden Abschnitt schauen wir uns einmal den theoretischen Hintergrund zu der ANOVA an. Ich fokusiiere mich hier einmal für die Theorie auf die einfaktorielle ANOVA. Die Prinzipien lassen sich dann auch auf die zweifaktorielle und mehrfaktoriellen Algorithmen der ANOVA anwenden. Was dann später noch dazukommt sind dann die Interaktionen.

::: {layout="[15,85]" layout-valign="top"}
![](images/angel_01_small.png){fig-align="center" width="100%"}

> In der ersten Version dieses Kapitels habe ich noch sehr viel beispielhaft für eine einfaktorielle ANOVA durchgerechnet. Wie sich dann in den Jahren herausstellte, hat es dir wenig geholfen, die ANOVA zu verstehen oder anzuwenden. Wer rechnet schon die ANOVA per Hand? Daher hier eben das klassische [lying-to-children](https://en.wikipedia.org/wiki/Lie-to-children) und ich erkläre dir die ANOVA mehr konzeptionell als rein mathematisch korrekt.
:::

### Haupteffekte $f_A$

Für die Theorie konzentrieren wir uns nur auf die einfaktoriele ANOVA

| Quelle | df | Sum of squares (SS) | Mean squares (MS) | Teststatistik F$_{\boldsymbol{D}}$ |
|:--:|:--:|:--:|:--:|:--:|
| $A$ | $df_A$ | $SS_A$ | $MS_A = \cfrac{SS_A}{df_A}$ | $F_{D} = \cfrac{MS_A}{MS_{Error}}$ |
| $Error$ | $df_{Error}$ | $SS_{Error}$ | $MS_{Error} = \cfrac{SS_{Error}}{df_{Error}}$ |  |
| $Total$ | $df_{total}$ | $SS_{Total}$ |  |  |

: Einfaktorielle ANOVA in der theoretischen Darstellung. Die sum of squares müssen noch zu den Mean squares gemittelt werden. Abschließend wird die F Statistik als Prüfgröße berechnet. {#tbl-anova-fac1-theo}

| Quelle | df | Sum of squares (SS) | Mean squares (MS) | Teststatistik F$_{\boldsymbol{D}}$ |
|:--:|:--:|:--:|:--:|:--:|
| $A$ | $df_A$ | $SS_{A}$ | $MS_{A} = \cfrac{SS_A}{df_A}$ | $F_{D} = \cfrac{MS_{A}}{MS_{Error}}$ |
| $B$ | $df_B$ | $SS_{B}$ | $MS_{B} = \cfrac{SS_B}{df_B}$ | $F_{D} = \cfrac{MS_{B}}{MS_{Error}}$ |
| $A \times B$ | $df_{A \times B}$ | $SS_{A \times B}$ | $MS_{A \times B} = \cfrac{SS_{A \times B}}{df_{A \times B}}$ | $F_{D} = \cfrac{MS_{A \times B}}{MS_{Error}}$ |
| $Error$ | $df_{Error}$ | $SS_{error}$ | $MS_{Error} = \cfrac{SS_{Error}}{df_{Error}}$ |  |
| $Total$ | $df_{total}$ | $SS_{total}$ |  |  |

: Zweifaktorielle ANOVA ohne Interaktionseffekt in der theoretischen Darstellung. Die Sum of squares müssen noch zu den Mean squares gemittelt werden. Abschließend wird die F Statistik als Prüfgröße berechnet. {#tbl-anova-fac2-ohne-inter}

| Col1         | Col2           | Col3 |
|--------------|----------------|------|
| $MS_A$       | $MS_{between}$ |      |
| $MS_{Error}$ | $MS_{within}$  |      |
|              |                |      |

: foot. {#tbl-anova-namen}

text

Wollen wir nicht in einem Experiment eine geringe Varianz haben?

:   Nein, das ist eine häufige Fehleinschätzung. In einem Feldexperiment mit verschiedenen Behandlungen wirst du *über alle* Behandlungen eine große Varianz haben wollen.

text

Wann sind drei oder mehr Mittelwerte gleich?

:   Wann können wir das sagen? Die Nullhypothese ist dann...

text

$$
y_1 = y_2 = y_3
$$

text

$$
\overbrace{\cfrac{y_1 + y_2 + y_3}{3}}^{\beta_0} \overset{?}{=} y_1 = y_2 = y_3
$$

text

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-intro-null
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7.5
#| fig-cap: "Visualisierung  *[Zum Vergrößern anklicken]*"

ex_intro_null_lst <- get_intro_data_tbl(mean = c(5, 5, 5), 
                                        sd = c(1, 0.5, 1), ng = c(4, 3, 5))
ex_intro_alt_lst <- get_intro_data_tbl(mean = c(5, 1, 8), 
                                       sd = c(1, 0.5, 1), ng = c(4, 3, 5))

get_ex_lst_intro_plot(ex_intro_null_lst) + 
  ggtitle("Nullhypothese annehmen",
          subtitle = "Die Mittelwerte sind gleich") +
  get_ex_lst_intro_plot(ex_intro_alt_lst) + 
  ggtitle("Nullhypothese ablehnen",
          subtitle = "Die Mittelwerte unterscheiden sich") +
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```

text

$$
F_D = \cfrac{MS_A}{MS_{Error}}
$$

text

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-fstat
#| fig-align: center
#| fig-height: 4
#| fig-width: 7
#| fig-cap: "foon."

p_f_stat
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-msa-mse
#| fig-align: center
#| fig-height: 6
#| fig-width: 7.5
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

ex_00_lst <- get_data_tbl(mean = c(5, 5, 5), sd = c(0.2, 0.2, 0.2))
ex_01_lst <- get_data_tbl(mean = c(5, 1, 9), sd = c(0.2, 0.2, 0.2))
ex_10_lst <- get_data_tbl(mean = c(5, 5, 5), sd = c(2, 2, 2))
ex_11_lst <- get_data_tbl(mean = c(5, 1, 9), sd = c(2, 2, 2))

get_ex_lst_plot(ex_00_lst) + 
  ggtitle(expression(MS[A]%~~%0~und~MS[Error]%~~%0),
          "Mittelwerte gleich und Fehler klein") +
  get_ex_lst_plot(ex_01_lst) +
  ggtitle(expression(MS[A]~">"~0~und~MS[Error]%~~%0),
          "Mittelwerte ungleich und Fehler klein") +
  get_ex_lst_plot(ex_10_lst) + 
  ggtitle(expression(MS[A]%~~%0~und~MS[Error]~">"~0),
          "Mittelwerte gleich und Fehler groß") +  
  get_ex_lst_plot(ex_11_lst) +
  ggtitle(expression(MS[A]~">"~0~und~MS[Error]~">"~0),
          "Mittelwerte ungleich und Fehler groß") +  
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-single-cat-anova 
#| fig-align: center
#| fig-height: 5
#| fig-width: 8
#| fig-cap: "Visualisierung  *[Zum Vergrößern anklicken]*"

p_example_fac_1_total + p_example_fac1 +
  plot_layout(width = c(1, 5)) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```

#### Varianzhomogenität {.unnumbered .unlisted}

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-var-hetero
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7.5
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

ex_hetero_lst <- get_data_tbl(mean = c(1, 5, 6), sd = c(0.5, 4, 0.5))
ex_homo_lst <- get_data_tbl(mean = c(1, 5, 6), sd = c(1.7, 1.7, 1.7))

get_ex_lst_plot(ex_hetero_lst) + 
  labs(title = "Experimentelle Daten",
       subtitle = "Varianzheterogenität in den Gruppen",
       caption = "Buchstaben zeigen Compact letter display") +
  annotate("label", x = c(5.5, 16.5, 25.5), y = c(4, 13, 9), 
           label = c("A", "AB", "B"), fill = "gray90") +
  get_ex_lst_plot(ex_homo_lst) +
  labs(title = "ANOVA Modellierung",
       subtitle = "Varianzhomogenität in den Gruppen",
       caption = "Buchstaben zeigen Compact letter display") +
  annotate("label", x = c(5.5, 15.5, 25.5), y = c(6, 9.5, 9), 
           label = c("A", "A", "A"), fill = "gray90") +
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```

### Effektschätzer

[Effect Sizes for ANOVAs](https://easystats.github.io/effectsize/articles/anovaES.html)

#### Eta$^2$ {.unnumbered .unlisted}

[$Eta^2$](https://easystats.github.io/effectsize/articles/anovaES.html#eta2)

`interpret_eta_squared()` aus dem R Paket `{effectsize}`

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-eta-venn
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 10
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p1_eta_venn + p2_eta_venn +
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```

#### Omega$^2$ und Epsilon$^2$ {.unnumbered .unlisted}

$\omega^2$ und $\epsilon^2$

[Other Measures of Effect Size](https://easystats.github.io/effectsize/articles/anovaES.html#other-measures-of-effect-size)

### Interaktion $f_A \times f_B$

Wenn du mehr als einen Faktor $f_A$ in deinem Modell vorliegen hast, dann kannst du eine Interaktion zwischen den Faktoren vorliegen haben. Wir schreiben in R einen Interaktionsterm mit dem `:` zwischen den Namen der beiden Faktoren. Wenn wir also die Interaktion zwischen dem Faktor $f_1$ und $f_2$ in R modellieren wollen, dann schreiben wir `fa:fb`. In der mathematischen Schreibweise haben wir dann häufig die Form $f_A \times f_B$ vorliegen. Ich schreibe hier häufig dann die mathematische Notian im Fließtext und natürlich im R Code dann die entsprechende Notation in R.

| Mathematisch     | R       |
|------------------|---------|
| $f_A \times f_B$ | `fa:fb` |

: Vergleich der Schreibweise einer Interaktion zwischen den Faktoren $f_A$ und $f_B$ einmal mathematisch und einmal in R. {#tbl-anova-inter-namen}

Der folgende Abschnitt teilt sich grob in zwei Teile. Einmal der theoretische Hintergrund zur Interaktion und was dort eigentlich die Herausforderungen in der Modellierung sind sowwie einen Abschnitt zur visuellen Überprüfung der Interaktion in einer zweifaktoriellen Analyse.

#### Theoretischer Hintergrund {.unnumbered .unlisted}

::: callout-warning
## Achtung, bitte beachten!

Dieser Abschnitt ist dann *etwas* eskaliert. Wenn du dich nicht für die statistischen Methoden und Hintergründe interessierst, dann überspringe diesen Abschnitt und gehe gleich zur visuellen Überprüfung der Interaktion.
:::

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-inter-circ
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 10
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p2_inter_venn + p1_inter_venn +
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))  
```

[Anova – Type I/II/III SS explained](https://md.psych.bio.uni-goettingen.de/mv/unit/lm_cat/lm_cat_unbal_ss_explained.html) und [How to interpret type I, type II, and type III ANOVA and MANOVA?](https://stats.stackexchange.com/questions/20452/how-to-interpret-type-i-type-ii-and-type-iii-anova-and-manova)

[Interaktionseffekte](https://methpsy.elearning.psych.tu-dresden.de/mediawiki/index.php/Interaktionseffekte)

[Adding Interactions](https://easystats.github.io/effectsize/articles/anovaES.html#adding-interactions)

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-1fac-contr-sum
#| tbl-cap: "foo"

f1_contr_sum_tbl |> 
  mutate(pos = rep(1:3,3)) |> 
  pivot_wider(names_from = fa, values_from = rsp) |> 
  select(-pos) |> 
  kable(align = "c", "pipe")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-1fac-contr-sum-desc
#| tbl-cap: "foo."

f1_contr_sum_tbl  |> 
  group_by(fa) |> 
  summarise(Mittelwert = mean(rsp)) |> 
  mutate_if(is.numeric, round, 2) |> 
  set_names(c("Faktor A", "Mittelwert")) |> 
  kable(align = "c", "pipe")
```

::: panel-tabset
## Treatment coding

```{r}
lm(rsp ~ fa, f1_contr_sum_tbl, contrasts = list(fa = "contr.treatment")) |> 
  coef() |> round(2)
```

## Effect coding

```{r}
lm(rsp ~ fa, f1_contr_sum_tbl, contrasts = list(fa = "contr.sum")) |> 
  coef() |> round(2)
```
:::

Es gibt noch mehr [Contrast codings](https://stats.oarc.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/), je nachdem wie dein Messwert $y$ oder deine Faktoren $f$ beschaffen sind

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-f1-effect-coding
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 10
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p2_f1_contr_sum + p1_f1_contr_sum +
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))

```

::: panel-tabset
## Effect coding ohne Interaktion

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-2fac-contr-sum-nointer
#| tbl-cap: "foo"

f2_contr_sum_nointer_tbl |> 
  mutate(pos = rep(1:3,6)) |> 
  select(-key) |> 
  pivot_wider(names_from = fb, values_from = rsp) |> 
  select(-pos) |> 
  set_names(c("", "B.1", "B.2")) |> 
  kable(align = "c", "pipe")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-2fac-contr-sum-nointer-desc
#| tbl-cap: "foo."

f2_contr_sum_nointer_tbl |> 
  group_by(fa, fb) |> 
  summarise(Mittelwert = mean(rsp)) |> 
  mutate_if(is.numeric, round, 2) |> 
  set_names(c("Faktor A", "Faktor B", "Mittelwert")) |> 
  kable(align = "c", "pipe")
```

```{r}
lm(rsp ~ fa + fb + fa:fb, f2_contr_sum_nointer_tbl, 
   contrasts = list(fa = "contr.sum", fb = "contr.sum")) |> 
  coef() |> round(2)
```

| $y$  |     | $\beta_0$ | $\beta_{A1}$ | $\beta_{B1}$ | $\beta_{A1:B1}$ |
|------|-----|-----------|--------------|--------------|-----------------|
| $40$ | $=$ | $120$     | $-60$        | $+23.3$      | $-3.33$         |

: foot. {#tbl-anova-namen}

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-f2-effect-coding-no-inter
#| fig-align: center
#| fig-height: 5
#| fig-width: 7
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p_f2_contr_sum_nointer

```

## Effect coding mit Interaktion

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-2fac-contr-sum-inter
#| tbl-cap: "foo"

f2_contr_sum_inter_tbl |> 
  mutate(pos = rep(1:3,6)) |> 
  select(-key) |> 
  pivot_wider(names_from = fb, values_from = rsp) |> 
  select(-pos) |> 
  set_names(c("", "B.1", "B.2")) |> 
  kable(align = "c", "pipe")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-2fac-contr-sum-inter-desc
#| tbl-cap: "foo."

f2_contr_sum_inter_tbl |> 
  group_by(fa, fb) |> 
  summarise(Mittelwert = mean(rsp)) |> 
  mutate_if(is.numeric, round, 2) |> 
  set_names(c("Faktor A", "Faktor B", "Mittelwert")) |> 
  kable(align = "c", "pipe")
```

```{r}
lm(rsp ~ fa + fb + fa:fb, f2_contr_sum_inter_tbl, 
   contrasts = list(fa = "contr.sum", fb = "contr.sum")) |> 
  coef() |> round(2)
```

| $y$   |     | $\beta_0$ | $\beta_{A1}$ | $\beta_{B1}$ | $\beta_{A1:B1}$ |
|-------|-----|-----------|--------------|--------------|-----------------|
| $210$ | $=$ | $120$     | $+5$         | $+23.3$      | $+61.67$        |

: foot. {#tbl-anova-namen}

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-f2-effect-coding-inter
#| fig-align: center
#| fig-height: 5
#| fig-width: 7
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p_f2_contr_sum_stat_inter

```
:::

#### Visuelle Überprüfung {.unnumbered .unlisted}

::: panel-tabset
## Liniendiagramm

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-inter-theo-line
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 10
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p1_inter_line_theo + p2_inter_line_theo + p3_inter_line_theo +
  plot_layout(ncol = 3) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))

```

## Boxplot

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-inter-theo-box
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 10
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p1_inter_box_theo + p2_inter_box_theo + p3_inter_box_theo +
  plot_layout(ncol = 3) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```

## Barplot

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-inter-theo-bar
#| fig-align: center
#| fig-height: 4.5
#| fig-width: 10
#| fig-cap: "Visualisierung *[Zum Vergrößern anklicken]*"

p1_inter_bar_theo + p2_inter_bar_theo + p3_inter_bar_theo +
  plot_layout(ncol = 3) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))
```
:::

## Ein Wort zur Transformation vom Messwert $y$ {.unnumbered .unlisted}

lognormal und Co.

## Der ANOVA Pfad {.unnumbered .unlisted}

Hier einmal eine Mairmaid Flowchart rein?

## Genutzte R Pakete

Wir wollen folgende R Pakete in diesem Kapitel nutzen.

```{r echo = TRUE}
#| message: false
#| warning: false
pacman::p_load(tidyverse, magrittr, broom, WRS2, scales,
               readxl, see, car, patchwork, emmeans,
               interactions, effectsize, afex, report,
               conflicted)
conflicts_prefer(dplyr::mutate)
conflicts_prefer(dplyr::summarize)
conflicts_prefer(dplyr::filter)
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", 
                "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

An der Seite des Kapitels findest du den Link *Quellcode anzeigen*, über den du Zugang zum gesamten R-Code dieses Kapitels erhältst.

## Daten

#### Einfaktorieller Datensatz {.unnumbered .unlisted}

```{r}
#| message: false

fac1_tbl <- read_xlsx("data/flea_dog_cat_fox.xlsx") |>
  select(animal, jump_length) |> 
  mutate(animal = as_factor(animal))|> 
  rowid_to_column(".id")
```

Dann schauen wir uns die Daten einmal in der folgenden Tabelle als Auszug einmal an. Wichtig ist hier nochmal, dass du eben einen Faktor `animal` mit drei Leveln also Gruppen vorliegen hast. Wir wolen jetzt die drei Tierarten hinsichtlich ihrer Sprungweite in \[cm\] miteinander vergleichen. Weil wir jetzt mehr als zwei Gruppen vorliegen haben, sprechen wir von einem multiplen Vergleich.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-1fac-table
#| tbl-cap: "Tabelle der Sprungweiten in [cm] als Messwert $y$ von Hunde-, Katzen- und Fuchsflöhen. Der Datensatz ist einfaktoriell, da wir nur einen Behandlungsfaktor $x$ mit `animal` vorliegen haben."

fac1_raw_tbl <- read_xlsx("data/flea_dog_cat_fox.xlsx") |>
  select(animal, jump_length)

rbind(head(fac1_raw_tbl, n = 3),
      rep("...", times = ncol(fac1_raw_tbl)),
      tail(fac1_raw_tbl, n = 3)) |> 
  kable(align = "c", "pipe")
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-boxplot-1fac
#| fig-align: center
#| fig-height: 4
#| fig-width: 4
#| fig-cap: "Beispielhafter einfaktorieller Boxplot für die Sprungweiten in [cm] gruppiert nach den Floharten."

ggplot(data = fac1_tbl, 
       aes(x = animal, y = jump_length, fill = animal)) +
  theme_minimal() +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = "point", 
               shape=23, size = 3, fill = "gray50") +
  labs(x = "Flohart", y = "Sprungweite in [cm]") +
  theme(legend.position = "none") + 
  scale_fill_okabeito() 
```

#### Zweifaktorieller Datensatz {.unnumbered .unlisted}

Neben dem einfaktoriellen Datensatz wollen wir uns noch den häufigeren Fall mit zwei Faktoren anschauen. Wir haben also nicht nur die drei Floharten vorliegen und wollen wissen ob diese unterschiedlich weit springen. Darüber hinaus haben wir noch einen zweiten Faktor gewählt. Wir haben die Sprungweiten der Hunde-, Katzen- und Fuchsflöhe nämlich an zwei Messorten, der Stadt und dem Dorf, gemessen. Dadurch haben wir jetzt den Faktor `animal` und den Faktor `site` vorliegen. Wiederum fragen wir usn, ob sich die Sprungweite in \[cm\] der drei Floharten in den beiden Messorten unterscheidet. Im Folgenden lade ich einmal den Datensatz in das Objekt `fac2_tbl`.

```{r}
#| message: false

fac2_tbl <- read_xlsx("data/flea_dog_cat_fox_site.xlsx") |> 
  select(animal, site, jump_length) |> 
  filter(site %in% c("city", "village")) |> 
  mutate(animal = as_factor(animal),
         site = as_factor(site))|> 
  rowid_to_column(".id")
```

Betrachten wir als erstes einen Auszug aus der Datentabelle. Wir haben hier als Messwert oder Outcome $y$ die Sprungweite `jump_length` vorliegen. Als ersten Faktor die Variable `animal` und als zweiten Faktor die Variable `site` festgelegt.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-2fac-table
#| tbl-cap: "Tabelle der Sprungweiten in [cm] als Messwert $y$ von Hunde-, Katzen- und Fuchsflöhen an zwei verschiedenen Messorten Stadt und Dorf. Der Datensatz ist zweifaktoriell, da wir einen Behandlungsfaktor $x$ mit `animal` und einen zweiten Faktor mit `site` vorliegen haben."

fac2_raw_tbl <- read_xlsx("data/flea_dog_cat_fox_site.xlsx") |> 
  select(animal, site, jump_length) |> 
      filter(site %in% c("city", "village")) 

rbind(head(fac2_raw_tbl, n = 3),
      rep("...", times = ncol(fac2_raw_tbl)),
      tail(fac2_raw_tbl, n = 3)) |> 
  kable(align = "c", "pipe")
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-boxplot-2fac
#| fig-align: center
#| fig-height: 4
#| fig-width: 8
#| fig-cap: "Beispielhafter zweifaktorieller Boxplot für die Sprungweiten in [cm] gruppiert nach den Floharten und den beiden Messorten."

ggplot(data = fac2_tbl, 
       aes(x = site, y = jump_length, fill = animal)) +
  theme_minimal() +
  geom_boxplot() + 
  stat_summary(fun.y = mean, geom = "point", aes(group = animal), 
               shape=23, size = 3, fill = "gray50",
               position = position_dodge(0.75)) +
  labs(x = "Flohart", y = "Sprungweite in [cm]", fill = "Tierart") +
  scale_fill_okabeito() 
```

#### Multifaktorieller Datensatz {.unnumbered .unlisted}

```{r}
fac3_tbl <- read_excel("data/fleas_complex_data.xlsx", sheet = "fac4") |> 
  select(animal, stage, site, season, jump_length) |> 
  mutate(animal = as_factor(animal),
         stage = factor(stage, level = c("juvenile", "adult")),
         site = as_factor(site),
         season = as_factor(season),
         jump_length = round(jump_length, 2))|> 
  rowid_to_column(".id")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-fac3-table
#| tbl-cap: "foo."

fac3_raw_tbl <- read_excel("data/fleas_complex_data.xlsx", sheet = "fac4") |> 
  select(animal, stage, site, season, jump_length) |> 
  mutate_if(is.numeric, round, 2)

rbind(head(fac3_raw_tbl, n = 3),
      rep("...", times = ncol(fac3_raw_tbl)),
      tail(fac3_raw_tbl, n = 3)) |> 
  kable(align = "c", "pipe")
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-boxplot-3fac
#| fig-align: center
#| fig-height: 6
#| fig-width: 7
#| fig-cap: "foo."

ggplot(data = fac3_tbl, 
       aes(x = stage, y = jump_length, fill = animal)) +
  theme_minimal() +
  geom_boxplot() + 
  stat_summary(fun.y = mean, geom = "point", aes(group = animal), 
               shape=23, size = 3, fill = "gray50",
               position = position_dodge(0.75)) +
  labs(x = "Entwicklungsstadium", y = "Sprungweite in [cm]", fill = "Flohart") +
  facet_wrap(~ site:season) +
  scale_fill_okabeito() +
  theme(legend.position = "top")
```

#### Zweifaktorieller Datensatz mit Messwiederholung {.unnumbered .unlisted}

```{r}
repated_fac3_tbl <- read_excel("data/fleas_complex_data.xlsx", sheet = "repeated") |> 
  select(animal, stage, t0:t3) |> 
  rowid_to_column(".id") |>   
  pivot_longer(cols = t0:t3,
               values_to = "jump_length",
               names_to = "time_num") |> 
  mutate(animal = as_factor(animal),
         stage = factor(stage, level = c("juvenile", "adult")),
         time_fac = as_factor(time_num),
         jump_length = round(jump_length, 2))
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-repeated-table
#| tbl-cap: "foo."

repeated_raw_tbl <- read_excel("data/fleas_complex_data.xlsx", sheet = "repeated") |> 
  select(animal, stage, t0:t3) |> 
  mutate_if(is.numeric, round, 2)

rbind(head(repeated_raw_tbl, n = 3),
      rep("...", times = ncol(repeated_raw_tbl)),
      tail(repeated_raw_tbl, n = 3)) |> 
  kable(align = "c", "pipe")
```

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-ggplot-anova-repeated
#| fig-align: center
#| fig-height: 4
#| fig-width: 7
#| fig-cap: "Darstellung der Varianzhomogenität und Varianzheterogenität in einem Barplot. *[Zum Vergrößern anklicken]*"

ggplot(repated_fac3_tbl, aes(x = time_num, y = jump_length,
                             color = animal, linetype = stage,
                             group = interaction(animal, stage))) +
  theme_minimal() +
  geom_point() +
  stat_summary(fun = mean, geom = "line") +
  scale_color_okabeito() +
  theme(legend.position = "top")
```

#### Zweifaktorieller Datensatz mit Kovariate {.unnumbered .unlisted}

```{r}
fac2_cov_tbl <- read_excel("data/fleas_complex_data.xlsx", sheet = "covariate") |> 
  select(animal, stage, weight, jump_length) |> 
  mutate(animal = as_factor(animal),
         stage = factor(stage, level = c("juvenile", "adult")),
         weight = round(weight, 2),
         jump_length = round(jump_length, 2))|> 
  rowid_to_column(".id")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-fac2cov-table
#| tbl-cap: "foo."

fac2_cov_raw_tbl <- read_excel("data/fleas_complex_data.xlsx", sheet = "covariate") |> 
  select(animal, stage, weight, jump_length) |> 
  mutate_if(is.numeric, round, 2)

rbind(head(fac2_cov_raw_tbl, n = 3),
      rep("...", times = ncol(fac2_cov_raw_tbl)),
      tail(fac2_cov_raw_tbl, n = 3)) |> 
  kable(align = "c", "pipe")
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| label: fig-ggplot-anova-boxplot-fac2cov
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo."

p1 <- ggplot(data = fac2_cov_tbl, 
       aes(x = stage, y = jump_length, fill = animal)) +
  theme_minimal() +
  geom_boxplot() + 
  stat_summary(fun.y = mean, geom = "point", aes(group = animal), 
               shape=23, size = 3, fill = "gray50",
               position = position_dodge(0.75)) +
  labs(x = "Entwicklungsstadium", y = "Sprungweite in [cm]", fill = "Flohart") +
  scale_fill_okabeito() +
  theme(legend.position = "top")

p2 <- ggplot(data = fac2_cov_tbl, 
       aes(x = stage, y = weight, fill = animal)) +
  theme_minimal() +
  geom_boxplot() + 
  stat_summary(fun.y = mean, geom = "point", aes(group = animal), 
               shape=23, size = 3, fill = "gray50",
               position = position_dodge(0.75)) +
  labs(x = "Entwicklungsstadium", y = "Gewicht in [mg]", fill = "Flohart") +
  scale_fill_okabeito() +
  theme(legend.position = "top")

p1 + p2 + 
  plot_layout(ncol = 2) +
  plot_annotation(tag_levels = 'A') +
  plot_annotation(tag_levels = 'A', tag_prefix = '(', tag_suffix = ')') &
  theme(plot.tag = element_text(size = 16, face = "bold"))

```

## Einfaktorielle ANOVA

::: panel-tabset
## `{base}`

```{r}
aov(jump_length ~ animal, data = fac1_tbl) |> 
  tidy()
```

```{r}
lm(jump_length ~ animal, data = fac1_tbl) |> 
  anova() |> 
  tidy()
```

## `{car}`

#### Varianzhomogenität {.unnumbered .unlisted}

```{r}
lm(jump_length ~ animal, data = fac1_tbl) |> 
  Anova() |> 
  tidy()
```

#### Varianzheterogenität {.unnumbered .unlisted}

```{r}
lm(jump_length ~ animal, data = fac1_tbl) |> 
  Anova(white.adjust = TRUE)  |> 
  tidy()
```

## `{afex}`

```{r}
aov_car(jump_length ~ animal + Error(.id), data = fac1_tbl) 
```

## `{WRS2}`

```{r}
t1way(jump_length ~ animal, data = fac1_tbl)
```

Values of = 0.10, 0.30, and 0.50 correspond to small, medium, and large effect sizes.

## Excel
:::

#### Effektschätzer {.unnumbered .unlisted}

```{r}
aov(jump_length ~ animal, data = fac1_tbl) |> 
  eta_squared()
```

#### `{report}` {.unnumbered .unlisted}

Das [R Paket `{report}`](https://easystats.github.io/report/)

```{r}
lm(jump_length ~ animal, data = fac1_tbl) |> 
  Anova() |> 
  report()
```

```{r}
lm(jump_length ~ animal, data = fac1_tbl) |> 
  Anova() |> 
  report_table()
```

## Zweifaktorielle ANOVA

### Haupteffekte

::: panel-tabset
## `{base}`

```{r}
aov(jump_length ~ animal + site + animal:site, data = fac2_tbl) |> 
  tidy() |> 
  mutate(p.value = pvalue(p.value))
```

```{r}
lm(jump_length ~ animal + site + animal:site, data = fac2_tbl) |> 
  anova() |> 
  tidy() |> 
  mutate(p.value = pvalue(p.value))
```

## `{car}`

#### Varianzhomogenität {.unnumbered .unlisted}

```{r}
lm(jump_length ~ animal + site + animal:site, data = fac2_tbl) |> 
  Anova(type = "III") |> 
  tidy()  |> 
  mutate(p.value = pvalue(p.value))
```

#### Varianzheterogenität {.unnumbered .unlisted}

```{r}
lm(jump_length ~ animal + site + animal:site, data = fac2_tbl) |> 
  Anova(white.adjust = TRUE)  |> 
  tidy() |> 
  mutate(p.value = pvalue(p.value))
```

## `{afex}`

```{r}
aov_car(jump_length ~ animal + site + animal:site + Error(.id), data = fac2_tbl) 

```

## `{WRS2}`

```{r}
t2way(jump_length ~ animal + site + animal:site, data = fac2_tbl)
```

## Excel
:::

#### Effektschätzer {.unnumbered .unlisted}

```{r}
aov(jump_length ~ animal + site + animal:site, data = fac2_tbl) |> 
  eta_squared()
```

### Interaktion

::: panel-tabset
## `{ggplot}`

```{r}
#| message: false
#| echo: true
#| warning: false
#| label: fig-interactionplot-1
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo."

fac2_tbl |> 
  ggplot(aes(x = animal, y = jump_length,
             color = site, group = site)) +
  theme_minimal() +
  stat_summary(fun = mean, geom = "point") +
  stat_summary(fun = mean, geom = "line") +
  scale_color_okabeito()
```

## `{interactions}`

[R Paket `{interactions}`](https://interactions.jacob-long.com/)

```{r}
#| message: false
#| echo: true
#| warning: false
#| label: fig-interactionplot-2
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo."

lm(jump_length ~ animal + site + animal:site, data = fac2_tbl) |> 
  cat_plot(modx = site, pred = animal, geom = "line") +
  theme_minimal() +
  scale_color_okabeito()
```
:::

## Mehrfaktorielle ANOVA

### Haupteffekte

::: panel-tabset
## `{base}`

```{r}
aov(jump_length ~ animal*stage*site, data = fac3_tbl) |> 
  tidy() |> 
  mutate(p.value = pvalue(p.value))
```

## `{car}`

#### Varianzhomogenität {.unnumbered .unlisted}

```{r}
lm(jump_length ~ animal*stage*site, data = fac3_tbl,
    contrasts = list(
    animal = "contr.sum",
    stage = "contr.sum",
    site = "contr.sum"
  )) |> 
  Anova(type = "III") |> 
  tidy()  |> 
  mutate(p.value = pvalue(p.value))
```

#### Varianzheterogenität {.unnumbered .unlisted}

```{r}
lm(jump_length ~ animal*stage*site, data = fac3_tbl,
    contrasts = list(
    animal = "contr.sum",
    stage = "contr.sum",
    site = "contr.sum"
  )) |> 
  Anova(white.adjust = TRUE, type = "III")  |> 
  tidy() |> 
  mutate(p.value = pvalue(p.value))
```

## `{afex}`

```{r}
aov_car(jump_length ~ animal*stage*site + Error(.id), data = fac3_tbl) 
```

## `{WRS2}`

```{r}
t3way(jump_length ~ animal*stage*site, data = fac3_tbl)
```
:::

### Interaktion

::: panel-tabset
## `{ggplot}`

```{r}
#| message: false
#| echo: true
#| warning: false
#| label: fig-interactionplot-3a
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo."

fac3_tbl |> 
  ggplot(aes(x = animal, y = jump_length,
             color = site, linetype = stage, 
             group = interaction(site, stage))) +
  theme_minimal() +
  stat_summary(fun = mean, geom = "point") +
  stat_summary(fun = mean, geom = "line") +
  scale_color_okabeito()
```

```{r}
#| message: false
#| echo: true
#| warning: false
#| label: fig-interactionplot-3b
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo."
fac3_tbl |> 
  ggplot(aes(x = animal, y = jump_length,
             color = site, group = site)) +
  theme_minimal() +
  stat_summary(fun = mean, geom = "point") +
  stat_summary(fun = mean, geom = "line") +
  scale_color_okabeito() +
  facet_wrap(~ stage)
```

## `{interactions}`

[R Paket `{interactions}`](https://interactions.jacob-long.com/)

```{r}
#| message: false
#| echo: true
#| warning: false
#| label: fig-interactionplot-4
#| fig-align: center
#| fig-height: 3.5
#| fig-width: 7
#| fig-cap: "foo."

lm(jump_length ~ animal*stage*site, data = fac3_tbl) |> 
  cat_plot(modx = site, mod2 = stage, pred = animal,  geom = "line") +
  theme_minimal() +
  scale_color_okabeito()
```
:::

@field2013discovering

```{r}
#| message: false
#| warning: false
lm(jump_length ~ animal*stage*site, data = fac3_tbl) |> 
  Anova(type = "III") |>
  epsilon_squared() |> 
  interpret_eta_squared(rules = "field2013")
```

#### Mehrfaktorielles Modell {.unnumbered .unlisted}

https://www.datanovia.com/en/lessons/anova-in-r/#three-way-independent-anova

https://rpubs.com/JS24/853604

https://rpubs.com/krystian3000/853580

https://www.graphpad.com/guides/prism/latest/statistics/stat_what_is_three-way_anova_used_f.htm

#### Multivaiates Modell {.unnumbered .unlisted}

$$
(y_1, y_2, ..., y_p) \sim x_1
$$

::: panel-tabset
## Theoretisch

## Händisch

## R
:::

::: panel-tabset
## Varianzhomogenität `{car}`

## Varianzheterogenität `{WRS2}`
:::

## MANOVA() {.unnumbered .unlisted}

## Referenzen {.unnumbered}
