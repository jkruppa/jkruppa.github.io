```{r echo = FALSE}
pacman::p_load(tidyverse, readxl, knitr, kableExtra, openxlsx)
```

# Beispielhafte Auswertungen {#sec-beispiel-auswertung}

*Version vom `r format(Sys.time(), '%B %d, %Y um %H:%M:%S')`*

::: callout-tip
## Beispielhafte Auswertungen per Video

Du findest auf YouTube in der Playlist [Spielweise in R (Level 3)](https://www.youtube.com/playlist?list=PLe51bCp9JvEFZeYClBKad6yurjUzc8jXp) viele der Analysen hier einmal als Video. Ich werde zwar alles nochmal hier als Text aufschreiben, aber manchmal ist das Sehen und Hören dann einfacher.
:::

Worum geht es in diesem Kapitel? Ich rechne hier fröhlich Dinge und präsentiere dann die Ergebnisse. Das heißt, du findest hier beispielhafte Auswertungen, die eventuell auch deine Problemstellung betreffen. Da *ich selber* meist keine Ahnung von der Biologie hinter den Experimenten habe, musst du mir nachsehen, dass ich hier nie zu einem echten biologischen Schluss oder Auswertung komme.

-   In @sec-app-example-iso schauen wir uns einmal die Erstellung eines Isoplethendiagramms für Münster & Osnabrück aus den frei verfügbaren Daten des Deutschen Wetterdienstes an.
-   In @sec-app-example-number-groups rechnen wir einmal ein simples Beispiel für Zähldaten in zwei Gruppen. Wir haben hier nicht wiederholt gezählt, sondern nur jeweils einmal an einer Stelle.
-   In @sec-app-example-anova-inter rechnen wir nochmal eine zweifaktorielle ANOVA mit Interaktionsterm durch. Wir kriegen dann unser *compact letter display* wie auch die Konfidenzintervalle wieder.
-   In @sec-mult-map-ght rechnen wir einen Games Howell Test für normalverteilte Daten mit Varianzheterogenität. Hier hauen wir ein wenig auf die Pauke und rechnen alles in wenigen Zeilen mit der Funktion `map()`. War eine spaßige Auswerung für mich, da ich hier mal wieder programmieren üben konnte.
-   In @sec-root-quality schauen wir uns ein größeres Beispiel für die Analyse von Wurzelbonituren an. Im Prinzip geht das natürlich auch alles für jede andere Bonitur. Wenn du eine andere Bonitur hast, kannst du natürlich auch den Weg der Analyse gehen.
-   In @sec-cutting haben wir ein etwas komplexeres Beispiel für vier Outcomes, die an acht Terminen gemessen wurden. Wir sehen hier einmal, wie die Daten eingelesen werden und ein Korrelationsplot über die vier Outcomes erstellt wird.
-   In @sec-tukeyHSD schauen wir uns den Tukey Test für paaweise Vergleiche einmal an. Wir nutzen hier die schnelle Variante mit der Funktion `aov()`. Für das *compact letter display* müssen wir uns dann ein wenig strecken, aber es geht dann auch.
-   In @sec-plowing-data haben wir nochmal ein schönes Beispiel für eine Analyse mit mehreren Faktoren und verschiedenen Outcomes. Wir haben also einen Blumenstrauß an Daten, die wir sortieren und auswerten müssen. Da ich selber keine Ahnung vom Pflügen habe, gehen wir die Sache distanziert durch.
-   In @sec-app-mixed-cutting schauen wir uns ein lineares gemischtes Modell an. Das heißt, wir wollen einen Gruppenvergleich rechnen und dabei die verschiedenen Zeitpunkte mit berücksichtigen. Anstatt also jeden Zeitpunkt einzeln, rechnen wir alle Zeitpunkte zusammen.
-   In @sec-app-spinach-metal wollen wir uns die Konzentration von drei Spurenelementen als Outcome in Blättern und Stielen der Spinatpflanze anschauen. Wir haben hierfür dann die Konzentration von Fe, Cd und Zn gemessen. Insgesamt gab es sieben verschiedene Behandlungsformen.

Je weiter du nach unten in diesem Kapitel kommst, desto weniger Text wirst du finden. Ich werde noch eine Zeit brauchen, bis ich alles wieder schon mit Text hier verarbeitet habe. Es wird aber immer mal wieder etwas *messy* aussehen. Hier wird eben auch gearbeitet. Der R Code wird dann aber immer funktionieren, nur die Beschreibungen sind dann eben manchmal nicht da.

## Genutzte R Pakete

Wir wollen folgende R Pakete in diesem Kapitel nutzen.

```{r echo = TRUE}
#| message: false
pacman::p_load(tidyverse, magrittr, readxl, janitor,
               broom, multcomp, emmeans, effectsize, report,
               see, metR, parameters, multcompView,
               modelsummary, rstatix, corrplot, psych,
               ordinal, rcompanion, lme4, performance,
               scales,
               conflicted)
## resolve some conflicts with same function naming
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("chisq.test", "stats")
conflict_prefer("%+%", "ggplot2")
conflict_prefer("eta_squared", "effectsize")
```

Am Ende des Kapitels findest du nochmal den gesamten R Code in einem Rutsch zum selber durchführen oder aber kopieren.

## Isoplethendiagramm für Münster & Osnabrück {#sec-app-example-iso}

{{< include app-example-analysis/app-example-analysis-01.qmd >}}

## Analyse von Anzahlen in zwei Gruppen {#sec-app-example-number-groups}

{{< include app-example-analysis/app-example-analysis-02.qmd >}}

## Auswertung zweifaktorielle ANOVA mit Interaktion {#sec-app-example-anova-inter}

{{< include app-example-analysis/app-example-analysis-03.qmd >}}

## Multiples Testen mit Games Howell Test {#sec-mult-map-ght}

{{< include app-example-analysis/app-example-analysis-04.qmd >}}

## Wurzelqualität in einem zweifaktoriellen Design {#sec-root-quality}

{{< include app-example-analysis/app-example-analysis-05.qmd >}}

## Wachstum nach Rückschnitt mit Messwiederholung {#sec-cutting}

{{< include app-example-analysis/app-example-analysis-06.qmd >}}

## Einen TukeyHSD Test rechnen {#sec-tukeyHSD}

{{< include app-example-analysis/app-example-analysis-07.qmd >}}

## Auswertung von Pflugdaten mit `ggplot` Templates {#sec-plowing-data}

{{< include app-example-analysis/app-example-analysis-08.qmd >}}

## Auswertung mit Messwiederholungen {#sec-app-mixed-cutting}

{{< include app-example-analysis/app-example-analysis-09.qmd >}}

## Spurenelemente in Spinatblättern und Stielen {#sec-app-spinach-metal}

```{r}
spinach_tbl <- read_excel("data/spinach_metal_data.xlsx") %>% 
  mutate(trt = as_factor(trt),
         sample = as_factor(sample),
         block = as_factor(block))
```

```{r}
spinach_plot_tbl <- spinach_tbl %>% 
  pivot_longer(cols = fe:zn,
               names_to = "outcome",
               values_to = "rsp") %>% 
  mutate(outcome = as_factor(outcome))

```

```{r}

ggplot(spinach_plot_tbl, aes(trt, rsp, shape = block, color = trt)) +
  theme_minimal() +
  geom_jitter() +
  facet_wrap(~ outcome*sample, scales = "free_y", ncol = 2) +
  labs(x = "Behandlung", y = "Gemessenes Outcome",
       shape = "Block", color = "Behandlung") +
  scale_color_okabeito()
```

### Eisen (Fe) und Blatt

```{r}
fe_leaf_tbl <- spinach_plot_tbl %>% 
  filter(outcome == "fe" & sample == "leaf")
```

```{r}
fe_leaf_fit <- lm(rsp ~ trt + block, data = fe_leaf_tbl)
```

```{r}
fe_leaf_fit %>% anova()
```

```{r}
fe_leaf_fit %>% eta_squared()
```

```{r}
fe_leaf_emm <- fe_leaf_fit %>% 
  emmeans(~ trt)
```

```{r}
fe_leaf_emm %>% 
  contrast(method = "pairwise", adjust = "bonferroni")
```

```{r}
fe_leaf_emm %>%
  cld(Letters = letters, adjust = "none") %>% 
  arrange(trt)
```

```{r}
spinach_tbl %>% 
  select(fe, zn) %>% 
  pairs.panels(smooth = TRUE, density = TRUE, method = "kendall", lm = TRUE, 
               cor = TRUE, ellipses = FALSE, stars = TRUE) 
```

```{r}
spinach_tbl %>% 
  filter(sample == "leaf") %>% 
  select(fe, zn) %>% 
  pairs.panels(smooth = TRUE, density = TRUE, method = "kendall", lm = TRUE, 
               cor = TRUE, ellipses = FALSE, stars = TRUE)    

```

```{r}
spinach_tbl %>% 
  filter(sample == "stem") %>% 
  select(fe, zn) %>% 
  pairs.panels(smooth = TRUE, density = TRUE, method = "kendall", lm = TRUE, 
               cor = TRUE, ellipses = FALSE, stars = TRUE) 
```

```{r}
spinach_nest_tbl <- spinach_plot_tbl %>% 
  group_by(sample, outcome) %>% 
  nest() 
```

```{r}
spinach_nest_tbl %>%
  mutate(model = map(data, ~lm(rsp ~ trt + block, data = .x)))
```

```{r}
spinach_nest_tbl %>%
  mutate(model = map(data, ~lm(rsp ~ trt + block, data = .x))) %>% 
  mutate(anova = map(model, anova)) %>% 
  mutate(parameter = map(anova, model_parameters)) %>% 
  select(sample, outcome, parameter) %>% 
  unnest(parameter) %>% 
  filter(Parameter != "Residuals") %>% 
  select(sample, outcome, Parameter, p) %>% 
  mutate(p = pvalue(p))
```
