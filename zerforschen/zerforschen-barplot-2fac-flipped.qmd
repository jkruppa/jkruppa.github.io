![Ursprüngliche Abbildung, die nachgebaut werden soll. Zwei nicht-lineare Regession](images/eda/zerforschen_barplot_complex_02.png){#fig-ur-barplot-03 fig-align="center" width="80%"}

```{r}
barplot_tbl <- read_excel("data/zerforschen_barplot_2fac_flipped.xlsx") %>% 
  mutate(iod = fct_rev(iod),
         fruit = fct_rev(fruit))
barplot_tbl
```

```{r}
#| message: false
#| warning: false
stat_tbl <- barplot_tbl %>% 
  group_by(iod, fruit) %>% 
  summarise(mean = mean(iod_yield),
            sd = sd(iod_yield))
stat_tbl
```

```{r}
#| message: false
#| echo: true
#| warning: false
#| label: fig-ggplot-zerforschen-barplot-2fac-flipped
#| fig-align: center
#| fig-height: 4
#| fig-width: 7
#| fig-cap: "Die Abbildung des Säulendiagramms in `ggplot` nachgebaut."

ggplot(data = stat_tbl, aes(x = iod, y = mean,
                            fill = fruit)) +
  theme_bw() +
  geom_hline(yintercept = c(25, 50, 75, 100), linetype = "dashed") +

  geom_bar(stat = "identity", position = position_dodge(0.9)) + 
  geom_errorbar(aes(ymin = mean-sd, ymax = mean+sd), 
                width = 0.2, position = position_dodge(0.9)) +
  labs(x = "Iodform",
       y =TeX(r"(Iodgehalt $[\mu g\, l\, (100g\, FM)^{-1}]$)")) +
  scale_fill_okabeito(name = "Frucht-\ngröße [mm]", breaks=c('65-75', '75-80')) +
  theme(legend.position = c(0.85, 0.2),
        legend.box.background = element_rect(color = "black"),
        legend.box.margin = margin(t = 1, l = 1),
        legend.text.align = 0) +
  annotate("rect", xmin = 0, xmax = 3, ymin = 50, ymax = 100, 
           alpha = 0.2, fill = cbbPalette[6]) + 
  annotate("label", x = 1.5, y = 75, label = "Zielbereich", size = 5) +
  annotate("text", x = c(0.8, 1.25, 1.8, 2.25), y = c(55, 62, 72, 102),
           label = c("a", "a", "a", "b")) +
  coord_flip() 

```
