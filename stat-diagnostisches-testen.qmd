```{r echo = FALSE}
pacman::p_load(tidyverse, readxl, knitr, kableExtra, Hmisc)
```

# Der diagnostische Test

::: callout-note
## Was macht der $\mathcal{X}^2$-Test?

Ein $\mathcal{X}^2$-Test vergleicht die Anteile zweier Gruppen.
:::

::: callout-tip
## Einführung in den $\mathcal{X}^2$-Test per Video

Du findest auf YouTube [Der Chi-Quadrat-Test erklärt](https://youtu.be/B6YNtxBsK3c) als Video Reihe. Ich werde zwar alles nochmal hier als Text aufschreiben, aber manchmal ist das Sehen und Hören dann einfacher.
:::

Der

::: {.callout-caution collapse="true"}
## Ein Wort zur Klausur

Wir rechnen den $\mathcal{X}^2$-Test per Hand in der Klausur. Teilweise füllen wir die $2x2$ Tabelle aus, teilweise berechnen wir nur die Randsummen.

Bitte schau dir die Aufgaben in den [gesammelten Klausurfragen auf GitHub](https://github.com/jkruppa/teaching/tree/main/Klausur) an um eine Idee zu haben, welche Fragen zum Wilcoxon-Mann-Whitney-Test drankommen.

Wenn kein $\chi^2_{\alpha=5\%}$ in der Klausur gegeben ist, setzen wir $\chi^2_{\alpha=5\%} = 3.84$.
:::

## Genutzte R Pakete für das Kapitel

Wir wollen folgende R Pakete in diesem Kapitel nutzen.

```{r echo = TRUE}
pacman::p_load(tidyverse, magrittr)
```

Am Ende des Kapitels findest du nochmal den gesamten R Code in einem Rutsch zum selber durchführen oder aber kopieren.

## Diagnostisches Testen

|          |           |                   |                   |                |
|:--------:|:---------:|:-----------------:|:-----------------:|:--------------:|
|          |           |     **Krank**     |                   |                |
|          |           |     $K^+$ (1)     |     $K^-$ (0)     |                |
| **Test** | $T^+$ (1) | $TP_{\;\Large a}$ | $FN_{\;\Large b}$ | $\mathbf{a+b}$ |
|          | $T^-$ (0) | $FP_{\;\Large c}$ | $TN_{\;\Large d}$ | $\mathbf{c+d}$ |
|          |           |  $\mathbf{a+c}$   |  $\mathbf{b+d}$   |  $\mathbf{n}$  |

: Eine 2x2 Tabelle oder Vierfeldertafel {#tbl-2x2-table-general}

Das ist ein Text @tbl-2x2-table-general

|          |           |                      |                       |                       |
|:--------:|:---------:|:--------------------:|:---------------------:|:---------------------:|
|          |           |      **Krank**       |                       |                       |
|          |           |      $K^+$ (1)       |       $K^-$ (0)       |                       |
| **Test** | $T^+$ (1) |         160          |          931          | $\mathbf{a+b} = 1091$ |
|          | $T^-$ (0) |          40          |         8869          | $\mathbf{c+d} = 8109$ |
|          |           | $\mathbf{a+c} = 200$ | $\mathbf{b+d} = 9800$ | $\mathbf{n} = 10000$  |

: Eine 2x2 Tabelle oder Vierfeldertafel {#tbl-2x2-table-example}

::: column-page
![Visualisierung der Korrelation.](images/diag_testen_dist.png){#fig-stat-diag-00 fig-align="center" width="80%"}
:::

::: column-page
![Visualisierung der Korrelation.](images/diag_testen_doppel.png){#fig-stat-diag-01 fig-align="center" width="80%"}
:::

$T^+$ mit der Erkrankung ist 80%

$T^+$ ohne der Erkrankung liegt bei 95%

2% Prävalenz der Erkrankung in der betrachteten Population

$Pr(K^+|T^+)$ die Wahrscheinlichkeit krank zu sein gegeben eines positiven Tests

## Confusion matrix (deu. *Fehlermatrix*)

::: column-margin
[Confusion matrix](https://en.wikipedia.org/wiki/Confusion_matrix)
:::

$$
\mbox{Sensitivität} = \mbox{sens} = \cfrac{TP}{TP + FN} = \cfrac{160}{160 + 931} = 0.147
$$

$$
\mbox{Spezifität} = \mbox{spec} = \cfrac{TN}{TN + FP} = \cfrac{8869}{8869 + 40} = 0.995
$$

$$
\mbox{Positiver Vorhersagewert} = \mbox{PPV} = \cfrac{TP}{TP + FP} = \cfrac{160}{160 + 40} = 0.800
$$

$$
\mbox{Negativer Vorhersagewert} = \mbox{NPV} = \cfrac{TN}{TN + FN} = \cfrac{8869}{8869 + 931} = 0.905
$$
