# Mit `purrr` und `furrr` {#sec-purrr-furrr}

*Version vom `r format(Sys.time(), '%B %d, %Y um %H:%M:%S')`*

![](images/caution.png){fig-align="center" width="50%"}

::: callout-caution
## Was soll das hier? Ziemlich wild alles...

Dieses Kapitel dient dazu *fortgeschrittene* Programmierung in R zu präsentieren. Teilweise nutze ich komplexeren Code bei der Auswertung von den Beispielen in @sec-beispiel-auswertung. Wenn dich also Programmieren interessiert, dann kannst du dir hier noch was anschauen.
:::

## Genutzte R Pakete

Wir wollen folgende R Pakete in diesem Kapitel nutzen.

```{r echo = TRUE}
#| message: false
pacman::p_load(tidyverse, tidymodels, magrittr, 
               janitor, purrr, furrr, see,
               readxl, tictoc, conflicted)
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("mutate", "dplyr")
conflict_prefer("extract", "magrittr")

```

Am Ende des Kapitels findest du nochmal den gesamten R Code in einem Rutsch zum selber durchführen oder aber kopieren.

## Mit `purrr` über Listen {#sec-purrr}

[Iteration](https://r4ds.had.co.nz/iteration.html#iteration)

[R Paket purrr](https://purrr.tidyverse.org/)

## Mit `furrr` parallel über Listen {#sec-furrr}

[R Paket furrr](https://furrr.tidyverse.org/)

```{r}
no_cores <- availableCores() - 1
no_cores
```

```{r}
plan(sequential)

tic()
nothingness <- future_map(c(2, 2, 2), ~Sys.sleep(.x))
toc()
```

Der folgende Code sollte ca. 2 Sekunden dauern, wenn der Code parallel läuft. Wir haben einen kleinen Overhead in `future_map()` durch das Senden von Daten an die einzelnen Kerne. Es gibt auch einmalige Zeitkosten für `plan(multisession)`, um die Kerne einzurichten.

```{r}
plan(multisession, workers = 3)

tic()
nothingness <- future_map(c(2, 2, 2), ~Sys.sleep(.x))
toc()
```

## Mit `modify()` modifizieren

[Modify elements selectively](https://purrr.tidyverse.org/reference/modify.html)

## progressr: An Introduction

[progressr: An Introduction](https://cran.r-project.org/web/packages/progressr/vignettes/progressr-intro.html)
